{"version":3,"file":"community.v2.min.js","sources":["../../../node_modules/tslib/tslib.es6.js","../../../js/data_handler/export_params.ts","../../../js/data_handler/checks.ts","../../../js/data_handler/filter_check.ts","../../../js/data_handler/patterns.ts","../../../js/data_handler/row_writers.ts","../../../js/data_handler/exporter.ts","../../../js/data_handler/retrievers.ts","../../../js/data_handler/formatters.ts","../../../js/data_handler/ingesters.ts","../../../js/data_handler/summary.ts","../../../js/data_handler/mappers.ts","../../../js/data_handler/parsers.ts","../../../js/data_handler/index.ts","../../../js/site/defaults.ts","../../../js/site/global_view.ts","../../../js/site/patterns.ts","../../../js/site/storage.ts","../../../js/site/subscriptions.ts","../../../js/site/static_refs.ts","../../../js/site/utils.ts","../../../js/site/conditionals.ts","../../../js/site/palettes.ts","../../../js/site/inputs/index.ts","../../../js/site/common_methods.ts","../../../js/site/time_funs.ts","../../../js/site/dataview.ts","../../../js/site/inputs/combobox.ts","../../../js/site/tutorials.ts","../../../js/site/page.ts","../../../js/site/inputs/virtual.ts","../../../js/site/value_types.ts","../../../js/site/outputs/index.ts","../../../js/site/outputs/info.ts","../../../js/site/outputs/legend.ts","../../../js/site/index.ts","../../../js/site/inputs/button.ts","../../../js/site/inputs/buttongroup.ts","../../../js/site/inputs/select.ts","../../../js/site/inputs/number.ts","../../../js/site/inputs/radio.ts","../../../js/site/inputs/switch.ts","../../../js/site/inputs/checkbox.ts","../../../js/site/inputs/text.ts","../../../js/site/outputs/map.ts","../../../js/site/outputs/plotly.ts","../../../js/site/outputs/datatables.ts","../../../js/site/outputs/table.ts","../../../js/site/outputs/text.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    function next() {\r\n        while (env.stack.length) {\r\n            var rec = env.stack.pop();\r\n            try {\r\n                var result = rec.dispose && rec.dispose.call(rec.value);\r\n                if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n};\r\n","import {UnparsedObject} from '../types'\r\n\r\nexport const defaults: UnparsedObject = {\r\n  file_format: 'csv',\r\n  table_format: 'mixed',\r\n  features: {ID: 'id', Name: 'name'},\r\n  feature_conditions: [],\r\n  variables: {\r\n    filter_by: [],\r\n    conditions: [],\r\n  },\r\n}\r\n\r\nexport const options: {[index: string]: string[]} = {\r\n  file_format: ['csv', 'tsv'],\r\n  table_format: ['tall', 'mixed', 'wide'],\r\n  filter_components: ['first', 'min', 'mean', 'sum', 'max', 'last'],\r\n}\r\n","import {options} from './export_params'\r\n\r\nexport const group_checks: {[index: string]: Function} = {\r\n  '!': function (this: number, v: number): boolean {\r\n    return this !== v\r\n  },\r\n  '=': function (this: number, v: number): boolean {\r\n    return this === v\r\n  },\r\n  includes: function (v: number): boolean {\r\n    return -1 !== this.indexOf(v)\r\n  },\r\n  excludes: function (v: number): boolean {\r\n    return -1 === this.indexOf(v)\r\n  },\r\n}\r\n\r\nexport const export_checks: {[index: string]: Function} = {\r\n  file_format: function (a: string): boolean {\r\n    return -1 === options.file_format.indexOf(a)\r\n  },\r\n  table_format: function (a: string): boolean {\r\n    return -1 === options.table_format.indexOf(a)\r\n  },\r\n  include: function (a: string, vars: {[index: string]: string}): string {\r\n    for (let i = a.length; i--; ) {\r\n      if (!(a[i] in vars)) return a[i]\r\n    }\r\n    return ''\r\n  },\r\n}\r\n\r\nexport const value_checks: {[index: string]: Function} = {\r\n  '!': function (a: number): boolean {\r\n    return !a || -1 == a\r\n  },\r\n  '': function (a: number): boolean {\r\n    return !!a && -1 != a\r\n  },\r\n  '=': function (a: number, b: number): boolean {\r\n    return a === b\r\n  },\r\n  '!=': function (a: number, b: number): boolean {\r\n    return a != b\r\n  },\r\n  '>': function (a: number, b: number): boolean {\r\n    return a > b\r\n  },\r\n  '<': function (a: number, b: number): boolean {\r\n    return a < b\r\n  },\r\n  '>=': function (a: number, b: number): boolean {\r\n    return a >= b\r\n  },\r\n  '<=': function (a: number, b: number): boolean {\r\n    return a <= b\r\n  },\r\n  equals: function (s: number, e: string | number): boolean {\r\n    return !s || -1 == s || s === e\r\n  },\r\n  includes: function (s: (string | number)[], e: string | number): boolean {\r\n    return !s || !s.length || -1 !== s.indexOf(e)\r\n  },\r\n  excludes: function (s: (string | number)[], e: string | number): boolean {\r\n    return !s || !s.length || -1 === s.indexOf(e)\r\n  },\r\n}\r\n","import {Filter, VariableFilter, Variables, VectorSummary, Entity} from '../types'\r\n\r\nfunction vector_summary(vec: number | number[], range: number[]): VectorSummary {\r\n  if (Array.isArray(vec)) {\r\n    const n = Math.min(range[1] + 1, vec.length),\r\n      r: VectorSummary = {\r\n        missing: 0,\r\n        first: vec[0],\r\n        min: Infinity,\r\n        mean: 0,\r\n        sum: 0,\r\n        max: -Infinity,\r\n        last: vec[n - 1],\r\n      }\r\n    let on = 0\r\n    for (let i = Math.max(range[0], 0); i < n; i++) {\r\n      const v = vec[i]\r\n      if ('number' === typeof v) {\r\n        if (isNaN(v)) {\r\n          r.missing++\r\n        } else {\r\n          on++\r\n          if (r.min > v) r.min = v\r\n          if (r.max < v) r.max = v\r\n          r.sum += v\r\n        }\r\n      } else {\r\n        if ('NA' !== v) on++\r\n      }\r\n    }\r\n    r.mean = on ? r.sum / on : 0\r\n    return r\r\n  } else {\r\n    return {missing: Number(isNaN(vec)) + 0, first: vec, min: vec, mean: vec, sum: vec, max: vec, last: vec}\r\n  }\r\n}\r\n\r\nexport function passes_filter(\r\n  entity: Entity,\r\n  time_range: number[],\r\n  filter: VariableFilter,\r\n  variables: Variables\r\n): boolean {\r\n  const s: {[index: string]: VectorSummary} = {},\r\n    adjs: {[index: string]: number} = {}\r\n  for (let i = filter.filter_by.length; i--; ) {\r\n    const f = filter.filter_by[i]\r\n    const c = variables[f].code\r\n    if (!(c in entity.data)) return false\r\n    const r =\r\n      entity.group in variables[f].info\r\n        ? variables[f].info[entity.group].time_range\r\n        : variables[f].time_range[entity.group]\r\n    if (!r) return false\r\n    adjs[f] = r[0]\r\n    s[f] = vector_summary(entity.data[c], [time_range[0] - r[0], Math.max(time_range[1] - r[0], time_range[1] - r[1])])\r\n  }\r\n  for (let i = filter.conditions.length; i--; ) {\r\n    const co = filter.conditions[i]\r\n    if (\r\n      !(co.time_component ? co.check(entity.data[variables[co.name].code], adjs[co.name] || 0) : co.check(s[co.name]))\r\n    )\r\n      return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport function passes_feature_filter(entities: {[index: string]: Entity}, id: string, filter: Filter[]): boolean {\r\n  const entity = entities[id]\r\n  for (let i = filter.length; i--; ) {\r\n    const value = filter[i].value\r\n    if (value !== '-1') {\r\n      if ('id' === filter[i].name && Array.isArray(value)) {\r\n        let pass = false\r\n        value.forEach((id: string) => {\r\n          if (!pass) {\r\n            const group = id in entities && entities[id].group\r\n            if (\r\n              group && group in entity.features\r\n                ? id === entity.features[group]\r\n                : id.length < entity.features.id.length\r\n                ? id === entity.features.id.substring(0, id.length)\r\n                : id === entity.features.id\r\n            )\r\n              pass = true\r\n          }\r\n        })\r\n        return pass\r\n      } else if (!filter[i].check(entity.features[filter[i].name])) return false\r\n    }\r\n  }\r\n  return true\r\n}\r\n","export const patterns: {[index: string]: RegExp} = {\r\n  seps: /[\\s._-]/g,\r\n  comma: /,/,\r\n  word_start: /\\b(\\w)/g,\r\n  single_operator: /([<>!])([^=])/,\r\n  greater: /%3E$/,\r\n  less: /%3C$/,\r\n  operator_start: /[<>!]$/,\r\n  component: /^(.+)\\[(.+)\\]/,\r\n  number: /^[0-9.+-]+$/,\r\n  non_letter_num: /[^0-9a-z]+/g,\r\n}\r\n","import DataHandler from './index'\r\nimport {Entity, Features} from '../types'\r\n\r\nexport function tall(\r\n  this: DataHandler,\r\n  entity: Entity,\r\n  time_range: number[],\r\n  feats: Features,\r\n  vars: string[],\r\n  sep: string\r\n): string {\r\n  if (entity.group in this.meta.times) {\r\n    const op: string[] = [],\r\n      time = this.meta.times[entity.group].value as number[]\r\n    let tr = ''\r\n    Object.keys(feats).forEach(f => {\r\n      tr += '\"' + entity.features[feats[f]] + '\"' + sep\r\n    })\r\n    vars.forEach(k => {\r\n      const vc = entity.variables[k].code\r\n      if (vc in entity.data) {\r\n        const range: [number, number] = this.meta.variables[entity.group][k].time_range\r\n        let r = ''\r\n        const yn = time_range[1] + 1\r\n        for (let y = time_range[0]; y < yn; y++) {\r\n          if (y >= range[0] && y <= range[1]) {\r\n            const vec = entity.data[vc]\r\n            const value = Array.isArray(vec) ? vec[y - range[0]] : vec\r\n            if (!isNaN(value)) {\r\n              r += (r ? '\\n' : '') + tr + time[y] + sep + '\"' + k + '\"' + sep + value\r\n            }\r\n          }\r\n        }\r\n        if (r) op.push(r)\r\n      }\r\n    })\r\n    return op.join('\\n')\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function mixed(\r\n  this: DataHandler,\r\n  entity: Entity,\r\n  time_range: number[],\r\n  feats: Features,\r\n  vars: string[],\r\n  sep: string\r\n): string {\r\n  if (entity.group in this.meta.times) {\r\n    const op: string[] = [],\r\n      time = this.meta.times[entity.group].value as number[]\r\n    let tr = ''\r\n    Object.keys(feats).forEach(f => {\r\n      tr += '\"' + entity.features[feats[f]] + '\"' + sep\r\n    })\r\n    const yn = time_range[1] + 1\r\n    for (let y = time_range[0]; y < yn; y++) {\r\n      let r = tr + time[y]\r\n      vars.forEach((k: string) => {\r\n        const vc = entity.variables[k].code\r\n        if (vc in entity.data) {\r\n          const trange = this.meta.variables[entity.group][k].time_range\r\n          const vec = entity.data[vc]\r\n          let value = NaN\r\n          if (Array.isArray(vec)) {\r\n            if (y >= trange[0] && y <= trange[1]) value = vec[y - trange[0]]\r\n          } else if (y === trange[0]) {\r\n            value = vec\r\n          }\r\n          r += sep + (isNaN(value) ? 'NA' : value)\r\n        } else r += sep + 'NA'\r\n      })\r\n      op.push(r)\r\n    }\r\n    return op.join('\\n')\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function wide(\r\n  this: DataHandler,\r\n  entity: Entity,\r\n  time_range: number[],\r\n  feats: Features,\r\n  vars: string[],\r\n  sep: string\r\n): string {\r\n  if (entity.group in this.meta.times) {\r\n    let r = ''\r\n    Object.keys(feats).forEach(f => {\r\n      r += (r ? sep : '') + '\"' + entity.features[feats[f]] + '\"'\r\n    })\r\n    vars.forEach(k => {\r\n      const vc = entity.variables[k].code\r\n      const range: [number, number] = this.meta.ranges[k]\r\n      const trange: [number, number] = this.meta.variables[entity.group][k].time_range\r\n      const yn = time_range[1] + 1\r\n      for (let y = time_range[0]; y < yn; y++) {\r\n        if (y >= range[0] && y <= range[1]) {\r\n          if (vc in entity.data) {\r\n            const vec = entity.data[vc]\r\n            let value = NaN\r\n            if (Array.isArray(vec)) {\r\n              if (y >= trange[0] && y <= trange[1]) value = vec[y - trange[0]]\r\n            } else if (y === trange[0]) {\r\n              value = vec\r\n            }\r\n            r += sep + (isNaN(value) ? 'NA' : value)\r\n          } else r += sep + 'NA'\r\n        }\r\n      }\r\n    })\r\n    return r\r\n  }\r\n  return ''\r\n}\r\n","import * as params from './export_params'\r\nimport {group_checks, export_checks} from './checks'\r\nimport {passes_filter, passes_feature_filter} from './filter_check'\r\nimport {patterns} from './patterns'\r\nimport * as row_writers from './row_writers'\r\nimport type {Query, Entity, Features, Entities, RawQuery} from '../types'\r\nimport DataHandler from './index'\r\n\r\nexport async function exporter(\r\n  this: DataHandler,\r\n  query_string?: RawQuery,\r\n  entities?: Entities,\r\n  in_browser?: boolean,\r\n  all_data?: boolean\r\n) {\r\n  if (!in_browser) await this.data_ready\r\n  const query: Query = this.parse_query(query_string)\r\n  entities = entities || this.entities\r\n  if (-1 === params.options.file_format.indexOf(query.file_format)) query.file_format = params.defaults.file_format\r\n  if (!(query.table_format in row_writers)) query.table_format = params.defaults.table_format\r\n  const res = {\r\n      statusCode: 400,\r\n      headers: {'Content-Type': 'text/plain; charset=utf-8', 'Content-Disposition': 'attachment; filename='},\r\n      body: 'Invalid Request',\r\n    },\r\n    inc: string[] =\r\n      query.include && query.include.length\r\n        ? 'string' === typeof query.include\r\n          ? query.include in this.variables\r\n            ? [query.include]\r\n            : query.include.split(',')\r\n          : query.include\r\n        : Object.keys(this.variables),\r\n    exc = query.exclude || [],\r\n    vars: string[] = [],\r\n    feats: Features = query.features || JSON.parse(JSON.stringify(params.defaults.features)),\r\n    rows: string[] = [],\r\n    range = [Infinity, -Infinity],\r\n    sep = 'csv' === query.file_format ? ',' : '\\t',\r\n    rw: Function = row_writers[query.table_format].bind(this),\r\n    no_filter = !query.variables.filter_by.length,\r\n    no_feature_filter = !query.feature_conditions.length,\r\n    in_group: Function = !('dataset' in query)\r\n      ? () => true\r\n      : group_checks[query.dataset.operator].bind(query.dataset.value)\r\n  let malformed = ''\r\n  inc.forEach(ii => {\r\n    if (ii in this.features && !(ii in feats)) {\r\n      feats[ii] = this.format_label(ii)\r\n    } else if (!(ii in this.variables)) {\r\n      malformed += ii + ','\r\n      if (malformed in this.variables) {\r\n        inc.push(malformed)\r\n        malformed = ''\r\n      }\r\n    }\r\n  })\r\n  for (const k in export_checks)\r\n    if (k in query) {\r\n      const r: string = export_checks[k]('include' === k ? inc : query[k as keyof Query], this.variables)\r\n      if (r) {\r\n        res.body = 'Failed check for ' + k + ': ' + r\r\n        return res\r\n      }\r\n    }\r\n  Object.keys(this.variable_codes).forEach(k => {\r\n    if (-1 !== inc.indexOf(this.variable_codes[k].name) && -1 === exc.indexOf(this.variable_codes[k].name)) {\r\n      vars.push(this.variable_codes[k].name)\r\n      const tr: [number, number] = this.meta.ranges[this.variable_codes[k].name]\r\n      if (tr[0] < range[0]) range[0] = tr[0]\r\n      if (tr[1] > range[1]) range[1] = tr[1]\r\n    }\r\n  })\r\n  if (query.time_range[0] < range[0]) query.time_range[0] = range[0]\r\n  if (query.time_range[1] > range[1]) query.time_range[1] = range[1]\r\n  rows.push(Object.keys(feats).join(sep))\r\n  if ('wide' === query.table_format) {\r\n    vars.forEach(vi => {\r\n      const tr: [number, number] = this.meta.ranges[vi],\r\n        yn = Math.min(query.time_range[1], tr[1]) + 1\r\n      for (let y = Math.max(query.time_range[0], tr[0]); y < yn; y++) {\r\n        rows[0] += sep + '\"' + vi + '_' + this.meta.overall.value[y] + '\"'\r\n      }\r\n    })\r\n  } else\r\n    rows[0] +=\r\n      sep +\r\n      'time' +\r\n      sep +\r\n      ('mixed' === query.table_format ? vars.map(n => '\"' + n + '\"') : ['variable', 'value']).join(sep)\r\n  let first_entity = ''\r\n  Object.keys(entities).forEach(k => {\r\n    const e: Entity = entities[k]\r\n    if (\r\n      in_group(e.group) &&\r\n      (no_feature_filter || passes_feature_filter(entities, k, query.feature_conditions)) &&\r\n      (no_filter || passes_filter(e, query.time_range, query.variables, this.variables))\r\n    ) {\r\n      const r: string = rw(e, query.time_range, feats, vars, sep)\r\n      if (r) {\r\n        if (!first_entity) first_entity = k\r\n        rows.push(r)\r\n      }\r\n    }\r\n  })\r\n  res.headers['Content-Type'] = 'text/' + (',' === sep ? 'csv' : 'plain') + '; charset=utf-8'\r\n  res.body = rows.join('\\n')\r\n  const times: number[] = this.meta.overall.value,\r\n    filename =\r\n      'export_' +\r\n      (in_browser && !all_data && first_entity\r\n        ? entities[first_entity].group + '_'\r\n        : query.dataset\r\n        ? query.dataset.value + '_'\r\n        : '') +\r\n      (query.time_range[0] === query.time_range[1]\r\n        ? times[query.time_range[0]]\r\n        : times[query.time_range[0]] + '-' + times[query.time_range[1]]) +\r\n      '_' +\r\n      (1 === vars.length\r\n        ? this.variables[vars[0]].meta.short_name.toLowerCase().replace(patterns.non_letter_num, '-')\r\n        : vars.length + '-variables') +\r\n      '_' +\r\n      (rows.join('\\n').split('\\n').length - 1) +\r\n      'x' +\r\n      rows[0].split(sep).length\r\n  if (in_browser) {\r\n    const e = document.createElement('a')\r\n    document.body.appendChild(e)\r\n    e.rel = 'noreferrer'\r\n    e.target = '_blank'\r\n    e.download = filename + '.' + query.file_format\r\n    e.href = URL.createObjectURL(new Blob([res.body], {type: res.headers['Content-Type']}))\r\n    setTimeout(function () {\r\n      e.dispatchEvent(new MouseEvent('click'))\r\n      URL.revokeObjectURL.bind(null, e.href)\r\n      document.body.removeChild(e)\r\n    }, 0)\r\n  }\r\n  res.statusCode = 200\r\n  res.headers['Content-Disposition'] += filename + '.' + query.file_format\r\n  return res\r\n}\r\n","import {Entity} from '../types'\r\n\r\nexport function single(this: Entity, v: string, t: number) {\r\n  if (t < 0) return NaN\r\n  if (this.variables[v].is_time) {\r\n    return Array.isArray(this.time.value) && t < this.time.value.length ? this.time.value[t] : NaN\r\n  } else {\r\n    v = this.variables[v].code\r\n    return 0 === t && v in this.data ? this.data[v] : NaN\r\n  }\r\n}\r\n\r\nexport function multi(this: Entity, v: string, t: number) {\r\n  if (t < 0) return NaN\r\n  if (this.variables[v].is_time) {\r\n    return Array.isArray(this.time.value) ? this.time.value[t] : this.time.value\r\n  } else {\r\n    v = this.variables[v].code\r\n    const value = this.data[v]\r\n    return v in this.data ? (Array.isArray(value) ? (t < value.length ? value[t] : NaN) : 0 === t ? value : NaN) : NaN\r\n  }\r\n}\r\n\r\nexport function row_time(\r\n  this: {i: number; o: number; format_value: Function},\r\n  d: number[],\r\n  type: string,\r\n  row: {offset: number; int: boolean}\r\n) {\r\n  const i = this.i - (row.offset - this.o)\r\n  return d && i >= 0 && i < d.length ? ('number' === typeof d[i] ? this.format_value(d[i], row.int) : d[i]) : NaN\r\n}\r\n","import DataHandler from './index'\r\nimport {Settings} from '../types'\r\nimport {patterns} from './patterns'\r\n\r\nexport function value(this: {settings: Settings}, v: null | number, int?: boolean): number | string {\r\n  if (null === v || isNaN(v)) {\r\n    return NaN\r\n  } else if (int) {\r\n    return v\r\n  } else {\r\n    return 'number' !== typeof this.settings.settings.digits\r\n      ? v\r\n      : v.toFixed(this.settings.settings.digits > 0 ? this.settings.settings.digits : 0)\r\n  }\r\n}\r\n\r\nexport function label(this: DataHandler, l: string): string {\r\n  return 'string' !== typeof l\r\n    ? ''\r\n    : l in this.variables && this.variables[l].meta && this.variables[l].meta.short_name\r\n    ? this.variables[l].meta.short_name\r\n    : l.replace(patterns.seps, ' ').replace(patterns.word_start, function (w) {\r\n        return w.toUpperCase()\r\n      })\r\n}\r\n","import DataHandler from './index'\r\nimport type {Data, EntityFeatureSet, EntityFeatures, IdMap} from '../types'\r\n\r\nexport function data(this: DataHandler, d: Data, name: string) {\r\n  this.sets[name] = d\r\n  this.loaded[name] = true\r\n  if (!(name in this.info)) this.info[name] = {name: name, site_file: name + '.json', schema: {fields: []}, ids: []}\r\n  if ('_meta' in d) {\r\n    const time = d._meta.time\r\n    this.meta.times[name] = time\r\n    if ('number' === typeof time.value) time.value = [time.value as number]\r\n    const times = time.value as number[]\r\n    time.n = times.length\r\n    time.is_single = 1 === time.n\r\n    time.range = [times[0], times[time.n - 1]]\r\n    if (d._meta.time.name in this.variables) {\r\n      time.info = this.variables[time.name]\r\n      time.info.is_time = true\r\n    }\r\n    if (time.range[0] < this.meta.overall.range[0]) this.meta.overall.range[0] = time.range[0]\r\n    if (time.range[1] > this.meta.overall.range[1]) this.meta.overall.range[1] = time.range[1]\r\n    times.forEach((v: number) => {\r\n      if (-1 === this.meta.overall.value.indexOf(v)) this.meta.overall.value.push(v)\r\n    })\r\n    this.meta.overall.value.sort()\r\n    this.meta.variables[name] = d._meta.variables || {}\r\n    Object.keys(this.meta.variables[name]).forEach((k: string) => {\r\n      if (!(k in this.variables)) {\r\n        this.variables[k] = {\r\n          datasets: [name],\r\n          info: {},\r\n          time_range: {},\r\n          type: 'unknown',\r\n          name: k,\r\n          code: k,\r\n          views: {},\r\n          meta: {\r\n            full_name: k,\r\n            measure: k.split(':')[1] || k,\r\n            short_name: this.format_label(k),\r\n            long_name: k,\r\n            type: 'unknown',\r\n          },\r\n        }\r\n        this.variable_info[k] = this.variables[k].meta\r\n      }\r\n      this.variables[k].name = k\r\n      this.variables[k].code = this.meta.variables[name][k].code\r\n      const t = this.meta.variables[name][k].time_range\r\n      this.variables[k].time_range[name] = t\r\n      this.variable_codes[this.variables[k].code] = this.variables[k]\r\n      if (-1 !== t[0]) {\r\n        if (k in this.meta.ranges) {\r\n          if (t[0] < this.meta.ranges[k][0]) this.meta.ranges[k][0] = t[0]\r\n          if (t[1] > this.meta.ranges[k][1]) this.meta.ranges[k][1] = t[1]\r\n        } else {\r\n          this.meta.ranges[k] = [t[0], t[1]]\r\n        }\r\n      }\r\n    })\r\n  }\r\n  this.load_id_maps()\r\n}\r\n\r\nexport async function id_maps(this: DataHandler) {\r\n  this.metadata.datasets &&\r\n    this.metadata.datasets.forEach((k: string) => {\r\n      let has_map = false\r\n      k in this.info &&\r\n        this.info[k].ids.forEach((id: IdMap, i: number) => {\r\n          if ('map' in id) {\r\n            has_map = true\r\n            const map = id.map\r\n            if (map in this.data_maps) {\r\n              if (this.data_maps[map].retrieved) {\r\n                const features = (\r\n                  k in this.data_maps[map].resource ? this.data_maps[map].resource[k] : this.data_maps[map].resource\r\n                ) as EntityFeatures\r\n                this.info[k].schema.fields[i].ids = this.entity_features[k] = features\r\n                this.map_entities(k)\r\n              } else {\r\n                const queue = this.data_maps[map].queue as string[]\r\n                if (-1 === queue.indexOf(k)) queue.push(k)\r\n              }\r\n            } else if ('string' !== typeof map || id.map_content) {\r\n              if ('string' === typeof map) {\r\n                this.data_maps[map] = {queue: [], resource: JSON.parse(id.map_content), retrieved: true}\r\n                const features = (\r\n                  k in this.data_maps[map].resource ? this.data_maps[map].resource[k] : this.data_maps[map].resource\r\n                ) as EntityFeatures\r\n                this.info[k].schema.fields[i].ids = this.entity_features[k] = features\r\n              } else {\r\n                this.entity_features[k] = map\r\n              }\r\n              this.map_entities(k)\r\n            } else {\r\n              this.data_maps[map] = {queue: [k], resource: {}, retrieved: false}\r\n              if (this.settings.entity_info && map in this.settings.entity_info) {\r\n                const e = this.settings.entity_info\r\n                if ('string' === typeof e[map]) e[map] = JSON.parse(e[map] as string)\r\n                this.ingest_map(e[map] as EntityFeatures, map, i)\r\n              } else if ('undefined' === typeof window) {\r\n                require('https')\r\n                  .get(map, (r: {req: {protocol: string; host: string; path: string}; on: Function}) => {\r\n                    const c: string[] = []\r\n                    r.on('data', (d: string) => {\r\n                      c.push(d)\r\n                    })\r\n                    r.on('end', () => {\r\n                      this.ingest_map(JSON.parse(c.join('')), r.req.protocol + '//' + r.req.host + r.req.path, i)\r\n                    })\r\n                  })\r\n                  .end()\r\n              } else {\r\n                const f = new window.XMLHttpRequest()\r\n                f.onreadystatechange = function (this: DataHandler, url: string, fi: number) {\r\n                  if (4 === f.readyState) {\r\n                    if (200 === f.status) {\r\n                      this.ingest_map(JSON.parse(f.responseText), url, fi)\r\n                    } else {\r\n                      throw new Error('data_handler.ingester.id_maps failed: ' + f.responseText)\r\n                    }\r\n                  }\r\n                }.bind(this, map, i)\r\n                f.open('GET', map, true)\r\n                f.send()\r\n              }\r\n            }\r\n          }\r\n        })\r\n      if (!has_map) {\r\n        this.entity_features[k] = {}\r\n        this.map_entities(k)\r\n      }\r\n    })\r\n}\r\n\r\nexport function map(this: DataHandler, m: EntityFeatures | EntityFeatureSet, url: string, field: number) {\r\n  this.data_maps[url].resource = m\r\n  this.data_maps[url].retrieved = true\r\n  this.data_maps[url].queue.forEach((k: string) => {\r\n    if (this.info[k].schema.fields.length > field) {\r\n      if (!(k in this.entity_features)) this.entity_features[k] = {}\r\n      const features = (\r\n        k in this.data_maps[url].resource ? this.data_maps[url].resource[k] : this.data_maps[url].resource\r\n      ) as EntityFeatures\r\n      this.info[k].schema.fields[field].ids = this.entity_features[k] = features\r\n      this.map_entities(k)\r\n    }\r\n  })\r\n  this.hooks.data_load && this.hooks.data_load()\r\n}\r\n","import DataHandler from './index'\r\nimport type {Order, Data, Variable, VariableView, EntityData, Summary, MeasureInfo} from '../types'\r\nimport {DataViewSelection, SiteDataView} from '../site/dataview'\r\n\r\nfunction sort_a1(a: [string, number], b: [string, number]): number {\r\n  return isNaN(a[1]) ? (isNaN(b[1]) ? 0 : -1) : isNaN(b[1]) ? 1 : a[1] - b[1]\r\n}\r\n\r\nfunction summary_template(): Summary {\r\n  return {\r\n    type: 'number',\r\n    filled: false,\r\n    missing: [],\r\n    n: [],\r\n    sum: [],\r\n    max: [],\r\n    q3: [],\r\n    mean: [],\r\n    range: [],\r\n    norm_median: [],\r\n    break_median: [],\r\n    lower_median_min: [],\r\n    lower_median_range: [],\r\n    upper_median_min: [],\r\n    upper_median_range: [],\r\n    norm_mean: [],\r\n    break_mean: [],\r\n    lower_mean_min: [],\r\n    lower_mean_range: [],\r\n    upper_mean_min: [],\r\n    upper_mean_range: [],\r\n    median: [],\r\n    q1: [],\r\n    min: [],\r\n    mode: [],\r\n    level_ids: {},\r\n    levels: [],\r\n  }\r\n}\r\n\r\nexport function init(this: DataHandler, v: string, d: string) {\r\n  if (!this.inited_summary[d + v]) {\r\n    this.settings.view_names.forEach((view: string) => {\r\n      const vi: Variable = this.variables[v]\r\n      if (!(view in vi.views))\r\n        vi.views[view] = {\r\n          order: {},\r\n          selected_order: {},\r\n          selected_summaries: {},\r\n          summaries: {},\r\n          state: {},\r\n          table: {},\r\n        }\r\n      if (!(d in vi.time_range)) {\r\n        vi.time_range[d] = [0, this.meta.times[d].n - 1]\r\n      }\r\n      const ny = (vi.time_range[d][2] = vi.time_range[d][1] - vi.time_range[d][0] + 1)\r\n      const m: VariableView = vi.views[view],\r\n        c = vi.code\r\n      if (d in this.sets) {\r\n        const da: Data = this.sets[d]\r\n        const n: number = this.info[d].entity_count\r\n        const at = !n || n > 65535 ? Uint32Array : n > 255 ? Uint16Array : Uint8Array\r\n        const info = vi.info[d]\r\n        const is_string = 'string' === info.type\r\n        let o = info.order\r\n        if (o) {\r\n          Object.keys(da).forEach((k: string) => {\r\n            if (!(k in this.entities)) return\r\n            if (!(view in this.entities[k].views))\r\n              this.entities[k].views[view] = {summary: {}, rank: {}, subset_rank: {}}\r\n            this.entities[k].views[view].rank[v] = new at(ny)\r\n            this.entities[k].views[view].subset_rank[v] = new at(ny)\r\n          })\r\n        } else {\r\n          info.order = o = []\r\n          for (let y = ny; y--; ) {\r\n            o.push([])\r\n          }\r\n          Object.keys(da).forEach((k: string) => {\r\n            const dak = da[k] as EntityData\r\n            if ('_meta' !== k && c in dak) {\r\n              const ev: number | number[] = dak[c]\r\n              if (Array.isArray(ev)) {\r\n                for (let y = ny; y--; ) {\r\n                  if (is_string && ev[y] in vi.level_ids) {\r\n                    ev[y] = vi.level_ids[ev[y]]\r\n                  } else if ('number' !== typeof ev[y]) ev[y] = NaN\r\n                  o[y].push([k, ev[y]])\r\n                }\r\n                Object.freeze(ev)\r\n              } else {\r\n                if (is_string && ev in vi.level_ids) {\r\n                  o[0].push([k, vi.level_ids[ev]])\r\n                } else if ('number' !== typeof ev) {\r\n                  dak[c] = NaN\r\n                  o[0].push([k, NaN])\r\n                } else o[0].push([k, ev])\r\n              }\r\n              if (!(k in this.entities)) return\r\n              if (!(view in this.entities[k].views))\r\n                this.entities[k].views[view] = {summary: {}, rank: {}, subset_rank: {}}\r\n              const eview = this.entities[k].views[view]\r\n              if (!(v in eview.rank)) {\r\n                eview.rank[v] = new at(ny)\r\n                eview.subset_rank[v] = new at(ny)\r\n              }\r\n            }\r\n          })\r\n        }\r\n        o.forEach((ev: Order, y: number) => {\r\n          if (!Object.isFrozen(ev)) {\r\n            ev.sort(sort_a1)\r\n            Object.freeze(ev)\r\n          }\r\n          ev.forEach((r, i) => {\r\n            this.entities[r[0]].views[view].rank[v][y] = i\r\n          })\r\n        })\r\n      }\r\n      if (!(d in m.summaries)) {\r\n        m.order[d] = []\r\n        m.selected_order[d] = []\r\n        m.selected_summaries[d] = summary_template()\r\n        const s = summary_template()\r\n        if ('string' === vi.info[d as keyof MeasureInfo].type) {\r\n          s.type = 'string'\r\n          s.level_ids = vi.level_ids\r\n          s.levels = vi.levels\r\n          m.table = {}\r\n          vi.levels.forEach((l: string) => {\r\n            m.table[l] = []\r\n            for (let y = ny; y--; ) m.table[l].push(0)\r\n          })\r\n          for (let y = ny; y--; ) {\r\n            m.order[d].push([])\r\n            m.selected_order[d].push([])\r\n            s.missing.push(0)\r\n            s.n.push(0)\r\n            s.mode.push('')\r\n          }\r\n          m.summaries[d] = s\r\n        } else {\r\n          for (let y = ny; y--; ) {\r\n            m.order[d].push([])\r\n            m.selected_order[d].push([])\r\n            m.selected_summaries[d].n.push(0)\r\n            m.selected_summaries[d].missing.push(0)\r\n            s.missing.push(0)\r\n            s.n.push(0)\r\n            s.sum.push(0)\r\n            s.max.push(-Infinity)\r\n            s.q3.push(0)\r\n            s.mean.push(0)\r\n            s.norm_median.push(0)\r\n            s.break_median.push(-1)\r\n            s.lower_median_min.push(-1)\r\n            s.lower_median_range.push(-1)\r\n            s.upper_median_min.push(-1)\r\n            s.upper_median_range.push(-1)\r\n            s.norm_mean.push(0)\r\n            s.break_mean.push(-1)\r\n            s.lower_mean_min.push(-1)\r\n            s.lower_mean_range.push(-1)\r\n            s.upper_mean_min.push(-1)\r\n            s.upper_mean_range.push(-1)\r\n            s.median.push(0)\r\n            s.q1.push(0)\r\n            s.min.push(Infinity)\r\n          }\r\n          m.summaries[d] = s\r\n        }\r\n        Object.seal(m.order[d])\r\n        Object.seal(m.selected_order[d])\r\n        Object.seal(m.selected_summaries[d])\r\n        Object.seal(m.summaries[d])\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction quantile(p: number, n: number, o: number, x: Order): number {\r\n  const a = p * (n - 1),\r\n    ap = a % 1,\r\n    bp = 1 - ap,\r\n    b = o + Math.ceil(a),\r\n    i = o + Math.floor(a)\r\n  return x[i][1] * ap + x[b][1] * bp\r\n}\r\n\r\nexport async function calculate(this: DataHandler, measure: string, v: SiteDataView, full: boolean): Promise<void> {\r\n  const view = v && v.id\r\n  const dataset: string = v.get.dataset()\r\n  await this.data_processed[dataset]\r\n  const summaryId = dataset + measure\r\n  if (!this.inited_summary[summaryId]) this.init_summary(measure, dataset)\r\n  this.inited_summary[summaryId] = new Promise(resolve => {\r\n    this.summary_ready[summaryId] = resolve\r\n  })\r\n  const variable = this.variables[measure],\r\n    m = variable.views[view]\r\n  if (v.valid[dataset] && m.state[dataset] !== v.state) {\r\n    const summary_set = this.settings.settings.summary_selection as keyof DataViewSelection,\r\n      s = v.selection[summary_set],\r\n      a = v.selection.all,\r\n      mo = m.order[dataset],\r\n      mso = m.selected_order[dataset],\r\n      ny = variable.time_range[dataset][2],\r\n      order = variable.info[dataset].order,\r\n      levels = variable.levels,\r\n      level_ids = variable.level_ids,\r\n      subset = v.n_selected[summary_set] !== v.n_selected.dataset,\r\n      mss = m.selected_summaries[dataset],\r\n      ms = m.summaries[dataset],\r\n      is_string = 'string' === variable.type\r\n    for (let y = ny; y--; ) {\r\n      mo[y] = subset ? [] : order[y]\r\n      mso[y] = subset ? [] : order[y]\r\n      mss.missing[y] = 0\r\n      mss.n[y] = 0\r\n      ms.missing[y] = 0\r\n      ms.n[y] = 0\r\n      if (is_string) {\r\n        ms.mode[y] = ''\r\n        levels.forEach(k => (m.table[k][y] = 0))\r\n      } else {\r\n        ms.sum[y] = 0\r\n        ms.mean[y] = 0\r\n        ms.max[y] = -Infinity\r\n        ms.min[y] = Infinity\r\n        ms.break_mean[y] = -1\r\n        ms.break_median[y] = -1\r\n      }\r\n    }\r\n    order.forEach((o, y) => {\r\n      const moy = mo[y],\r\n        msoy = mso[y]\r\n      let rank = 0\r\n      o.forEach(oi => {\r\n        const k = oi[0],\r\n          value = oi[1]\r\n        if (k in s) {\r\n          const en = s[k].views[view],\r\n            present = !isNaN(value)\r\n          if (!y) {\r\n            if (!(measure in en.summary)) en.summary[measure] = {n: 0, overall: ms, order: mo}\r\n            en.summary[measure].n = 0\r\n          }\r\n          if (full && subset) {\r\n            moy.push(oi)\r\n            if (k in a) {\r\n              msoy.push(oi)\r\n              if (present) {\r\n                mss.n[y]++\r\n              } else mss.missing[y]++\r\n            }\r\n          }\r\n          if (present) {\r\n            en.subset_rank[measure][y] = rank++\r\n            en.summary[measure].n++\r\n            ms.n[y]++\r\n            if (is_string) {\r\n              m.table[levels[value]][y]++\r\n            } else {\r\n              ms.sum[y] += value\r\n              if (value > ms.max[y]) ms.max[y] = value\r\n              if (value < ms.min[y]) ms.min[y] = value\r\n            }\r\n          } else ms.missing[y]++\r\n        }\r\n      })\r\n    })\r\n    if (full) {\r\n      mo.forEach((o, y) => {\r\n        if (is_string) {\r\n          if (ms.n[y]) {\r\n            let l = 0\r\n            Object.keys(m.table).forEach(k => {\r\n              if (m.table[k][y] > m.table[levels[l]][y]) l = level_ids[k]\r\n            })\r\n            ms.mode[y] = levels[l]\r\n          } else ms.mode[y] = ''\r\n        } else {\r\n          if (ms.n[y]) {\r\n            ms.mean[y] = ms.sum[y] / ms.n[y]\r\n            if (!isFinite(ms.min[y])) ms.min[y] = ms.mean[y]\r\n            if (!isFinite(ms.max[y])) ms.max[y] = ms.mean[y]\r\n            ms.range[y] = ms.max[y] - ms.min[y]\r\n            if (1 === ms.n[y]) {\r\n              ms.q3[y] = ms.median[y] = ms.q1[y] = null == o[0][1] ? ms.mean[y] : o[0][1]\r\n            } else {\r\n              ms.median[y] = quantile(0.5, ms.n[y], ms.missing[y], o)\r\n              ms.q3[y] = quantile(0.75, ms.n[y], ms.missing[y], o)\r\n              ms.q1[y] = quantile(0.25, ms.n[y], ms.missing[y], o)\r\n            }\r\n            const n = o.length\r\n            for (let i = ms.missing[y], bmd = false, bme = false; i < n; i++) {\r\n              const v = o[i][1]\r\n              if ('number' === typeof v) {\r\n                if (!bmd && v > ms.median[y]) {\r\n                  ms.break_median[y] = i - 1\r\n                  bmd = true\r\n                }\r\n                if (!bme && v > ms.mean[y]) {\r\n                  ms.break_mean[y] = i - 1\r\n                  bme = true\r\n                }\r\n              }\r\n              if (bmd && bme) break\r\n            }\r\n          } else {\r\n            ms.max[y] = 0\r\n            ms.q3[y] = 0\r\n            ms.median[y] = 0\r\n            ms.q1[y] = 0\r\n            ms.min[y] = 0\r\n          }\r\n          if (ms.n[y]) {\r\n            ms.norm_median[y] = ms.range[y] ? (ms.median[y] - ms.min[y]) / ms.range[y] : 0.5\r\n            if (-1 !== ms.break_median[y]) {\r\n              ms.lower_median_min[y] = ms.norm_median[y] - (o[ms.missing[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.lower_median_range[y] =\r\n                ms.norm_median[y] - ((o[ms.break_median[y]][1] - ms.min[y]) / ms.range[y] - ms.lower_median_min[y])\r\n              ms.upper_median_min[y] = ms.norm_median[y] - (o[ms.break_median[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.upper_median_range[y] =\r\n                (o[o.length - 1][1] - ms.min[y]) / ms.range[y] - ms.norm_median[y] - ms.upper_median_min[y]\r\n            }\r\n            ms.norm_mean[y] = ms.range[y] ? (ms.mean[y] - ms.min[y]) / ms.range[y] : 0.5\r\n            if (-1 !== ms.break_mean[y]) {\r\n              ms.lower_mean_min[y] = ms.norm_mean[y] - (o[ms.missing[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.lower_mean_range[y] =\r\n                ms.norm_mean[y] - ((o[ms.break_mean[y]][1] - ms.min[y]) / ms.range[y] - ms.lower_mean_min[y])\r\n              ms.upper_mean_min[y] = ms.norm_mean[y] - (o[ms.break_mean[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.upper_mean_range[y] =\r\n                (o[o.length - 1][1] - ms.min[y]) / ms.range[y] - ms.norm_mean[y] - ms.upper_mean_min[y]\r\n            }\r\n          }\r\n        }\r\n      })\r\n    } else {\r\n      for (let y = 0; y < ny; y++) {\r\n        if (ms.n[y]) {\r\n          if (is_string) {\r\n            let q1 = 0\r\n            Object.keys(m.table).forEach(k => {\r\n              if (m.table[k][y] > m.table[levels[q1]][y]) q1 = level_ids[k]\r\n            })\r\n            ms.mode[y] = levels[q1]\r\n          } else ms.mean[y] = ms.sum[y] / ms.n[y]\r\n        } else {\r\n          ms[is_string ? 'mode' : 'mean'][y] = NaN\r\n        }\r\n      }\r\n    }\r\n    ms.filled = true\r\n    m.state[dataset] = v.state\r\n    this.summary_ready[summaryId]()\r\n  } else await this.summary_ready[summaryId]\r\n}\r\n","import DataHandler from './index'\r\nimport type {Entity, EntityData, IdMap, MeasureInfo, ResourceField, ResourceFields, Variable} from '../types'\r\n\r\nexport function variables(this: DataHandler) {\r\n  this.metadata.datasets.forEach((k: string) => {\r\n    this.data_queue[k] = {}\r\n    const m = this.info[k]\r\n    if (m) {\r\n      m.id_vars = m.ids.map((id: IdMap) => id.variable)\r\n      m.schema.fields.forEach((v: ResourceField) => {\r\n        const vn = v.name\r\n        if (vn in this.variables) {\r\n          const ve = this.variables[vn]\r\n          ve.datasets.push(k)\r\n          ve.info[k] = v\r\n          if ('string' === v.type) {\r\n            ve.levels = []\r\n            ve.level_ids = {}\r\n            ;((v.info && v.info.levels) || Object.keys(v.table)).forEach(l => {\r\n              if (!(l in ve.level_ids)) {\r\n                ve.level_ids[l] = ve.levels.length\r\n                ve.levels.push(l)\r\n              }\r\n            })\r\n          }\r\n        } else {\r\n          const ve: Variable = (this.variables[vn] = {\r\n            datasets: [k],\r\n            info: {} as ResourceFields,\r\n            time_range: {},\r\n            type: v.type,\r\n            code: vn,\r\n            name: vn,\r\n            meta: v.info,\r\n            levels: [],\r\n            level_ids: {},\r\n            table: {},\r\n            order: [],\r\n            views: {},\r\n          })\r\n          ve.info[k] = v\r\n          if ('string' === v.type) {\r\n            ve.levels = []\r\n            ve.level_ids = {}\r\n            Object.keys(v.table).forEach(l => {\r\n              ve.level_ids[l] = ve.levels.length\r\n              ve.levels.push(l)\r\n            })\r\n          }\r\n          if (!ve.meta)\r\n            ve.meta = {\r\n              full_name: vn,\r\n              measure: vn.split(':')[1] || vn,\r\n              short_name: this.format_label(vn),\r\n              type: v.type || 'unknown',\r\n            }\r\n          ve.meta.full_name = vn\r\n          if (!('measure' in ve.meta)) ve.meta.measure = vn.split(':')[1] || vn\r\n          if (!('short_name' in ve.meta)) ve.meta.short_name = this.format_label(vn)\r\n          if (!('long_name' in ve.meta)) ve.meta.long_name = ve.meta.short_name\r\n          if (!(vn in this.variable_info)) this.variable_info[vn] = ve.meta as MeasureInfo\r\n        }\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\nexport async function entities(this: DataHandler, g: string): Promise<void> {\r\n  if (g in this.sets && !this.inited[g] && g in this.meta.times) {\r\n    const s = this.sets[g],\r\n      time = this.meta.times[g],\r\n      retriever = DataHandler.retrievers[time.is_single ? 'single' : 'multi'],\r\n      datasets = Object.keys(this.sets),\r\n      infos = this.info\r\n    Object.keys(s).forEach((id: string) => {\r\n      const si = s[id] as EntityData,\r\n        l = id.length\r\n      if ('_meta' !== id) {\r\n        const overwrite = this.entity_features[g][id]\r\n        const f = overwrite || {id: id, name: id}\r\n        f.id = id\r\n        if (!f.name) f.name = id\r\n        const e = (\r\n          id in this.entities\r\n            ? this.entities[id]\r\n            : {\r\n                group: g,\r\n                data: si,\r\n                variables: this.variables,\r\n                features: f,\r\n                views: {},\r\n              }\r\n        ) as Entity\r\n        if (id in this.entities) {\r\n          e.group = g\r\n          e.data = si\r\n          e.variables = this.variables\r\n          if (!e.features) e.features = {}\r\n          if (!e.views) e.views = {}\r\n        } else {\r\n          this.entities[id] = e\r\n        }\r\n        if (!(id in this.entity_tree)) this.entity_tree[id] = {parents: {}, children: {}}\r\n        const rel = this.entity_tree[id]\r\n        e.relations = rel\r\n        Object.keys(f).forEach((k: string) => {\r\n          if (!(k in this.features)) this.features[k] = this.format_label(k)\r\n          if ('id' === k || overwrite || !(k in e.features)) {\r\n            e.features[k] = f[k]\r\n          }\r\n          if (-1 !== this.metadata.datasets.indexOf(k)) {\r\n            if (!(f[k] in this.entity_tree)) this.entity_tree[f[k]] = {parents: {}, children: {}}\r\n            this.entity_tree[f[k]].children[id] = rel\r\n            rel.parents[f[k]] = this.entity_tree[f[k]]\r\n          }\r\n        })\r\n        if (infos) {\r\n          datasets.forEach((d: string) => {\r\n            const p = d in infos && infos[d].id_length\r\n            if (p && p < l) {\r\n              const sl = id.substring(0, p)\r\n              if (sl in this.sets[d]) {\r\n                if (!(sl in this.entity_tree)) this.entity_tree[sl] = {parents: {}, children: {}}\r\n                this.entity_tree[sl].children[id] = rel\r\n                rel.parents[sl] = this.entity_tree[sl]\r\n              }\r\n            }\r\n          })\r\n        }\r\n        this.settings.view_names.forEach((v: string) => {\r\n          if (!(v in e.views)) {\r\n            e.views[v] = {summary: {}, rank: {}, subset_rank: {}}\r\n          }\r\n        })\r\n        e.time = time\r\n        e.get_value = retriever.bind(e)\r\n      }\r\n    })\r\n    this.inited[g] = true\r\n    this.data_promise[g]()\r\n    setTimeout(() => {\r\n      if (!this.inited.first) {\r\n        this.hooks.init && this.hooks.init()\r\n        this.inited.first = true\r\n      }\r\n      g in this.data_queue &&\r\n        Object.keys(this.data_queue[g]).forEach((id: string) => {\r\n          this.data_queue[g][id]()\r\n          delete this.data_queue[g][id]\r\n        })\r\n      this.hooks.onload && this.hooks.onload(g)\r\n    }, 0)\r\n  }\r\n  for (const k in this.info) if (Object.prototype.hasOwnProperty.call(this.info, k) && !this.inited[k]) return void 0\r\n  this.all_data_ready()\r\n}\r\n","import {patterns} from './patterns'\r\nimport {Filter, MeasureInfo, MeasureInfos, Query, UnparsedObject} from '../types'\r\nimport * as params from './export_params'\r\nimport {group_checks} from './checks'\r\nimport DataHandler from './index'\r\n\r\nconst ps = {\r\n  any: /\\{(?:categor|variant)/,\r\n  category: /\\{categor(?:y|ies)(\\.[^}]+?)?\\}/g,\r\n  variant: /\\{variants?(\\.[^}]+?)?\\}/g,\r\n  all: /\\{(?:categor(?:y|ies)|variants?)(\\.[^}]+?)?\\}/g,\r\n  desc: /description$/,\r\n}\r\n\r\nfunction replace_dynamic(e: string, p: RegExp, s: UnparsedObject, v?: UnparsedObject, d = 'default'): string {\r\n  p.lastIndex = 0\r\n  for (let m, k; (m = p.exec(e)); ) {\r\n    const ss = v && 'v' === m[0].substring(1, 2) ? v : s\r\n    k = m[1] ? m[1].substring(1) : d\r\n    if (!(k in ss)) {\r\n      if ('description' in ss && ps.desc.test(k)) {\r\n        k = d = 'description'\r\n      } else if (k === d) {\r\n        k = 'default'\r\n      }\r\n    }\r\n    const r = ss[k]\r\n    if ('string' === typeof r) {\r\n      while (e.includes(m[0])) e = e.replace(m[0], r)\r\n      p.lastIndex = 0\r\n    }\r\n  }\r\n  return e\r\n}\r\n\r\nfunction prepare_source(name: string, o: UnparsedObject, s: UnparsedObject, p: RegExp): UnparsedObject {\r\n  const r: UnparsedObject = {name: 'blank' === name ? '' : name}\r\n  Object.keys(o).forEach(n => {\r\n    const e = o[n]\r\n    r[n] = 'string' === typeof e ? replace_dynamic(e, p, s) : e\r\n  })\r\n  if (!('default' in r)) r.default = r.name\r\n  return r\r\n}\r\n\r\nexport function measure_info(info: MeasureInfos): MeasureInfos {\r\n  Object.keys(info).forEach(name => {\r\n    if (ps.any.test(name)) {\r\n      const base = info[name] as MeasureInfo\r\n      const bn = Object.keys(base)\r\n      if (base.categories || base.variants) {\r\n        const categories: {[index: string]: any} = Array.isArray(base.categories) ? {} : base.categories || {}\r\n        const variants: {[index: string]: any} = Array.isArray(base.variants) ? {} : base.variants || {}\r\n        const cats: string[] = Array.isArray(base.categories) ? base.categories : Object.keys(categories)\r\n        if (!cats.length) cats.push('')\r\n        const vars: string[] = Array.isArray(base.variants) ? base.variants : Object.keys(variants)\r\n        if (!vars.length) vars.push('')\r\n        cats.forEach(cn => {\r\n          vars.forEach(vn => {\r\n            const cs = prepare_source(cn, categories[cn] || {}, variants[vn] || {}, ps.variant)\r\n            const vs = prepare_source(vn, variants[vn] || {}, categories[cn] || {}, ps.category)\r\n            const s = {...cs, ...vs}\r\n            const r: any = {}\r\n            bn.forEach((k: keyof MeasureInfo) => {\r\n              if ('categories' !== k && 'variants' !== k) {\r\n                const temp = base[k]\r\n                r[k] = 'string' === typeof temp ? replace_dynamic(temp, ps.all, cs, vs, k) : temp\r\n              }\r\n            })\r\n            Object.keys(s).forEach(k => {\r\n              if (\r\n                !(k in r) &&\r\n                'default' !== k &&\r\n                'name' !== k &&\r\n                ('description' !== k || !(r.long_description || r.short_description))\r\n              )\r\n                r[k] = s[k]\r\n            })\r\n            info[replace_dynamic(name, ps.all, cs, vs)] = r as MeasureInfo\r\n          })\r\n        })\r\n      }\r\n    }\r\n  })\r\n  return info\r\n}\r\n\r\nexport function query(this: DataHandler, q: any): Query {\r\n  const f: UnparsedObject = JSON.parse(JSON.stringify(params.defaults))\r\n  if ('string' === typeof q) {\r\n    if ('?' === q[0]) q = q.substring(1)\r\n    const aq: string[] = q.split('&')\r\n    q = {}\r\n    aq.forEach(aqi => {\r\n      const a = aqi.split('=')\r\n      q[a[0]] = a.length > 1 ? a[1] : ''\r\n    })\r\n  }\r\n  q &&\r\n    Object.keys(q).forEach(k => {\r\n      if ('include' === k || 'exclude' === k || k in f) {\r\n        f[k] = q[k]\r\n      } else {\r\n        let a: string[] = []\r\n        if (patterns.single_operator.test(k)) {\r\n          a = k.replace(patterns.single_operator, '$1=$2').split('=')\r\n          if (a.length > 1) {\r\n            k = a[0]\r\n            q[k] = a[1]\r\n          }\r\n        }\r\n        const aq = patterns.component.exec(k),\r\n          tf: Filter = {\r\n            name: k.replace(patterns.greater, '>').replace(patterns.less, '<'),\r\n            component: 'mean',\r\n            operator: '=',\r\n            value: patterns.number.test(q[k]) ? +q[k] : q[k],\r\n            time_component: false,\r\n            check: () => false,\r\n          }\r\n        if ('object' === typeof q[k]) {\r\n          if ('component' in q[k]) tf.component = q[k].component\r\n          if ('operator' in q[k]) tf.operator = q[k].operator\r\n          if ('value' in q[k]) tf.value = q[k].value\r\n        }\r\n        k = tf.name\r\n        if (aq) {\r\n          if (-1 !== params.options.filter_components.indexOf(aq[2])) {\r\n            tf.component = aq[2]\r\n            tf.name = aq[1]\r\n          } else if (patterns.number.test(aq[2])) {\r\n            const time = +aq[2]\r\n            const i = time > 0 && time < this.meta.overall.value.length ? time : this.meta.overall.value.indexOf(time)\r\n            if (-1 !== i) {\r\n              tf.time_component = true\r\n              tf.component = i\r\n              tf.name = aq[1]\r\n            }\r\n          }\r\n        }\r\n        if (patterns.operator_start.test(k) && k[k.length - 1] in DataHandler.checks) {\r\n          tf.operator = k[k.length - 1]\r\n          if (!a.length) tf.operator += '='\r\n          if (k === tf.name) tf.name = k.substring(0, k.length - 1)\r\n        }\r\n        if (undefined === tf.value || '-1' == tf.value) return\r\n        if (\r\n          ('=' === tf.operator || '!' === tf.operator) &&\r\n          'string' === typeof tf.value &&\r\n          patterns.comma.test(tf.value)\r\n        ) {\r\n          tf.value = tf.value.split(',')\r\n          tf.operator = '=' === tf.operator ? 'includes' : 'excludes'\r\n        }\r\n        if ('time_range' === tf.name) {\r\n          if (Array.isArray(tf.value)) {\r\n            f.time_range = [\r\n              this.meta.overall.value.indexOf(+tf.value[0]),\r\n              this.meta.overall.value.indexOf(+tf.value[1]),\r\n            ]\r\n          } else {\r\n            const i = this.meta.overall.value.indexOf(+tf.value)\r\n            f.time_range =\r\n              '=' === tf.operator ? [i, i] : '>' === tf.operator ? [i, this.meta.overall.value.length - 1] : [0, i]\r\n          }\r\n          if (-1 === f.time_range[0]) f.time_range[0] = 0\r\n          if (-1 === f.time_range[1])\r\n            f.time_range[1] = this.meta.overall.value.length ? this.meta.overall.value.length - 1 : 0\r\n        } else if ('dataset' === tf.name) {\r\n          f.dataset = tf\r\n        } else if (tf.name in this.features) {\r\n          if ('id' === tf.name && !tf.value) tf.value = (tf.value + '').split(',')\r\n          tf.check = group_checks[tf.operator].bind(tf.value)\r\n          f.feature_conditions.push(tf)\r\n        } else if (tf.name in this.variables) {\r\n          tf.check = (\r\n            tf.time_component\r\n              ? function (this: {check: Function; condition: Filter}, d: number | number[], adj: number) {\r\n                  const multi = 'number' !== typeof d,\r\n                    i = 'number' === typeof this.condition.component ? this.condition.component - adj : 0\r\n                  return multi\r\n                    ? this.check(d[i], this.condition.value)\r\n                    : !i\r\n                    ? this.check(d, this.condition.value)\r\n                    : false\r\n                }\r\n              : function (this: {check: Function; condition: Filter}, s: {[index: string]: string}) {\r\n                  return this.check(s[this.condition.component], this.condition.value)\r\n                }\r\n          ).bind({check: DataHandler.checks[tf.operator], condition: tf})\r\n          if (-1 === f.variables.filter_by.indexOf(tf.name)) f.variables.filter_by.push(tf.name)\r\n          f.variables.conditions.push(tf)\r\n        }\r\n      }\r\n    })\r\n  if (!('time_range' in f)) f.time_range = [0, this.meta.overall.value.length ? this.meta.overall.value.length - 1 : 0]\r\n  return f as Query\r\n}\r\n","'use strict'\r\nimport {value_checks} from './checks'\r\nimport {exporter} from './exporter'\r\nimport * as retrievers from './retrievers'\r\nimport * as formatter from './formatters'\r\nimport * as ingester from './ingesters'\r\nimport * as summary from './summary'\r\nimport * as mapper from './mappers'\r\nimport * as parser from './parsers'\r\nimport type {\r\n  Settings,\r\n  Variable,\r\n  Metadata,\r\n  MeasureInfos,\r\n  DataSets,\r\n  Features,\r\n  Variables,\r\n  References,\r\n  Entities,\r\n  Relations,\r\n  MetaTime,\r\n  LogicalObject,\r\n  Promises,\r\n  DataMaps,\r\n  DataResource,\r\n  MeasureInfo,\r\n  DataPackage,\r\n  EntityFeatureSet,\r\n  Entity,\r\n} from '../types'\r\nimport {SiteDataView} from '../site/dataview'\r\n\r\nexport default class DataHandler {\r\n  constructor(\r\n    settings?: Settings,\r\n    defaults?: {[index: string]: string},\r\n    data?: DataSets,\r\n    hooks?: {[index: string]: Function}\r\n  ) {\r\n    if (hooks) this.hooks = hooks\r\n    if (defaults) this.defaults = defaults\r\n    if (settings) this.settings = settings\r\n    if (this.settings.metadata) this.metadata = this.settings.metadata\r\n    if (data) this.sets = data\r\n    this.get_value = this.get_value.bind(this)\r\n    this.dynamic_load = 'dataviews' in this.settings && this.settings.settings && !!this.settings.settings.partial_init\r\n    this.settings.view_names = this.dynamic_load ? Object.keys(this.settings.dataviews) : ['default_view']\r\n    if ('string' === typeof this.metadata.datasets) this.metadata.datasets = [this.metadata.datasets]\r\n    const init = () => {\r\n      if (!this.metadata.datasets || !this.metadata.datasets.length) {\r\n        this.metadata.datasets = Object.keys(this.info)\r\n        if (!this.metadata.datasets.length) this.metadata.datasets = Object.keys(this.sets)\r\n      }\r\n      if (this.metadata.measure_info) {\r\n        const info = parser.measure_info(this.metadata.measure_info)\r\n        this.metadata.datasets.forEach((d: string) => {\r\n          if (info._references) this.info[d]._references = info._references\r\n          const v = this.info[d].schema.fields\r\n          v.forEach(e => (e.name in info ? (e.info = info[e.name] as MeasureInfo) : ''))\r\n        })\r\n      }\r\n      this.map_variables()\r\n      this.metadata.datasets.forEach((k: string) => {\r\n        this.loaded[k] = k in this.sets\r\n        this.inited[k] = false\r\n        this.data_processed[k] = new Promise(resolve => {\r\n          this.data_promise[k] = resolve\r\n        })\r\n        if (k in this.info)\r\n          this.info[k].site_file = (this.metadata.url ? this.metadata.url + '/' : '') + this.info[k].name + '.json'\r\n        if (this.loaded[k]) {\r\n          this.ingest_data(this.sets[k], k)\r\n        } else if (\r\n          !this.dynamic_load ||\r\n          (this.settings.settings && !this.settings.settings.partial_init) ||\r\n          !this.defaults.dataset ||\r\n          k === this.defaults.dataset\r\n        )\r\n          this.retrieve(k, this.info[k].site_file)\r\n      })\r\n    }\r\n    if (this.metadata.package && !this.metadata.info) {\r\n      if ('undefined' === typeof window) {\r\n        require('https')\r\n          .get(this.metadata.url + this.metadata.package, (r: {on: Function}) => {\r\n            const c: string[] = []\r\n            r.on('data', (d: string) => {\r\n              c.push(d)\r\n            })\r\n            r.on('end', () => {\r\n              this.info = {}\r\n              const dp: DataPackage = JSON.parse(c.join(''))\r\n              if (dp.measure_info) this.metadata.measure_info = dp.measure_info\r\n              dp.resources.forEach((r: DataResource) => (this.info[r.name] = r))\r\n              init()\r\n            })\r\n          })\r\n          .end()\r\n      } else {\r\n        const f = new window.XMLHttpRequest()\r\n        f.onreadystatechange = () => {\r\n          if (4 === f.readyState) {\r\n            if (200 === f.status) {\r\n              this.info = {}\r\n              const dp = JSON.parse(f.responseText)\r\n              if (dp.measure_info) this.metadata.measure_info = dp.measure_info\r\n              dp.resources.forEach((r: DataResource) => (this.info[r.name] = r))\r\n              init()\r\n            } else {\r\n              throw new Error('failed to load datapackage: ' + f.responseText)\r\n            }\r\n          }\r\n        }\r\n        f.open('GET', this.metadata.url + this.metadata.package)\r\n        f.send()\r\n      }\r\n    } else {\r\n      if (this.metadata.info) this.info = this.metadata.info\r\n      init()\r\n    }\r\n  }\r\n  hooks: {[index: string]: Function} = {}\r\n  defaults: {[index: string]: string} = {dataview: 'default_view', time: 'time'}\r\n  settings: Settings = {}\r\n  metadata: Metadata = {datasets: []}\r\n  info: {[index: string]: DataResource} = {}\r\n  sets: DataSets = {}\r\n  dynamic_load = false\r\n  all_data_ready: Function = () => false\r\n  data_ready: Promise<void> = new Promise(resolve => {\r\n    this.all_data_ready = resolve\r\n  })\r\n  features: Features = {}\r\n  variables: Variables = {}\r\n  variable_codes: Variables = {}\r\n  variable_info: MeasureInfos = {}\r\n  references: References = {}\r\n  entities: Entities = {}\r\n  entity_tree: {[index: string]: Relations} = {}\r\n  meta: MetaTime = {\r\n    times: {},\r\n    variables: {},\r\n    ranges: {},\r\n    overall: {\r\n      range: [Infinity, -Infinity],\r\n      value: [],\r\n    },\r\n  }\r\n  loaded: LogicalObject = {}\r\n  onload: () => {}\r\n  inited: {[index: string]: number | NodeJS.Timeout | boolean} = {}\r\n  inited_summary: Promises = {}\r\n  summary_ready: {[index: string]: Function} = {}\r\n  entity_features: EntityFeatureSet = {}\r\n  data_maps: DataMaps = {}\r\n  data_queue: {[index: string]: {[index: string]: Function}} = {}\r\n  data_promise: {[index: string]: Function} = {}\r\n  data_processed: Promises = {}\r\n  load_requests: {[index: string]: string} = {}\r\n  retrieve = async function (this: DataHandler, name: string, url: string) {\r\n    if (!this.load_requests[name]) {\r\n      this.load_requests[name] = url\r\n      const f = new window.XMLHttpRequest()\r\n      f.onreadystatechange = () => {\r\n        if (4 === f.readyState) {\r\n          if (200 === f.status) {\r\n            this.ingest_data(JSON.parse(f.responseText), name)\r\n          } else {\r\n            throw new Error('DataHandler.retrieve failed: ' + f.responseText)\r\n          }\r\n        }\r\n      }\r\n      f.open('GET', url, true)\r\n      f.send()\r\n    }\r\n  }\r\n  format_value = formatter.value\r\n  format_label = formatter.label\r\n  ingest_data = ingester.data\r\n  ingest_map = ingester.map\r\n  load_id_maps = ingester.id_maps\r\n  init_summary = summary.init\r\n  calculate_summary = summary.calculate\r\n  map_variables = mapper.variables\r\n  map_entities = mapper.entities\r\n  parse_query = parser.query\r\n  export = exporter\r\n  get_variable = async function (this: DataHandler, variable: string, view: SiteDataView): Promise<Variable> {\r\n    if (view.dataset in this.data_processed) await this.data_processed[view.dataset]\r\n    if (variable in this.variables) await this.calculate_summary(variable, view, true)\r\n    return this.variables[variable]\r\n  }\r\n  get_value = function vector(this: DataHandler, r: {variable: string; entity: Entity}): number[] {\r\n    if (this.variables[r.variable].is_time) {\r\n      return r.entity.time.value as number[]\r\n    } else {\r\n      const v = this.variables[r.variable].code\r\n      return (\r\n        v in r.entity.data ? (Array.isArray(r.entity.data[v]) ? r.entity.data[v] : [r.entity.data[v]]) : [NaN]\r\n      ) as number[]\r\n    }\r\n  }\r\n  public static retrievers = retrievers\r\n  public static checks = value_checks\r\n}\r\n","export const defaults: {[index: string]: string} = {\r\n  time: 'time',\r\n  dataview: 'default_view',\r\n  palette: 'vik',\r\n  background_highlight: '#adadad',\r\n  border: '#7e7e7e',\r\n  border_highlight_true: '#ffffff',\r\n  border_highlight_false: '#000000',\r\n  missing: '#00000000',\r\n}\r\n","import type Community from './index'\r\nimport type {Entities, Entity, FilterParsed, LogicalObject} from '../types'\r\nimport type {DataViewParsed} from './dataview'\r\n\r\nexport class GlobalView {\r\n  site: Community\r\n  registered: LogicalObject = {}\r\n  selection: Entities = {}\r\n  entities: Map<string, Entity> = new Map()\r\n  selected: string[] = []\r\n  select_ids: {[index: string]: boolean} = {}\r\n  filters: Map<string, FilterParsed> = new Map()\r\n  times: number[]\r\n  dataview: DataViewParsed\r\n  states = {\r\n    id_state: 'initial',\r\n    filter_state: 'initial',\r\n  }\r\n  constructor(site: Community) {\r\n    this.site = site\r\n  }\r\n  init() {\r\n    this.times = this.site.data.meta.overall.value\r\n    this.dataview = this.site.dataviews[this.site.defaults.dataview].parsed\r\n  }\r\n  filter_state(q?: string[], agg?: number) {\r\n    const as_state = !q\r\n    if (as_state) q = []\r\n    this.filters.forEach(f => {\r\n      const component =\r\n        'selected' === f.component\r\n          ? this.times['undefined' === typeof agg ? this.dataview.time_agg : agg]\r\n          : f.time_component\r\n          ? this.times[f.component as number]\r\n          : f.component\r\n      if (f.value) q.push(f.variable + '[' + component + ']' + f.operator + f.value + (as_state ? f.active : ''))\r\n    })\r\n    return q.join('&')\r\n  }\r\n  id_state() {\r\n    return Object.keys(this.select_ids).join(',')\r\n  }\r\n  id_filter() {\r\n    const ids: {[index: string]: boolean} = {}\r\n    this.selected = []\r\n    this.select_ids = ids\r\n    if (this.site.data.metadata.datasets) {\r\n      const inputs = this.site.page.modal.filter.entity_inputs\r\n      this.site.data.metadata.datasets.forEach(d => {\r\n        if (d in inputs) {\r\n          const s = inputs[d].value() as string[],\r\n            cs: string[] = []\r\n          if (Array.isArray(s)) {\r\n            s.forEach(id => {\r\n              const e = this.site.data.entities[id]\r\n              if (e) {\r\n                cs.push(id)\r\n                this.selected.push(id)\r\n                ids[id] = true\r\n                if (e.relations) {\r\n                  Object.keys(e.relations.parents).forEach(k => (ids[k] = true))\r\n                  Object.keys(e.relations.children).forEach(k => (ids[k] = true))\r\n                }\r\n              }\r\n            })\r\n            inputs[d].source = cs\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n","export const patterns = {\r\n  seps: /[\\s,/._-]+/g,\r\n  period: /\\./,\r\n  all_periods: /\\./g,\r\n  word_start: /\\b(\\w)/g,\r\n  settings: /^settings?\\./,\r\n  features: /^features?\\./,\r\n  filter: /^filter\\./,\r\n  data: /^data\\./,\r\n  variables: /^variables?\\./,\r\n  properties: /prop/,\r\n  palette: /^pal/,\r\n  datasets: /^dat/,\r\n  variable: /^var/,\r\n  levels: /^lev/,\r\n  ids: /^ids/,\r\n  minmax: /^m[inax]{2}$/,\r\n  int_types: /^(?:year|int|integer)$/,\r\n  end_punct: /[.?!]$/,\r\n  mustache: /\\{([^}]+)\\}/g,\r\n  measure_name: /(?:^measure|_name)$/,\r\n  http: /^https?:\\/\\//,\r\n  bool: /^(?:true|false)$/,\r\n  number: /^[\\d-][\\d.,]*$/,\r\n  leading_zeros: /^0+/,\r\n  url_spaces: /%20/g,\r\n  hashes: /#/g,\r\n  embed_setting: /^(?:hide_|navcolor|close_menus)/,\r\n  median: /^med/i,\r\n  location_string: /^[^?]*/,\r\n  time_ref: /\\{time\\}/g,\r\n  pre_colon: /^[^:]*:/,\r\n  exclude_query: /^(?:features|time_range|id)$/,\r\n  space: /\\s+/,\r\n  has_html: /<(?:math|a|br)[/\\s>]/,\r\n  href: /\\\\(?:href|url)\\{([^}]+)\\}(?:\\{([^}]+)\\})?/g,\r\n  bracket_content: /(?:^|>)[^<]*(?:<|$)/,\r\n  html_tags: /^(?:semantics|m|a|br)/,\r\n  html_attributes:\r\n    /^(?:xmlns|display|style|encoding|stretchy|alttext|scriptlevel|fence|math|separator|href|rel|target)/,\r\n  id_escapes: /(?<=#[^\\s]+)([.[\\](){}?*-])/g,\r\n  repo: /\\.com[/:]([^\\/]+\\/[^\\/]+)/,\r\n  basename: /^.*\\//,\r\n}\r\n","import type {Generic} from '../types'\r\n\r\nexport const storage: {\r\n  name: string\r\n  perm: Storage\r\n  copy: Generic\r\n  set(opt: string, value: boolean | string | number): void\r\n  get(opt?: string): string | number | boolean | Generic\r\n} = {\r\n  name: window.location.pathname || 'default',\r\n  perm: window.localStorage,\r\n  copy: {},\r\n  set: function (opt: string, value: boolean | string | number) {\r\n    const s: Generic = JSON.parse(this.perm.getItem(this.name) || '{}')\r\n    s[opt] = value\r\n    this.perm.setItem(this.name, JSON.stringify(s))\r\n  },\r\n  get: function (opt?: string) {\r\n    const s: Generic = JSON.parse(this.perm.getItem(this.name) || '{}')\r\n    return opt ? s[opt] : s\r\n  },\r\n}\r\n","import type {Entity} from '../types'\r\nimport type Community from './index'\r\nimport type {SiteOutputs} from './outputs/index'\r\n\r\nexport class Subscriptions {\r\n  site: Community\r\n  subs: {[index: string]: Map<string, SiteOutputs>}\r\n  constructor(site: Community) {\r\n    this.site = site\r\n    this.subs = {}\r\n  }\r\n  add(id: string, o: SiteOutputs) {\r\n    if (!(id in this.subs)) this.subs[id] = new Map()\r\n    this.subs[id].set(o.id, o)\r\n  }\r\n  update(id: string, fun: string, e: Entity) {\r\n    if (id in this.subs) {\r\n      const tu = this.site.outputs[id]\r\n      this.subs[id].forEach(u => {\r\n        if (fun in u) (u[fun as keyof SiteOutputs] as Function)(e, tu)\r\n      })\r\n    }\r\n  }\r\n}\r\n","export const keymap = {\r\n  Enter: 'select',\r\n  NumpadEnter: 'select',\r\n  ArrowUp: 'move',\r\n  Home: 'move',\r\n  ArrowDown: 'move',\r\n  End: 'move',\r\n  Escape: 'close',\r\n  Tab: 'close',\r\n}\r\nexport const filter_components = {\r\n  Time: ['first', 'selected', 'last'],\r\n  summary: ['missing', 'min', 'q1', 'mean', 'median', 'q3', 'max'],\r\n}\r\n\r\nexport const tooltip_icon_rule =\r\n  'button.has-note::after,.button-wrapper.has-note ' +\r\n  'button::before,.has-note legend::before,.has-note ' +\r\n  'label::before,.wrapper.has-note > div > label::before{display:none}'\r\n","import type {MeasureInfo, MeasureSource, OptionSets, ResourceField, SlimNote} from '../types'\r\nimport type {InputCombobox} from './inputs/combobox'\r\nimport type {SiteInputs} from './inputs/index'\r\nimport type {InputSelect} from './inputs/select'\r\nimport {patterns} from './patterns'\r\n\r\nexport function set_description(e: HTMLElement, info: MeasureInfo) {\r\n  let description = info.long_description || info.description || info.short_description || ''\r\n  const subs: Map<string, string> = new Map()\r\n  for (let l; (l = patterns.href.exec(description)); ) {\r\n    subs.set(l[0], '<a href=\"' + l[1] + '\" target=\"_blank\" rel=\"noreferrer\">' + (l.length > 2 ? l[2] : l[1]) + '</a>')\r\n  }\r\n  if (subs.size) {\r\n    subs.forEach((f, r) => {\r\n      description = description.replace(r, f)\r\n    })\r\n  }\r\n  let has_html = patterns.has_html.test(description)\r\n  if (has_html) {\r\n    const tags = description.split(patterns.bracket_content)\r\n    for (let i = tags.length; i--; ) {\r\n      const t = tags[i]\r\n      if (t && '/' !== t.substring(0, 1)) {\r\n        const p = t.split(patterns.space),\r\n          n = p.length\r\n        has_html = patterns.html_tags.test(p[0])\r\n        if (!has_html) break\r\n        for (let a = 1; a < n; a++) {\r\n          has_html = patterns.html_attributes.test(p[a])\r\n          if (!has_html) break\r\n        }\r\n        if (!has_html) break\r\n      }\r\n    }\r\n  }\r\n  e[has_html ? 'innerHTML' : 'innerText'] = description\r\n}\r\n\r\nexport function toggle_input(u: InputCombobox | InputSelect, enable?: boolean) {\r\n  if (enable && !u.e.classList.contains('locked')) {\r\n    u.e.removeAttribute('disabled')\r\n    u.e.classList.remove('disabled')\r\n    if ('combobox' === u.type) u.input_element.removeAttribute('disabled')\r\n  } else {\r\n    u.e.setAttribute('disabled', 'true')\r\n    u.e.classList.add('disabled')\r\n    if ('combobox' === u.type) u.input_element.setAttribute('disabled', 'true')\r\n  }\r\n}\r\n\r\nexport function fill_ids_options(u: InputCombobox | InputSelect, d: string, out: OptionSets, onend?: Function) {\r\n  if (!(d in u.site.data.sets)) {\r\n    u.site.data.data_queue[d][u.id] = () => {\r\n      u.loader && u.e.removeEventListener('click', u.loader)\r\n      fill_ids_options(u, d, out, onend)\r\n      u.set_current()\r\n      u.current_set = d\r\n    }\r\n    return\r\n  }\r\n  out[d] = {options: [], values: {}, display: {}}\r\n  const current = u.values,\r\n    s = out[d].options as HTMLOptionElement[],\r\n    values = out[d].values,\r\n    disp = out[d].display,\r\n    combobox = 'combobox' === u.type\r\n  let ck = !u.sensitive && !!u.current_set,\r\n    n = 0\r\n  if (u.settings.group) {\r\n    out[d].groups = {e: [], by_name: {}}\r\n    if (combobox && u.settings.accordion) {\r\n      u.listbox.classList.add('accordion')\r\n      u.listbox.id = u.id + '-listbox'\r\n    }\r\n  }\r\n  const ugroup = out[d].groups\r\n  Object.keys(u.site.data.entities).forEach(k => {\r\n    const entity = u.site.data.entities[k]\r\n    if (d === entity.group) {\r\n      if (ck && !(k in current)) {\r\n        u.sensitive = true\r\n        ck = false\r\n      }\r\n      if (ugroup) {\r\n        let groups = entity.features[u.settings.group] || ['No Group']\r\n        if (!Array.isArray(groups)) groups = [groups]\r\n        for (let g = groups.length; g--; ) {\r\n          const group: string = groups[g]\r\n          if (!(group in ugroup.by_name)) {\r\n            const e = document.createElement(combobox ? 'div' : 'optgroup')\r\n            if (combobox) {\r\n              const id = u.id + '_' + group.replace(patterns.seps, '-')\r\n              let ee\r\n              if (u.settings.accordion) {\r\n                e.setAttribute('data-group', group)\r\n                e.className = 'combobox-group accordion-item combobox-component'\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.className = 'accordion-header combobox-component'\r\n                ee.appendChild((ee = document.createElement('button')))\r\n                ee.id = id + '-label'\r\n                ee.innerText = group\r\n                ee.type = 'button'\r\n                ee.className = 'accordion-button combobox-component collapsed'\r\n                ee.setAttribute('data-bs-toggle', 'collapse')\r\n                ee.setAttribute('data-bs-target', '#' + id)\r\n                ee.setAttribute('aria-expanded', 'false')\r\n                ee.setAttribute('aria-controls', id)\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.id = id\r\n                ee.className = 'combobox-component accordion-collapse collapse'\r\n                ee.setAttribute('data-bs-parent', '#' + u.id + '-listbox')\r\n                ee.appendChild((ee = document.createElement('div')))\r\n                ee.className = 'accordion-body combobox-component'\r\n                ee.role = 'group'\r\n                ee.setAttribute('aria-labelledby', id + '-label')\r\n              } else {\r\n                e.className = 'combobox-group combobox-component'\r\n                e.id = id\r\n                e.role = 'group'\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.appendChild((ee = document.createElement('label')))\r\n                ee.dataset.for = id\r\n                ee.innerText = group\r\n                ee.id = id + '-label'\r\n                ee.className = 'combobox-group-label combobox-component'\r\n              }\r\n            } else {\r\n              e.setAttribute('aria-label', group)\r\n            }\r\n            ugroup.by_name[group] = e\r\n            ugroup.e.push(e)\r\n          }\r\n          const o = u.add(k, entity.features.name, true)\r\n          o.setAttribute('data-group', group)\r\n          if (combobox && u.settings.accordion) {\r\n            ugroup.by_name[group].lastElementChild.lastElementChild.appendChild(o)\r\n          } else {\r\n            ugroup.by_name[group].appendChild(o)\r\n          }\r\n        }\r\n      } else {\r\n        s.push(u.add(k, entity.features.name) as HTMLOptionElement)\r\n        values[k] = n\r\n        disp[entity.features.name] = n++\r\n      }\r\n    }\r\n  })\r\n  if (u.settings.group) {\r\n    n = 0\r\n    Object.keys(ugroup.by_name).forEach(g => {\r\n      ugroup.by_name[g].querySelectorAll(combobox ? '.combobox-option' : 'option').forEach((c: HTMLOptionElement) => {\r\n        s.push(c)\r\n        values[combobox ? c.dataset.value : c.value] = n\r\n        disp[c.innerText] = n++\r\n      })\r\n    })\r\n  }\r\n  onend && onend()\r\n}\r\n\r\nexport function fill_variables_options(u: InputCombobox | InputSelect, d: string, out: OptionSets) {\r\n  out[d] = {options: [], values: {}, display: {}}\r\n  const current = u.values,\r\n    s = out[d].options as HTMLOptionElement[],\r\n    values = out[d].values,\r\n    disp = out[d].display,\r\n    combobox = 'combobox' === u.type\r\n  let ck = !u.sensitive && !!u.current_set,\r\n    n = 0\r\n  if (u.settings.group) {\r\n    out[d].groups = {e: [], by_name: {}}\r\n    if (combobox && u.settings.accordion) {\r\n      u.listbox.classList.add('accordion')\r\n      u.listbox.id = u.id + '-listbox'\r\n    }\r\n  }\r\n  const url_set = u.site.url_options[u.id] as string,\r\n    ugroup = out[d].groups\r\n  let ck_suffix = false\r\n  if (url_set && !(url_set in u.site.data.variables)) {\r\n    u.site.url_options[u.id] = url_set.replace(patterns.pre_colon, '')\r\n    if (!(url_set in u.site.data.variables)) ck_suffix = true\r\n  }\r\n  u.site.data.info[d].schema.fields.forEach(m => {\r\n    const v = u.site.data.variables[m.name]\r\n    if (v && !v.is_time) {\r\n      const l = u.site.data.format_label(m.name)\r\n      if (ck && !(m.name in current)) {\r\n        u.sensitive = true\r\n        ck = false\r\n      }\r\n      if (ugroup) {\r\n        let groups = (m.info && m.info[u.settings.group as keyof MeasureInfo]) || ['No Group']\r\n        if (!Array.isArray(groups)) groups = [groups as string]\r\n        for (let g = groups.length; g--; ) {\r\n          const group = groups[g] as string\r\n          if (!(group in ugroup.by_name)) {\r\n            const e = document.createElement(combobox ? 'div' : 'optgroup')\r\n            if (combobox) {\r\n              const id = u.id + '_' + group.replace(patterns.seps, '-')\r\n              let ee\r\n              if (u.settings.accordion) {\r\n                e.setAttribute('data-group', group)\r\n                e.className = 'combobox-group accordion-item combobox-component'\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.className = 'accordion-header combobox-component'\r\n                ee.appendChild((ee = document.createElement('button')))\r\n                ee.id = id + '-label'\r\n                ee.innerText = group\r\n                ee.type = 'button'\r\n                ee.className = 'accordion-button combobox-component collapsed'\r\n                ee.setAttribute('data-bs-toggle', 'collapse')\r\n                ee.setAttribute('data-bs-target', '#' + id)\r\n                ee.setAttribute('aria-expanded', 'false')\r\n                ee.setAttribute('aria-controls', id)\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.id = id\r\n                ee.className = 'combobox-component accordion-collapse collapse'\r\n                ee.setAttribute('data-bs-parent', '#' + u.id + '-listbox')\r\n                ee.appendChild((ee = document.createElement('div')))\r\n                ee.className = 'accordion-body combobox-component'\r\n                ee.role = 'group'\r\n                ee.setAttribute('aria-labelledby', id + '-label')\r\n              } else {\r\n                e.className = 'combobox-group combobox-component'\r\n                e.role = 'group'\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.appendChild((ee = document.createElement('label')))\r\n                ee.dataset.for = id\r\n                ee.innerText = group\r\n                ee.id = id\r\n                ee.className = 'combobox-group-label combobox-component'\r\n              }\r\n            } else {\r\n              e.setAttribute('aria-label', group)\r\n            }\r\n            ugroup.by_name[group] = e\r\n            ugroup.e.push(e)\r\n          }\r\n          const o = u.add(m.name, l, true, m)\r\n          o.setAttribute('data-group', group)\r\n          if (combobox && u.settings.accordion) {\r\n            ugroup.by_name[group].lastElementChild.lastElementChild.appendChild(o)\r\n          } else {\r\n            ugroup.by_name[group].appendChild(o)\r\n          }\r\n        }\r\n      } else {\r\n        s.push(u.add(m.name, l, true, m) as HTMLOptionElement)\r\n        s[n].id = u.id + '-option' + n\r\n        values[m.name] = n\r\n        disp[l] = n++\r\n      }\r\n      if (ck_suffix && url_set === m.name.replace(patterns.pre_colon, '')) {\r\n        u.site.url_options[u.id] = m.name\r\n        ck_suffix = false\r\n      }\r\n    }\r\n  })\r\n  if (u.settings.group) {\r\n    n = 0\r\n    Object.keys(ugroup.by_name).forEach(g => {\r\n      ugroup.by_name[g].querySelectorAll(combobox ? '.combobox-option' : 'option').forEach((c: HTMLOptionElement) => {\r\n        s.push(c)\r\n        s[n].id = u.id + '-option' + n\r\n        values[combobox ? c.dataset.value : c.value] = n\r\n        disp[(c.firstChild && c.firstChild.textContent) || c.innerText] = n++\r\n      })\r\n    })\r\n  }\r\n  if (!u.settings.clearable && !(u.default in u.site.data.variables)) u.default = u.site.defaults.variable\r\n}\r\n\r\nexport function fill_overlay_properties_options(u: InputCombobox | InputSelect, source: string, out: OptionSets) {\r\n  out[source] = {options: [], values: {}, display: {}}\r\n  const current = u.values,\r\n    s = out[source].options as HTMLOptionElement[],\r\n    values = out[source].values,\r\n    disp = out[source].display,\r\n    combobox = 'combobox' === u.type\r\n  let ck = !u.sensitive && !!u.current_set,\r\n    n = 0\r\n  Object.keys(u.site.maps.queue[source].property_summaries).forEach(v => {\r\n    const l = u.site.data.format_label(v)\r\n    if (ck && !(l in current)) {\r\n      u.sensitive = true\r\n      ck = false\r\n    }\r\n    s.push(u.add(v, l) as HTMLOptionElement)\r\n    s[n].id = u.id + '-option' + n\r\n    values[v] = n\r\n    disp[l] = n++\r\n  })\r\n}\r\n\r\nexport function fill_levels_options(u: InputCombobox | InputSelect, d: string, v: string, out: OptionSets) {\r\n  const m = u.site.data.variables[v].info[d],\r\n    t = 'string' === m.type ? 'levels' : 'ids',\r\n    l = m[t]\r\n  if (l) {\r\n    const k = d + v\r\n    out[k] = {options: [], values: {}, display: {}}\r\n    const current = u.values,\r\n      s = out[k].options as HTMLOptionElement[],\r\n      values = out[k].values,\r\n      disp = out[k].display\r\n    let ck = !u.sensitive && !!u.current_set,\r\n      n = 0\r\n    Object.keys(l).forEach(k => {\r\n      const lk = l[k]\r\n      if (ck && !(k in current)) {\r\n        u.sensitive = true\r\n        ck = false\r\n      }\r\n      s.push(u.add(lk.id, lk.name, true) as HTMLOptionElement)\r\n      values[lk.id] = n\r\n      disp[lk.name] = n++\r\n    })\r\n  } else if ('ids' === t) {\r\n    u.site.data.data_queue[d][u.id] = function () {\r\n      return fill_levels_options(u, d, v, out)\r\n    }\r\n  }\r\n}\r\n\r\nexport function tooltip_trigger(this: SiteInputs | SlimNote): void {\r\n  if (this.site.spec.settings.hide_tooltips || this.id === this.site.page.tooltip.showing) return void 0\r\n  const tooltip = this.site.page.tooltip\r\n  tooltip.showing = this.id\r\n  ;(tooltip.e.firstElementChild as HTMLElement).innerText = this.note\r\n  tooltip.e.classList.remove('hidden')\r\n  const p = this.wrapper.getBoundingClientRect(),\r\n    t = tooltip.e.getBoundingClientRect()\r\n  tooltip.e.style.left = Math.max(0, Math.min(p.x, p.x + p.width / 2 - t.width / 2)) + 'px'\r\n  tooltip.e.style.top = p.y + (p.y < t.height ? p.height + 5 : -t.height - 5) + 'px'\r\n}\r\n\r\nexport function make_summary_table(\r\n  formatter: (v: number) => string | number,\r\n  parent: HTMLElement,\r\n  summary?: ResourceField,\r\n  additional?: {[index: string]: string}\r\n) {\r\n  parent.classList.add('info-summary-wrapper')\r\n  const table = document.createElement('table'),\r\n    headers = document.createElement('tr'),\r\n    row = document.createElement('tr')\r\n  table.className = 'info-summary'\r\n  table.appendChild(document.createElement('thead'))\r\n  table.appendChild(document.createElement('tbody'))\r\n  table.firstElementChild.appendChild(headers)\r\n  table.lastElementChild.appendChild(row)\r\n  if (additional) {\r\n    Object.keys(additional).forEach(h => {\r\n      const th = document.createElement('th'),\r\n        td = document.createElement('td')\r\n      headers.appendChild(th)\r\n      th.innerText = h\r\n      row.appendChild(td)\r\n      td.innerText = additional[h]\r\n    })\r\n  }\r\n  ;['NAs', 'Min', 'Q1', 'Mean', 'Median', 'Q3', 'Max'].forEach(h => {\r\n    const lower = h.toLowerCase() as keyof ResourceField\r\n    if (!summary || lower in summary) {\r\n      const th = document.createElement('th'),\r\n        td = document.createElement('td')\r\n      headers.appendChild(th)\r\n      th.innerText = h\r\n      row.appendChild(td)\r\n      td.innerText = summary ? formatter(summary[lower] as number) + '' : 'NA'\r\n    }\r\n  })\r\n  parent.appendChild(table)\r\n  return table\r\n}\r\n\r\nexport function make_variable_source(s: MeasureSource, table?: boolean) {\r\n  const e = document.createElement(table ? 'tr' : 'div')\r\n  let div = document.createElement('div'),\r\n    a = document.createElement('a'),\r\n    span = document.createElement('span'),\r\n    td = document.createElement('td'),\r\n    p = document.createElement('p')\r\n  if (table) {\r\n    if (s.name) {\r\n      e.appendChild(td)\r\n      if (s.url) {\r\n        td.appendChild(a)\r\n        a.target = '_blank'\r\n        a.rel = 'noreferrer'\r\n        a.href = s.url\r\n        a.innerText = s.name\r\n      } else {\r\n        td.appendChild(span)\r\n        span.innerText = s.name\r\n      }\r\n    }\r\n    if (s.date_accessed) {\r\n      e.appendChild((td = document.createElement('td')))\r\n      td.appendChild((span = document.createElement('span')))\r\n      span.innerText = s.date_accessed\r\n    }\r\n  } else {\r\n    e.className = 'card'\r\n    if (s.name) {\r\n      e.appendChild(div)\r\n      div.className = 'card-header'\r\n      if (s.url) {\r\n        div.appendChild(a)\r\n        a.target = '_blank'\r\n        a.rel = 'noreferrer'\r\n        a.href = s.url\r\n        a.innerText = s.name\r\n      } else {\r\n        div.appendChild(span)\r\n        span.innerText = s.name\r\n      }\r\n    }\r\n    e.appendChild(document.createElement('div'))\r\n    e.lastElementChild.className = 'card-body'\r\n    if (s.location) {\r\n      e.lastElementChild.appendChild(p)\r\n      p.appendChild((span = document.createElement('span')))\r\n      span.innerText = 'Location: '\r\n      p.appendChild((span = document.createElement('span')))\r\n      if (s.location_url) {\r\n        span.appendChild((a = document.createElement('a')))\r\n        a.target = '_blank'\r\n        a.rel = 'noreferrer'\r\n        a.href = s.location_url\r\n        a.innerText = s.location\r\n      } else {\r\n        span.innerText = s.location\r\n      }\r\n    }\r\n    if (s.date_accessed) {\r\n      e.lastElementChild.appendChild((p = document.createElement('p')))\r\n      p.appendChild((span = document.createElement('span')))\r\n      span.innerText = 'Date Accessed: '\r\n      p.appendChild((span = document.createElement('span')))\r\n      span.innerText = s.date_accessed\r\n    }\r\n  }\r\n  return e\r\n}\r\n","import type Community from './index'\r\nimport DataHandler from '../data_handler/index'\r\nimport type {BaseInput, SiteInputs} from './inputs/index'\r\nimport type {InputCombobox} from './inputs/combobox'\r\nimport type {InputNumber} from './inputs/number'\r\nimport {tooltip_icon_rule} from './static_refs'\r\nimport {fill_ids_options, fill_levels_options, fill_variables_options, toggle_input} from './utils'\r\nimport type {DataViewSelection, SiteDataView} from './dataview'\r\nimport type {OutputInfo} from './outputs/info'\r\nimport type {OutputPlotly} from './outputs/plotly'\r\nimport type {OutputMap} from './outputs/map'\r\nimport {GlobalView} from './global_view'\r\n\r\nexport function setting(this: Community, u: BaseInput) {\r\n  const current = this.spec.settings[u.setting],\r\n    v = u.value() as typeof current,\r\n    theme = v ? 'dark' : 'light'\r\n  if (v !== this.spec.settings[u.setting]) {\r\n    this.spec.settings[u.setting] = v\r\n    if ('theme_dark' === u.setting) {\r\n      v\r\n        ? document.body.classList.replace('light-theme', 'dark-theme')\r\n        : document.body.classList.replace('dark-theme', 'light-theme')\r\n      if (this.spec.plotly) Object.keys(this.spec.plotly).forEach(k => (this.outputs[k] as OutputPlotly).update_theme())\r\n      if (this.spec.map)\r\n        Object.keys(this.spec.map).forEach(k => {\r\n          const u = this.outputs[k] as OutputMap\r\n          if (u && theme in u.tiles) {\r\n            Object.keys(u.tiles).forEach(l => {\r\n              if (theme !== l) u.tiles[l].removeFrom(u.map)\r\n            })\r\n            u.tiles[theme].addTo(u.map)\r\n          }\r\n        })\r\n    } else if ('hide_url_parameters' === u.setting) {\r\n      window.history.replaceState(\r\n        Date.now(),\r\n        '',\r\n        this.spec.settings.hide_url_parameters\r\n          ? window.location.protocol + '//' + window.location.host + window.location.pathname\r\n          : this.get_options_url()\r\n      )\r\n    } else if ('hide_tooltips' === u.setting) {\r\n      v ? this.page.script_style.sheet.insertRule(tooltip_icon_rule, 0) : this.page.script_style.sheet.deleteRule(0)\r\n    } else if ('map_overlay' === u.setting) {\r\n      Object.keys(this.spec.map).forEach(id => {\r\n        if ('_' !== id[0]) {\r\n          const mu = this.outputs[id] as OutputMap\r\n          if (v) {\r\n            mu.update()\r\n          } else {\r\n            mu.overlay.clearLayers()\r\n            mu.overlay_control.remove()\r\n          }\r\n        }\r\n      })\r\n    } else if ('tracking' === u.setting) {\r\n      if (v && this.spec.tag_id) {\r\n        this.gtag('js', new Date())\r\n        this.gtag('config', this.spec.tag_id)\r\n        this.gtag('consent', 'default', {analytics_storage: 'denied'})\r\n      }\r\n      this.gtag('consent', 'update', {analytics_storage: v ? 'granted' : 'denied'})\r\n    } else {\r\n      this.global_update()\r\n    }\r\n    this.gtag('event', 'setting', {event_category: u.setting, event_label: v})\r\n    this.storage.set(u.setting, this.spec.settings[u.setting])\r\n  }\r\n}\r\nexport function options(this: Community, u: InputCombobox) {\r\n  const no_view = !u.view || !this.dataviews[u.view].selection,\r\n    d = (this.valueOf(u.dataset || no_view || this.spec.dataviews[u.view].dataset) || this.defaults.dataset) as string,\r\n    va = this.valueOf(u.variable) as string,\r\n    k = d + (va ? va : ''),\r\n    combobox = 'combobox' === u.type\r\n  if (!(k in u.option_sets)) {\r\n    if (this.patterns.variable.test(u.optionSource)) {\r\n      if ('number' === typeof u.default && -1 === u.default) u.default = this.defaults.variable\r\n      fill_variables_options(u, d, u.option_sets)\r\n    } else if (this.patterns.levels.test(u.optionSource)) {\r\n      fill_levels_options(u, d, va, u.option_sets)\r\n    } else if (this.patterns.ids.test(u.optionSource)) {\r\n      fill_ids_options(u, d, u.option_sets)\r\n    }\r\n  }\r\n  if (k in u.option_sets) {\r\n    const fresh = k !== u.current_set && (u.sensitive || !u.current_set),\r\n      c = u[combobox ? 'listbox' : 'e']\r\n    if (fresh || u.filter || u.selection_subset) {\r\n      if (fresh) {\r\n        c.innerHTML = ''\r\n        if (u.option_sets[k].groups) u.groups = u.option_sets[k].groups\r\n        u.values = u.option_sets[k].values\r\n        u.display = u.option_sets[k].display\r\n        u.options = u.option_sets[k].options as HTMLDivElement[]\r\n      }\r\n      let ns = 0\r\n      if ('ID' === u.variable || this.patterns.ids.test(u.optionSource)) {\r\n        const value = u.value()\r\n        let selection = -1 === value || '' === value ? u.subset : u.selection_subset,\r\n          v = {}\r\n        if (!no_view) {\r\n          if (selection in this.inputs) selection = this.valueOf(selection) as string\r\n          if ('siblings' === selection) {\r\n            const rel = this.data.entity_tree && this.data.entity_tree[value as string]\r\n            if (rel) {\r\n              const parents = Object.keys(rel.parents)\r\n              if (parents.length) {\r\n                v = {}\r\n                parents.forEach(id => {\r\n                  v = {...v, ...this.data.entity_tree[id].children}\r\n                })\r\n              }\r\n            }\r\n          } else {\r\n            v = this.dataviews[u.view].selection[selection as keyof DataViewSelection]\r\n          }\r\n        }\r\n        u.options.forEach((si: HTMLDivElement | HTMLOptionElement) => {\r\n          if (fresh && !u.groups) c.appendChild(si)\r\n          if (no_view || (combobox ? si.dataset.value : (si as HTMLOptionElement).value) in v) {\r\n            si.classList.remove('hidden')\r\n            ns++\r\n          } else {\r\n            si.classList.add('hidden')\r\n          }\r\n        })\r\n      } else if (fresh) {\r\n        u.options.forEach(si => {\r\n          si.classList.remove('hidden')\r\n          if (!u.groups) c.appendChild(si)\r\n          ns++\r\n        })\r\n      } else ns++\r\n      if (fresh && u.groups) u.groups.e.forEach(e => c.appendChild(e))\r\n      toggle_input(u, !!ns)\r\n      u.current_set = k\r\n      if (fresh) {\r\n        if (combobox) {\r\n          u.source = []\r\n        } else {\r\n          ;(u.e as HTMLSelectElement).selectedIndex = -1\r\n          u.source = ''\r\n        }\r\n        u.id in this.url_options\r\n          ? u.set(this.url_options[u.id] as string | number)\r\n          : u.state in u.values\r\n          ? u.set(u.state)\r\n          : u.reset()\r\n      }\r\n      if (u.filter) u.filter()\r\n    }\r\n  }\r\n}\r\nexport async function min(this: Community, u: InputNumber, c: InputNumber) {\r\n  let cv = c.value() as string | number,\r\n    uv = u.value(),\r\n    v = this.dataviews[u.view || c.view],\r\n    variable\r\n  if ('string' === typeof cv) {\r\n    cv = this.patterns.minmax.test(cv) ? c.parsed.min : parseFloat(cv)\r\n  }\r\n  if (v && v.y) {\r\n    variable = this.valueOf(v.y) as string\r\n    if (variable in this.data.variables) {\r\n      if (!v.time_range.time.length) await this.conditionals.time_range(v, u, true)\r\n      cv = Math.max(v.time_range.time[0], cv)\r\n    }\r\n    u.update()\r\n  }\r\n  u.e.min = ('undefined' === typeof u.parsed.min ? cv : Math.max(u.parsed.min, cv)) + ''\r\n  if (!u.e.value) {\r\n    u.reset()\r\n  } else if ('number' === typeof uv && isFinite(uv) && uv < cv) {\r\n    u.set(cv)\r\n  }\r\n  if (u.min_indicator) (u.min_indicator.firstElementChild as HTMLElement).innerText = cv + ''\r\n}\r\nexport async function max(this: Community, u: InputNumber, c: InputNumber) {\r\n  let cv = c.value() as string | number,\r\n    uv = u.value(),\r\n    v = this.dataviews[u.view || c.view],\r\n    variable: string\r\n  if ('string' === typeof cv) {\r\n    cv = this.patterns.minmax.test(cv) ? c.parsed.min : parseFloat(cv)\r\n  }\r\n  if (v && v.y) {\r\n    variable = this.valueOf(v.y) as string\r\n    if (variable in this.data.variables) {\r\n      if (!v.time_range.time.length) await this.conditionals.time_range(v, u, true)\r\n      cv = Math.min(v.time_range.time[1], cv)\r\n    }\r\n    u.update()\r\n  }\r\n  u.e.max = ('undefined' === typeof u.parsed.max ? cv : Math.min(u.parsed.max, cv)) + ''\r\n  if (!u.e.value) {\r\n    u.reset()\r\n  } else if ('number' === typeof uv && isFinite(uv) && uv > cv) {\r\n    u.set(cv)\r\n  }\r\n  if (u.max_indicator) (u.max_indicator.firstElementChild as HTMLElement).innerText = cv + ''\r\n}\r\nexport function time_filters(this: Community, u: SiteDataView) {\r\n  u.time_range.filtered[0] = Infinity\r\n  u.time_range.filtered[1] = -Infinity\r\n  const d = u.get.dataset(),\r\n    time = this.data.meta.times[d],\r\n    current = u.time_range.filtered_index + ''\r\n  if (!this.data.inited[d]) return\r\n  for (let i = time.n; i--; ) {\r\n    let pass = false\r\n    if (i >= u.time_range.index[0] && i <= u.time_range.index[1]) {\r\n      for (let f = u.time_filters.length; f--; ) {\r\n        const v: {[index: string]: number} = {},\r\n          tf = u.time_filters[f]\r\n        if (!(tf.value in v)) v[tf.value] = this.valueOf(tf.value) as number\r\n        pass = DataHandler.checks[tf.type](time.value[i], v[tf.value])\r\n        if (!pass) break\r\n      }\r\n    }\r\n    u.times[i] = pass\r\n    if (pass) {\r\n      if (u.time_range.filtered[0] > time.value[i]) u.time_range.filtered[0] = time.value[i]\r\n      if (u.time_range.filtered[1] < time.value[i]) u.time_range.filtered[1] = time.value[i]\r\n    }\r\n  }\r\n  u.time_range.filtered_index = [\r\n    u.time_range.index[0] + u.time_range.filtered[0] - u.time_range.time[0],\r\n    u.time_range.index[1] + u.time_range.filtered[1] - u.time_range.time[1],\r\n  ]\r\n  if (current !== u.time_range.filtered_index + '') {\r\n    const c = this.dependencies[u.id + '_filter']\r\n    if (c)\r\n      c.forEach(ci => {\r\n        if ('update' === ci.type) {\r\n          if (ci.id in this.inputs) {\r\n            ;(this.inputs[ci.id] as InputNumber).update()\r\n          } else {\r\n            ;(this.outputs[ci.id] as OutputInfo).update()\r\n          }\r\n        } else if (ci.type in this.conditionals) {\r\n          this.conditionals[ci.type as keyof typeof this.conditionals](this.inputs[ci.id], u)\r\n        }\r\n      })\r\n  }\r\n}\r\nexport async function time_range(this: Community, u: SiteDataView, c?: GlobalView | SiteInputs, passive?: boolean) {\r\n  const v = c && 'value' in c && (c.value() as string),\r\n    d = u.get.dataset(),\r\n    tv = u.time ? (this.valueOf(u.time) as string) : this.defaults.time,\r\n    t = tv in this.data.variables ? this.data.variables[tv].info[d].min : 1,\r\n    s = this.dependencies[u.id + '_time'],\r\n    variable = v in this.data.variables ? v : (this.valueOf(u.y) as string)\r\n  let r = variable && (await this.data.get_variable(variable, u))\r\n  if (r) {\r\n    const reset = d + variable != u.time_range.dataset + u.time_range.variable\r\n    const range = r.time_range[d]\r\n    if (-1 !== range[0]) {\r\n      u.time_range.dataset = d\r\n      u.time_range.variable = variable\r\n      u.time_range.index[0] = range[0]\r\n      u.time_range.time[0] = u.time_range.filtered[0] = t + range[0]\r\n      u.time_range.index[1] = range[1]\r\n      u.time_range.time[1] = u.time_range.filtered[1] = t + range[1]\r\n    }\r\n    if (!passive && s) {\r\n      s.forEach(si => {\r\n        const su = this.inputs[si.id] as InputNumber,\r\n          value = su.value() as number\r\n        if ('min' === si.type) {\r\n          if (reset || (isFinite(u.time_range.time[0]) && parseFloat(su.e.min) !== u.time_range.time[0])) {\r\n            su.e.min = u.time_range.time[0] + ''\r\n            if (reset || !this.meta.retain_state || u.time_range.time[0] > value) {\r\n              su.current_default = u.time_range.time[0]\r\n              su.set(su.current_default)\r\n            }\r\n          }\r\n        } else if ('max' === si.type) {\r\n          if (reset || (isFinite(u.time_range.time[1]) && parseFloat(su.e.max) !== u.time_range.time[1])) {\r\n            su.e.max = u.time_range.time[1] + ''\r\n            if (reset || !this.meta.retain_state || u.time_range.time[1] < value || value < u.time_range.time[0]) {\r\n              su.current_default = u.time_range.time[1]\r\n              su.set(su.current_default)\r\n            }\r\n          }\r\n        }\r\n      })\r\n      this.conditionals.time_filters(u)\r\n    }\r\n  } else {\r\n    u.time_range.dataset = d\r\n    u.time_range.index[0] = 0\r\n    u.time_range.time[0] = u.time_range.filtered[0] = 1\r\n    u.time_range.index[1] = 0\r\n    u.time_range.time[1] = u.time_range.filtered[1] = 1\r\n  }\r\n}\r\n","interface BasePalette {\r\n  name: string\r\n  odd?: number\r\n}\r\nexport interface DiscretePalette extends BasePalette {\r\n  type: 'discrete'\r\n  colors: string[]\r\n}\r\ntype triple = [number, number, number]\r\ninterface ContinuousPalette extends BasePalette {\r\n  type: 'continuous' | 'continuous-divergent'\r\n  colors: [[triple, triple], triple, [triple, triple]]\r\n}\r\ninterface PolynomialPalette extends BasePalette {\r\n  type: 'continuous-polynomial'\r\n  colors: triple[]\r\n}\r\n\r\ntype SitePalette = {\r\n  [index: string]: DiscretePalette | ContinuousPalette | PolynomialPalette\r\n}\r\n\r\nexport const palettes: SitePalette = {\r\n  // discrete palettes from https://colorbrewer2.org\r\n  rdylbu7: {\r\n    name: 'Red-Yellow-Blue (7)',\r\n    type: 'discrete',\r\n    colors: ['#d73027', '#fc8d59', '#fee090', '#adadad', '#e0f3f8', '#91bfdb', '#4575b4'],\r\n  },\r\n  orrd7: {\r\n    name: 'Orange-Red (7)',\r\n    type: 'discrete',\r\n    colors: ['#fef0d9', '#fdd49e', '#fdbb84', '#fc8d59', '#ef6548', '#d7301f', '#990000'],\r\n  },\r\n  gnbu7: {\r\n    name: 'Green-Blue (7)',\r\n    type: 'discrete',\r\n    colors: ['#a8ddb5', '#ccebc5', '#f0f9e8', '#adadad', '#4eb3d3', '#2b8cbe', '#08589e'],\r\n  },\r\n  brbg7: {\r\n    name: 'Brown-Teal (7)',\r\n    type: 'discrete',\r\n    colors: ['#8c510a', '#d8b365', '#f6e8c3', '#adadad', '#c7eae5', '#5ab4ac', '#01665e'],\r\n  },\r\n  puor7: {\r\n    name: 'Purple-Orange (7)',\r\n    type: 'discrete',\r\n    colors: ['#b35806', '#f1a340', '#fee0b6', '#adadad', '#d8daeb', '#998ec3', '#542788'],\r\n  },\r\n  prgn6: {\r\n    name: 'Purple-Green (6)',\r\n    type: 'discrete',\r\n    colors: ['#762a83', '#af8dc3', '#e7d4e8', '#d9f0d3', '#7fbf7b', '#1b7837'],\r\n  },\r\n  reds5: {\r\n    name: 'Red (5)',\r\n    type: 'discrete',\r\n    colors: ['#f1eef6', '#d7b5d8', '#df65b0', '#dd1c77', '#980043'],\r\n  },\r\n  greens5: {\r\n    name: 'Green (5)',\r\n    type: 'discrete',\r\n    colors: ['#ffffcc', '#c2e699', '#78c679', '#31a354', '#006837'],\r\n  },\r\n  paired4: {\r\n    name: 'Blue-Green (4)',\r\n    type: 'discrete',\r\n    colors: ['#1f78b4', '#a6cee3', '#b2df8a', '#33a02c'],\r\n  },\r\n  greys4: {\r\n    name: 'Grey (4)',\r\n    type: 'discrete',\r\n    colors: ['#f7f7f7', '#cccccc', '#969696', '#525252'],\r\n  },\r\n  grey: {\r\n    name: 'Grey',\r\n    type: 'continuous',\r\n    colors: [\r\n      [\r\n        [70, 70, 70],\r\n        [80, 80, 80],\r\n      ],\r\n      [150, 150, 150],\r\n      [\r\n        [230, 230, 230],\r\n        [-80, -80, -80],\r\n      ],\r\n    ],\r\n  },\r\n  brown: {\r\n    name: 'Brown',\r\n    type: 'continuous',\r\n    colors: [\r\n      [\r\n        [131, 30, 0],\r\n        [62, 85, 95],\r\n      ],\r\n      [193, 115, 95],\r\n      [\r\n        [255, 200, 190],\r\n        [-62, -85, -95],\r\n      ],\r\n    ],\r\n  },\r\n  purple: {\r\n    name: 'Purple',\r\n    type: 'continuous',\r\n    colors: [\r\n      [\r\n        [90, 14, 213],\r\n        [52.5, 89, 16],\r\n      ],\r\n      [142.5, 103, 229],\r\n      [\r\n        [195, 192, 245],\r\n        [-52.5, -89, -16],\r\n      ],\r\n    ],\r\n  },\r\n  prgn: {\r\n    name: 'Purple-Green',\r\n    type: 'continuous-divergent',\r\n    colors: [\r\n      [\r\n        [27, 120, 55],\r\n        [207, 107, 168.5],\r\n      ],\r\n      [234, 227, 223.5],\r\n      [\r\n        [118, 42, 131],\r\n        [116, 185, 92.5],\r\n      ],\r\n    ],\r\n  },\r\n  puor: {\r\n    name: 'Purple-Orange',\r\n    type: 'continuous-divergent',\r\n    colors: [\r\n      [\r\n        [179, 88, 6],\r\n        [56, 133, 202.5],\r\n      ],\r\n      [235, 221, 208.5],\r\n      [\r\n        [84, 39, 136],\r\n        [151, 182, 72.5],\r\n      ],\r\n    ],\r\n  },\r\n  rdbu: {\r\n    name: 'Red-Blue',\r\n    type: 'continuous-divergent',\r\n    colors: [\r\n      [\r\n        [69, 117, 180],\r\n        [170, 116.5, 16],\r\n      ],\r\n      [239, 233.5, 196],\r\n      [\r\n        [215, 48, 39],\r\n        [24, 185.5, 157],\r\n      ],\r\n    ],\r\n  },\r\n  vik: {\r\n    name: 'vik',\r\n    type: 'continuous-polynomial',\r\n    colors: [\r\n      [97.031, 18.4251, 0.4149],\r\n      [461.7602, 637.5326, 244.4647],\r\n      [-2434.798, -2838.5427, -5893.4695],\r\n      [9665.3469, 14405.823, 44072.722],\r\n      [-2575.9109, -25871.106, -109792.1319],\r\n      [-42510.0569, 8528.3288, 120953.8594],\r\n      [63342.3061, 14006.291, -59644.4457],\r\n      [-26045.0391, -8868.9621, 10155.5667],\r\n    ],\r\n  },\r\n  lajolla: {\r\n    name: 'lajolla',\r\n    type: 'continuous-polynomial',\r\n    colors: [\r\n      [256.0016, 255.9138, 204.945],\r\n      [-187.6735, -46.2889, -768.5655],\r\n      [1022.785, -1057.5602, 1782.0325],\r\n      [-2032.382, 1490.8271, -1785.9056],\r\n      [966.8373, -617.1949, 567.7715],\r\n    ],\r\n  },\r\n}\r\n","import {tooltip_trigger} from '../utils'\r\nimport type {LogicalObject, SiteRule, SiteSpec} from '../../types'\r\nimport type Community from '../index'\r\nimport type {InputButton} from './button'\r\nimport type {InputButtonGroup} from './buttongroup'\r\nimport type {InputCheckbox} from './checkbox'\r\nimport type {InputCombobox} from './combobox'\r\nimport type {InputNumber} from './number'\r\nimport type {InputRadio} from './radio'\r\nimport type {InputSelect} from './select'\r\nimport type {InputVirtual} from './virtual'\r\nimport type {InputSwitch} from './switch'\r\nimport type {InputText} from './text'\r\n\r\ntype InputTypes =\r\n  | 'number'\r\n  | 'radio'\r\n  | 'switch'\r\n  | 'checkbox'\r\n  | 'button'\r\n  | 'text'\r\n  | 'buttongroup'\r\n  | 'select'\r\n  | 'combobox'\r\n  | 'virtual'\r\nexport type SiteInputs =\r\n  | InputCombobox\r\n  | InputSelect\r\n  | InputNumber\r\n  | InputButton\r\n  | InputVirtual\r\n  | InputRadio\r\n  | InputText\r\n  | InputSwitch\r\n  | InputCheckbox\r\n  | InputButtonGroup\r\nexport type RegisteredInputs = {[index: string]: SiteInputs}\r\n\r\nexport abstract class BaseInput {\r\n  type: InputTypes\r\n  input = true\r\n  site: Community\r\n  e: HTMLElement\r\n  wrapper: HTMLElement\r\n  id: string\r\n  settings: {[index: string]: any} = {}\r\n  default: string | string[] | number\r\n  source: boolean | string | number | (string | number)[]\r\n  optionSource: string\r\n  subset: string\r\n  selection_subset: string\r\n  depends: string | LogicalObject\r\n  variable: string\r\n  dataset: string\r\n  view: string\r\n  note: string\r\n  current_index: number | number[] = -1\r\n  previous: boolean | string | number | (string | number)[] = ''\r\n  state = 'initial'\r\n  setting?: string\r\n  deferred?: boolean\r\n  rule?: SiteRule\r\n  constructor(e: HTMLElement, site: Community) {\r\n    this.e = e\r\n    this.site = site\r\n    this.default = e.dataset.default\r\n    this.optionSource = e.dataset.optionsource\r\n    this.subset = e.dataset.subset || 'all'\r\n    this.selection_subset = e.dataset.selectionsubset || this.subset\r\n    this.depends = e.dataset.depends\r\n    this.variable = e.dataset.variable\r\n    this.dataset = e.dataset.dataset\r\n    this.view = e.dataset.view\r\n    this.id = e.id || this.optionSource || 'ui' + site.page.elementCount++\r\n    this.note = e.getAttribute('aria-description') || ''\r\n    this.type = e.dataset.autotype as InputTypes\r\n    if (this.type in site.spec) {\r\n      const spec = site.spec[this.type as keyof SiteSpec] as SiteInputs\r\n      if (this.id in spec) this.settings = (spec as any)[this.id]\r\n    }\r\n    if (e.parentElement)\r\n      this.wrapper = e.parentElement.classList.contains('wrapper') ? e.parentElement : e.parentElement.parentElement\r\n    if (this.wrapper) {\r\n      if (this.note) this.wrapper.classList.add('has-note')\r\n      this.wrapper.setAttribute('data-of', this.id)\r\n      ;['div', 'span', 'label', 'fieldset', 'legend', 'input', 'button'].forEach(type => {\r\n        const c = this.wrapper.querySelectorAll(type)\r\n        if (c.length) c.forEach(ci => ci.setAttribute('data-of', this.id))\r\n      })\r\n    }\r\n    if (this.note) {\r\n      const trigger = tooltip_trigger.bind(this)\r\n      this.wrapper.addEventListener('mouseover', trigger)\r\n      const p = 'DIV' !== e.tagName ? e : e.querySelector('input')\r\n      if (p) {\r\n        p.addEventListener('focus', trigger)\r\n        p.addEventListener('blur', this.site.page.tooltip_clear)\r\n      }\r\n    }\r\n    if (site.patterns.number.test(this.default)) this.default = +this.default\r\n  }\r\n  value() {\r\n    if (Array.isArray(this.source)) return this.source\r\n    const v = this.site.valueOf(this.source)\r\n    return 'undefined' === typeof v ? this.site.valueOf(this.default) : v\r\n  }\r\n  set(v: any) {\r\n    this.source = v\r\n  }\r\n  reset() {\r\n    this.set(this.site.valueOf(this.default))\r\n  }\r\n}\r\n","import type {MeasureInfo} from '../types'\r\nimport type {InputCombobox} from './inputs/combobox'\r\nimport type {InputSelect} from './inputs/select'\r\n\r\nexport function options_filter(this: InputCombobox | InputSelect) {\r\n  if (this.settings.filters) {\r\n    Object.keys(this.settings.filters).forEach(f => {\r\n      this.current_filter[f] = this.site.valueOf(this.settings.filters[f]) as keyof MeasureInfo\r\n    })\r\n    let first = ''\r\n    Object.keys(this.values).forEach((v, i) => {\r\n      let pass = false\r\n      if (v in this.site.data.variables && 'meta' in this.site.data.variables[v]) {\r\n        const info = this.site.data.variables[v].meta as MeasureInfo\r\n        for (const k in this.current_filter)\r\n          if (k in info) {\r\n            pass = info[k as keyof MeasureInfo] === this.current_filter[k]\r\n            if (!pass) break\r\n          }\r\n      }\r\n      if (pass && !first) first = v\r\n      this.options[i].classList[pass ? 'remove' : 'add']('hidden')\r\n    })\r\n    this.current_index = this.values[this.value() as string]\r\n    if (first && (-1 === this.current_index || this.options[this.current_index].classList.contains('hidden'))) {\r\n      this.set(first)\r\n    }\r\n  }\r\n}\r\n\r\nexport function set_current_options(this: InputCombobox | InputSelect) {\r\n  const to = this.option_sets[this.dataset]\r\n  this.values = to.values\r\n  this.display = to.display\r\n  this.options = to.options as typeof this.options\r\n  this.groups = to.groups\r\n  this.source = ''\r\n  this.id in this.site.url_options\r\n    ? this.set(this.site.url_options[this.id] as string)\r\n    : this.state in this.values\r\n    ? this.set(this.state)\r\n    : this.reset()\r\n}\r\n\r\nexport function loader(this: InputCombobox | InputSelect) {\r\n  if (!this.e.classList.contains('locked')) {\r\n    this.deferred = false\r\n    this.e.removeEventListener('click', this.loader)\r\n    this.site.request_queue(false, this.id)\r\n  }\r\n}\r\n","import type {VariableFilterParsed} from '../types'\r\nimport type {DataViewParsed} from './dataview'\r\nimport {patterns} from './patterns'\r\n\r\ntype TimeFuns = {\r\n  number: Function\r\n  first: Function\r\n  selected: Function\r\n  last: Function\r\n}\r\n\r\nconst time_funs = {\r\n  number: function (this: number, v: VariableFilterParsed) {\r\n    return this - v.range[0]\r\n  },\r\n  first: function (v: VariableFilterParsed) {\r\n    return 0\r\n  },\r\n  selected: function (v: VariableFilterParsed, p: DataViewParsed) {\r\n    return p.time_agg - v.range[0]\r\n  },\r\n  last: function (v: VariableFilterParsed) {\r\n    return v.range[1] - v.range[0]\r\n  },\r\n}\r\n\r\nexport function component_fun(times: number[], c: string | number): Function {\r\n  if ('string' === typeof c && patterns.number.test(c)) {\r\n    c = times.indexOf(+c)\r\n    if (-1 === c)\r\n      return function () {\r\n        return NaN\r\n      }\r\n  }\r\n  return 'number' === typeof c\r\n    ? time_funs.number.bind(c)\r\n    : c in time_funs\r\n    ? time_funs[c as keyof TimeFuns]\r\n    : function () {\r\n        return NaN\r\n      }\r\n}\r\n","import DataHandler from '../data_handler/index'\r\nimport type {Entities, Entity, Filter, Generic, SiteCondition, VariableFilterParsed} from '../types'\r\nimport Community from './index'\r\nimport {component_fun} from './time_funs'\r\n\r\ntype VariableCondition = {\r\n  variable: string\r\n  type?: string\r\n  value?: string | number\r\n  operator?: string\r\n  component?: string\r\n}\r\n\r\nexport type DataViewSpec = {\r\n  dataset?: string\r\n  ids?: string\r\n  palette?: string\r\n  time?: string\r\n  time_agg?: string\r\n  time_filters?: VariableCondition[]\r\n  x?: string\r\n  y?: string\r\n}\r\n\r\nexport type DataViewParsed = {\r\n  dataset: string\r\n  ids: EntitySelection | false\r\n  features: string\r\n  variables: string\r\n  time_filters: string\r\n  time_agg: number\r\n  id_source: string\r\n  palette: string\r\n  variable_values: Map<string, VariableFilterParsed>\r\n  feature_values: {[index: string]: Filter}\r\n}\r\n\r\ntype EntitySelection = {[index: string]: boolean | Entity}\r\n\r\nexport type DataViewSelection = {\r\n  ids: Entities\r\n  children: Entities\r\n  features: Entities\r\n  variables: Entities\r\n  dataset: Entities\r\n  filtered: Entities\r\n  full_filter: Entities\r\n  all: Entities\r\n}\r\ntype DataViewSelectionCount = {\r\n  ids: number\r\n  children: number\r\n  features: number\r\n  variables: number\r\n  dataset: number\r\n  filtered: number\r\n  full_filter: number\r\n  all: number\r\n}\r\n\r\nexport class SiteDataView {\r\n  id: string\r\n  palette: string\r\n  y: string\r\n  x: string\r\n  time: string\r\n  time_agg: string | number\r\n  time_filters: VariableCondition[]\r\n  time_range = {\r\n    dataset: '',\r\n    variable: '',\r\n    filtered: [-Infinity, Infinity],\r\n    filtered_index: [-Infinity, Infinity],\r\n    index: [-Infinity, Infinity],\r\n    time: [-Infinity, Infinity],\r\n  }\r\n  dataset: string\r\n  ids: string\r\n  features: Generic\r\n  state = 'initial'\r\n  valid: {[index: string]: boolean} = {}\r\n  get: {\r\n    dataset: () => string\r\n    single_id: () => string\r\n    ids: () => EntitySelection | false\r\n    features: () => string\r\n    variables: () => string\r\n    time_filters: () => string\r\n  }\r\n  checks: {\r\n    dataset: (e: Entity) => boolean\r\n    ids: (e: Entity) => boolean\r\n    features: (e: Entity) => boolean\r\n    variables: (e: Entity) => boolean\r\n  }\r\n  site: Community\r\n  parsed: DataViewParsed = {\r\n    dataset: '',\r\n    ids: false,\r\n    features: '',\r\n    variables: '',\r\n    time_filters: '',\r\n    time_agg: 0,\r\n    id_source: '',\r\n    palette: '',\r\n    variable_values: new Map(),\r\n    feature_values: {},\r\n  }\r\n  selection: DataViewSelection = {\r\n    ids: {},\r\n    children: {},\r\n    features: {},\r\n    variables: {},\r\n    dataset: {},\r\n    filtered: {},\r\n    full_filter: {},\r\n    all: {},\r\n  }\r\n  n_selected: DataViewSelectionCount = {\r\n    ids: 0,\r\n    children: 0,\r\n    features: 0,\r\n    variables: 0,\r\n    dataset: 0,\r\n    filtered: 0,\r\n    full_filter: 0,\r\n    all: 0,\r\n  }\r\n  variables: VariableCondition[]\r\n  times: boolean[]\r\n  constructor(site: Community, id: string, spec?: DataViewSpec) {\r\n    this.site = site\r\n    this.id = id\r\n    this.update = this.update.bind(this)\r\n    site.dataviews[id] = this\r\n    if (spec)\r\n      Object.keys(spec).forEach((k: keyof DataViewSpec) => {\r\n        ;(this as any)[k] = spec[k]\r\n      })\r\n    if ('string' === typeof this.palette && this.palette in this.site.inputs) {\r\n      this.site.add_dependency(this.palette, {type: 'dataview', id: id})\r\n    }\r\n    if ('string' === typeof this.dataset && this.dataset in this.site.inputs) {\r\n      this.site.add_dependency(this.dataset, {type: 'dataview', id: id})\r\n    }\r\n    if ('string' === typeof this.ids && this.ids in this.site.inputs) {\r\n      this.site.add_dependency(this.ids, {type: 'dataview', id: id})\r\n    }\r\n    this.site.add_dependency(id, {type: 'time_range', id: id})\r\n    this.site.add_dependency('view.filter', {type: 'dataview', id: id})\r\n    this.site.add_dependency('view.id', {type: 'dataview', id: id})\r\n    if (this.x in this.site.inputs) this.site.add_dependency(this.x, {type: 'time_range', id: id})\r\n    if (this.y in this.site.inputs) this.site.add_dependency(this.y, {type: 'time_range', id: id})\r\n    if (this.features) {\r\n      Object.keys(this.features).forEach(f => {\r\n        const value = this.features[f]\r\n        if ('string' === typeof value && value in this.site.inputs) {\r\n          this.site.add_dependency(value, {type: 'dataview', id: id})\r\n        }\r\n      })\r\n    }\r\n    if (this.variables) {\r\n      this.variables.forEach(v => {\r\n        if (v.variable in this.site.inputs) {\r\n          this.site.add_dependency(v.variable, {type: 'dataview', id: id})\r\n        }\r\n        if (!('type' in v)) v.type = '='\r\n        if (v.type in this.site.inputs) {\r\n          this.site.add_dependency(v.type, {type: 'dataview', id: id})\r\n        }\r\n        if (!('value' in v)) v.value = 0\r\n        if ('string' === typeof v.value && v.value in this.site.inputs) {\r\n          this.site.add_dependency(v.value, {type: 'dataview', id: id})\r\n        }\r\n      })\r\n    }\r\n    this.compile()\r\n  }\r\n  value() {\r\n    if (this.get) {\r\n      this.reparse()\r\n      return (\r\n        '' +\r\n        this.parsed.dataset +\r\n        this.site.view.entities.size +\r\n        this.site.data.inited[this.parsed.dataset] +\r\n        this.parsed.id_source +\r\n        Object.keys(this.parsed.ids) +\r\n        this.parsed.features +\r\n        this.parsed.variables +\r\n        this.parsed.palette +\r\n        this.site.spec.settings.summary_selection\r\n      )\r\n    }\r\n  }\r\n  update() {\r\n    const state = this.value()\r\n    if (state !== this.state && this.site.view.registered[this.parsed.dataset]) {\r\n      if (this.site.data.inited[this.parsed.dataset]) {\r\n        this.valid[this.parsed.dataset] = true\r\n        this.n_selected.ids = 0\r\n        this.n_selected.children = 0\r\n        this.n_selected.features = 0\r\n        this.n_selected.variables = 0\r\n        this.n_selected.dataset = 0\r\n        this.n_selected.filtered = 0\r\n        this.n_selected.full_filter = 0\r\n        this.n_selected.all = 0\r\n        this.selection.ids = {}\r\n        this.selection.children = {}\r\n        this.selection.features = {}\r\n        this.selection.variables = {}\r\n        this.selection.dataset = {}\r\n        this.selection.filtered = {}\r\n        this.selection.full_filter = {}\r\n        this.selection.all = {}\r\n        this.site.view.filters.forEach(f => {\r\n          f.passed = 0\r\n          f.failed = 0\r\n        })\r\n        this.site.view.entities.forEach(e => {\r\n          const c = this.check(e),\r\n            id = e.features.id\r\n          if (c.ids) {\r\n            this.selection.ids[id] = e\r\n            this.n_selected.ids++\r\n            c.all++\r\n          }\r\n          if (c.features) {\r\n            this.selection.features[id] = e\r\n            this.n_selected.features++\r\n            c.all++\r\n          }\r\n          if (c.variables) {\r\n            this.selection.variables[id] = e\r\n            this.n_selected.variables++\r\n            c.all++\r\n          }\r\n          if (c.dataset) {\r\n            this.selection.dataset[id] = e\r\n            this.n_selected.dataset++\r\n            c.all++\r\n          }\r\n          if (c.dataset && c.ids) {\r\n            this.selection.children[id] = e\r\n            this.n_selected.children++\r\n          }\r\n          if (c.features && c.variables) {\r\n            this.selection.full_filter[id] = e\r\n            this.n_selected.full_filter++\r\n          }\r\n          if (c.variables && c.features && c.ids) {\r\n            this.selection.filtered[id] = e\r\n            this.n_selected.filtered++\r\n          }\r\n          if (4 === c.all) {\r\n            this.selection.all[id] = e\r\n            this.n_selected.all++\r\n          }\r\n        })\r\n        this.site.request_queue(this.id)\r\n      } else {\r\n        this.valid[this.parsed.dataset] = false\r\n        this.site.data.data_queue[this.parsed.dataset][this.id] = this.update\r\n      }\r\n    }\r\n  }\r\n  compile() {\r\n    this.times = []\r\n    if (this.time_filters) {\r\n      this.time_filters = [\r\n        {variable: this.site.defaults.time, type: '>=', value: 'filter.time_min'},\r\n        {variable: this.site.defaults.time, type: '<=', value: 'filter.time_max'},\r\n      ]\r\n      this.site.add_dependency(this.id + '_time', {type: 'min', id: 'filter.time_min'})\r\n      this.site.add_dependency(this.id + '_time', {type: 'max', id: 'filter.time_max'})\r\n      this.time_filters.forEach(f => {\r\n        if ('string' === typeof f.value && f.value in this.site.inputs) {\r\n          this.site.add_dependency(f.value, {type: 'time_filters', id: this.id})\r\n        }\r\n      })\r\n    }\r\n    this.get = {\r\n      dataset: () => {\r\n        let d = this.site.defaults.dataset\r\n        if ('string' === typeof this.dataset && this.dataset in this.site.inputs) {\r\n          d = this.site.valueOf(this.site.inputs[this.dataset].value()) as string\r\n          if (!(d in this.site.data.data_queue)) {\r\n            d = this.site.defaults.dataset\r\n            this.site.inputs[this.dataset].set(d)\r\n          }\r\n        } else {\r\n          d = this.site.valueOf(this.dataset) as string\r\n        }\r\n        return d in this.site.data.data_queue ? d : this.site.defaults.dataset\r\n      },\r\n      single_id: () => {\r\n        const id = this.site.valueOf(\r\n          'string' === typeof this.ids && this.ids in this.site.inputs ? this.site.inputs[this.ids].value() : this.ids\r\n        )\r\n        return 'string' === typeof id ? id : ''\r\n      },\r\n      ids: () => {\r\n        const id = this.site.valueOf(\r\n          'string' === typeof this.ids && this.ids in this.site.inputs ? this.site.inputs[this.ids].value() : this.ids\r\n        )\r\n        if ('string' === typeof id && '' !== id && '-1' !== id) {\r\n          const ids: {[index: string]: boolean} = {},\r\n            e = this.site.data.entities[id]\r\n          ids[id] = true\r\n          if (e && e.relations) Object.keys(e.relations.children).forEach(k => (ids[k] = true))\r\n          return ids\r\n        } else if (this.site.view.selected.length) {\r\n          return this.site.view.select_ids\r\n        }\r\n        return false\r\n      },\r\n      features: () => {\r\n        let s = ''\r\n        this.features &&\r\n          Object.keys(this.features).forEach(k => {\r\n            s += k + this.site.valueOf(this.features[k])\r\n          })\r\n        return s\r\n      },\r\n      variables: () => {\r\n        if (this.variables || this.site.view.filters.size) {\r\n          if (!this.parsed.variable_values.size) this.reparse()\r\n          let s = ''\r\n          this.parsed.variable_values.forEach(vi => {\r\n            vi.filter.summary.update()\r\n            s += vi.name + vi.operator + vi.component + vi.value + vi.active\r\n          })\r\n          return s\r\n        } else return ''\r\n      },\r\n      time_filters: () => {\r\n        let s = ''\r\n        this.time_filters &&\r\n          this.time_filters.forEach(f => {\r\n            s += f.value in this.site.inputs ? this.site.valueOf(f.value) : f.value\r\n          })\r\n        return s\r\n      },\r\n    }\r\n    this.checks = {\r\n      dataset: (e: Entity) => {\r\n        return this.parsed.dataset === e.group\r\n      },\r\n      ids: (e: Entity) => {\r\n        return e.features && this.ids_check(this.parsed.ids, e.features.id)\r\n      },\r\n      features: (e: Entity) => {\r\n        if (e.features) {\r\n          let k,\r\n            v,\r\n            pass = true\r\n          for (k in this.parsed.feature_values) {\r\n            if (k in this.parsed.feature_values) {\r\n              v = this.parsed.feature_values[k]\r\n              pass = DataHandler.checks[v.operator](v.value, this.site.valueOf(e.features[k]))\r\n              if (!pass) break\r\n            }\r\n          }\r\n          return pass\r\n        } else return true\r\n      },\r\n      variables: (e: Entity) => {\r\n        if (e.data) {\r\n          let pass = true\r\n          this.parsed.variable_values.forEach(v => {\r\n            if (v.active && !isNaN(+v.value)) {\r\n              const ev = e.get_value(v.name, v.comp_fun(v, this.parsed)),\r\n                ck = !isNaN(ev) && DataHandler.checks[v.operator](ev, v.value)\r\n              v.filter[ck ? 'passed' : 'failed']++\r\n              if (pass && !ck) pass = false\r\n            } else {\r\n              v.filter.failed++\r\n            }\r\n          })\r\n          return pass\r\n        } else return true\r\n      },\r\n    }\r\n  }\r\n  ids_check(a: EntitySelection | false, b: string) {\r\n    return !a || b in a\r\n  }\r\n  check(e: Entity) {\r\n    return {\r\n      ids: !this.ids || this.checks.ids(e),\r\n      features: !this.features || this.checks.features(e),\r\n      variables: (!this.variables && !this.site.view.filters.size) || this.checks.variables(e),\r\n      dataset: !this.dataset || this.checks.dataset(e),\r\n      all: 0,\r\n    }\r\n  }\r\n  reparse() {\r\n    this.parsed.dataset = this.get.dataset()\r\n    this.parsed.ids = this.get.ids()\r\n    this.parsed.time_filters = this.get.time_filters()\r\n    this.parsed.time_agg =\r\n      this.parsed.dataset in this.site.data.meta.times\r\n        ? (this.site.valueOf(this.time_agg) as number) - this.site.data.meta.times[this.parsed.dataset].range[0]\r\n        : 0\r\n    if ('string' === typeof this.ids) {\r\n      const u = this.site.inputs[this.ids]\r\n      if (\r\n        this.ids in this.site.inputs &&\r\n        (('virtual' === u.type && u.source in this.site.inputs) ||\r\n          ('depends' in u && (u.depends as string) in this.site.inputs))\r\n      ) {\r\n        this.parsed.id_source = (\r\n          'virtual' === u.type\r\n            ? this.site.valueOf(this.site.inputs[u.source].dataset)\r\n            : this.site.inputs[u.depends as string].value()\r\n        ) as string\r\n      }\r\n    }\r\n    if (this.palette) this.parsed.palette = this.site.valueOf(this.palette) as string\r\n    if (this.features) {\r\n      this.parsed.feature_values = {}\r\n      Object.keys(this.features).forEach(k => {\r\n        const value = this.site.valueOf(this.features[k]) as string | string[]\r\n        this.parsed.feature_values[k] = {\r\n          value: value,\r\n          operator: 'string' === typeof value ? 'equals' : 'includes',\r\n        }\r\n      })\r\n      this.parsed.features = this.get.features()\r\n    } else this.parsed.features = ''\r\n    this.parsed.variable_values.clear()\r\n    if (this.site.view.filters.size)\r\n      this.site.view.filters.forEach(f => {\r\n        this.parsed.variable_values.set(f.id, {\r\n          filter: f,\r\n          name: f.variable,\r\n          range: this.site.data.variables[f.variable].info[this.parsed.dataset].time_range,\r\n          operator: f.operator,\r\n          value: f.value ? +f.value : NaN,\r\n          value_type: 'number',\r\n          component: f.component,\r\n          active: f.active,\r\n          comp_fun: component_fun(this.site.data.meta.overall.value, f.component),\r\n        })\r\n      })\r\n    if (this.variables || this.parsed.variable_values.size) {\r\n      if (this.variables)\r\n        this.variables.forEach(v => {\r\n          const value = this.site.valueOf(v.value) as string | number\r\n          this.parsed.variable_values.set(this.parsed.variable_values.size + '', {\r\n            name: v.variable,\r\n            operator: v.operator,\r\n            value: value,\r\n            component: v.component,\r\n            active: true,\r\n            comp_fun: component_fun(this.site.data.meta.overall.value, v.component),\r\n          })\r\n        })\r\n      this.parsed.variables = this.get.variables()\r\n    } else this.parsed.variables = ''\r\n  }\r\n}\r\n","import {BaseInput} from './index'\r\nimport type Community from '../index'\r\nimport type {Generic, ObjectIndex, OptionSets, ResourceField} from '../../types'\r\nimport {keymap} from '../static_refs'\r\nimport {loader, options_filter, set_current_options} from '../common_methods'\r\nimport {patterns} from '../patterns'\r\n\r\nexport type ComboboxSpec = {\r\n  strict?: boolean\r\n  numeric?: boolean\r\n  search?: boolean\r\n  multi?: boolean\r\n  accordion?: boolean\r\n  group?: string\r\n  filters?: Generic\r\n}\r\n\r\nexport class InputCombobox extends BaseInput {\r\n  type: 'combobox' = 'combobox'\r\n  hover_index = -1\r\n  cleared_selection = ''\r\n  default: string | number\r\n  expanded = false\r\n  listbox: HTMLElement\r\n  groups: {e: HTMLElement[]; by_name: {[index: string]: HTMLElement}}\r\n  container = document.createElement('div')\r\n  selection: HTMLElement\r\n  input_element: HTMLInputElement\r\n  filter_index: number[]\r\n  current_filter: {[index: string]: string} = {}\r\n  onchange: Function\r\n  value_type: string\r\n  values: ObjectIndex = {}\r\n  display: ObjectIndex = {}\r\n  options: HTMLDivElement[] = []\r\n  option_sets: OptionSets = {}\r\n  current_set = ''\r\n  sensitive = false\r\n  loader?: (...args: any) => void\r\n  filter = options_filter\r\n  reformat_label = false\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.set = this.set.bind(this)\r\n    this.reset = this.reset.bind(this)\r\n    this.resize = this.resize.bind(this)\r\n    this.toggle = this.toggle.bind(this)\r\n    this.highlight = this.highlight.bind(this)\r\n    this.filterer = this.filterer.bind(this)\r\n    this.close = this.close.bind(this)\r\n    this.set_selected = this.set_selected.bind(this)\r\n    this.settings.use_display = this.settings.search || this.settings.multi\r\n    this.listbox = this.e.parentElement.children[1] as HTMLElement\r\n    this.options = [...this.listbox.querySelectorAll('.combobox-option')] as HTMLDivElement[]\r\n    if (this.optionSource && this.site.patterns.ids.test(this.optionSource)) {\r\n      this.loader = loader.bind(this)\r\n      e.addEventListener('click', this.loader)\r\n      this.deferred = true\r\n    }\r\n    if (this.options.length) {\r\n      this.reformat_label = true\r\n      this.options.forEach((e, i) => {\r\n        this.values[e.dataset.value] = i\r\n        if (this.reformat_label) this.reformat_label = e.dataset.value === e.innerText\r\n      })\r\n      const group: NodeListOf<HTMLElement> = this.listbox.querySelectorAll('.combobox-group')\r\n      if (group.length) {\r\n        this.groups = {e: [], by_name: {}}\r\n        group.forEach(e => {\r\n          const name = e.dataset.group\r\n          this.groups.e.push(e)\r\n          this.groups.by_name[name] = e\r\n        })\r\n      }\r\n    }\r\n    this.container.className = 'combobox-options-container combobox-component hidden'\r\n    this.site.page.overlay.appendChild(this.container)\r\n    this.container.appendChild(this.listbox)\r\n    this.selection = this.e.firstElementChild.firstElementChild as HTMLElement\r\n    this.input_element = this.e.firstElementChild.lastElementChild as HTMLInputElement\r\n    if (2 === this.e.childElementCount) {\r\n      this.e.lastElementChild.addEventListener(\r\n        'click',\r\n        function (this: InputCombobox) {\r\n          if (!this.e.classList.contains('locked')) {\r\n            this.cleared_selection = ''\r\n            this.set([])\r\n            this.input_element.focus()\r\n          }\r\n        }.bind(this)\r\n      )\r\n    }\r\n    this.input_element.addEventListener(\r\n      'focus',\r\n      function (this: HTMLElement) {\r\n        this.classList.add('focused')\r\n      }.bind(this.e)\r\n    )\r\n    this.input_element.addEventListener(\r\n      'blur',\r\n      function (this: HTMLElement) {\r\n        this.classList.remove('focused')\r\n      }.bind(this.e)\r\n    )\r\n    this.listbox.addEventListener('click', this.set)\r\n    window.addEventListener('resize', this.resize)\r\n    this.e.addEventListener('mousedown', this.toggle)\r\n    this.listbox.addEventListener('mouseover', this.highlight)\r\n    if (this.settings.accordion) {\r\n      this.listbox.addEventListener('show.bs.collapse', e => {\r\n        const group = this.hover_index === -1 ? '' : this.options[this.hover_index].dataset.group\r\n        const et = e.target as HTMLElement\r\n        if (group !== et.dataset.group) {\r\n          et.firstElementChild.firstElementChild.dispatchEvent(new MouseEvent('mouseover'))\r\n          this.input_element.focus()\r\n        }\r\n      })\r\n    }\r\n    if (this.settings.search) {\r\n      this.input_element.addEventListener('keyup', this.filterer)\r\n    }\r\n    this.input_element.addEventListener(\r\n      'keydown',\r\n      function (this: InputCombobox, e: KeyboardEvent) {\r\n        const action = keymap[e.code as keyof typeof keymap]\r\n        if (action) {\r\n          if ('close' === action) {\r\n            this.close()\r\n          } else if ('select' === action) {\r\n            if (!this.expanded) return this.toggle(void 0, this.input_element)\r\n            this.set(e)\r\n          } else if ('move' === action) {\r\n            const value = this.input_element.value\r\n            if (this.settings.strict || (this.expanded && '' === value)) {\r\n              e.preventDefault()\r\n              if ('ArrowUp' === e.code) {\r\n                if (this.filter_index && this.filter_index.length) {\r\n                  this.hover_index = this.filter_index.indexOf(this.hover_index) - 1\r\n                  this.hover_index = this.filter_index[0 > this.hover_index ? 0 : this.hover_index]\r\n                } else {\r\n                  this.hover_index = Math.max(0, this.hover_index - 1)\r\n                }\r\n              } else if ('ArrowDown' === e.code) {\r\n                if (this.filter_index && this.filter_index.length) {\r\n                  this.hover_index = this.filter_index.indexOf(this.hover_index) + 1\r\n                  this.hover_index =\r\n                    this.filter_index[\r\n                      this.filter_index.length - 1 < this.hover_index ? this.filter_index.length - 1 : this.hover_index\r\n                    ]\r\n                } else {\r\n                  this.hover_index = Math.min(this.options.length - 1, this.hover_index + 1)\r\n                }\r\n              } else if ('Home' === e.code) {\r\n                this.hover_index = 0\r\n              } else if ('End' === e.code) {\r\n                this.hover_index = this.options.length - 1\r\n              }\r\n              if (this.expanded) {\r\n                this.highlight()\r\n              } else {\r\n                this.set(this.hover_index)\r\n              }\r\n            } else if (this.site.patterns.number.test(value)) {\r\n              this.set(+value + ('ArrowUp' === e.code ? 1 : -1))\r\n            }\r\n          }\r\n        } else if (!this.expanded) {\r\n          this.toggle(void 0, this.input_element)\r\n        } else {\r\n          this.clear_highlight()\r\n        }\r\n      }.bind(this)\r\n    )\r\n  }\r\n  init() {\r\n    this.options.forEach((e, i) => {\r\n      if (this.reformat_label) e.innerText = this.site.data.format_label(e.dataset.value)\r\n      this.display[e.innerText] = i\r\n    })\r\n  }\r\n  set_current = set_current_options\r\n  filterer() {\r\n    const q = this.input_element.value.toLowerCase()\r\n    if ('' === q) {\r\n      this.filter_reset()\r\n    } else {\r\n      this.filter_index = []\r\n      if (this.groups) {\r\n        this.groups.e.forEach(g => g.firstElementChild.firstElementChild.classList.add('hidden'))\r\n      }\r\n      this.options.forEach((o, i) => {\r\n        if (!o.classList.contains('hidden') && o.innerText.toLowerCase().includes(q)) {\r\n          o.classList.remove('filter-hidden')\r\n          this.filter_index.push(i)\r\n          const group = o.dataset.group\r\n          if (group) {\r\n            this.groups.by_name[group].firstElementChild.firstElementChild.classList.remove('hidden')\r\n            if (this.settings.accordion) {\r\n              const g = this.groups.by_name[group]\r\n              g.firstElementChild.nextElementSibling.classList.add('show')\r\n              g.firstElementChild.firstElementChild.classList.remove('collapsed')\r\n              g.firstElementChild.firstElementChild.setAttribute('aria-expanded', 'true')\r\n            }\r\n          }\r\n        } else {\r\n          o.classList.add('filter-hidden')\r\n        }\r\n      })\r\n    }\r\n  }\r\n  highlight(e?: MouseEvent, target?: HTMLElement) {\r\n    if (e && !target) target = e.target as HTMLElement\r\n    if (!target || target.dataset.value in this.values) {\r\n      if (!this.groups) this.settings.accordion = false\r\n      if (target && target.dataset.value) {\r\n        this.hover_index = this.values[target.dataset.value]\r\n      } else if (-1 === this.hover_index && Array.isArray(this.source)) {\r\n        this.hover_index = this.values[this.source[0]]\r\n      }\r\n      if ('undefined' === typeof this.hover_index) this.hover_index = -1\r\n      const o = this.options[this.hover_index]\r\n      if (o) {\r\n        const previous = this.listbox.querySelector('.highlighted')\r\n        if (previous) previous.classList.remove('highlighted')\r\n        if (e && 'mouseover' === e.type) {\r\n          target.classList.add('highlighted')\r\n        } else {\r\n          o.classList.add('highlighted')\r\n          if (this.settings.accordion) {\r\n            const c = o.parentElement.parentElement\r\n            if (!c.classList.contains('show')) {\r\n              c.classList.add('show')\r\n              c.previousElementSibling.firstElementChild.classList.remove('collapsed')\r\n              c.previousElementSibling.firstElementChild.setAttribute('aria-expanded', 'true')\r\n            }\r\n          }\r\n          this.input_element.setAttribute('aria-activedescendant', o.id)\r\n          const port = this.container.getBoundingClientRect(),\r\n            item = o.getBoundingClientRect()\r\n          let top = port.top\r\n          if (this.groups && o.dataset.group)\r\n            top += this.groups.by_name[o.dataset.group].firstElementChild.getBoundingClientRect().height\r\n          if (top > item.top) {\r\n            this.container.scrollTo(0, this.container.scrollTop + item.top - top)\r\n          } else if (port.bottom < item.bottom) {\r\n            this.container.scrollTo(0, this.container.scrollTop + item.bottom - port.bottom)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  toggle(e?: MouseEvent, target?: HTMLElement) {\r\n    if (e && !target) target = e.target as HTMLElement\r\n    if (target && (!e || !e.button) && !this.e.classList.contains('disabled') && 'BUTTON' !== target.tagName) {\r\n      if (this.expanded) {\r\n        if (target !== this.input_element) this.close()\r\n      } else {\r\n        if (this.site.spec.combobox)\r\n          Object.keys(this.site.spec.combobox).forEach(id => {\r\n            if (id !== this.id) {\r\n              const ou = this.site.inputs[id] as InputCombobox\r\n              ou.expanded && ou.close()\r\n            }\r\n          })\r\n        this.container.classList.remove('hidden')\r\n        if ('' !== this.selection.innerText) this.cleared_selection = this.selection.innerText\r\n        if (this.cleared_selection in this.display)\r\n          this.highlight(void 0, this.options[this.display[this.cleared_selection]])\r\n        if (this.settings.use_display) this.selection.innerText = ''\r\n        window.addEventListener('click', this.close)\r\n        this.e.setAttribute('aria-expanded', 'true')\r\n        if (!e || e.target !== this.input_element) setTimeout(() => this.input_element.focus(), 0)\r\n        this.resize()\r\n        this.expanded = true\r\n      }\r\n    }\r\n  }\r\n  value() {\r\n    return this.source\r\n      ? this.settings.multi\r\n        ? this.source\r\n        : Array.isArray(this.source) && this.source.length\r\n        ? this.source[0]\r\n        : ''\r\n      : this.site.valueOf(this.default)\r\n  }\r\n  close(e?: MouseEvent) {\r\n    if (\r\n      this.expanded &&\r\n      (!e ||\r\n        !(e.target as HTMLElement).classList ||\r\n        !(e.target as HTMLElement).classList.contains('combobox-component'))\r\n    ) {\r\n      if (\r\n        this.settings.use_display &&\r\n        '' === this.selection.innerText &&\r\n        Array.isArray(this.source) &&\r\n        this.source.length\r\n      )\r\n        this.selection.innerText = this.cleared_selection\r\n      if ('' !== this.input_element.value) setTimeout(this.set, 0)\r\n      this.e.setAttribute('aria-expanded', 'false')\r\n      this.expanded = false\r\n      this.container.classList.add('hidden')\r\n      window.removeEventListener('click', this.close)\r\n    }\r\n  }\r\n  resize() {\r\n    const s = this.e.getBoundingClientRect()\r\n    this.container.style.left = s.x + 'px'\r\n    this.container.style.width = s.width + 'px'\r\n    if (window.screen.height / 2 > s.y) {\r\n      this.container.style.top = s.y + s.height + 'px'\r\n      this.container.style.bottom = ''\r\n    } else {\r\n      this.container.style.top = ''\r\n      this.container.style.bottom = -s.y + 'px'\r\n    }\r\n  }\r\n  clear_highlight() {\r\n    if (-1 !== this.hover_index) {\r\n      this.options[this.hover_index].classList.remove('highlighted')\r\n      this.hover_index = -1\r\n    }\r\n  }\r\n  filter_reset() {\r\n    if (this.groups) this.groups.e.forEach(g => g.firstElementChild.firstElementChild.classList.remove('hidden'))\r\n    this.input_element.value = ''\r\n    this.filter_index = []\r\n    this.options.forEach((o, i) => {\r\n      if (!o.classList.contains('hidden')) this.filter_index.push(i)\r\n    })\r\n    this.listbox.querySelectorAll('.filter-hidden').forEach(o => o.classList.remove('filter-hidden'))\r\n  }\r\n  set_selected(value: string | number) {\r\n    if (value in this.values) {\r\n      const option = this.options[this.values[value] as number]\r\n      option.classList.add('selected')\r\n      option.setAttribute('aria-selected', 'true')\r\n    }\r\n  }\r\n  static create(\r\n    site: Community,\r\n    label: string,\r\n    options?: string[] | {[index: string]: string[]},\r\n    settings?: Generic,\r\n    id?: string\r\n  ) {\r\n    id = id || 'created_combobox_' + ++site.page.elementCount\r\n    const main = document.createElement('div')\r\n    let e = document.createElement('div'),\r\n      div = document.createElement('div'),\r\n      input = document.createElement('input'),\r\n      lab = document.createElement('label')\r\n    if (settings) {\r\n      if (!site.spec.combobox) site.spec.combobox = {}\r\n      site.spec.combobox[id] = settings\r\n    }\r\n    e.className = 'wrapper combobox-wrapper'\r\n    if (settings && settings.floating) {\r\n      e.appendChild(div)\r\n      div.className = 'form-floating'\r\n      div.dataset.of = id\r\n      e = div\r\n    }\r\n    e.appendChild(main)\r\n    main.id = id\r\n    main.dataset.autotype = 'combobox'\r\n    main.className = 'auto-input form-select combobox combobox-component'\r\n    main.role = 'combobox'\r\n    main.appendChild((div = document.createElement('div')))\r\n    div.className = 'combobox-selection combobox-component'\r\n    div.appendChild(document.createElement('span'))\r\n    div.lastElementChild.className = 'combobox-component'\r\n    div.lastElementChild.setAttribute('aria-live', 'assertive')\r\n    div.lastElementChild.setAttribute('aria-atomic', 'true')\r\n    div.lastElementChild.setAttribute('aria-role', 'log')\r\n    div.appendChild(input)\r\n    input.setAttribute('aria-haspopup', 'listbox')\r\n    input.setAttribute('aria-expanded', 'false')\r\n    input.setAttribute('aria-controls', id + '-listbox')\r\n    input.className = 'combobox-input combobox-component'\r\n    input.type = 'text'\r\n    input.role = 'combobox'\r\n    input.id = id + '-input'\r\n    input.autocomplete = 'off'\r\n    if (settings && settings.clearable) {\r\n      const button = document.createElement('button')\r\n      e.firstElementChild.appendChild(button)\r\n      button.type = 'button'\r\n      button.className = 'btn-close'\r\n      button.title = 'clear selection'\r\n    }\r\n    e.appendChild((div = document.createElement('div')))\r\n    div.className = 'combobox-options combobox-component'\r\n    div.setAttribute('aria-labelledby', id + '-label')\r\n    div.role = 'listbox'\r\n    div.tabIndex = -1\r\n    div.id = id + '-listbox'\r\n    e.appendChild(lab)\r\n    lab.id = id + '-label'\r\n    lab.innerText = label\r\n    lab.setAttribute('for', id + '-input')\r\n    const u = new InputCombobox(main, site)\r\n    site.inputs[id] = u\r\n    let n = 0\r\n    if (options)\r\n      if (Array.isArray(options)) {\r\n        options.forEach(o => {\r\n          const l = site.data.format_label(o)\r\n          u.display[l] = n\r\n          u.values[o] = n++\r\n          u.add(o, l)\r\n        })\r\n      } else {\r\n        u.groups = {e: [], by_name: {}}\r\n        Object.keys(options).forEach(k => {\r\n          const g = options[k]\r\n          const e = document.createElement('div'),\r\n            id = u.id + '_group_' + k.replace(patterns.seps, '-')\r\n          e.className = 'combobox-group combobox-component'\r\n          e.setAttribute('aria-labelledby', id)\r\n          e.appendChild((lab = document.createElement('label')))\r\n          lab.innerText = k\r\n          lab.id = id\r\n          lab.className = 'combobox-group-label combobox-component'\r\n          u.groups.by_name[k] = e\r\n          u.groups.e.push(e)\r\n          g.forEach(o => u.groups.by_name[k].appendChild(u.add(o, o, true)))\r\n          u.listbox.appendChild(e)\r\n        })\r\n        Object.keys(u.groups.by_name).forEach(g => {\r\n          u.groups.by_name[g].querySelectorAll('.combobox-option').forEach((c: HTMLElement) => {\r\n            ;(u.options as HTMLElement[]).push(c)\r\n            c.setAttribute('data-group', g)\r\n            u.values[c.dataset.value] = n\r\n            u.display[c.innerText] = n++\r\n          })\r\n        })\r\n      }\r\n    return u\r\n  }\r\n  get() {\r\n    const s: string[] = []\r\n    this.listbox.querySelectorAll('.selected').forEach((o: HTMLElement) => s.push(o.dataset.value))\r\n    this.source = s\r\n    this.site.request_queue(false, this.id)\r\n  }\r\n  set(v?: MouseEvent | KeyboardEvent | string | number | (string | number)[], toggle?: boolean): void {\r\n    if (!v) v = this.input_element.value\r\n    let update = false,\r\n      i = -1\r\n    if (!Array.isArray(v) && 'object' === typeof v) {\r\n      const t = v.target as HTMLElement\r\n      if ((this.settings.accordion ? 'BUTTON' : 'LABEL') === t.tagName) return void 0\r\n      i = this.hover_index\r\n      if (\r\n        -1 !== i &&\r\n        (this.options[i].classList.contains('hidden') || this.options[i].classList.contains('filter-hidden'))\r\n      )\r\n        i = -1\r\n      v =\r\n        -1 === i\r\n          ? 'INPUT' === t.tagName\r\n            ? this.input_element.value\r\n            : t.dataset.value || t.innerText\r\n          : this.options[i].dataset.value || this.options[i].innerText\r\n      toggle = this.settings.multi\r\n    }\r\n    this.filter_reset()\r\n    if (Array.isArray(v)) {\r\n      if (this.settings.multi) {\r\n        this.listbox.querySelectorAll('.selected').forEach(e => {\r\n          e.classList.remove('selected')\r\n          e.setAttribute('aria-selected', 'false')\r\n        })\r\n        this.source = -1 === v[0] ? [] : v\r\n        v.forEach(this.set_selected)\r\n        update = true\r\n      } else v = v[0]\r\n    }\r\n    if (!Array.isArray(this.source)) this.source = []\r\n    if (!Array.isArray(v)) {\r\n      if (this.settings.strict && 'string' === typeof v && !(v in this.values) && this.site.patterns.number.test(v))\r\n        v = +v\r\n      if ('number' !== this.value_type && 'number' === typeof v && this.options[v]) {\r\n        v = this.options[v].dataset.value\r\n      }\r\n      if ('string' === typeof v && v in this.display) v = this.options[this.display[v]].dataset.value\r\n      if (this.settings.strict && !(v in this.values)) v = this.default\r\n      i = this.source.indexOf(v)\r\n      if (-1 === i) {\r\n        update = true\r\n        if (-1 === v || '' === v) {\r\n          this.source = []\r\n        } else {\r\n          if (this.settings.multi) {\r\n            this.source.push(v)\r\n          } else this.source[0] = v\r\n        }\r\n        if (v in this.values) {\r\n          if (!this.settings.multi) {\r\n            const selected = this.listbox.querySelector('.selected')\r\n            if (selected) {\r\n              selected.classList.remove('selected')\r\n              selected.setAttribute('aria-selected', 'false')\r\n            }\r\n          }\r\n          this.set_selected(v)\r\n        }\r\n      } else if (toggle) {\r\n        update = true\r\n        this.source.splice(i, 1)\r\n        if (v in this.values) {\r\n          const selection = this.options[this.values[v]]\r\n          selection.classList.remove('selected')\r\n          selection.setAttribute('aria-selected', 'false')\r\n        }\r\n      }\r\n    }\r\n    if (!this.settings.multi && this.expanded) {\r\n      this.input_element.focus()\r\n      this.close()\r\n      this.filter_reset()\r\n    }\r\n    const display = this.source.length\r\n      ? this.settings.multi\r\n        ? this.source.length + ' of ' + this.options.length + ' selected'\r\n        : this.source[0] in this.values\r\n        ? this.options[this.values[this.source[0]]].firstChild.textContent\r\n        : this.settings.strict || -1 === this.source[0]\r\n        ? ''\r\n        : this.source[0] + ''\r\n      : ''\r\n    if (this.settings.use_display) {\r\n      this.selection.innerText = display\r\n    } else {\r\n      this.input_element.value = display\r\n    }\r\n    if (this.onchange) this.onchange()\r\n    if (update) this.site.request_queue(false, this.id)\r\n  }\r\n  add(value: string, display?: string, noadd?: boolean, meta?: ResourceField) {\r\n    const e = document.createElement('div')\r\n    e.id = this.id + '_' + value\r\n    e.role = 'option'\r\n    e.setAttribute('aria-selected', 'false')\r\n    e.tabIndex = 0\r\n    e.className = 'combobox-option combobox-component'\r\n    e.dataset.value = value\r\n    e.innerText = display || this.site.data.format_label(value)\r\n    if (meta && meta.info) {\r\n      e.appendChild(document.createElement('p'))\r\n      e.lastElementChild.className = 'combobox-option-description combobox-component'\r\n      ;(e.lastElementChild as HTMLElement).innerText = meta.info.description || meta.info.short_description || ''\r\n    }\r\n    if (!noadd) this.listbox.appendChild(e)\r\n    this.options.push(e)\r\n    return e\r\n  }\r\n}\r\n","import type {RegisteredInputs, SiteInputs} from './inputs/index'\r\nimport {patterns} from './patterns'\r\n\r\ntype Actions = string[] | {[index: string]: string}\r\ntype TutorialStep = {\r\n  focus: string\r\n  description?: string\r\n  option?: string | string[]\r\n  before?: Actions\r\n  after?: Actions\r\n  wait?: number\r\n  time?: number\r\n  disable_continue?: boolean\r\n}\r\ntype Tutorial = {\r\n  name: string\r\n  title: string\r\n  description: string\r\n  steps: TutorialStep[]\r\n  reset?: boolean\r\n  manager?: TutorialManager\r\n  n_steps?: number\r\n  current_step?: number\r\n  run?: Function\r\n}\r\nexport type Tutorials = {[index: string]: Tutorial}\r\n\r\nexport class TutorialManager {\r\n  tutorials: Tutorials\r\n  site_elements: RegisteredInputs\r\n  container = document.createElement('div')\r\n  backdrop = document.createElement('div')\r\n  highlight = document.createElement('div')\r\n  menu = document.createElement('div')\r\n  frame = document.createElement('div')\r\n  header = document.createElement('p')\r\n  dialog = document.createElement('p')\r\n  timer = document.createElement('div')\r\n  running_timer: number | NodeJS.Timer\r\n  focuser: number | NodeJS.Timer\r\n  progress = document.createElement('div')\r\n  continue = document.createElement('button')\r\n  in_progress = ''\r\n  waiting = false\r\n  current_step = 0\r\n  current_time = 0\r\n  current_element: HTMLElement\r\n  current_site_element: SiteInputs\r\n  site_reset: Function\r\n  constructor(tutorials: Tutorials, elements?: RegisteredInputs, resetter?: Function) {\r\n    this.tutorials = tutorials\r\n    this.site_elements = elements || {}\r\n    this.site_reset = resetter || (() => {})\r\n    this.start_tutorial = this.start_tutorial.bind(this)\r\n    this.progress_tutorial = this.progress_tutorial.bind(this)\r\n    this.execute_step = this.execute_step.bind(this)\r\n    this.end_tutorial = this.end_tutorial.bind(this)\r\n\r\n    // prepare menu\r\n    document.body.appendChild(this.menu)\r\n    this.menu.id = 'community_tutorials_menu'\r\n    this.menu.className = 'modal fade'\r\n    this.menu.tabIndex = -1\r\n    let e = document.createElement('div')\r\n    this.menu.appendChild(e)\r\n    e.className = 'modal-dialog modal-dialog-scrollable'\r\n    e.appendChild((e = document.createElement('div')))\r\n    e.className = 'modal-content'\r\n    e.appendChild((e = document.createElement('div')))\r\n    e.className = 'modal-header'\r\n    e.appendChild((e = document.createElement('p')))\r\n    e.className = 'modal-title h5'\r\n    e.innerText = 'Tutorials'\r\n    let close = document.createElement('button')\r\n    e.insertAdjacentElement('afterend', close)\r\n    close.type = 'button'\r\n    close.className = 'btn-close'\r\n    close.setAttribute('data-bs-dismiss', 'modal')\r\n    close.setAttribute('aria-label', 'Close')\r\n    const l = document.createElement('div')\r\n    this.menu.lastElementChild.lastElementChild.appendChild(l)\r\n    l.className = 'modal-body'\r\n    Object.keys(tutorials).forEach(name => {\r\n      const t = tutorials[name],\r\n        e = document.createElement('div'),\r\n        description = document.createElement('div'),\r\n        start = document.createElement('button')\r\n      t.manager = this\r\n      t.n_steps = t.steps.length\r\n      let p = document.createElement('div')\r\n      l.appendChild(e)\r\n      e.className = 'tutorial-listing card'\r\n      e.appendChild(p)\r\n      p.className = 'card-header'\r\n      p.innerText = t.title || name\r\n      e.appendChild((p = document.createElement('div')))\r\n      p.className = 'card-body'\r\n      p.appendChild(description)\r\n      description.appendChild(document.createElement('p'))\r\n      ;(description.firstElementChild as HTMLParagraphElement).innerText = t.description || ''\r\n      if (t.steps.length && t.steps[0].before && !Array.isArray(t.steps[0].before)) {\r\n        const before = t.steps[0].before,\r\n          setting_display = document.createElement('div'),\r\n          header = document.createElement('span')\r\n        setting_display.className = 'tutorial-initial-settings'\r\n        setting_display.appendChild(header)\r\n        header.innerText = 'Initial Settings'\r\n        header.className = 'h6'\r\n        Object.keys(t.steps[0].before).forEach((k, i) => {\r\n          const row = document.createElement('p')\r\n          let part = document.createElement('span')\r\n          part.className = 'syntax-variable'\r\n          part.innerText = k.replace(patterns.settings, '')\r\n          row.appendChild(part)\r\n          part = document.createElement('span')\r\n          part.className = 'syntax-operator'\r\n          part.innerText = ' = '\r\n          row.appendChild(part)\r\n          part = document.createElement('span')\r\n          part.className = 'syntax-value'\r\n          part.innerText = before[k]\r\n          row.appendChild(part)\r\n          setting_display.appendChild(row)\r\n        })\r\n        description.appendChild(setting_display)\r\n      }\r\n      p.appendChild(start)\r\n      start.type = 'button'\r\n      start.className = 'btn'\r\n      start.innerText = 'Start'\r\n      start.dataset.name = name\r\n      start.addEventListener('click', this.start_tutorial)\r\n    })\r\n\r\n    // prepare step display\r\n    document.body.appendChild(this.container)\r\n    this.container.appendChild(this.backdrop)\r\n    this.container.className = 'tutorial-container hidden'\r\n    this.container.addEventListener('keyup', this.progress_tutorial)\r\n    this.backdrop.addEventListener('click', this.progress_tutorial)\r\n    this.backdrop.className = 'tutorial-backdrop'\r\n    this.container.appendChild(this.highlight)\r\n    this.highlight.className = 'tutorial-highlight'\r\n    this.highlight.addEventListener('click', this.progress_tutorial)\r\n    this.container.appendChild(this.frame)\r\n    this.frame.className = 'tutorial-frame'\r\n    this.frame.style.left = '50%'\r\n    this.frame.tabIndex = -1\r\n    this.frame.appendChild((e = document.createElement('div')))\r\n    this.frame.id = 'community_tutorial_frame'\r\n    this.frame.role = 'dialog'\r\n    this.frame.setAttribute('aria-labelledby', 'community_tutorial_description')\r\n    e.className = 'tutorial-step card'\r\n    e.appendChild((e = document.createElement('div')))\r\n    e.className = 'card-header'\r\n    e.appendChild(this.header)\r\n    this.header.className = 'card-title'\r\n    this.header.id = 'community_tutorial_title'\r\n    close = document.createElement('button')\r\n    e.appendChild(close)\r\n    close.type = 'button'\r\n    close.className = 'btn-close'\r\n    close.setAttribute('aria-label', 'Close Tutorial')\r\n    close.addEventListener('click', this.end_tutorial)\r\n    this.frame.firstElementChild.appendChild((e = document.createElement('div')))\r\n    e.className = 'card-body'\r\n    e.appendChild(this.dialog)\r\n    this.dialog.role = 'status'\r\n    this.dialog.id = 'community_tutorial_description'\r\n    this.dialog.setAttribute('aria-labelledby', 'community_tutorial_progress')\r\n    this.dialog.setAttribute('aria-live', 'polite')\r\n    e.lastElementChild.className = 'card-text'\r\n    this.frame.firstElementChild.appendChild((e = document.createElement('div')))\r\n    e.className = 'tutorial-footer card-footer'\r\n    e.appendChild(this.progress)\r\n    this.progress.role = 'progressbar'\r\n    this.progress.id = 'community_tutorial_progress'\r\n    e.appendChild(this.timer)\r\n    this.timer.role = 'timer'\r\n    e.appendChild(this.continue)\r\n    this.continue.addEventListener('click', this.progress_tutorial)\r\n    this.continue.type = 'button'\r\n    this.continue.className = 'btn'\r\n    this.continue.innerText = 'Next'\r\n    this.continue.setAttribute('aria-controls', 'community_tutorial_frame')\r\n  }\r\n  retrieve_element(this: TutorialManager, name: string): HTMLElement {\r\n    let e: HTMLElement\r\n    if (name in this.site_elements) {\r\n      this.current_site_element = this.site_elements[name]\r\n      e = this.current_site_element.e\r\n    } else if ('nav:' === name.substring(0, 4).toLowerCase()) {\r\n      const text = name.replace(patterns.pre_colon, '')\r\n      document.querySelectorAll('.nav-item button').forEach((item: HTMLButtonElement) => {\r\n        if (text === item.innerText) e = item\r\n      })\r\n    } else {\r\n      try {\r\n        e = document.querySelector(name.replace(patterns.id_escapes, '\\\\$1'))\r\n      } catch (error) {}\r\n    }\r\n    return e\r\n  }\r\n  start_tutorial(this: TutorialManager, event?: MouseEvent, name?: string): void {\r\n    this.end_tutorial()\r\n    document.querySelectorAll('[data-bs-dismiss]').forEach((close: HTMLButtonElement) => close.click())\r\n    this.in_progress = name ? name : (event.target as HTMLButtonElement).dataset.name\r\n    if (!(this.in_progress in this.tutorials)) {\r\n      console.error('tutorial does not exist:', this.in_progress)\r\n      this.in_progress = ''\r\n      return\r\n    }\r\n    this.container.classList.remove('hidden')\r\n    this.header.innerText = this.tutorials[this.in_progress].title || this.in_progress\r\n    this.current_step = 0\r\n    this.current_time = 0\r\n    this.dialog.innerText = 'Starting tutorial ' + this.header.innerText\r\n    this.timer.innerText = ''\r\n    this.continue.innerText = 'Next'\r\n    if (this.tutorials[this.in_progress].reset) this.site_reset()\r\n    this.progress_tutorial()\r\n  }\r\n  progress_tutorial(this: TutorialManager, event?: KeyboardEvent): void {\r\n    const isClick = !event || !event.code\r\n    if (!isClick && 'Escape' === event.code) this.end_tutorial()\r\n    if (this.in_progress && !this.waiting && (isClick || 'Enter' === event.code || 'ArrowRight' === event.code)) {\r\n      this.waiting = true\r\n      clearTimeout(this.focuser as number)\r\n      clearInterval(this.running_timer as number)\r\n      const t = this.tutorials[this.in_progress]\r\n      let step: TutorialStep\r\n      const handle_object = (obj: {[index: string]: string}) => {\r\n        Object.keys(obj).forEach(k => {\r\n          if (patterns.number.test(k)) {\r\n            do_action(obj[k])\r\n          } else {\r\n            if (k in this.site_elements && this.site_elements[k].set) {\r\n              this.site_elements[k].set(obj[k])\r\n            }\r\n          }\r\n        })\r\n      }\r\n      const set_value = (value: string | string[]) => {\r\n        if (this.current_site_element && this.current_site_element.set) {\r\n          this.current_site_element.set(value as string)\r\n        } else {\r\n          const input =\r\n            'value' in this.current_element ? this.current_element : this.current_element.querySelector('input')\r\n          if (input) {\r\n            input.value = value\r\n            input.dispatchEvent(new Event('change'))\r\n            input.dispatchEvent(new KeyboardEvent('keydown', {code: 'Enter'}))\r\n          }\r\n        }\r\n      }\r\n      const do_action = (action: string) => {\r\n        if ('set' === action) {\r\n          if ('option' in step) set_value(step.option)\r\n        } else if ('click' === action) {\r\n          const u = this.current_site_element\r\n          if (u) {\r\n            if (action === u.id && 'toggle' in u) {\r\n              if (!u.expanded) u.toggle(void 0, u.e)\r\n            } else {\r\n              u.e.click()\r\n            }\r\n          } else {\r\n            this.current_element && this.current_element.click()\r\n          }\r\n        } else if ('close' === action) {\r\n          document.querySelectorAll('[data-bs-dismiss]').forEach((close: HTMLButtonElement) => close.click())\r\n        } else if ('value' === action.substring(0, 5)) {\r\n          set_value(action.replace(patterns.pre_colon, '').trimStart())\r\n        } else {\r\n          const e = this.retrieve_element(action)\r\n          if (e) e.click()\r\n        }\r\n      }\r\n      // handle previous step's after action\r\n      if (this.current_step > 0) {\r\n        step = t.steps[this.current_step - 1]\r\n        if ('after' in step) {\r\n          if (Array.isArray(step.after)) {\r\n            step.after.forEach(do_action)\r\n          } else {\r\n            handle_object(step.after)\r\n          }\r\n        }\r\n      }\r\n      if (this.current_step >= t.n_steps) {\r\n        this.end_tutorial()\r\n      } else {\r\n        this.current_site_element = void 0\r\n        // handle current step's before action\r\n        step = t.steps[this.current_step]\r\n        this.current_element = this.retrieve_element(step.focus)\r\n        if ('before' in step) {\r\n          if (Array.isArray(step.before)) {\r\n            step.before.forEach(do_action)\r\n          } else {\r\n            handle_object(step.before)\r\n          }\r\n        }\r\n        if (this.current_step === t.n_steps - 1) this.continue.innerText = 'Finish'\r\n        if (this.current_element && this.current_element.scrollIntoView) this.current_element.scrollIntoView()\r\n        // execute current step after actions have resolved\r\n        setTimeout(this.execute_step, 'wait' in step ? step.wait : 400)\r\n      }\r\n    }\r\n  }\r\n  execute_step(this: TutorialManager): void {\r\n    if (this.in_progress) {\r\n      const t = this.tutorials[this.in_progress]\r\n      const step = t.steps[this.current_step]\r\n      if (!this.current_element) {\r\n        const e = this.retrieve_element(step.focus)\r\n        if (!e) {\r\n          console.error('failed to retrieve element', step.focus)\r\n          return this.end_tutorial()\r\n        }\r\n        this.current_element = e\r\n        if (e.scrollIntoView) e.scrollIntoView()\r\n        setTimeout(this.execute_step, 0)\r\n        return\r\n      }\r\n      this.continue.disabled = !!step.disable_continue\r\n      const b = this.current_element.getBoundingClientRect(),\r\n        f = this.frame.getBoundingClientRect()\r\n      this.highlight.style.top = b.top + 'px'\r\n      this.highlight.style.left = b.left + 'px'\r\n      this.highlight.style.width = b.width + 'px'\r\n      this.highlight.style.height = b.height + 'px'\r\n      this.frame.style.top = (b.y < screen.availHeight / 2 ? b.y + b.height + 10 : b.y - f.height - 10) + 'px'\r\n      this.frame.style.marginLeft = -f.width / 2 + 'px'\r\n      if (step.time) {\r\n        this.current_time = step.time\r\n        this.timer.innerText = step.time + ''\r\n        this.running_timer = setInterval(() => {\r\n          this.current_time--\r\n          this.timer.innerText = this.current_time + ''\r\n          if (this.current_time <= 0) {\r\n            clearInterval(this.running_timer as number)\r\n            this.progress_tutorial()\r\n          }\r\n        }, 1e3)\r\n      } else {\r\n        this.timer.innerText = ''\r\n      }\r\n      this.progress.innerText = 'Step ' + (this.current_step + 1) + ' of ' + t.n_steps\r\n      this.dialog.innerText = step.description\r\n      this.current_step++\r\n      this.waiting = false\r\n      this.focuser = setTimeout(() => this.continue.focus(), 0)\r\n    }\r\n  }\r\n  end_tutorial(this: TutorialManager): void {\r\n    this.in_progress = ''\r\n    this.current_step = 0\r\n    this.container.classList.add('hidden')\r\n    this.waiting = false\r\n    clearTimeout(this.focuser as number)\r\n  }\r\n}\r\n","import type {\r\n  Filter,\r\n  FilterParsed,\r\n  MeasureInfo,\r\n  Reference,\r\n  ReferencesParsed,\r\n  ResourceField,\r\n  SlimNote,\r\n  Summary,\r\n  VariableFilterParsed,\r\n} from '../types'\r\nimport {InputCombobox} from './inputs/combobox'\r\nimport type Community from './index'\r\nimport {patterns} from './patterns'\r\nimport {filter_components} from './static_refs'\r\nimport {TutorialManager} from './tutorials'\r\nimport {\r\n  fill_ids_options,\r\n  make_summary_table,\r\n  make_variable_source,\r\n  set_description,\r\n  toggle_input,\r\n  tooltip_trigger,\r\n} from './utils'\r\n\r\ninterface Modal {\r\n  init: boolean\r\n  e: HTMLElement\r\n  header: HTMLElement\r\n  body: HTMLElement\r\n}\r\n\r\ninterface FilterUI extends Modal {\r\n  conditions: HTMLTableElement\r\n  variable_filters: HTMLElement\r\n  entity_filters: HTMLElement\r\n  entity_inputs: {[index: string]: InputCombobox}\r\n  time_range: HTMLElement\r\n}\r\n\r\ninterface InfoUI extends Modal {\r\n  body: HTMLElement\r\n  title: HTMLElement\r\n  description: HTMLElement\r\n  name: HTMLElement\r\n  type: HTMLElement\r\n  sources: HTMLElement\r\n  references: HTMLElement\r\n  origin: HTMLElement\r\n  source_file: HTMLElement\r\n}\r\n\r\ntype Side = 'top' | 'left' | 'bottom' | 'right'\r\n\r\nfunction make_variable_reference(c: Reference) {\r\n  if (!Array.isArray(c.author)) c.author = [c.author]\r\n  const e = document.createElement('li'),\r\n    n = c.author.length\r\n  let s = '',\r\n    j = 1 === n ? '' : 2 === n ? ' & ' : ', & ',\r\n    span = document.createElement('span')\r\n  for (let i = n; i--; ) {\r\n    const a = c.author[i]\r\n    s =\r\n      (i ? j : '') + ('string' === typeof a ? a : a.family + (a.given ? ', ' + a.given.substring(0, 1) + '.' : '')) + s\r\n    j = ', '\r\n  }\r\n  e.innerText = s + ' (' + c.year + '). ' + c.title + '.'\r\n  if (c.journal) {\r\n    e.appendChild(span)\r\n    span.innerText = c.journal + (c.volume ? ', ' + c.volume : '')\r\n    span.style.fontStyle = 'italic'\r\n    e.appendChild((span = document.createElement('span')))\r\n    span.innerText = (c.page ? ', ' + c.page : '') + '.'\r\n  }\r\n  if (c.version) {\r\n    e.appendChild((span = document.createElement('span')))\r\n    span.innerText = ' Version ' + c.version + '.'\r\n  }\r\n  if (c.doi || c.url) {\r\n    e.appendChild((span = document.createElement('span')))\r\n    span.innerText = c.doi ? ' doi: ' : ' url: '\r\n    const a = document.createElement('a')\r\n    e.appendChild(a)\r\n    a.rel = 'noreferrer'\r\n    a.target = '_blank'\r\n    a.href = c.doi ? 'https://doi.org/' + c.doi : c.url\r\n    a.innerText = c.doi || c.url.replace(patterns.http, '')\r\n  }\r\n  return e\r\n}\r\n\r\nclass PageMenu {\r\n  e: HTMLElement\r\n  wrapper: HTMLElement\r\n  toggler?: HTMLButtonElement\r\n  side: Side\r\n  page: Page\r\n  timeout: number | NodeJS.Timeout = -1\r\n  constructor(e: HTMLElement, page: Page) {\r\n    this.e = e\r\n    this.wrapper = e.parentElement\r\n    this.page = page\r\n    this.hide = this.hide.bind(this)\r\n    this.toggle = this.toggle.bind(this)\r\n    const has_toggler = e.lastElementChild.tagName === 'BUTTON'\r\n    if (has_toggler) this.toggler = e.lastElementChild as HTMLButtonElement\r\n    if (e.classList.contains('menu-top')) {\r\n      this.side = 'top'\r\n      page.top_menu = this\r\n      e.style.left = page.content_bounds.left + 'px'\r\n      e.style.right = page.content_bounds.right + 'px'\r\n      if (has_toggler) {\r\n        this.toggler.addEventListener('click', this.toggle)\r\n        this.toggler.style.top = page.content_bounds.top + 'px'\r\n      }\r\n    } else if (e.classList.contains('menu-right')) {\r\n      this.side = 'right'\r\n      page.right_menu = this\r\n      e.style.right = page.content_bounds.right + 'px'\r\n      if (has_toggler) {\r\n        this.toggler.addEventListener('click', this.toggle)\r\n        this.toggler.style.top = page.content_bounds.top + 'px'\r\n      }\r\n    } else if (e.classList.contains('menu-bottom')) {\r\n      this.side = 'bottom'\r\n      page.bottom_menu = this\r\n      page.content_bounds.bottom = 40\r\n      page.bottom_menu.e.style.left = page.content_bounds.left + 'px'\r\n      page.bottom_menu.e.style.right = page.content_bounds.right + 'px'\r\n      if (has_toggler) {\r\n        this.toggler.addEventListener('click', this.toggle)\r\n      }\r\n    } else if (e.classList.contains('menu-left')) {\r\n      this.side = 'left'\r\n      page.left_menu = this\r\n      e.style.left = page.content_bounds.left + 'px'\r\n      if (has_toggler) {\r\n        this.toggler.addEventListener('click', this.toggle)\r\n        this.toggler.style.top = page.content_bounds.top + 'px'\r\n      }\r\n    }\r\n  }\r\n  hide() {\r\n    this.timeout = -1\r\n    this.e.firstElementChild.classList.add('hidden')\r\n    this.page.resize()\r\n  }\r\n  toggle() {\r\n    if (this.timeout !== -1) clearTimeout(this.timeout)\r\n    this.timeout = -1\r\n    if ('closed' === this.e.dataset.state) {\r\n      this.e.dataset.state = 'open'\r\n      this.e.firstElementChild.classList.remove('hidden')\r\n      this.e.style[this.side] = '0px'\r\n      this.page.content.style[this.side] =\r\n        this.e.getBoundingClientRect()['left' === this.side || 'right' === this.side ? 'width' : 'height'] + 'px'\r\n      if ('top' === this.side || 'bottom' === this.side)\r\n        this.toggler.style[this.side] = this.page.content_bounds[this.side] + 'px'\r\n      setTimeout(this.page.trigger_resize, 300)\r\n    } else {\r\n      this.e.dataset.state = 'closed'\r\n      if ('left' === this.side || 'right' === this.side) {\r\n        this.e.style[this.side] = -this.e.getBoundingClientRect().width + 'px'\r\n        this.page.content.style[this.side] = this.page.content_bounds[this.side] + 'px'\r\n      } else {\r\n        const b = this.e.getBoundingClientRect()\r\n        this.page.content.style[this.side] = this.page.content_bounds[this.side] + ('top' === this.side ? 40 : 0) + 'px'\r\n        this.e.style[this.side] = -b.height + ('top' === this.side ? this.page.content_bounds.top : 0) + 'px'\r\n        if ('top' === this.side || 'bottom' === this.side) this.toggler.style[this.side] = b.height + 'px'\r\n      }\r\n      this.timeout = setTimeout(this.hide, 300)\r\n    }\r\n  }\r\n}\r\n\r\nexport class Page {\r\n  site: Community\r\n  load_screen: HTMLElement\r\n  wrap: HTMLElement\r\n  navbar: DOMRect | {height: number}\r\n  content: HTMLElement\r\n  menus: PageMenu[] = []\r\n  panels: NodeListOf<HTMLElement>\r\n  overlay = document.createElement('div')\r\n  selection = document.createElement('span')\r\n  script_style = document.createElement('style')\r\n  modal: {info: InfoUI; filter: FilterUI} = {\r\n    info: {\r\n      init: false,\r\n      e: document.createElement('div'),\r\n      header: document.createElement('div'),\r\n      body: document.createElement('div'),\r\n      title: document.createElement('div'),\r\n      description: document.createElement('div'),\r\n      name: document.createElement('tr'),\r\n      type: document.createElement('tr'),\r\n      sources: document.createElement('div'),\r\n      references: document.createElement('div'),\r\n      origin: document.createElement('div'),\r\n      source_file: document.createElement('div'),\r\n    },\r\n    filter: {\r\n      init: false,\r\n      e: document.createElement('div'),\r\n      header: document.createElement('div'),\r\n      body: document.createElement('div'),\r\n      conditions: document.createElement('table'),\r\n      variable_filters: document.createElement('div'),\r\n      entity_filters: document.createElement('div'),\r\n      entity_inputs: {},\r\n      time_range: document.createElement('div'),\r\n    },\r\n  }\r\n  tooltip = {\r\n    showing: '',\r\n    e: document.createElement('div'),\r\n  }\r\n  content_bounds = {\r\n    top: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    left: 0,\r\n    outer_right: 0,\r\n  }\r\n  elementCount = 0\r\n  top_menu?: PageMenu\r\n  right_menu?: PageMenu\r\n  bottom_menu?: PageMenu\r\n  left_menu?: PageMenu\r\n  tutorials?: TutorialManager\r\n  constructor(site: Community) {\r\n    this.site = site\r\n    this.render_credits = this.render_credits.bind(this)\r\n    this.show_variable_info = this.show_variable_info.bind(this)\r\n    this.tooltip_clear = this.tooltip_clear.bind(this)\r\n    this.site.page = this\r\n    this.load_screen = document.getElementById('load_screen')\r\n    this.wrap = document.getElementById('site_wrap')\r\n    const navbar = document.querySelector('.navbar') as HTMLElement\r\n    if (navbar) {\r\n      this.navbar = navbar.getBoundingClientRect()\r\n      navbar.querySelectorAll('button').forEach(b => {\r\n        const panel = document.querySelector(b.getAttribute('data-bs-target'))\r\n        if (panel && 'false' === panel.getAttribute('data-bs-backdrop')) {\r\n          panel.addEventListener(\r\n            'show.bs.offcanvas',\r\n            function (this: Page) {\r\n              this.content_bounds.outer_right = panel.getBoundingClientRect().width\r\n              this.resize(true)\r\n              setTimeout(this.trigger_resize, 200)\r\n            }.bind(this)\r\n          )\r\n          panel.addEventListener(\r\n            'hide.bs.offcanvas',\r\n            function (this: Page) {\r\n              this.content_bounds.outer_right = 0\r\n              this.resize(true)\r\n              setTimeout(this.trigger_resize, 200)\r\n            }.bind(this)\r\n          )\r\n        }\r\n      })\r\n      if ('navcolor' in site.url_options) {\r\n        if ('' === site.url_options.navcolor) site.url_options.navcolor = window.location.hash\r\n        navbar.style.backgroundColor = (site.url_options.navcolor as string).replace('%23', '#')\r\n      }\r\n      if (site.url_options.hide_logo && site.url_options.hide_title && site.url_options.hide_navcontent) {\r\n        navbar.classList.add('hidden')\r\n      } else {\r\n        const brand = document.querySelector('.navbar-brand')\r\n        if (brand) {\r\n          if (site.url_options.hide_logo && 'IMG' === brand.firstElementChild.tagName)\r\n            brand.firstElementChild.classList.add('hidden')\r\n          if (site.url_options.hide_title && 'IMG' !== brand.lastElementChild.tagName)\r\n            brand.lastElementChild.classList.add('hidden')\r\n        }\r\n        if (site.url_options.hide_navcontent) {\r\n          document.querySelector('.navbar-toggler').classList.add('hidden')\r\n          const nav = document.querySelector('.navbar-nav')\r\n          if (nav) nav.classList.add('hidden')\r\n        }\r\n      }\r\n      if (site.url_options.hide_panels && this.panels.length) {\r\n        this.panels.forEach(p => p.classList.add('hidden'))\r\n      }\r\n    } else {\r\n      this.navbar = {height: 0}\r\n    }\r\n    this.content = document.querySelector('.content')\r\n    this.panels = document.querySelectorAll('.panel')\r\n    this.init_panel = this.init_panel.bind(this)\r\n    this.resize = this.resize.bind(this)\r\n    window.addEventListener('resize', this.resize)\r\n    this.tooltip.e.className = 'tooltip hidden'\r\n    this.tooltip.e.appendChild(document.createElement('p'))\r\n    document.head.appendChild(this.script_style)\r\n    document.body.appendChild(this.tooltip.e)\r\n    document.body.addEventListener('mouseover', this.tooltip_clear)\r\n    this.overlay.className = 'content-overlay'\r\n    document.body.appendChild(this.overlay)\r\n    document.body.className =\r\n      this.site.storage.get('theme_dark') || this.site.spec.settings.theme_dark ? 'dark-theme' : 'light-theme'\r\n    this.content_bounds.top = this.navbar.height\r\n    this.init_variable_info()\r\n    this.init_filter()\r\n    document.querySelectorAll('[data-autotype=credits]').forEach(this.render_credits)\r\n    if (site.spec.tutorials) {\r\n      this.tutorials = new TutorialManager(site.spec.tutorials, site.inputs, site.global_reset)\r\n      this.overlay.appendChild(this.tutorials.container)\r\n    }\r\n  }\r\n  init() {\r\n    this.panels.length && this.panels.forEach(this.init_panel)\r\n    document.querySelectorAll('.menu-wrapper').forEach((m: HTMLElement) => {\r\n      const menu = new PageMenu(m, this)\r\n      this.menus.push(menu)\r\n      if (this.site.url_options.close_menus && 'open' === menu.wrapper.dataset.state) menu.toggler.click()\r\n    })\r\n    if (this.content) {\r\n      this.content.style.top =\r\n        (this.top_menu ? this.top_menu.e.getBoundingClientRect().height : this.navbar.height) + 'px'\r\n    }\r\n    Object.keys(this.site.data.loaded)\r\n      .reverse()\r\n      .forEach(d => {\r\n        const u = InputCombobox.create(\r\n            this.site,\r\n            d,\r\n            void 0,\r\n            {search: true, multi: true, clearable: true},\r\n            'filter.' + d\r\n          ),\r\n          div = document.createElement('div')\r\n        this.modal.filter.entity_inputs[d] = u\r\n        this.modal.filter.entity_filters.lastElementChild.appendChild(div)\r\n        div.className = 'col-sm'\r\n        div.appendChild(u.e.parentElement)\r\n        u.e.parentElement.classList.add('form-floating')\r\n        u.listbox.classList.add('multi')\r\n        u.dataset = d\r\n        u.loader = () => {\r\n          u.site.data.retrieve(u.dataset, u.site.data.info[u.dataset].site_file)\r\n          u.e.removeEventListener('click', u.loader)\r\n        }\r\n        if (!u.site.data.loaded[d]) {\r\n          u.e.addEventListener('click', u.loader)\r\n        }\r\n        u.onchange = () => {\r\n          this.site.view.id_filter()\r\n          this.site.request_queue('view.id')\r\n        }\r\n        fill_ids_options(\r\n          u,\r\n          d,\r\n          u.option_sets,\r\n          function (this: InputCombobox) {\r\n            this.set_current()\r\n            toggle_input(u, !!this.options.length)\r\n            Object.keys(this.values).forEach(id => {\r\n              this.site.view.entities.set(id, this.site.data.entities[id])\r\n            })\r\n            this.site.view.registered[d] = true\r\n            this.set(this.id in this.site.url_options ? (this.site.url_options[this.id] as string).split(',') : -1)\r\n          }.bind(u)\r\n        )\r\n        toggle_input(u, !!u.options.length)\r\n        this.site.registered_inputs.set(u.id, u)\r\n        this.site.inputs[u.id] = u\r\n      })\r\n  }\r\n  init_panel(p: HTMLElement) {\r\n    const side = p.classList.contains('panel-left') ? 'left' : 'right'\r\n    this.content_bounds[side] = p.getBoundingClientRect().width\r\n    p.style.marginTop = this.content_bounds.top + 'px'\r\n    p.lastElementChild.addEventListener('click', () => {\r\n      const w = p.getBoundingClientRect().width,\r\n        bw = p.lastElementChild.getBoundingClientRect().width\r\n      if ('true' === p.lastElementChild.getAttribute('aria-expanded')) {\r\n        this.content_bounds[side] = bw\r\n        if (this.top_menu) this.top_menu.e.style[side] = bw + 'px'\r\n        if (this.bottom_menu) this.bottom_menu.e.style[side] = bw + 'px'\r\n        p.style[side] = -w + bw + 'px'\r\n        p.lastElementChild.setAttribute('aria-expanded', 'false')\r\n      } else {\r\n        this.content_bounds[side] = w\r\n        if (this.top_menu) this.top_menu.e.style[side] = w + 'px'\r\n        if (this.bottom_menu) this.bottom_menu.e.style[side] = w + 'px'\r\n        p.style[side] = '0px'\r\n        p.lastElementChild.setAttribute('aria-expanded', 'true')\r\n      }\r\n      this.resize()\r\n      setTimeout(this.trigger_resize, 200)\r\n    })\r\n  }\r\n  init_variable_info() {\r\n    const e = this.modal.info,\r\n      button = document.createElement('button'),\r\n      a = document.createElement('a')\r\n    let th = document.createElement('th'),\r\n      p = document.createElement('p'),\r\n      div = document.createElement('div'),\r\n      ul = document.createElement('ul')\r\n    document.body.appendChild(e.e)\r\n    this.modal.info.init = true\r\n    e.e.id = 'variable_info_display'\r\n    e.e.className = 'modal fade'\r\n    e.e.setAttribute('tabindex', '-1')\r\n    e.e.setAttribute('aria-labelledby', 'variable_info_title')\r\n    e.e.setAttribute('aria-hidden', 'true')\r\n    e.e.appendChild(div)\r\n    div.className = 'modal-dialog modal-dialog-scrollable'\r\n    div.appendChild((div = document.createElement('div')))\r\n    div.className = 'modal-content'\r\n    div.appendChild(e.header)\r\n    e.header.className = 'modal-header'\r\n    e.header.appendChild(document.createElement('p'))\r\n    e.header.firstElementChild.className = 'h5 modal-title'\r\n    e.header.firstElementChild.id = 'variable_info_title'\r\n    e.header.appendChild(button)\r\n    button.type = 'button'\r\n    button.className = 'btn-close'\r\n    button.setAttribute('data-bs-dismiss', 'modal')\r\n    button.title = 'close'\r\n    e.header.insertAdjacentElement('afterend', e.body)\r\n    e.body.className = 'modal-body'\r\n    e.body.appendChild((e.title = document.createElement('p')))\r\n    e.title.className = 'h4'\r\n    e.body.appendChild((e.description = document.createElement('p')))\r\n\r\n    e.body.appendChild(document.createElement('table'))\r\n    e.body.lastElementChild.className = 'info-feature-table'\r\n\r\n    e.body.lastElementChild.appendChild((e.name = document.createElement('tr')))\r\n    e.name.appendChild(th)\r\n    th.innerText = 'Name'\r\n    e.name.appendChild(document.createElement('td'))\r\n\r\n    e.body.lastElementChild.appendChild((e.type = document.createElement('tr')))\r\n    e.type.appendChild((th = document.createElement('th')))\r\n    th.innerText = 'Type'\r\n    e.type.appendChild(document.createElement('td'))\r\n\r\n    e.body.appendChild(e.sources)\r\n    e.sources.appendChild(p)\r\n    p.innerText = 'Sources'\r\n    p.className = 'h3'\r\n    e.sources.appendChild((div = document.createElement('div')))\r\n    div.className = 'sources-cards'\r\n\r\n    e.body.appendChild(e.references)\r\n    e.references.appendChild((p = document.createElement('p')))\r\n    p.className = 'h3'\r\n    p.innerText = 'References'\r\n    e.references.appendChild(ul)\r\n    ul.className = 'reference-list'\r\n\r\n    e.body.appendChild(e.origin)\r\n    e.origin.appendChild((p = document.createElement('p')))\r\n    p.className = 'h3'\r\n    p.innerText = 'Origin'\r\n    e.origin.appendChild((ul = document.createElement('ul')))\r\n    ul.className = 'origin-list'\r\n\r\n    e.body.appendChild(e.source_file)\r\n    e.source_file.className = 'info-source-file'\r\n    e.source_file.appendChild(a)\r\n    a.innerText = 'source'\r\n    a.target = '_blank'\r\n    a.rel = 'noreferrer'\r\n  }\r\n  show_variable_info(e: MouseEvent) {\r\n    const v = this.site.dataviews[this.site.defaults.dataview],\r\n      name = this.site.valueOf((e.target && (e.target as HTMLButtonElement).dataset.variable) || v.y) as string,\r\n      info = this.site.data.variable_info[name] as MeasureInfo\r\n    ;(this.modal.info.header.firstElementChild as HTMLElement).innerText = info.short_name\r\n    this.modal.info.title.innerText = info.long_name\r\n    set_description(this.modal.info.description, info)\r\n    ;(this.modal.info.name.lastElementChild as HTMLElement).innerText = name\r\n    ;(this.modal.info.type.lastElementChild as HTMLElement).innerText =\r\n      info.unit || info.aggregation_method || info.type || ''\r\n    if (info.sources && info.sources.length) {\r\n      this.modal.info.sources.lastElementChild.innerHTML = ''\r\n      this.modal.info.sources.classList.remove('hidden')\r\n      info.sources.forEach(s => {\r\n        this.modal.info.sources.lastElementChild.appendChild(make_variable_source(s))\r\n      })\r\n    } else this.modal.info.sources.classList.add('hidden')\r\n    if (info.citations && info.citations.length) {\r\n      this.modal.info.references.lastElementChild.innerHTML = ''\r\n      this.modal.info.references.classList.remove('hidden')\r\n      if ('string' === typeof info.citations) info.citations = [info.citations]\r\n      if ('references' in this.site.data) {\r\n        delete this.site.data.variable_info._references\r\n        delete this.site.data.references\r\n      }\r\n      if (!('_references' in this.site.data.variable_info)) {\r\n        const r: ReferencesParsed = {}\r\n        this.site.data.variable_info._references_parsed = r\r\n        Object.keys(this.site.data.info).forEach(d => {\r\n          const m = this.site.data.info[d]\r\n          if ('_references' in m) {\r\n            Object.keys(m._references).forEach(t => {\r\n              if (!(t in r))\r\n                r[t] = {\r\n                  reference: m._references[t],\r\n                  element: make_variable_reference(m._references[t]),\r\n                }\r\n            })\r\n          }\r\n        })\r\n      }\r\n      const r = this.site.data.variable_info._references_parsed\r\n      info.citations.forEach(c => {\r\n        if (c in r) this.modal.info.references.lastElementChild.appendChild(r[c].element)\r\n      })\r\n    } else this.modal.info.references.classList.add('hidden')\r\n    if ('origin' in info) {\r\n      this.modal.info.origin.classList.remove('hidden')\r\n      const l = this.modal.info.origin.lastElementChild\r\n      l.innerHTML = ''\r\n      if ('string' === typeof info.origin) info.origin = [info.origin]\r\n      info.origin.forEach(url => {\r\n        const c = document.createElement('li'),\r\n          repo = patterns.repo.exec(url)[1]\r\n        let link = document.createElement('a')\r\n        link.href = 'https://github.com/' + repo\r\n        link.target = '_blank'\r\n        link.rel = 'noreferrer'\r\n        link.innerText = repo\r\n        c.appendChild(link)\r\n        c.appendChild(document.createElement('span'))\r\n        ;(c.lastElementChild as HTMLElement).innerText = ' / '\r\n        link = document.createElement('a')\r\n        link.href = url\r\n        link.target = '_blank'\r\n        link.rel = 'noreferrer'\r\n        link.innerText = url.replace(patterns.basename, '')\r\n        c.appendChild(link)\r\n        l.appendChild(c)\r\n      })\r\n    } else this.modal.info.origin.classList.add('hidden')\r\n    if (info.source_file) {\r\n      this.modal.info.source_file.classList.remove('hidden')\r\n      ;(this.modal.info.source_file.firstElementChild as HTMLLinkElement).href = info.source_file\r\n    } else this.modal.info.source_file.classList.add('hidden')\r\n  }\r\n  init_filter() {\r\n    // set up filter's time range\r\n    const e = this.modal.filter,\r\n      button = document.createElement('button')\r\n    let p = document.createElement('p'),\r\n      div = document.createElement('div'),\r\n      input = document.createElement('input'),\r\n      label = document.createElement('label'),\r\n      span = document.createElement('span'),\r\n      tr = document.createElement('tr')\r\n    document.body.appendChild(e.e)\r\n    this.modal.filter.init = true\r\n    e.e.id = 'filter_display'\r\n    e.e.className = 'modal fade'\r\n    e.e.setAttribute('aria-labelledby', 'filter_title')\r\n    e.e.setAttribute('aria-hidden', 'true')\r\n    e.e.appendChild(div)\r\n    div.className = 'modal-dialog'\r\n    div.appendChild((div = document.createElement('div')))\r\n    div.className = 'modal-content'\r\n    div.appendChild(e.header)\r\n\r\n    e.header.className = 'modal-header'\r\n    e.header.appendChild(p)\r\n    p.className = 'h5 modal-title'\r\n    p.id = 'filter_title'\r\n    p.innerText = 'Filter'\r\n    e.header.appendChild(button)\r\n    button.type = 'button'\r\n    button.className = 'btn-close'\r\n    button.setAttribute('data-bs-dismiss', 'modal')\r\n    button.title = 'close'\r\n    e.header.insertAdjacentElement('afterend', e.body)\r\n    e.body.className = 'filter-dialog'\r\n    e.body.appendChild((p = document.createElement('p')))\r\n    p.className = 'h6'\r\n    p.innerText = 'Time Range'\r\n\r\n    e.body.appendChild(e.time_range)\r\n    e.time_range.className = 'row'\r\n\r\n    e.time_range.appendChild((div = document.createElement('div')))\r\n    div.className = 'col'\r\n    div.appendChild((div = document.createElement('div')))\r\n    div.className = 'form-floating text-wrapper wrapper'\r\n    div.appendChild(input)\r\n    input.className = 'form-control auto-input'\r\n    input.setAttribute('data-autoType', 'number')\r\n    input.setAttribute('data-default', 'min')\r\n    input.max = 'filter.time_max'\r\n    input.type = 'number'\r\n    input.id = 'filter.time_min'\r\n    div.appendChild(label)\r\n    label.innerText = 'First Time'\r\n    label.setAttribute('for', 'filter.time_min')\r\n    e.time_range.appendChild((div = document.createElement('div')))\r\n    div.className = 'col'\r\n    div.appendChild((div = document.createElement('div')))\r\n    div.className = 'form-floating text-wrapper wrapper'\r\n    div.appendChild((input = document.createElement('input')))\r\n    input.className = 'form-control auto-input'\r\n    input.setAttribute('data-autoType', 'number')\r\n    input.setAttribute('data-default', 'max')\r\n    input.min = 'filter.time_min'\r\n    input.type = 'number'\r\n    input.id = 'filter.time_max'\r\n    div.appendChild((label = document.createElement('label')))\r\n    label.innerText = 'Last Time'\r\n    label.setAttribute('for', 'filter.time_max')\r\n\r\n    // entity filter\r\n    e.body.appendChild(e.entity_filters)\r\n    e.entity_filters.appendChild((p = document.createElement('p')))\r\n    p.className = 'h6'\r\n    p.innerText = 'Select Entities'\r\n    span.className = 'note'\r\n    span.innerText = '(click disabled selectors to load)'\r\n    p.appendChild(span)\r\n    e.entity_filters.appendChild((div = document.createElement('div')))\r\n    div.className = 'row'\r\n    e.entity_inputs = {}\r\n\r\n    e.body.appendChild(e.variable_filters)\r\n    e.variable_filters.appendChild((p = document.createElement('p')))\r\n    p.className = 'h6'\r\n    p.innerText = 'Variable Conditions'\r\n    // variable filter dropdown\r\n    e.variable_filters.appendChild((div = document.createElement('div')))\r\n    div.className = 'row'\r\n    div.appendChild((div = document.createElement('div')))\r\n    div.className = 'col'\r\n    div.appendChild((div = document.createElement('div')))\r\n    const filter_select = InputCombobox.create(\r\n      this.site,\r\n      'Add Variable Condition',\r\n      void 0,\r\n      {strict: true, search: true, clearable: true, floating: true, accordion: true},\r\n      'filter_variable_dropdown'\r\n    )\r\n    filter_select.input = false\r\n    filter_select.settings.filter_table = document.querySelector('.filter-body')\r\n    filter_select.onchange = () => {\r\n      const value = filter_select.value() as string\r\n      if (value in this.site.data.variables) {\r\n        this.add_filter_condition(value)\r\n        filter_select.selection.innerText = ''\r\n        const input = document.querySelectorAll('.filter-body .combobox-input') as NodeListOf<HTMLElement>\r\n        if (input && input.length) input[input.length - 1].focus()\r\n      }\r\n    }\r\n    filter_select.view = this.site.defaults.dataview\r\n    filter_select.optionSource = 'variables'\r\n    this.site.add_dependency(this.site.defaults.dataview, {type: 'options', id: filter_select.id})\r\n    div.appendChild(filter_select.e.parentElement)\r\n    // variable filter table\r\n    e.variable_filters.appendChild((div = document.createElement('div')))\r\n    div.className = 'hidden'\r\n    div.appendChild(e.conditions)\r\n    e.conditions.className = 'filter-conditions-table table'\r\n    e.conditions.appendChild(document.createElement('thead'))\r\n    e.conditions.lastElementChild.className = 'filter-header'\r\n    e.conditions.appendChild(document.createElement('tbody'))\r\n    e.conditions.lastElementChild.className = 'filter-body'\r\n    e.conditions.firstElementChild.appendChild(tr)\r\n    ;['Variable', 'Result', 'Active', 'Component', 'Operator', 'Value', 'Remove'].forEach(h => {\r\n      const th = document.createElement('th')\r\n      tr.appendChild(th)\r\n      if ('Component' === h || 'Result' === h) {\r\n        const l: SlimNote = {\r\n          id: '',\r\n          note: '',\r\n          site: this.site,\r\n          wrapper: document.createElement('label'),\r\n        }\r\n        if ('Component' === h) {\r\n          l.id = 'filter_component_header'\r\n          l.note =\r\n            'Component refers to which single value to filter on for each entity; select a dynamic time reference, or enter a time.'\r\n        } else {\r\n          l.id = 'filter_result_header'\r\n          l.note = 'Passing / total entities across loaded datasets.'\r\n        }\r\n        th.appendChild(l.wrapper)\r\n        th.className = 'has-note'\r\n        l.wrapper.innerText = h\r\n        l.wrapper.id = l.id\r\n        l.wrapper.setAttribute('data-of', l.id)\r\n        l.wrapper.setAttribute('aria-description', l.note)\r\n        th.addEventListener('mouseover', tooltip_trigger.bind(l))\r\n      } else {\r\n        th.innerText = h\r\n      }\r\n    })\r\n    e.variable_filters.lastElementChild.appendChild((p = document.createElement('p')))\r\n    p.className = 'note'\r\n    p.innerText = 'Summaries are across time within each unfiltered dataset.'\r\n  }\r\n  resize(e?: Event | boolean) {\r\n    const full = e && 'boolean' === typeof e,\r\n      f = this[full ? 'wrap' : 'content']\r\n    if (!full) {\r\n      f.style.top =\r\n        (this.top_menu && 'open' === this.top_menu.e.dataset.state\r\n          ? this.top_menu.e.getBoundingClientRect().height\r\n          : this.content_bounds.top +\r\n            ((!this.top_menu && !this.left_menu && !this.right_menu) ||\r\n            (this.right_menu && 'open' === this.right_menu.e.dataset.state) ||\r\n            (this.left_menu && 'open' === this.left_menu.e.dataset.state)\r\n              ? 0\r\n              : 40)) + 'px'\r\n      f.style.bottom =\r\n        this.content_bounds.bottom +\r\n        (!this.bottom_menu || 'closed' === this.bottom_menu.e.dataset.state\r\n          ? 0\r\n          : this.bottom_menu.e.getBoundingClientRect().height) +\r\n        'px'\r\n      f.style.left =\r\n        this.content_bounds.left +\r\n        (!this.left_menu || 'closed' === this.left_menu.e.dataset.state\r\n          ? 0\r\n          : this.left_menu.e.getBoundingClientRect().width) +\r\n        'px'\r\n    }\r\n    f.style.right =\r\n      this.content_bounds[full ? 'outer_right' : 'right'] +\r\n      (!this.right_menu || 'closed' === this.right_menu.e.dataset.state\r\n        ? 0\r\n        : this.right_menu.e.getBoundingClientRect().width) +\r\n      'px'\r\n  }\r\n  tooltip_clear(e: MouseEvent) {\r\n    const target = e.target as HTMLElement\r\n    if (this.tooltip.showing && ('blur' === e.type || this.tooltip.showing !== (target.dataset.of || target.id))) {\r\n      this.tooltip.showing = ''\r\n      this.tooltip.e.classList.add('hidden')\r\n    }\r\n  }\r\n  add_filter_condition(variable: string, presets?: VariableFilterParsed | Filter) {\r\n    presets = presets || {operator: '>=', value: 0}\r\n    let tr = document.createElement('tr'),\r\n      td = document.createElement('td'),\r\n      p = document.createElement('p'),\r\n      label = document.createElement('label'),\r\n      div = document.createElement('div'),\r\n      input = document.createElement('input'),\r\n      select = document.createElement('select'),\r\n      button = document.createElement('button')\r\n    const f: FilterParsed = {\r\n        e: tr,\r\n        variable: variable,\r\n        component: presets.component || 'last',\r\n        operator: presets.operator || '>=',\r\n        value: (presets.value as string | number) || 0,\r\n        active: true,\r\n        id: variable + '_' + Date.now(),\r\n        passed: 0,\r\n        failed: 0,\r\n        info: this.site.data.variables[variable].info,\r\n        view: this.site.dataviews[this.site.defaults.dataview],\r\n      },\r\n      d = f.view.get.dataset(),\r\n      range = f.info[d].time_range,\r\n      times = this.site.data.meta.overall.value,\r\n      formatter = this.site.data.format_value.bind(this.site.data)\r\n    this.site.view.filters.set(f.id, f)\r\n    if ('number' === typeof f.component) f.component = times[f.component] + ''\r\n    // variable name\r\n    tr.appendChild(td)\r\n    td.appendChild(p)\r\n    p.id = f.id\r\n    p.className = 'cell-text'\r\n    p.innerText = f.info[d].info.short_name\r\n    td.appendChild(p)\r\n    td.appendChild((p = document.createElement('p')))\r\n    f.summary = {\r\n      f,\r\n      update: function () {\r\n        const d = f.view.get.dataset(),\r\n          range = f.info[d].time_range\r\n        if (d !== this.add.Dataset) {\r\n          this.add.Dataset = d\r\n          this.add.First = this.times[range[0]] + '' || 'NA'\r\n          this.add.Last = this.times[range[1]] + '' || 'NA'\r\n          const s = this.f.info[d],\r\n            heads = this.table.firstElementChild.firstElementChild.children as HTMLCollectionOf<HTMLTableCellElement>,\r\n            cells = this.table.lastElementChild.firstElementChild.children as HTMLCollectionOf<HTMLTableCellElement>\r\n          for (let i = cells.length; i--; ) {\r\n            const h = heads[i].innerText as keyof typeof this.add,\r\n              n = h.toLowerCase() as keyof ResourceField\r\n            cells[i].innerText = n in s ? this.format(s[n] as number) + '' : this.add[h]\r\n          }\r\n        }\r\n      },\r\n      add: {\r\n        Dataset: d,\r\n        First: times[range[0]] + '' || 'NA',\r\n        Last: times[range[1]] + '' || 'NA',\r\n      },\r\n      times: this.site.data.meta.overall.value,\r\n      format: formatter,\r\n    }\r\n    f.summary.table = make_summary_table(formatter, p, f.info[d], f.summary.add)\r\n    // filter result\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild((p = document.createElement('p')))\r\n    p.setAttribute('aria-describedby', f.id)\r\n    p.className = 'cell-text'\r\n    p.innerText = '0/0'\r\n    // active switch\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild(label)\r\n    label.innerText = 'Active'\r\n    label.className = 'filter-label'\r\n    label.id = f.id + '_switch'\r\n    td.appendChild(div)\r\n    div.className = 'form-check form-switch filter-form-input'\r\n    div.appendChild(input)\r\n    input.className = 'form-check-input'\r\n    input.type = 'checkbox'\r\n    input.role = 'switch'\r\n    input.setAttribute('aria-labelledby', f.id + '_switch')\r\n    input.setAttribute('aria-describedby', f.id)\r\n    input.checked = true\r\n    input.addEventListener('change', () => {\r\n      f.active = !f.active\r\n      this.site.request_queue('view.filter')\r\n    })\r\n    // component combobox\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild((label = document.createElement('label')))\r\n    label.innerText = 'Component'\r\n    label.className = 'filter-label'\r\n    label.id = f.id + '_component'\r\n    const comp_select = InputCombobox.create(this.site, 'component', filter_components.Time)\r\n    comp_select.default = f.component\r\n    comp_select.set(f.component)\r\n    tr.lastElementChild.appendChild(comp_select.e.parentElement)\r\n    comp_select.e.parentElement.removeChild(comp_select.e.parentElement.lastElementChild)\r\n    comp_select.e.parentElement.classList.add('filter-form-input')\r\n    comp_select.e.setAttribute('aria-labelledby', f.id + '_component')\r\n    comp_select.input_element.setAttribute('aria-labelledby', f.id + '_component')\r\n    comp_select.input_element.setAttribute('aria-describedby', f.id)\r\n    comp_select.listbox.setAttribute('aria-labelledby', f.id + '_component')\r\n    comp_select.onchange = () => {\r\n      f.component = comp_select.value() as string\r\n      this.site.request_queue('view.filter')\r\n    }\r\n    // operator select\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild((label = document.createElement('label')))\r\n    label.innerText = 'Operator'\r\n    label.className = 'filter-label'\r\n    label.id = f.id + '_operator'\r\n    tr.lastElementChild.appendChild(select)\r\n    select.className = 'form-select filter-form-input'\r\n    select.setAttribute('aria-labelledby', f.id + '_operator')\r\n    select.setAttribute('aria-describedby', f.id)\r\n    select.addEventListener('change', e => {\r\n      f.operator = (e.target as HTMLSelectElement).selectedOptions[0].value\r\n      this.site.request_queue('view.filter')\r\n    })\r\n    ;['>=', '=', '!=', '<='].forEach(k => {\r\n      const option = document.createElement('option')\r\n      select.appendChild(option)\r\n      option.value = option.innerText = k\r\n      if (k === f.operator) option.selected = true\r\n    })\r\n    // value input\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild((label = document.createElement('label')))\r\n    label.innerText = 'Value'\r\n    label.className = 'filter-label'\r\n    label.id = f.id + '_value'\r\n    const value_select = InputCombobox.create(this.site, 'component', ['min', 'q1', 'median', 'mean', 'q3', 'max'])\r\n    value_select.value_type = 'number'\r\n    value_select.default = f.value\r\n    value_select.set(f.value)\r\n    td.appendChild(value_select.e.parentElement)\r\n    value_select.e.parentElement.removeChild(value_select.e.parentElement.lastElementChild)\r\n    value_select.e.parentElement.classList.add('filter-form-input')\r\n    value_select.e.setAttribute('aria-labelledby', f.id + '_value')\r\n    value_select.input_element.setAttribute('aria-labelledby', f.id + '_value')\r\n    value_select.input_element.setAttribute('aria-describedby', f.id)\r\n    value_select.listbox.setAttribute('aria-labelledby', f.id + '_value')\r\n    value_select.onchange = async function (this: InputCombobox, f: FilterParsed) {\r\n      f.value = this.value() as number | string\r\n      if (this.site.patterns.number.test(f.value + '')) {\r\n        f.value = +f.value\r\n        f.value_source = ''\r\n      } else {\r\n        f.view.reparse()\r\n        const v = await this.site.data.get_variable(f.variable, f.view),\r\n          s = v && v.views[f.view.id].summaries[f.view.parsed.dataset]\r\n        if (s && f.value in s) {\r\n          const a = f.view.parsed.variable_values.get(f.id),\r\n            k = f.value as keyof Summary,\r\n            time = a.comp_fun(a, f.view.parsed) as number\r\n          f.value_source = f.value\r\n          f.value = (s[k] as (number | string)[])[time]\r\n        }\r\n      }\r\n      this.site.request_queue('view.filter')\r\n    }.bind(value_select, f)\r\n    // remove button\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild((label = document.createElement('label')))\r\n    label.innerText = 'Remove'\r\n    label.className = 'filter-label'\r\n    label.id = f.id + '_remove'\r\n    td.appendChild(button)\r\n    button.className = 'btn-close filter-form-input'\r\n    button.type = 'button'\r\n    button.setAttribute('aria-labelledby', f.id + '_remove')\r\n    button.setAttribute('aria-describedby', f.id)\r\n    button.addEventListener(\r\n      'mouseup',\r\n      function (this: {filter: FilterParsed; site: Community}, e: MouseEvent) {\r\n        if (!e.button) {\r\n          this.filter.e.parentElement.removeChild(this.filter.e)\r\n          this.site.view.filters.delete(this.filter.id)\r\n          if (!this.site.view.filters.size)\r\n            this.site.page.modal.filter.variable_filters.lastElementChild.classList.add('hidden')\r\n          this.site.request_queue('view.filter')\r\n        }\r\n      }.bind({filter: f, site: this.site})\r\n    )\r\n    this.site.request_queue('view.filter')\r\n    this.modal.filter.conditions.lastElementChild.appendChild(tr)\r\n    this.modal.filter.variable_filters.lastElementChild.classList.remove('hidden')\r\n  }\r\n  trigger_resize() {\r\n    window.dispatchEvent(new Event('resize'))\r\n  }\r\n  render_credits(e: HTMLElement) {\r\n    const s = this.site.spec.credit_output && this.site.spec.credit_output[e.id],\r\n      exclude = (s && s.exclude) || [],\r\n      add = (s && s.add) || {},\r\n      credits = {...this.site.spec.credits, ...add}\r\n    e.appendChild(document.createElement('ul'))\r\n    Object.keys(credits).forEach(k => {\r\n      if (-1 === exclude.indexOf(k)) {\r\n        const c = credits[k],\r\n          li = document.createElement('li')\r\n        e.lastElementChild.appendChild(li)\r\n        if ('url' in c) {\r\n          const a = document.createElement('a')\r\n          li.appendChild(a)\r\n          a.href = c.url\r\n          a.target = '_blank'\r\n          a.rel = 'noreferrer'\r\n          a.innerText = c.name\r\n        } else {\r\n          li.innerText = c.name\r\n        }\r\n        if ('version' in c) {\r\n          const span = document.createElement('span')\r\n          li.appendChild(span)\r\n          span.className = 'version-tag'\r\n          span.innerText = c.version\r\n        }\r\n        if ('description' in c) {\r\n          const p = document.createElement('p')\r\n          li.parentElement.appendChild(p)\r\n          p.innerText = c.description\r\n        }\r\n      }\r\n    })\r\n  }\r\n}\r\n","import DataHandler from '../../data_handler/index'\r\nimport type {Generic, SiteCondition} from '../../types'\r\nimport type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport type VirtualSpec = {\r\n  id: string\r\n  states: {\r\n    condition: SiteCondition[]\r\n    value: string\r\n  }[]\r\n  default: string\r\n  display: Generic\r\n}\r\n\r\nexport class InputVirtual extends BaseInput {\r\n  type: 'virtual' = 'virtual'\r\n  spec: VirtualSpec\r\n  states: {\r\n    condition: SiteCondition[]\r\n    value: string | number\r\n  }[] = []\r\n  source: string | number\r\n  values: (string | number)[] = []\r\n  display: Generic\r\n  constructor(spec: VirtualSpec, site: Community) {\r\n    const e = document.createElement('input')\r\n    e.id = spec.id\r\n    super(e, site)\r\n    this.source = this.default = spec.default\r\n    if (this.source) this.values.push(this.source)\r\n    if (spec.states) this.states = spec.states\r\n    if (spec.display) this.display = spec.display\r\n    const p: {[index: string]: {type: 'update'; id: string}} = {}\r\n    this.states.forEach(si => {\r\n      this.values.push(si.value)\r\n      si.condition.forEach(c => {\r\n        p[c.id] = {type: 'update', id: this.id}\r\n        this.site.add_dependency(c.id, p[c.id])\r\n      })\r\n    })\r\n    this.update()\r\n  }\r\n  init() {\r\n    this.values.forEach(id => {\r\n      if ('string' === typeof id && id in this.site.inputs) this.site.add_dependency(id, {type: 'update', id: this.id})\r\n    })\r\n  }\r\n  update() {\r\n    this.source = void 0\r\n    for (let p, i = this.states.length; i--; ) {\r\n      p = true\r\n      for (let c = this.states[i].condition.length; c--; ) {\r\n        const r = this.states[i].condition[c]\r\n        if (DataHandler.checks[r.type](this.site.valueOf(r.id), this.site.valueOf(r.value))) {\r\n          if (r.any) {\r\n            p = true\r\n            break\r\n          }\r\n        } else p = false\r\n      }\r\n      if (p) {\r\n        this.source = this.states[i].value\r\n        break\r\n      }\r\n    }\r\n    if (!this.source) this.source = this.default as string\r\n    if (this.source !== this.previous) {\r\n      this.previous = this.source\r\n      this.site.request_queue(this.id)\r\n    } else if (this.source in this.site.inputs) {\r\n      const r = this.site.inputs[this.source].value()\r\n      if (r !== this.previous) {\r\n        this.previous = r\r\n        this.site.request_queue(this.id)\r\n      }\r\n    }\r\n  }\r\n  value() {\r\n    return this.site.valueOf(this.source)\r\n  }\r\n  set(v: string | number) {\r\n    if (-1 !== this.values.indexOf(v)) {\r\n      this.previous = this.source\r\n      this.source = v\r\n    } else if (this.source in this.site.inputs) {\r\n      const c = this.site.inputs[this.source]\r\n      if (\r\n        'values' in c &&\r\n        (Array.isArray(c.values) ? -1 !== c.values.indexOf(v) : v in c.values || ('display' in c && v in c.display))\r\n      ) {\r\n        c.set(v)\r\n      }\r\n    }\r\n    this.site.request_queue(this.id)\r\n  }\r\n}\r\n","export const value_types: {[index: string]: Function} = {\r\n  percent: function (v: number): string {\r\n    return v + '%'\r\n  },\r\n  minute: function (v: number): string {\r\n    return v + ' minutes'\r\n  },\r\n  minutes: function (v: number): string {\r\n    return v + ' minutes'\r\n  },\r\n  dollars: function (v: number): string {\r\n    return '$' + v\r\n  },\r\n  'Mb/s': function (v: number): string {\r\n    return v + ' Mbps'\r\n  },\r\n}\r\n","import type {SiteSpec} from '../../types'\r\nimport type Community from '../index'\r\nimport type {OutputDataTable} from './datatables'\r\nimport type {OutputInfo} from './info'\r\nimport type {OutputLegend} from './legend'\r\nimport type {OutputMap} from './map'\r\nimport type {OutputPlotly} from './plotly'\r\nimport type {OutputTable} from './table'\r\nimport type {OutputText} from './text'\r\n\r\ntype OutputTypes = 'info' | 'map' | 'plotly' | 'text' | 'datatable' | 'table' | 'legend'\r\nexport type SiteOutputs =\r\n  | OutputInfo\r\n  | OutputMap\r\n  | OutputPlotly\r\n  | OutputText\r\n  | OutputDataTable\r\n  | OutputTable\r\n  | OutputLegend\r\nexport type RegisteredOutputs = {[index: string]: SiteOutputs}\r\n\r\nexport abstract class BaseOutput {\r\n  type: OutputTypes\r\n  input = false\r\n  site: Community\r\n  view: string\r\n  e: HTMLElement\r\n  tab?: HTMLElement\r\n  id: string\r\n  note: string\r\n  color?: string\r\n  x?: string\r\n  y?: string\r\n  spec: {[index: string]: any} = {}\r\n  deferred = false\r\n  constructor(e: HTMLElement, site: Community) {\r\n    this.e = e\r\n    this.tab = 'tabpanel' === e.parentElement.getAttribute('role') ? e.parentElement : void 0\r\n    this.site = site\r\n    this.view = e.dataset.view || site.defaults.dataview\r\n    this.id = e.id || 'ui' + site.page.elementCount++\r\n    this.note = e.getAttribute('aria-description') || ''\r\n    this.type = e.dataset.autotype as OutputTypes\r\n    if (this.type in site.spec) {\r\n      const spec = site.spec[this.type as keyof SiteSpec] as SiteOutputs\r\n      if (this.id in spec) this.spec = (spec as any)[this.id]\r\n    }\r\n  }\r\n}\r\n","import type {Entity, LogicalObject, MeasureInfo, Summary, Variable} from '../../types'\r\nimport type Community from '../index'\r\nimport {filter_components} from '../static_refs'\r\nimport {make_summary_table, make_variable_source} from '../utils'\r\nimport {value_types} from '../value_types'\r\nimport {BaseOutput, SiteOutputs} from './index'\r\n\r\ntype InfoSpec = {\r\n  title?: string\r\n  body?: {name: string; value: string; style: string}[]\r\n  subto?: string[]\r\n  dataview: string\r\n  variable?: string\r\n  default?: {body?: string; title?: string}\r\n  variable_info?: boolean\r\n  show_summary?: boolean\r\n  floating?: boolean\r\n}\r\n\r\ntype Parsed = {\r\n  data?: string\r\n  variables?: string\r\n  features?: string\r\n  summary?: HTMLTableElement\r\n  filter?: HTMLTableElement\r\n}\r\n\r\nclass InfoPart {\r\n  parent: OutputInfo\r\n  text: string\r\n  value_source: string\r\n  parsed: Parsed = {}\r\n  ref = true\r\n  selection = false\r\n  base?: HTMLButtonElement | HTMLParagraphElement\r\n  temp?: HTMLButtonElement | HTMLParagraphElement\r\n  default?: HTMLButtonElement | HTMLParagraphElement\r\n  rows?: {name: InfoPart; value: InfoPart}[]\r\n  constructor(parent: OutputInfo, text: string) {\r\n    this.parent = parent\r\n    this.text = text\r\n    if ('value' === text) {\r\n      this.parsed.data = parent.spec.variable\r\n    } else if ('summary' === text) {\r\n      parent.spec.show_summary = true\r\n    } else if ('filter' === text) {\r\n      const e = document.createElement('table')\r\n      e.className = 'info-filter'\r\n      this.parsed.filter = e\r\n    }\r\n    const patterns = parent.site.patterns\r\n    if (patterns.features.test(text)) {\r\n      this.parsed.features = text.replace(patterns.features, '')\r\n    } else if (parent.site.patterns.data.test(text)) {\r\n      this.parsed.data = text.replace(patterns.data, '')\r\n    } else if (patterns.variables.test(text)) {\r\n      this.parsed.variables = text.replace(patterns.variables, '')\r\n    } else this.ref = false\r\n  }\r\n  get(entity?: Entity, caller?: SiteOutputs) {\r\n    if (this.ref && this.parent.site.data) {\r\n      if (entity)\r\n        if ('features' in this.parsed) {\r\n          return entity.features[this.parsed.features]\r\n        } else if ('data' in this.parsed) {\r\n          if ('value' === this.text) {\r\n            this.parsed.data = this.parent.site.valueOf(\r\n              this.parent.spec.variable ||\r\n                (caller && (caller.color || caller.y)) ||\r\n                this.parent.site.dataviews[this.parent.view].y\r\n            ) as string\r\n          } else if (this.text in this.parent.site.inputs)\r\n            this.parsed.data = this.parent.site.valueOf(this.text) as string\r\n          if (!(this.parsed.data in this.parent.site.data.variables)) return this.parsed.data\r\n          const info = this.parent.site.data.variables[this.parsed.data],\r\n            v = this.parent.site.data.format_value(\r\n              entity.get_value(this.parsed.data, this.parent.time),\r\n              info && info.info[entity.group] && 'integer' === info.info[entity.group].type\r\n            )\r\n          let type = info.meta.unit || info.meta.type\r\n          if (info.meta.aggregation_method && !(type in value_types)) type = info.meta.aggregation_method\r\n          return (!isNaN(v as number) && type in value_types ? value_types[type](v) : v) + ''\r\n        }\r\n      const info = this.parent.site.data.variable_info\r\n      if ('data' in this.parsed) {\r\n        return this.parent.site.data.meta.times[this.parent.dataset].value[this.parent.time_agg] + ''\r\n      } else if ('variables' in this.parsed && (this.value_source || this.parent.v in info)) {\r\n        const v = this.parent.site.valueOf(this.value_source || this.parent.v) as string,\r\n          i = info[v] as MeasureInfo\r\n        return (this.parsed.variables in i ? i[this.parsed.variables as keyof MeasureInfo] : this.text) as string\r\n      }\r\n      return this.text\r\n    } else return this.text\r\n  }\r\n}\r\n\r\nexport class OutputInfo extends BaseOutput {\r\n  type: 'info' = 'info'\r\n  dataset: string\r\n  time_agg: number\r\n  time: number\r\n  v: string\r\n  showing = false\r\n  has_default = false\r\n  selection = false\r\n  processed = false\r\n  depends: LogicalObject = {}\r\n  parts: {\r\n    title?: InfoPart\r\n    body?: {\r\n      base: HTMLElement\r\n      temp: HTMLElement\r\n      default: HTMLElement\r\n      rows: {base: HTMLElement; temp: HTMLElement; name: InfoPart; value: InfoPart}[]\r\n    }\r\n  } = {}\r\n  var: Variable\r\n  summary: Summary\r\n  options: InfoSpec\r\n  queue: number | NodeJS.Timeout\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.update = this.update.bind(this)\r\n    this.has_default = this.spec.default && (!!this.spec.default.title || !!this.spec.default.body)\r\n    this.site.subs.add(this.view, this)\r\n    if (this.spec.floating) {\r\n      document.body.appendChild(this.e)\r\n      this.e.classList.add('hidden')\r\n      document.addEventListener(\r\n        'mousemove',\r\n        function (this: OutputInfo, e: MouseEvent) {\r\n          if (this.showing) {\r\n            const f = this.site.page.content.getBoundingClientRect()\r\n            this.e.style.top = (e.y > f.height / 2 ? e.y - this.e.getBoundingClientRect().height - 10 : e.y + 10) + 'px'\r\n            this.e.style.left = (e.x > f.width / 2 ? e.x - this.e.getBoundingClientRect().width - 10 : e.x + 10) + 'px'\r\n          }\r\n        }.bind(this)\r\n      )\r\n    }\r\n    if (this.spec.title) {\r\n      this.parts.title = new InfoPart(this, this.spec.title)\r\n      if (\r\n        this.spec.variable_info &&\r\n        'variables' in this.parts.title.parsed &&\r\n        this.site.patterns.measure_name.test(this.parts.title.parsed.variables)\r\n      ) {\r\n        this.parts.title.base = document.createElement('button')\r\n        this.parts.title.base.type = 'button'\r\n        this.parts.title.base.setAttribute('data-bs-toggle', 'modal')\r\n        this.parts.title.base.setAttribute('data-bs-target', '#variable_info_display')\r\n        this.parts.title.base.addEventListener('click', this.site.page.show_variable_info)\r\n      } else this.parts.title.base = document.createElement('p')\r\n      this.parts.title.base.appendChild(document.createElement('span'))\r\n      this.parts.title.temp = document.createElement('p')\r\n      this.parts.title.default = document.createElement('p')\r\n      this.parts.title.temp.className =\r\n        this.parts.title.base.className =\r\n        this.parts.title.default.className =\r\n          'info-title hidden'\r\n      if (this.has_default && this.spec.default.title) {\r\n        this.e.appendChild(this.parts.title.default)\r\n        this.parts.title.default.innerText = this.spec.default.title\r\n      }\r\n      if (!this.parts.title.ref)\r\n        (this.parts.title.base.firstElementChild as HTMLElement).innerText = this.parts.title.get()\r\n      this.e.appendChild(this.parts.title.base)\r\n      this.e.appendChild(this.parts.title.temp)\r\n      this.parts.title.base.classList.add('hidden')\r\n      this.parts.title.temp.classList.add('hidden')\r\n    }\r\n    if (this.spec.body || (this.has_default && this.spec.default.body)) {\r\n      this.parts.body = {\r\n        base: document.createElement('div'),\r\n        temp: document.createElement('div'),\r\n        default: document.createElement('div'),\r\n        rows: [],\r\n      }\r\n      this.parts.body.temp.className =\r\n        this.parts.body.base.className =\r\n        this.parts.body.default.className =\r\n          'info-body hidden'\r\n      if (this.has_default && this.spec.default.body) this.parts.body.default.innerText = this.spec.default.body\r\n      let h = 0\r\n      this.spec.body &&\r\n        (this.spec.body as {name: string; value: string; style: string}[]).forEach((op, i) => {\r\n          const p = {\r\n              name: new InfoPart(this, op.name),\r\n              value: new InfoPart(this, op.value),\r\n              base: document.createElement('div'),\r\n              temp: document.createElement('div'),\r\n            },\r\n            base = document.createElement('div'),\r\n            temp = document.createElement('div')\r\n          this.parts.body.rows[i] = p\r\n          this.parts.body.base.appendChild(p.base)\r\n          this.parts.body.temp.appendChild(p.temp)\r\n          p.temp.className = p.base.className = 'info-body-row-' + op.style\r\n          h += 24 + ('stack' === op.style ? 24 : 0)\r\n          if (p.name) {\r\n            if (\r\n              this.spec.variable_info &&\r\n              'variables' in p.name.parsed &&\r\n              this.site.patterns.measure_name.test(p.name.parsed.variables)\r\n            ) {\r\n              p.base.appendChild(document.createElement('button'))\r\n              p.base.lastElementChild.role = 'button'\r\n              p.base.lastElementChild.setAttribute('data-bs-toggle', 'modal')\r\n              p.base.lastElementChild.setAttribute('data-bs-target', '#variable_info_display')\r\n              p.base.lastElementChild.addEventListener('click', this.site.page.show_variable_info)\r\n            } else p.base.appendChild(base)\r\n            p.temp.appendChild(temp)\r\n            base.className = temp.className = 'info-body-row-name'\r\n            base.innerText = temp.innerText = p.name.get()\r\n          }\r\n          if (p.value) {\r\n            p.base.appendChild(document.createElement('div'))\r\n            p.temp.appendChild(document.createElement('div'))\r\n          }\r\n        })\r\n      this.e.style.minHeight = h + 'px'\r\n      this.e.appendChild(this.parts.body.base)\r\n      this.e.appendChild(this.parts.body.default)\r\n      this.e.appendChild(this.parts.body.temp)\r\n    }\r\n  }\r\n  init() {\r\n    if (this.spec.title && 'summary' === this.spec.title) {\r\n      this.parts.title.parsed.summary = make_summary_table(this.site.data.format_value, this.e)\r\n    }\r\n    if (this.parts.body && this.parts.body.rows)\r\n      this.parts.body.rows.forEach(r => {\r\n        if (r.name && 'summary' === r.name.text)\r\n          r.name.parsed.summary = make_summary_table(this.site.data.format_value, this.e)\r\n        if (r.value) {\r\n          if ('summary' === r.value.text) {\r\n            r.value.parsed.summary = make_summary_table(this.site.data.format_value, this.e)\r\n            r.base.lastElementChild.appendChild(r.value.parsed.summary)\r\n          } else if ('filter' in r.value.parsed) {\r\n            r.base.lastElementChild.appendChild(r.value.parsed.filter)\r\n          } else {\r\n            const base = r.base.lastElementChild as HTMLElement,\r\n              temp = r.temp.lastElementChild as HTMLElement\r\n            temp.className = base.className =\r\n              'info-body-row-value' + ('statement' === r.value.parsed.variables ? ' statement' : '')\r\n            if (r.name.ref && 'value' === r.value.text) r.value.ref = true\r\n            if (!r.value.ref) temp.innerText = base.innerText = r.value.get()\r\n          }\r\n        }\r\n      })\r\n    this.update()\r\n  }\r\n  show(e: Entity, u: SiteOutputs) {\r\n    this.update(e, u)\r\n    this.showing = true\r\n    if (this.spec.floating) this.e.classList.remove('hidden')\r\n    if (this.parts.title) {\r\n      if (this.selection) {\r\n        this.parts.title.base.classList.add('hidden')\r\n      } else this.parts.title.default.classList.add('hidden')\r\n      this.parts.title.temp.classList.remove('hidden')\r\n    }\r\n    if (this.parts.body) {\r\n      if (this.selection) {\r\n        this.parts.body.base.classList.add('hidden')\r\n      } else this.parts.body.default.classList.add('hidden')\r\n      this.parts.body.temp.classList.remove('hidden')\r\n    }\r\n  }\r\n  revert() {\r\n    this.showing = false\r\n    if (this.spec.floating) {\r\n      this.e.classList.add('hidden')\r\n    } else {\r\n      if (this.parts.title) {\r\n        if (this.selection) {\r\n          this.parts.title.base.classList.remove('hidden')\r\n        } else if (this.has_default) this.parts.title.default.classList.remove('hidden')\r\n        this.parts.title.temp.classList.add('hidden')\r\n      }\r\n      if (this.parts.body) {\r\n        if (this.selection) {\r\n          this.parts.body.base.classList.remove('hidden')\r\n        } else if (this.has_default) this.parts.body.default.classList.remove('hidden')\r\n        this.parts.body.temp.classList.add('hidden')\r\n      }\r\n    }\r\n  }\r\n  async update(entity?: Entity, caller?: SiteOutputs, pass?: boolean) {\r\n    const v = this.site.dataviews[this.view]\r\n    if (!v) return\r\n    const y = this.site.inputs[v.time_agg]\r\n    this.v = this.site.valueOf(this.spec.variable || (caller && (caller.color || caller.y)) || v.y) as string\r\n    this.dataset = v.get.dataset()\r\n    if (y && !(this.dataset in this.site.data.meta.times)) {\r\n      if (!(this.id in this.site.data.data_queue[this.dataset]))\r\n        this.site.data.data_queue[this.dataset][this.id] = this.update\r\n      return\r\n    }\r\n    this.time_agg = y ? (y.value() as number) - this.site.data.meta.times[this.dataset].range[0] : 0\r\n    const time_range = this.v in this.site.data.variables && this.site.data.variables[this.v].time_range[this.dataset]\r\n    this.time = time_range ? this.time_agg - time_range[0] : 0\r\n    if (this.spec.show_summary) {\r\n      this.var = this.v && (await this.site.data.get_variable(this.v, this.site.dataviews[this.view]))\r\n      this.summary = this.view in this.var.views && this.var.views[this.view].summaries[this.dataset]\r\n    }\r\n    if (!this.processed) {\r\n      this.processed = true\r\n      if (!this.spec.floating) {\r\n        this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n        if (v.y in this.site.inputs) this.site.add_dependency(v.y, {type: 'update', id: this.id})\r\n        if (y) this.site.add_dependency(v.time_agg as string, {type: 'update', id: this.id})\r\n        if (this.spec.variable in this.site.inputs)\r\n          this.site.add_dependency(this.spec.variable, {type: 'update', id: this.id})\r\n      }\r\n      if (this.parts.body)\r\n        this.parts.body.rows.forEach(p => {\r\n          if (!p.value.ref && p.value.text in this.site.inputs && 'variables' in p.name.parsed) {\r\n            p.name.value_source = p.value.value_source = p.value.text\r\n            p.value.ref = true\r\n            p.value.parsed.data = ''\r\n          }\r\n        })\r\n    }\r\n    if (entity) {\r\n      // hover information\r\n      if (this.parts.title) {\r\n        this.parts.title.temp.innerText = this.parts.title.get(entity, caller)\r\n      }\r\n      if (this.parts.body) {\r\n        this.parts.body.rows.forEach(p => {\r\n          if (p.name.ref) {\r\n            if (p.name.value_source) p.name.value_source = p.value.text\r\n            const e = p.name.get(entity, caller)\r\n            if ('object' !== typeof e) {\r\n              ;(p.temp.firstElementChild as HTMLElement).innerText = this.parse_variables(\r\n                e,\r\n                p.value.parsed.variables,\r\n                entity\r\n              )\r\n            }\r\n          }\r\n          if (p.value.ref) {\r\n            if (p.value.value_source) p.value.value_source = p.value.text\r\n            const e = p.value.get(entity, caller)\r\n            if ('object' !== typeof e) {\r\n              ;(p.temp.lastElementChild as HTMLElement).innerText = this.parse_variables(\r\n                e,\r\n                p.value.parsed.variables,\r\n                entity\r\n              )\r\n            }\r\n          }\r\n        })\r\n      }\r\n    } else if (!this.spec.floating) {\r\n      if ((this.queue as number) > 0) clearTimeout(this.queue)\r\n      this.queue = -1\r\n      if (!pass) {\r\n        if (!this.tab || this.tab.classList.contains('show'))\r\n          this.queue = setTimeout(() => this.update(void 0, void 0, true), 50)\r\n      } else {\r\n        // base information\r\n        entity = this.site.data.entities[v.get.single_id()]\r\n        if (entity) {\r\n          // when showing a selected region\r\n          this.selection = true\r\n          if (this.parts.title) {\r\n            this.parts.title.base.classList.remove('hidden')\r\n            this.parts.title.default.classList.add('hidden')\r\n          }\r\n          if (this.parts.body && this.has_default) this.parts.body.default.classList.add('hidden')\r\n        } else {\r\n          // when no ID is selected\r\n          this.selection = false\r\n          if (this.parts.title) {\r\n            if (this.has_default) {\r\n              this.parts.title.base.classList.add('hidden')\r\n              this.parts.title.default.classList.remove('hidden')\r\n            } else if (!this.parts.title.ref || !('features' in this.parts.title.parsed))\r\n              this.parts.title.base.classList.remove('hidden')\r\n          }\r\n          if (this.parts.body) {\r\n            this.parts.body.base.classList.add('hidden')\r\n            if (this.has_default) this.parts.body.default.classList.remove('hidden')\r\n          }\r\n        }\r\n        if (this.parts.title) {\r\n          ;(this.parts.title.base.firstElementChild as HTMLElement).innerText = this.parts.title.get(entity, caller)\r\n        }\r\n        if (this.parts.body) {\r\n          if (!this.spec.subto) this.parts.body.base.classList.remove('hidden')\r\n          this.parts.body.rows.forEach(p => {\r\n            if ('summary' in p.value.parsed) {\r\n              this.fill_summary_table(p.value.parsed.summary, this.summary, this.time)\r\n            } else if ('filter' in p.value.parsed) {\r\n              const e = p.value.parsed.filter\r\n              let n = 0\r\n              e.innerHTML = ''\r\n              if (this.site.view.selected.length) {\r\n                n++\r\n                const s = document.createElement('tr')\r\n                s.className = 'filter-display'\r\n                let ss = document.createElement('td'),\r\n                  span = document.createElement('span')\r\n                s.appendChild(ss)\r\n                ss.appendChild(span)\r\n                span.className = 'syntax-variable'\r\n                span.innerText = 'Select Entities'\r\n                s.appendChild((ss = document.createElement('td')))\r\n                ss.appendChild((span = document.createElement('span')))\r\n                span.className = 'syntax-operator'\r\n                span.innerText = ':'\r\n                s.appendChild((ss = document.createElement('td')))\r\n                ss.setAttribute('colspan', '2')\r\n                ss.appendChild((span = document.createElement('span')))\r\n                span.className = 'syntax-value'\r\n                let ids = ''\r\n                this.site.view.selected.forEach(id => {\r\n                  const entity = this.site.data.entities[id]\r\n                  ids += (ids ? ', ' : '') + (entity && entity.features ? entity.features.name : id)\r\n                })\r\n                span.innerText = ids\r\n                e.appendChild(s)\r\n              }\r\n              this.site.view.filters.forEach(f => {\r\n                const checked = f.passed + f.failed\r\n                if (f.active && checked) {\r\n                  const result = f.passed + '/' + checked\r\n                  ;(f.e.children[1].lastElementChild as HTMLElement).innerText = result\r\n                  n++\r\n                  const s = document.createElement('tr'),\r\n                    info = this.site.data.variable_info[f.variable]\r\n                  s.className = 'filter-display'\r\n                  let ss = document.createElement('td'),\r\n                    span = document.createElement('span')\r\n                  s.appendChild(ss)\r\n                  ss.appendChild(span)\r\n                  span.className = 'syntax-variable'\r\n                  span.title = f.variable\r\n                  span.innerText = info.short_name as string\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.innerText = ' ('\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.className = 'syntax-component'\r\n                  span.innerText = f.component as string\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.innerText = ')'\r\n                  ss = document.createElement('td')\r\n                  s.appendChild(ss)\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.className = 'syntax-operator'\r\n                  span.innerText = f.operator\r\n                  ss = document.createElement('td')\r\n                  s.appendChild(ss)\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.className = 'syntax-value'\r\n                  span.innerText = (\r\n                    'number' === typeof f.value ? this.site.data.format_value(f.value) : f.value\r\n                  ) as string\r\n                  ss = document.createElement('td')\r\n                  s.appendChild(ss)\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.innerText = '(' + (f.value_source ? f.value_source + '; ' : '') + result + ')'\r\n                  e.appendChild(s)\r\n                }\r\n              })\r\n              this.e.classList[n ? 'remove' : 'add']('hidden')\r\n            }\r\n            if (('variables' in p.value.parsed || 'summary' in p.value.parsed) && !(v.y in this.depends)) {\r\n              this.depends[v.y] = true\r\n              this.site.add_dependency(v.y, {type: 'update', id: this.id})\r\n            } else if ('filter' in p.value.parsed && !('viewFilter' in this.depends)) {\r\n              this.depends.viewFilter = true\r\n              this.site.add_dependency('view.filter', {type: 'update', id: this.id})\r\n            }\r\n            if (p.name.ref) {\r\n              if (p.name.value_source) p.name.value_source = p.value.text\r\n              const e = p.name.get(entity, caller)\r\n              if ('object' !== typeof e) {\r\n                ;(p.base.firstElementChild as HTMLElement).innerText = e\r\n              }\r\n            }\r\n            if (p.value.ref) {\r\n              const e = p.value.get(entity, caller)\r\n              if (Array.isArray(e)) {\r\n                if ('sources' === p.value.parsed.variables) {\r\n                  p.base.innerHTML = ''\r\n                  p.base.appendChild(document.createElement('table'))\r\n                  p.base.lastElementChild.className = 'source-table'\r\n                  p.base.firstElementChild.appendChild(document.createElement('thead'))\r\n                  p.base.firstElementChild.firstElementChild.appendChild(document.createElement('tr'))\r\n                  p.base.firstElementChild.firstElementChild.firstElementChild.appendChild(document.createElement('th'))\r\n                  p.base.firstElementChild.firstElementChild.firstElementChild.appendChild(document.createElement('th'))\r\n                  ;(\r\n                    p.base.firstElementChild.firstElementChild.firstElementChild.firstElementChild as HTMLElement\r\n                  ).innerText = 'Source'\r\n                  ;(\r\n                    p.base.firstElementChild.firstElementChild.firstElementChild.lastElementChild as HTMLElement\r\n                  ).innerText = 'Accessed'\r\n                  p.base.firstElementChild.appendChild(document.createElement('tbody'))\r\n                  e.forEach(ei => {\r\n                    p.base.firstElementChild.lastElementChild.appendChild(make_variable_source(ei, true))\r\n                  })\r\n                }\r\n              } else {\r\n                ;(p.base.lastElementChild as HTMLElement).innerText = this.parse_variables(\r\n                  e,\r\n                  p.value.parsed.variables,\r\n                  entity\r\n                )\r\n              }\r\n            }\r\n          })\r\n        }\r\n      }\r\n    }\r\n    this.revert()\r\n  }\r\n  parse_variables(s: string, type: string, entity: Entity) {\r\n    if ('statement' === type) {\r\n      const patterns = this.site.patterns\r\n      for (let m, v; (m = patterns.mustache.exec(s)); ) {\r\n        if ('value' === m[1]) {\r\n          v = entity\r\n            ? this.site.data.format_value(\r\n                entity.get_value(this.v, this.time),\r\n                this.dataset in this.site.data.variables[this.v].info &&\r\n                  'integer' === this.site.data.variables[this.v].info[this.dataset].type\r\n              )\r\n            : NaN\r\n          const info = this.site.data.variable_info[this.v] as MeasureInfo\r\n          let type = info.unit || info.type\r\n          if (info.aggregation_method && !(type in value_types)) type = info.aggregation_method\r\n          s = s.replace(m[0], !isNaN(v as number) && type in value_types ? value_types[type](v) : v)\r\n          patterns.mustache.lastIndex = 0\r\n        } else if (entity) {\r\n          if ('region_name' === m[1]) {\r\n            s = s.replace(m[0], entity.features.name)\r\n            patterns.mustache.lastIndex = 0\r\n          } else if (patterns.features.test(m[1])) {\r\n            s = s.replace(m[0], entity.features[m[1].replace(patterns.features, '')])\r\n            patterns.mustache.lastIndex = 0\r\n          } else if (patterns.variables.test(m[1])) {\r\n            s = s.replace(\r\n              m[0],\r\n              entity.variables[this.v][m[1].replace(patterns.variables, '') as keyof Variable] as string\r\n            )\r\n            patterns.mustache.lastIndex = 0\r\n          } else if (patterns.data.test(m[1])) {\r\n            s = s.replace(m[0], entity.get_value(m[1].replace(patterns.data, ''), this.time))\r\n            patterns.mustache.lastIndex = 0\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return s\r\n  }\r\n  fill_summary_table(table: HTMLTableElement, summary: Summary, time: number) {\r\n    const e = table.lastElementChild.firstElementChild.children as HTMLCollectionOf<HTMLTableRowElement>\r\n    filter_components.summary.forEach((c: keyof Summary, i) => {\r\n      e[i].innerText = this.site.data.format_value((summary[c] as number[])[time], 0 === i) as string\r\n    })\r\n  }\r\n}\r\n","import type {Entity, Order, Summary} from '../../types'\r\nimport type Community from '../index'\r\nimport type {SiteInputs} from '../inputs/index'\r\nimport {BaseOutput} from './index'\r\n\r\nconst summary_levels: {[index: string]: string} = {\r\n  dataset: 'Overall',\r\n  filtered: 'Filtered',\r\n  children: 'Unfiltered selection',\r\n  all: 'Selection',\r\n}\r\n\r\nexport class OutputLegend extends BaseOutput {\r\n  type: 'legend' = 'legend'\r\n  clickto?: SiteInputs\r\n  palette: string\r\n  variable: string\r\n  state = ''\r\n  parsed: {\r\n    summary?: Summary\r\n    order?: Order\r\n    time: number\r\n    color: string\r\n    bins: number\r\n    rank: boolean\r\n  } = {time: 0, color: '', bins: 0, rank: false}\r\n  queue: {\r\n    e?: HTMLElement\r\n    lock: boolean\r\n    cooldown: number | NodeJS.Timeout\r\n    reset: () => void\r\n    trigger?: () => void\r\n  } = {\r\n    lock: false,\r\n    cooldown: -1,\r\n    reset: function () {\r\n      this.lock = false\r\n    },\r\n  }\r\n  integer = false\r\n  entity: Entity\r\n  parts: {\r\n    ticks: HTMLElement\r\n    scale: HTMLElement\r\n    summary: HTMLElement\r\n  }\r\n  ticks = {\r\n    center: document.createElement('div'),\r\n    min: document.createElement('div'),\r\n    max: document.createElement('div'),\r\n    entity: document.createElement('div'),\r\n  }\r\n  current_palette = ''\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.mouseover = this.mouseover.bind(this)\r\n    this.mouseout = this.mouseout.bind(this)\r\n    this.click = this.click.bind(this)\r\n    this.update = this.update.bind(this)\r\n    e.addEventListener('mousemove', this.mouseover)\r\n    e.addEventListener('mouseout', this.mouseout)\r\n    e.addEventListener('click', this.click)\r\n    this.variable = this.e.dataset.variable\r\n    this.queue.trigger = function (this: OutputLegend) {\r\n      this.mouseover(this.queue.e)\r\n    }.bind(this)\r\n    this.queue.reset = this.queue.reset.bind(this.queue)\r\n    this.parts = {\r\n      ticks: this.e.querySelector('.legend-ticks'),\r\n      scale: this.e.querySelector('.legend-scale'),\r\n      summary: this.e.querySelector('.legend-summary'),\r\n    }\r\n    this.parts.ticks.dataset.of = this.parts.scale.dataset.of = this.parts.summary.dataset.of = this.id\r\n    this.parts.summary.appendChild(this.ticks.center)\r\n    this.parts.summary.appendChild(this.ticks.min)\r\n    this.parts.summary.appendChild(this.ticks.max)\r\n    this.parts.ticks.appendChild(this.ticks.entity)\r\n  }\r\n  init() {\r\n    this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n    const view = this.site.dataviews[this.view]\r\n    if ('string' === typeof view.time_agg && view.time_agg in this.site.inputs)\r\n      this.site.add_dependency(view.time_agg, {type: 'update', id: this.id})\r\n    if (!this.palette) {\r\n      if (view.palette) {\r\n        this.palette = view.palette\r\n        if (view.palette in this.site.inputs) this.site.add_dependency(view.palette, {type: 'update', id: this.id})\r\n      } else {\r\n        this.palette =\r\n          'settings.palette' in this.site.inputs ? 'settings.palette' : (this.site.spec.settings.palette as string)\r\n      }\r\n    }\r\n    if (this.variable) {\r\n      if (this.variable in this.site.inputs) this.site.add_dependency(this.variable, {type: 'update', id: this.id})\r\n    } else if (view.y in this.site.inputs) this.site.add_dependency(view.y, {type: 'update', id: this.id})\r\n    if (this.palette in this.site.inputs) {\r\n      const palette = this.site.inputs[this.palette]\r\n      if (palette.e) {\r\n        palette.e.addEventListener('change', this.update)\r\n      }\r\n    }\r\n    const click_ref = this.e.dataset.click\r\n    if (click_ref in this.site.inputs) this.clickto = this.site.inputs[click_ref]\r\n    Object.keys(this.ticks).forEach((t: keyof typeof this.ticks) => {\r\n      const div = document.createElement('div')\r\n      let p = document.createElement('p')\r\n      this.ticks[t].dataset.of = this.id\r\n      this.ticks[t].className = 'legend-tick'\r\n      this.ticks[t].appendChild(div)\r\n      div.dataset.of = p.dataset.of = this.id\r\n      div.appendChild(p)\r\n      if ('m' !== t.substring(0, 1)) {\r\n        div.appendChild((p = document.createElement('p')))\r\n        p.dataset.of = this.id\r\n        div.appendChild((p = document.createElement('p')))\r\n        p.dataset.of = this.id\r\n        if ('entity' === t) {\r\n          this.ticks[t].firstElementChild.lastElementChild.classList.add('entity')\r\n        } else {\r\n          this.ticks[t].firstElementChild.firstElementChild.classList.add('summary')\r\n        }\r\n      }\r\n    })\r\n    this.ticks.entity.firstElementChild.classList.add('hidden')\r\n    this.ticks.max.className = 'legend-tick-end max'\r\n    this.ticks.min.className = 'legend-tick-end min'\r\n    this.ticks.center.style.left = '50%'\r\n    this.update()\r\n  }\r\n  show(e: Entity) {\r\n    if (e && e.features.name) {\r\n      const view = this.site.dataviews[this.view],\r\n        summary = this.parsed.summary,\r\n        time = this.parsed.time,\r\n        color = this.parsed.color,\r\n        string = summary && 'string' === summary.type,\r\n        min = summary && !string ? summary.min[time] : 0,\r\n        range = summary ? (string ? summary.levels.length - min : summary.range[time]) : 1,\r\n        n = summary.n[time],\r\n        subset = n === view.n_selected.dataset ? 'rank' : 'subset_rank',\r\n        es = this.site.data.entities[e.features.id].views[this.view],\r\n        value = e.get_value(color, time),\r\n        p =\r\n          ((string ? value in summary.level_ids : 'number' === typeof value)\r\n            ? this.site.spec.settings.color_by_order\r\n              ? NaN\r\n              : Math.max(0, Math.min(1, range ? ((string ? summary.level_ids[value] : value) - min) / range : 0.5))\r\n            : NaN) * 100,\r\n        container = this.ticks.entity,\r\n        t = container.firstElementChild.children[1] as HTMLElement\r\n      if (isFinite(p)) {\r\n        t.parentElement.classList.remove('hidden')\r\n        t.innerText = this.site.data.format_value(value, this.integer) as string\r\n        container.style.left = p + '%'\r\n        ;(container.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n          (p > 96 || p < 4) && e.features.name.length > 13 ? e.features.name.substring(0, 12) + '' : e.features.name\r\n      } else if (this.site.spec.settings.color_by_order && color in es[subset]) {\r\n        const i = es[subset][color][time],\r\n          po = n > 1 ? (i / (n - 1)) * 100 : 0\r\n        ;(container.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n          i > -1 && (po > 96 || po < 4) && e.features.name.length > 13\r\n            ? e.features.name.substring(0, 12) + ''\r\n            : e.features.name\r\n        if (i > -1) {\r\n          t.parentElement.classList.remove('hidden')\r\n          t.innerText = '# ' + (n - i)\r\n          container.style.left = po + '%'\r\n        }\r\n      }\r\n      container.style.marginLeft = -container.getBoundingClientRect().width / 2 + 'px'\r\n    }\r\n  }\r\n  revert() {\r\n    this.ticks.entity.firstElementChild.classList.add('hidden')\r\n  }\r\n  async update() {\r\n    const view = this.site.dataviews[this.view],\r\n      variable = this.site.valueOf(this.variable || view.y) as string,\r\n      d = view.get.dataset(),\r\n      var_info = await this.site.data.get_variable(variable, view),\r\n      time = this.site.valueOf(view.time_agg),\r\n      palettes = this.site.palettes\r\n    if (null !== time && view.valid[d] && var_info && this.view in var_info.views) {\r\n      const y =\r\n          ('number' === typeof time ? time - this.site.data.meta.times[d].range[0] : 0) - var_info.time_range[d][0],\r\n        summary = var_info.views[this.view].summaries[d],\r\n        ep = (this.site.valueOf(this.palette) as string).toLowerCase(),\r\n        pn =\r\n          ep in palettes\r\n            ? ep\r\n            : (this.site.spec.settings.palette as string) in palettes\r\n            ? (this.site.spec.settings.palette as string)\r\n            : this.site.defaults.palette,\r\n        p = palettes[pn],\r\n        nc = p.colors.length,\r\n        s = this.parts.scale,\r\n        ticks = this.ticks\r\n      this.parsed.summary = summary\r\n      this.parsed.order = var_info.views[this.view].order[d][y]\r\n      this.parsed.time = y\r\n      this.parsed.color = variable\r\n      if (summary && y < summary.n.length) {\r\n        this.integer = d in var_info.info && 'integer' === var_info.info[d].type\r\n        const refresh = this.site.spec.settings.color_by_order !== this.parsed.rank,\r\n          bins = s.querySelectorAll('span'),\r\n          odd = p.odd,\r\n          remake =\r\n            'discrete' === p.type\r\n              ? !bins.length || nc !== this.parsed.bins\r\n              : !s.firstElementChild || 'SPAN' !== s.firstElementChild.tagName\r\n        this.parsed.bins = nc\r\n        if (pn + this.site.spec.settings.color_scale_center !== this.current_palette || refresh) {\r\n          this.current_palette = pn + this.site.spec.settings.color_scale_center\r\n          this.parsed.rank = this.site.spec.settings.color_by_order as boolean\r\n          if (remake) s.innerHTML = ''\r\n          if ('discrete' === p.type) {\r\n            const n = Math.ceil(nc / 2)\r\n            let i = 0,\r\n              div = document.createElement('div'),\r\n              span: HTMLSpanElement\r\n            if (remake) {\r\n              s.appendChild(div)\r\n              div.dataset.of = this.id\r\n              div.style.left = '0'\r\n              const prop = (1 / (n - odd / 2)) * 100 + '%'\r\n              for (; i < n; i++) {\r\n                div.appendChild((span = document.createElement('span')))\r\n                span.dataset.of = this.id\r\n                span.style.backgroundColor = p.colors[i]\r\n                span.style.width = prop\r\n              }\r\n              if (odd) span.style.width = ((1 / (n - odd / 2)) * 100) / 2 + '%'\r\n              s.appendChild((div = document.createElement('div')))\r\n              div.dataset.of = this.id\r\n              div.style.right = '0'\r\n              for (i = Math.floor(nc / 2); i < nc; i++) {\r\n                div.appendChild((span = document.createElement('span')))\r\n                span.dataset.of = this.id\r\n                span.style.backgroundColor = p.colors[i]\r\n                span.style.width = prop\r\n              }\r\n              if (odd)\r\n                (div.firstElementChild as HTMLElement).style.width =\r\n                  ((1 / (Math.ceil(nc / 2) - odd / 2)) * 100) / 2 + '%'\r\n            } else {\r\n              for (; i < n; i++) {\r\n                bins[i].style.backgroundColor = p.colors[i]\r\n              }\r\n              for (i = Math.floor(nc / 2); i < nc; i++) {\r\n                bins[i + odd].style.backgroundColor = p.colors[i]\r\n              }\r\n            }\r\n          } else if ('continuous-polynomial' !== p.type) {\r\n            if (remake) {\r\n              s.appendChild(document.createElement('span'))\r\n              s.appendChild(document.createElement('span'))\r\n            }\r\n            ;(s.firstElementChild as HTMLElement).style.background =\r\n              'linear-gradient(0.25turn, rgb(' +\r\n              p.colors[2][0][0] +\r\n              ', ' +\r\n              p.colors[2][0][1] +\r\n              ', ' +\r\n              p.colors[2][0][2] +\r\n              '), rgb(' +\r\n              p.colors[1][0] +\r\n              ', ' +\r\n              p.colors[1][1] +\r\n              ', ' +\r\n              p.colors[1][2] +\r\n              '))'\r\n            ;(s.lastElementChild as HTMLElement).style.background =\r\n              'linear-gradient(0.25turn, rgb(' +\r\n              p.colors[1][0] +\r\n              ', ' +\r\n              p.colors[1][1] +\r\n              ', ' +\r\n              p.colors[1][2] +\r\n              '), rgb(' +\r\n              p.colors[0][0][0] +\r\n              ', ' +\r\n              p.colors[0][0][1] +\r\n              ', ' +\r\n              p.colors[0][0][2] +\r\n              '))'\r\n          }\r\n        }\r\n        const center = this.site.spec.settings.color_scale_center as keyof Summary | 'none'\r\n        if ('string' === var_info.type) {\r\n          ticks.center.classList.remove('hidden')\r\n          ;(ticks.min.firstElementChild.firstElementChild as HTMLElement).innerText = var_info.levels[0]\r\n          ;(ticks.max.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n            var_info.levels[var_info.levels.length - 1]\r\n        } else if (this.site.spec.settings.color_by_order) {\r\n          ticks.center.classList.add('hidden')\r\n          ;(ticks.min.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n            '# ' + (summary.n[y] ? summary.n[y] : 0)\r\n          ;(ticks.max.firstElementChild.firstElementChild as HTMLElement).innerText = '# ' + (summary.n[y] ? 1 : 0)\r\n        } else {\r\n          const state =\r\n            '' +\r\n            summary.n[y] +\r\n            summary.min[y] +\r\n            summary.max[y] +\r\n            this.site.spec.settings.digits +\r\n            center +\r\n            this.site.spec.settings.summary_selection\r\n          if (remake || refresh || state !== this.state) {\r\n            this.state = state\r\n            ticks.center.classList.remove('hidden')\r\n            ;(ticks.min.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n              (summary.n[y]\r\n                ? isFinite(summary.min[y])\r\n                  ? this.site.data.format_value(summary.min[y], this.integer)\r\n                  : NaN\r\n                : NaN) + ''\r\n            ;(ticks.max.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n              (summary.n[y]\r\n                ? isFinite(summary.max[y])\r\n                  ? this.site.data.format_value(summary.max[y], this.integer)\r\n                  : NaN\r\n                : NaN) + ''\r\n            if ('none' === center) {\r\n              ;(ticks.center.firstElementChild.lastElementChild as HTMLElement).innerText =\r\n                summary_levels[this.site.spec.settings.summary_selection as string] + ' median'\r\n              ;(ticks.center.firstElementChild.children[1] as HTMLElement).innerText = this.site.data.format_value(\r\n                summary.median[y]\r\n              ) as string\r\n              ticks.center.style.left = summary.norm_median[y] * 100 + '%'\r\n            } else {\r\n              ;(ticks.center.firstElementChild.lastElementChild as HTMLElement).innerText =\r\n                summary_levels[this.site.spec.settings.summary_selection as string] + ' ' + center\r\n              ;(ticks.center.firstElementChild.children[1] as HTMLElement).innerText = this.site.data.format_value(\r\n                (summary[center] as number[])[y]\r\n              ) as string\r\n              ticks.center.style.left = summary[('norm_' + center) as 'norm_mean'][y] * 100 + '%'\r\n            }\r\n            ticks.center.style.marginLeft = -ticks.center.getBoundingClientRect().width / 2 + 'px'\r\n          }\r\n        }\r\n        if (this.site.spec.settings.color_by_order || 'none' === center) {\r\n          ;(s.firstElementChild as HTMLElement).style.width = '50%'\r\n          ;(s.lastElementChild as HTMLElement).style.width = '50%'\r\n        } else {\r\n          ;(s.firstElementChild as HTMLElement).style.width = summary[('norm_' + center) as 'norm_mean'][y] * 100 + '%'\r\n          ;(s.lastElementChild as HTMLElement).style.width =\r\n            100 - summary[('norm_' + center) as 'norm_mean'][y] * 100 + '%'\r\n        }\r\n      }\r\n    }\r\n  }\r\n  mouseover(e: MouseEvent | HTMLElement) {\r\n    if (!this.queue.lock && 'clientX' in e) {\r\n      this.queue.lock = true\r\n      const s = this.parts.scale.getBoundingClientRect(),\r\n        p = (Math.max(s.x, Math.min(s.x + s.width, e.clientX)) - s.x) / s.width\r\n      let entity: Entity\r\n      if (this.site.spec.settings.color_by_order) {\r\n        if (this.parsed.order && this.parsed.order.length)\r\n          entity =\r\n            this.site.data.entities[\r\n              this.parsed.order[\r\n                Math.max(\r\n                  this.parsed.summary.missing[this.parsed.time],\r\n                  Math.min(this.parsed.order.length - 1, Math.floor((this.parsed.order.length - 1) * p))\r\n                )\r\n              ][0]\r\n            ]\r\n      } else if ('min' in this.parsed.summary) {\r\n        const min = this.parsed.summary.min[this.parsed.time],\r\n          max = this.parsed.summary.max[this.parsed.time],\r\n          tv = min + p * (max - min)\r\n        let i, n\r\n        if (this.parsed.order && this.parsed.order.length) {\r\n          n = this.parsed.summary.missing[this.parsed.time]\r\n          if (n < this.parsed.order.length) {\r\n            if (1 === this.parsed.order.length || !p) {\r\n              entity = this.site.data.entities[this.parsed.order[n][0]]\r\n            } else {\r\n              for (i = this.parsed.order.length - 2; i >= n; --i) {\r\n                if ((this.parsed.order[i][1] + this.parsed.order[i + 1][1]) / 2 <= tv) break\r\n              }\r\n              i++\r\n              entity = this.site.data.entities[this.parsed.order[i][0]]\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (entity) {\r\n        this.show(entity)\r\n        if (!this.entity || entity.features.id !== this.entity.features.id) {\r\n          if (!this.entity) {\r\n            this.entity = entity\r\n          } else this.site.subs.update(this.id, 'revert', this.entity)\r\n          this.site.subs.update(this.id, 'show', entity)\r\n          this.entity = entity\r\n        }\r\n      }\r\n      setTimeout(this.queue.reset, 200)\r\n    } else {\r\n      if ((this.queue.cooldown as number) > 0) clearTimeout(this.queue.cooldown)\r\n      this.queue.e = e as HTMLElement\r\n      this.queue.cooldown = setTimeout(this.queue.trigger, 100)\r\n    }\r\n  }\r\n  mouseout(e: MouseEvent) {\r\n    const target = e.relatedTarget as HTMLElement\r\n    if (target && this.id !== target.dataset.of) {\r\n      if ((this.queue.cooldown as number) > 0) clearTimeout(this.queue.cooldown)\r\n      this.queue.cooldown = -1\r\n      this.revert()\r\n      if (this.entity) {\r\n        this.site.subs.update(this.id, 'revert', this.entity)\r\n        this.entity = undefined\r\n      }\r\n    }\r\n  }\r\n  click() {\r\n    if (this.clickto && this.entity) {\r\n      this.revert()\r\n      this.clickto.set(this.entity.features.id)\r\n    }\r\n  }\r\n}\r\n","import DataHandler from '../data_handler/index'\r\nimport type {DataSets, Generic, MapInfo, Query, SiteCondition, SiteRule, SiteSpec, Summary} from '../types'\r\nimport {defaults} from './defaults'\r\nimport type {BaseInput, RegisteredInputs, SiteInputs} from './inputs/index'\r\nimport type {RegisteredOutputs, SiteOutputs} from './outputs/index'\r\nimport {GlobalView} from './global_view'\r\nimport {patterns} from './patterns'\r\nimport {storage} from './storage'\r\nimport {Subscriptions} from './subscriptions'\r\nimport * as conditionals from './conditionals'\r\nimport * as utils from './utils'\r\nimport {DiscretePalette, palettes} from './palettes'\r\nimport {InputSelect} from './inputs/select'\r\nimport {InputNumber} from './inputs/number'\r\nimport {SiteDataView} from './dataview'\r\nimport {Page} from './page'\r\nimport {InputVirtual} from './inputs/virtual'\r\nimport {InputButton} from './inputs/button'\r\nimport {InputCombobox} from './inputs/combobox'\r\nimport {InputRadio} from './inputs/radio'\r\nimport {InputCheckbox} from './inputs/checkbox'\r\nimport {OutputInfo} from './outputs/info'\r\nimport {OutputMap} from './outputs/map'\r\nimport {OutputPlotly} from './outputs/plotly'\r\nimport {InputButtonGroup} from './inputs/buttongroup'\r\nimport {InputSwitch} from './inputs/switch'\r\nimport {InputText} from './inputs/text'\r\nimport {OutputDataTable} from './outputs/datatables'\r\nimport {OutputTable} from './outputs/table'\r\nimport {OutputLegend} from './outputs/legend'\r\nimport {OutputText} from './outputs/text'\r\n\r\ntype Queue = {\r\n  timeout: NodeJS.Timer | number\r\n  elements: Map<string, boolean>\r\n}\r\n\r\nconst inputs = {\r\n  button: InputButton,\r\n  buttongroup: InputButtonGroup,\r\n  combobox: InputCombobox,\r\n  select: InputSelect,\r\n  number: InputNumber,\r\n  radio: InputRadio,\r\n  switch: InputSwitch,\r\n  checkbox: InputCheckbox,\r\n  text: InputText,\r\n}\r\nconst outputs = {\r\n  info: OutputInfo,\r\n  map: OutputMap,\r\n  plotly: OutputPlotly,\r\n  datatable: OutputDataTable,\r\n  table: OutputTable,\r\n  legend: OutputLegend,\r\n  text: OutputText,\r\n}\r\n\r\nexport type Dependency = {\r\n  id: string\r\n  type: 'rule' | 'update' | 'filter' | 'display' | 'dataview' | keyof typeof conditionals | keyof BaseInput\r\n  conditional?: keyof typeof conditionals\r\n  condition?: SiteCondition\r\n  uid?: string\r\n  rule?: number\r\n}\r\n\r\ntype Tree = {\r\n  _n: {children: number; parents: number}\r\n  children: {[index: string]: Tree}\r\n  parents: {[index: string]: Tree}\r\n}\r\n\r\nexport default class Community {\r\n  spec: SiteSpec\r\n  storage = storage\r\n  patterns = patterns\r\n  palettes = palettes\r\n  conditionals: {[index: string]: Function} = {}\r\n  data: DataHandler\r\n  page: Page\r\n  view: GlobalView\r\n  subs: Subscriptions\r\n  registered_inputs: Map<string, SiteInputs> = new Map()\r\n  registered_outputs: Map<string, SiteOutputs> = new Map()\r\n  defaults = defaults\r\n  dataviews: {[index: string]: SiteDataView} = {}\r\n  inputs: RegisteredInputs = {}\r\n  outputs: RegisteredOutputs = {}\r\n  dependencies: {[index: string]: Dependency[]} = {}\r\n  url_options: {[index: string]: boolean | string} = {}\r\n  queue: Queue = {timeout: 0, elements: new Map()}\r\n  tree: {[index: string]: Tree} = {}\r\n  maps: MapInfo = {\r\n    queue: {},\r\n    waiting: {},\r\n    overlay_property_selectors: [],\r\n  }\r\n  meta = {\r\n    retain_state: true,\r\n    lock_after: '',\r\n  }\r\n  state = ''\r\n  query = ''\r\n  parsed_query: Query = {}\r\n  endpoint?: string\r\n  rule_conditions: {[index: string]: SiteRule[]} = {}\r\n  constructor(spec: SiteSpec) {\r\n    if (spec) {\r\n      this.spec = spec\r\n      spec.active = this\r\n    }\r\n    if (!('dataLayer' in window)) (window as any).dataLayer = []\r\n    storage.copy = storage.get() as Generic\r\n    if (storage.copy)\r\n      for (const k in spec.settings) {\r\n        if (k in storage.copy) {\r\n          let c = storage.copy[k]\r\n          if ('string' === typeof c) {\r\n            if (patterns.bool.test(c)) {\r\n              c = !!c || 'true' === c\r\n            } else if (patterns.number.test(c)) c = parseFloat(c)\r\n          }\r\n          spec.settings[k] = c\r\n        }\r\n      }\r\n    function poly_channel(ch: number, pos: number, coefs: number[][]) {\r\n      const n = coefs.length\r\n      let v = coefs[0][ch] + pos * coefs[1][ch],\r\n        i = 2\r\n      for (; i < n; i++) {\r\n        v += Math.pow(pos, i) * coefs[i][ch]\r\n      }\r\n      return Math.max(0, Math.min(255, v))\r\n    }\r\n    Object.keys(palettes).forEach(k => {\r\n      const n = 255\r\n      let p = palettes[k]\r\n      if ('continuous-polynomial' === p.type) {\r\n        const c = p.colors as number[][],\r\n          r: DiscretePalette = {name: k, type: 'discrete', colors: []}\r\n        for (let i = 0; i < n; i++) {\r\n          const v = i / n\r\n          r.colors.push(\r\n            'rgb(' + poly_channel(0, v, c) + ', ' + poly_channel(1, v, c) + ', ' + poly_channel(2, v, c) + ')'\r\n          )\r\n        }\r\n        p = palettes[k] = r\r\n      }\r\n      p.odd = p.colors.length % 2\r\n    })\r\n    this.query = window.location.search.replace('?', '')\r\n    if (this.query) {\r\n      this.query.split('&').forEach(a => {\r\n        const c = a.split('='),\r\n          k = c[0]\r\n        let v: string | boolean\r\n        if (c.length < 2) c.push('true')\r\n        v = patterns.bool.test(c[1]) ? !!c[1] || 'true' === c[1] : c[1].replace(patterns.url_spaces, ' ')\r\n        this.url_options[c[0]] = v\r\n        if (patterns.settings.test(c[0])) storage.set(c[0].replace(patterns.settings, ''), v)\r\n      })\r\n    }\r\n    if ('embedded' in this.url_options || 'hide_navbar' in this.url_options) {\r\n      if (!('hide_logo' in this.url_options)) this.url_options.hide_logo = true\r\n      if (!('hide_title' in this.url_options)) this.url_options.hide_title = true\r\n      if (!('hide_navcontent' in this.url_options)) this.url_options.hide_navcontent = true\r\n      if (!('hide_panels' in this.url_options)) this.url_options.hide_panels = true\r\n      if ('embedded' in this.url_options && !('close_menus' in this.url_options)) this.url_options.close_menus = true\r\n    }\r\n    this.init = this.init.bind(this)\r\n    this.request_queue = this.request_queue.bind(this)\r\n    this.run_queue = this.run_queue.bind(this)\r\n    this.global_reset = this.global_reset.bind(this)\r\n    Object.keys(conditionals).forEach(\r\n      (k: keyof typeof conditionals) => (this.conditionals[k] = conditionals[k].bind(this))\r\n    )\r\n    if (this.spec.dataviews) {\r\n      this.defaults.dataview = Object.keys(this.spec.dataviews)[0]\r\n    } else {\r\n      this.spec.dataviews = {}\r\n      this.spec.dataviews[this.defaults.dataview] = {}\r\n    }\r\n    if (!this.maps.overlay_property_selectors) this.maps.overlay_property_selectors = []\r\n    this.view = new GlobalView(this)\r\n    new Page(this)\r\n    document.querySelectorAll('.auto-input').forEach((e: HTMLElement) => {\r\n      if (e.dataset.autotype in inputs && !(e.id in this.inputs)) {\r\n        const u = new inputs[e.dataset.autotype as keyof typeof inputs](e, this)\r\n        this.registered_inputs.set(u.id, u)\r\n        this.inputs[u.id] = u\r\n      }\r\n    })\r\n    this.subs = new Subscriptions(this)\r\n    document.querySelectorAll('.auto-output').forEach((e: HTMLElement) => {\r\n      if (e.dataset.autotype in outputs && !(e.id in this.outputs)) {\r\n        const u = new outputs[e.dataset.autotype as keyof typeof outputs](e, this)\r\n        this.registered_outputs.set(u.id, u)\r\n        this.outputs[u.id] = u\r\n        const opt = 'options' in u ? u.options : u.spec\r\n        if ('subto' in opt) {\r\n          if ('string' === typeof opt.subto) opt.subto = [opt.subto]\r\n          if (Array.isArray(opt.subto)) opt.subto.forEach(v => this.subs.add(v, u))\r\n        }\r\n      }\r\n    })\r\n    if (spec.variables && spec.variables.length)\r\n      spec.variables.forEach(v => {\r\n        const u = new InputVirtual(v, this)\r\n        this.registered_inputs.set(v.id, u)\r\n        this.inputs[v.id] = u\r\n      })\r\n    this.defaults.dataset = this.spec.dataviews[defaults.dataview].dataset\r\n    const sets = this.spec.metadata.datasets\r\n    if (!sets || !sets.length) {\r\n      this.drop_load_screen()\r\n    } else {\r\n      if (sets.length && -1 === sets.indexOf(this.defaults.dataset)) {\r\n        if (1 === sets.length) {\r\n          this.defaults.dataset = sets[0]\r\n        } else {\r\n          this.registered_inputs.forEach(u => {\r\n            if (!this.defaults.dataset) {\r\n              const d = u.default\r\n              if (-1 !== sets.indexOf(u.dataset)) {\r\n                this.defaults.dataset = u.dataset\r\n              } else if ('string' === typeof d && -1 !== sets.indexOf(d)) {\r\n                this.defaults.dataset = d\r\n              } else if (\r\n                'select' === u.type &&\r\n                'number' === typeof d &&\r\n                u.options[d] &&\r\n                -1 !== sets.indexOf(u.options[d].value)\r\n              ) {\r\n                this.defaults.dataset = u.options[d].value\r\n              } else if (\r\n                ('select' === u.type || 'combobox' === u.type) &&\r\n                Array.isArray(u.values) &&\r\n                u.values[u.default] &&\r\n                -1 !== sets.indexOf(u.values[u.default])\r\n              ) {\r\n                this.defaults.dataset = u.values[u.default]\r\n              }\r\n            }\r\n          })\r\n          if (!this.defaults.dataset) this.defaults.dataset = sets[sets.length - 1]\r\n        }\r\n        this.defaults.dataset = this.valueOf(this.defaults.dataset) as string\r\n        if (-1 === sets.indexOf(this.defaults.dataset)) this.defaults.dataset = sets[0]\r\n        this.registered_inputs.forEach(u => {\r\n          if (!u.dataset) u.dataset = this.defaults.dataset\r\n        })\r\n        if (!this.spec.dataviews[defaults.dataview].dataset)\r\n          this.spec.dataviews[defaults.dataview].dataset = this.defaults.dataset\r\n      }\r\n      if (spec.rules && spec.rules.length) {\r\n        spec.rules.forEach((r, i) => {\r\n          r.parsed = {}\r\n          if ('display' in r.effects) {\r\n            r.parsed.display = {e: document.getElementById(r.effects.display)}\r\n            const e = r.parsed.display.e.querySelector('.auto-input')\r\n            if (e) {\r\n              const u = this.inputs[e.id]\r\n              u.rule = r\r\n              r.parsed.display.u = u\r\n            }\r\n          }\r\n          if ('lock' in r.effects) {\r\n            const us = new Map()\r\n            document\r\n              .querySelectorAll('#' + r.effects.lock + ' .auto-input')\r\n              .forEach(e => us.set(e.id, this.inputs[e.id]))\r\n            r.parsed.lock = us\r\n          }\r\n          r.condition.forEach(c => {\r\n            if (c.type in DataHandler.checks) {\r\n              c.check = function (this: {c: SiteCondition; site: Community}) {\r\n                return DataHandler.checks[this.c.type](this.site.valueOf(this.c.id), this.site.valueOf(this.c.value))\r\n              }.bind({c, site: this})\r\n              if (c.id in this.inputs) {\r\n                this.add_dependency(c.id, {type: 'rule', id: c.id, condition: c, rule: i})\r\n                if (!(c.id in this.rule_conditions)) this.rule_conditions[c.id] = []\r\n                this.rule_conditions[c.id][i] = r\r\n              }\r\n              if (c.check()) {\r\n                Object.keys(r.effects).forEach(k => {\r\n                  if (k in this.inputs) this.inputs[k].set(this.valueOf(r.effects[k]) as string)\r\n                })\r\n              } else if (c.default) {\r\n                Object.keys(r.effects).forEach(k => {\r\n                  if (k in this.inputs) this.inputs[k].set(this.valueOf(c.default) as string)\r\n                })\r\n              }\r\n            }\r\n          })\r\n        })\r\n      }\r\n      const dataset = this.valueOf(this.spec.dataviews[this.defaults.dataview].dataset) as string | number\r\n      this.defaults.dataset = 'number' === typeof dataset ? sets[dataset] : dataset\r\n      if (-1 === sets.indexOf(this.defaults.dataset)) this.defaults.dataset = sets[0]\r\n      this.data = new DataHandler(this.spec, this.defaults, this.data as unknown as DataSets, {\r\n        init: this.init,\r\n        onload: function (this: Community) {\r\n          if (this.data.inited) clearTimeout(this.data.inited.load_screen as NodeJS.Timeout)\r\n          setTimeout(this.drop_load_screen.bind(this), 600)\r\n          delete this.data.onload\r\n        }.bind(this),\r\n        data_load: function (this: Community) {\r\n          Object.keys(this.dependencies).forEach(k => this.request_queue(false, k))\r\n        }.bind(this),\r\n      })\r\n    }\r\n  }\r\n  init() {\r\n    if (this.data.variables) {\r\n      const variable = Object.keys(this.data.variables)\r\n      this.defaults.variable = variable[variable.length - 1]\r\n    }\r\n    Object.keys(this.spec.dataviews).forEach(id => new SiteDataView(this, id, this.spec.dataviews[id]))\r\n    this.view.init()\r\n    this.page.init()\r\n    if (this.query) {\r\n      this.parsed_query = this.data.parse_query(this.query)\r\n      if (this.parsed_query.variables.conditions.length) {\r\n        this.parsed_query.variables.conditions.forEach(f => {\r\n          const info = this.data.variable_info[f.name]\r\n          if (info) this.page.add_filter_condition(f.name, f)\r\n        })\r\n      }\r\n    }\r\n    this.run_queue()\r\n    this.registered_inputs.forEach(async o => {\r\n      const combobox = 'combobox' === o.type\r\n      if (o.optionSource && 'options' in o) {\r\n        if (patterns.palette.test(o.optionSource)) {\r\n          o.options = []\r\n          Object.keys(palettes).forEach(v => o.add(v, palettes[v].name))\r\n          if (-1 === o.default) o.default = defaults.palette\r\n        } else if (patterns.datasets.test(o.optionSource)) {\r\n          if (-1 === o.default) o.default = defaults.dataset\r\n          o.options = []\r\n          this.spec.metadata.datasets.forEach(d => o.add(d))\r\n        } else if ('option_sets' in o) {\r\n          o.sensitive = false\r\n          if (patterns.properties.test(o.optionSource)) {\r\n            this.maps.overlay_property_selectors.push(o)\r\n          }\r\n          if (o.depends) this.add_dependency(o.depends as string, {type: 'options', id: o.id})\r\n          if (o.dataset in this.inputs) this.add_dependency(o.dataset, {type: 'options', id: o.id})\r\n          if (o.view) this.add_dependency(o.view, {type: 'options', id: o.id})\r\n          const v = this.valueOf(o.dataset) || defaults.dataset\r\n          if ('string' === typeof v) {\r\n            if (!o.dataset) o.dataset = v\r\n            if (v in this.data.info) this.conditionals.options(o)\r\n          }\r\n        }\r\n      }\r\n      if (combobox || 'select' === o.type) {\r\n        // resolve options\r\n        if (Array.isArray(o.values)) {\r\n          o.values = {}\r\n          o.display = {}\r\n          let new_display = true\r\n          const select = 'select' === o.type\r\n          o.options.forEach(e => {\r\n            if (select) e.dataset.value = (e as HTMLOptionElement).value\r\n            if (new_display) new_display = e.dataset.value === e.innerText\r\n          })\r\n          o.options.forEach((e, i) => {\r\n            o.values[e.dataset.value] = i\r\n            if (new_display) e.innerText = this.data.format_label(e.dataset.value)\r\n            o.display[e.innerText] = i\r\n          })\r\n          if (!(o.default in o.values) && !(o.default in this.inputs)) {\r\n            o.default = +o.default\r\n            if (isNaN(o.default)) o.default = -1\r\n            if (-1 !== o.default && o.default < o.options.length) {\r\n              o.default = o.options[o.default].dataset.value\r\n            } else {\r\n              o.default = -1\r\n            }\r\n          }\r\n          o.source = ''\r\n          o.id in this.url_options ? o.set(this.url_options[o.id] as string) : o.reset()\r\n        }\r\n        o.subset = o.e.dataset.subset || 'all'\r\n        o.selection_subset = o.e.dataset.selectionSubset || o.subset\r\n        if (o.type in this.spec && o.id in this.spec[o.type]) {\r\n          o.settings = this.spec[o.type][o.id]\r\n          if (o.settings.filters) {\r\n            Object.keys(o.settings.filters).forEach(f => {\r\n              this.add_dependency(o.settings.filters[f], {type: 'filter', id: o.id})\r\n            })\r\n          }\r\n        }\r\n      } else if ('number' === o.type) {\r\n        // retrieve option values\r\n        o.min = o.e.getAttribute('min')\r\n        o.min_ref = parseFloat(o.min)\r\n        o.min_indicator = o.e.parentElement.parentElement.querySelector('.indicator-min')\r\n        if (o.min_indicator) {\r\n          o.min_indicator.addEventListener(\r\n            'click',\r\n            function (this: InputNumber) {\r\n              this.set(this.parsed.min)\r\n            }.bind(o)\r\n          )\r\n        }\r\n        o.max = o.e.getAttribute('max')\r\n        o.max_ref = parseFloat(o.max)\r\n        o.max_indicator = o.e.parentElement.parentElement.querySelector('.indicator-max')\r\n        if (o.max_indicator) {\r\n          o.max_indicator.addEventListener(\r\n            'click',\r\n            function (this: InputNumber) {\r\n              this.set(this.parsed.max)\r\n            }.bind(o)\r\n          )\r\n        }\r\n        o.ref = isNaN(o.min_ref) || isNaN(o.max_ref)\r\n        o.range = [o.min_ref, o.max_ref]\r\n        o.step = parseFloat(o.e.step) || 1\r\n        o.parsed = {min: undefined, max: undefined}\r\n        o.depends = {}\r\n        o.default_max = 'max' === o.default || 'last' === o.default\r\n        o.default_min = 'min' === o.default || 'first' === o.default\r\n        if (o.view) this.add_dependency(o.view, {type: 'update', id: o.id})\r\n        if (!(o.max in this.data.variables)) {\r\n          if (o.max in this.inputs) {\r\n            this.add_dependency(o.max, {type: 'max', id: o.id})\r\n          } else o.e.max = o.max\r\n        } else if (o.view) {\r\n          this.add_dependency(o.view + '_time', {type: 'max', id: o.id})\r\n        }\r\n        if (!(o.min in this.data.variables)) {\r\n          if (o.min in this.inputs) {\r\n            this.add_dependency(o.min, {type: 'min', id: o.id})\r\n          } else o.e.min = o.min\r\n        } else if (o.view) {\r\n          this.add_dependency(o.view + '_time', {type: 'min', id: o.id})\r\n        }\r\n        if ('undefined' !== typeof o.default) {\r\n          if (patterns.number.test(o.default as string)) {\r\n            o.default = +o.default\r\n          } else\r\n            o.reset = o.default_max\r\n              ? function (this: InputNumber) {\r\n                  if (this.range) {\r\n                    this.current_default = this.site.valueOf(this.range[1]) as number\r\n                    this.set(this.current_default)\r\n                  }\r\n                }.bind(o)\r\n              : o.default_max\r\n              ? function (this: InputNumber) {\r\n                  if (this.range) {\r\n                    this.current_default = this.site.valueOf(this.range[0]) as number\r\n                    this.set(this.current_default)\r\n                  }\r\n                }.bind(o)\r\n              : o.default in this.inputs\r\n              ? function (this: InputNumber) {\r\n                  this.current_default = this.site.valueOf(this.default) as number\r\n                  this.set(this.current_default)\r\n                }.bind(o)\r\n              : function () {}\r\n        }\r\n        if (o.variable) {\r\n          const d = -1 === this.spec.metadata.datasets.indexOf(o.dataset) ? defaults.dataset : o.dataset\r\n          if (o.variable in this.inputs) {\r\n            this.add_dependency(o.variable, {type: 'update', id: o.id})\r\n          } else if (o.variable in this.data.variables) {\r\n            o.min = o.parsed.min = o.range[0] = this.data.variables[o.variable].info[d].min\r\n            o.e.min = o.min + ''\r\n            o.max = o.parsed.max = o.range[1] = this.data.variables[o.variable].info[d].max\r\n            o.e.max = o.max + ''\r\n          }\r\n        }\r\n      }\r\n      if ('select' === o.type || 'number' === o.type || 'text' === o.type) {\r\n        if (\r\n          o.e.parentElement.lastElementChild &&\r\n          o.e.parentElement.lastElementChild.classList.contains('select-reset')\r\n        ) {\r\n          o.e.parentElement.lastElementChild.addEventListener('click', o.reset.bind(o))\r\n        }\r\n      }\r\n      if (patterns.settings.test(o.id)) {\r\n        o.setting = o.id.replace(patterns.settings, '')\r\n        if (null == o.default && o.setting in this.spec.settings) o.default = this.spec.settings[o.setting] as string\r\n        this.add_dependency(o.id, {type: 'setting', id: o.id})\r\n      }\r\n      if (!o.view) o.view = defaults.dataview\r\n      const v = this.url_options[o.id] || storage.get(o.id.replace(patterns.settings, ''))\r\n      if ('init' in o) o.init()\r\n      if (v) {\r\n        o.set(v as string)\r\n      } else {\r\n        o.reset()\r\n      }\r\n    })\r\n    this.registered_outputs.forEach(o => {\r\n      if ('init' in o) o.init()\r\n    })\r\n  }\r\n  global_update() {\r\n    this.meta.retain_state = false\r\n    this.queue.elements.forEach(this.request_queue)\r\n    this.registered_outputs.forEach(u => u.update())\r\n  }\r\n  global_reset() {\r\n    this.meta.retain_state = false\r\n    this.registered_inputs.forEach((u, k) => {\r\n      if (!u.setting && u.reset) {\r\n        u.reset()\r\n        this.request_queue(false, k)\r\n      }\r\n    })\r\n  }\r\n  clear_storage() {\r\n    if (window.localStorage) storage.perm.removeItem(storage.name)\r\n    window.location.reload()\r\n  }\r\n  request_queue(waiting: boolean | string, id?: string) {\r\n    if ('boolean' !== typeof waiting) {\r\n      id = waiting as string\r\n      waiting = false\r\n    }\r\n    if (!waiting && (-1 === this.queue.timeout || !this.queue.elements.get(id))) {\r\n      this.queue.elements.set(id, true)\r\n      if ((this.queue.timeout as number) > 0) clearTimeout(this.queue.timeout as number)\r\n      this.queue.timeout = setTimeout(this.run_queue, 20)\r\n      this.meta.lock_after = id\r\n    }\r\n  }\r\n  run_queue() {\r\n    if ((this.queue.timeout as number) > 0) clearTimeout(this.queue.timeout as number)\r\n    this.queue.timeout = -1\r\n    this.queue.elements.forEach((fire, k) => {\r\n      if (fire) {\r\n        const d = this.refresh_conditions(k) as string\r\n        if (d) {\r\n          if (!(k in this.data.data_queue[d])) this.data.data_queue[d][k] = this.run_queue\r\n          return false\r\n        }\r\n        this.queue.elements.set(k, false)\r\n      }\r\n    })\r\n    let k = this.get_options_url()\r\n    if (this.data.inited.first && k !== this.state) {\r\n      this.state = k\r\n      Object.keys(this.url_options).forEach(s => {\r\n        const v = this.url_options[s]\r\n        if ('string' === typeof v && patterns.embed_setting.test(s))\r\n          k += '&' + s + '=' + ('navcolor' === s ? v.replace(patterns.hashes, '%23') : v)\r\n      })\r\n      if (!this.spec.settings.hide_url_parameters) {\r\n        window.history.replaceState(Date.now(), '', k)\r\n      }\r\n      setTimeout(this.page.resize, 50)\r\n    }\r\n  }\r\n  refresh_conditions(id: string) {\r\n    if (id in this.dependencies) {\r\n      const d = this.dependencies[id],\r\n        r: number[] = [],\r\n        c = 'view.' === id.substring(0, 5) ? this.view : id in this.dataviews ? this.dataviews[id] : this.inputs[id],\r\n        is_view = c instanceof SiteDataView,\r\n        is_global = c instanceof GlobalView,\r\n        part = 'id' === id.substring(6) ? 'id_state' : 'filter_state',\r\n        v = is_global ? c[part]() : c && c.value() + '',\r\n        state = is_global ? c.states[part] : c && c.state\r\n      if (c && (!this.meta.retain_state || state !== v)) {\r\n        if (is_global) {\r\n          c.states[part] = v\r\n        } else if (!is_view) {\r\n          const view = this.dataviews[c.view],\r\n            dd =\r\n              v in this.data.loaded ? v : c.dataset ? (this.valueOf(c.dataset) as string) : view && view.get.dataset()\r\n          if (this.data.info && dd in this.data.loaded && !this.data.loaded[dd]) {\r\n            if (!c.deferred) this.data.retrieve(dd, this.data.info[dd].site_file)\r\n            return dd\r\n          }\r\n          c.state = v\r\n        } else {\r\n          c.state = v\r\n        }\r\n        d.forEach(di => {\r\n          if ('rule' === di.type) {\r\n            if (-1 === r.indexOf(di.rule)) {\r\n              r.push(di.rule)\r\n            }\r\n          } else if ('dataview' === di.type) {\r\n            this.dataviews[di.id].update()\r\n          } else if (di.conditional) {\r\n            this.conditionals[di.conditional](di.id in this.dataviews ? this.dataviews[di.id] : this.inputs[di.id], c)\r\n          } else if (di.id in this.inputs) {\r\n            const du = this.inputs[di.id]\r\n            di.type in du && (du[di.type as keyof BaseInput] as Function)()\r\n          } else if (di.id in this.outputs) {\r\n            const du = this.outputs[di.id]\r\n            di.type in du && du[di.type as 'update']()\r\n          }\r\n        })\r\n        r.forEach(i => {\r\n          let pass = false\r\n          const ri = this.spec.rules[i],\r\n            n = ri.condition.length\r\n          for (let i = 0; i < n; i++) {\r\n            const ck = ri.condition[i]\r\n            pass = ck.check()\r\n            if (ck.any ? pass : !pass) break\r\n          }\r\n          Object.keys(ri.parsed).forEach(k => {\r\n            if (pass) {\r\n              if ('display' === k) {\r\n                ri.parsed[k].e.classList.remove('hidden')\r\n              } else if ('lock' === k) {\r\n                ri.parsed[k].forEach((u: InputSelect) => {\r\n                  u.e.classList.remove('locked')\r\n                  utils.toggle_input(u, true)\r\n                })\r\n              } else if (k in this.inputs) {\r\n                const value = this.valueOf(ri.effects[k]) as string\r\n                this.inputs[k].set(value)\r\n              }\r\n            } else if ('display' === k) {\r\n              const e = ri.parsed[k]\r\n              if (!e.e.classList.contains('hidden')) {\r\n                e.e.classList.add('hidden')\r\n                if (e.u && e.u.reset) e.u.reset()\r\n                e.e.querySelectorAll('.auto-input').forEach(c => {\r\n                  const input = this.inputs[c.id]\r\n                  if (input && input.reset) input.reset()\r\n                })\r\n              }\r\n            } else if ('lock' === k) {\r\n              ri.parsed[k].forEach((u: InputSelect) => {\r\n                u.e.classList.add('locked')\r\n                utils.toggle_input(u)\r\n              })\r\n            } else if ('default' in ri) {\r\n              if (k in this.inputs) {\r\n                this.inputs[k].set(this.valueOf(ri.default) as string)\r\n              }\r\n            }\r\n          })\r\n        })\r\n      }\r\n      if (id === this.meta.lock_after) this.meta.retain_state = true\r\n    }\r\n  }\r\n  valueOf(v: boolean | string | number | (string | number)[]): boolean | string | number | (string | number)[] {\r\n    return 'string' === typeof v && v in this.inputs ? this.valueOf(this.inputs[v].value()) : v\r\n  }\r\n  get_options_url() {\r\n    let s = ''\r\n    this.registered_inputs.forEach((u, k) => {\r\n      if ('virtual' !== u.type && !patterns.settings.test(k)) {\r\n        if (!('range' in u) || u.range[0] !== u.range[1]) {\r\n          let v = u.value() as number | string | string[]\r\n          if ('off_default' in u ? u.off_default : v !== u.default) {\r\n            if (Array.isArray(v)) v = v.join(',')\r\n            if ('' !== v && null != v && '-1' != v) s += (s ? '&' : '?') + k + '=' + v\r\n          }\r\n        }\r\n      }\r\n    })\r\n    if (this.data && this.view.filters.size) s += (s ? '&' : '?') + this.view.filter_state([])\r\n    return window.location.protocol + '//' + window.location.host + window.location.pathname + s\r\n  }\r\n  gtag(...args: any) {\r\n    if (this.spec.settings.tracking) (window as any).dataLayer.push(arguments)\r\n  }\r\n  drop_load_screen() {\r\n    if (!this.data || this.data.inited) clearTimeout(+this.data.inited.load_screen)\r\n    this.page.wrap.style.visibility = 'visible'\r\n    this.page.load_screen.style.display = 'none'\r\n    if (this.spec.tutorials && 'tutorial' in this.url_options) {\r\n      setTimeout(\r\n        this.page.tutorials.start_tutorial.bind(this.page.tutorials, {\r\n          target: {dataset: {name: this.url_options.tutorial}},\r\n        }),\r\n        0\r\n      )\r\n    }\r\n  }\r\n  add_dependency(id: string, o: Dependency): void {\r\n    if (!(id in this.dependencies)) this.dependencies[id] = []\r\n    if (!o.uid) o.uid = JSON.stringify(o)\r\n    if (o.type in this.conditionals) {\r\n      o.conditional = o.type as keyof typeof conditionals\r\n    }\r\n    const c = this.dependencies[id]\r\n    for (let i = c.length; i--; ) if (o.uid === c[i].uid) return void 0\r\n    c.push(o)\r\n    if (!(id in this.tree)) this.tree[id] = {_n: {children: 0, parents: 0}, children: {}, parents: {}}\r\n    if (!(o.id in this.tree)) this.tree[o.id] = {_n: {children: 0, parents: 0}, children: {}, parents: {}}\r\n    this.tree[id].children[o.id] = this.tree[o.id]\r\n    this.tree[id]._n.children++\r\n    this.tree[o.id].parents[id] = this.tree[id]\r\n    this.tree[o.id]._n.parents++\r\n    c.sort((a, b) => {\r\n      return !(a.id in this.tree) || !(b.id in this.tree)\r\n        ? -Infinity\r\n        : this.tree[a.id]._n.children - this.tree[b.id]._n.children\r\n    })\r\n    this.request_queue(true, id)\r\n  }\r\n  get_color(value: number, which: string, summary: Summary, index: number, rank: number, total: number) {\r\n    const pal = palettes[which]\r\n    if (isNaN(value) || 'continuous-polynomial' === pal.type) return this.defaults.missing\r\n    const settings = this.spec.settings,\r\n      centered = 'none' !== settings.color_scale_center && !settings.color_by_order,\r\n      fixed = 'discrete' === pal.type,\r\n      string = 'string' === summary.type,\r\n      min = !string ? summary.min[index] : 0,\r\n      range = string ? summary.levels.length - min : summary.range[index],\r\n      stat =\r\n        'none' === settings.color_scale_center || patterns.median.test(settings.color_scale_center as string)\r\n          ? 'median'\r\n          : 'mean',\r\n      center_source = ((settings.color_by_order ? 'break_' : 'norm_') + stat) as 'break_mean',\r\n      center = settings.color_by_order\r\n        ? centered\r\n          ? summary[center_source][index] / total\r\n          : 0.5\r\n        : isNaN(summary[center_source][index])\r\n        ? 0.5\r\n        : summary[center_source][index],\r\n      r = fixed\r\n        ? centered && !settings.color_by_order\r\n          ? Math.ceil(pal.colors.length / 2) - pal.odd / 2\r\n          : pal.colors.length\r\n        : 1,\r\n      p = settings.color_by_order\r\n        ? (rank + 0.5) / total\r\n        : range\r\n        ? ((string ? summary.level_ids[value] : value) - min) / range\r\n        : 0.5,\r\n      upper = p > (centered ? center : 0.5),\r\n      bound_ref = upper ? 'upper_' : 'lower_',\r\n      value_min = (bound_ref + stat + '_min') as 'upper_mean_min',\r\n      value_range = (bound_ref + stat + '_range') as 'upper_mean_range'\r\n    let v = centered ? (range ? (p + center - summary[value_min][index]) / summary[value_range][index] : 1) : p\r\n    if (!fixed) {\r\n      v = Math.max(0, Math.min(1, v))\r\n      if (upper) v = 1 - v\r\n      if (!centered) v *= 2\r\n    }\r\n    return (string ? value in summary.level_ids : 'number' === typeof value)\r\n      ? fixed\r\n        ? pal.colors[\r\n            Math.max(0, Math.min(pal.colors.length - 1, Math.floor(centered ? (upper ? r + r * v : r * v) : r * v)))\r\n          ]\r\n        : 'rgb(' +\r\n          (upper\r\n            ? pal.colors[0][0][0] +\r\n              v * pal.colors[0][1][0] +\r\n              ', ' +\r\n              (pal.colors[0][0][1] + v * pal.colors[0][1][1]) +\r\n              ', ' +\r\n              (pal.colors[0][0][2] + v * pal.colors[0][1][2])\r\n            : pal.colors[2][0][0] +\r\n              v * pal.colors[2][1][0] +\r\n              ', ' +\r\n              (pal.colors[2][0][1] + v * pal.colors[2][1][1]) +\r\n              ', ' +\r\n              (pal.colors[2][0][2] + v * pal.colors[2][1][2])) +\r\n          ')'\r\n      : defaults.missing\r\n  }\r\n}\r\n","import {BaseInput} from './index'\r\nimport type Community from '../index'\r\nimport {patterns} from '../patterns'\r\nimport type {Generic} from '../../types'\r\n\r\nexport class InputButton extends BaseInput {\r\n  type: 'button' = 'button'\r\n  e: HTMLButtonElement\r\n  target: string\r\n  text: string\r\n  api?: string\r\n  notification: HTMLElement\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.update = this.update.bind(this)\r\n    this.target = this.e.dataset.target\r\n    if ('copy' === this.target) this.settings.endpoint = site.spec.endpoint\r\n    if ('filter' === this.target) {\r\n      e.setAttribute('data-bs-toggle', 'modal')\r\n      e.setAttribute('data-bs-target', '#filter_display')\r\n      this.notification = document.createElement('span')\r\n      this.notification.className = 'filter-notification hidden'\r\n      e.parentElement.appendChild(this.notification)\r\n      site.add_dependency('view.filter', {type: 'update', id: this.id})\r\n      site.add_dependency('view.id', {type: 'update', id: this.id})\r\n      if (site.data) this.update()\r\n    } else\r\n      e.addEventListener(\r\n        'click',\r\n        this.settings.effects\r\n          ? 'export' === this.target || 'copy' === this.target\r\n            ? () => {\r\n                const f: {[index: string]: boolean | string | number | (string | number)[]} = {},\r\n                  s = this.settings,\r\n                  v = site.dataviews[s.dataview],\r\n                  d = v && v.parsed.dataset\r\n                Object.keys(s.query).forEach(k => (f[k] = site.valueOf(s.query[k])))\r\n                if (v) {\r\n                  if (!('include' in f) && v.y) f.include = site.valueOf(v.y)\r\n                  if (!('id' in f) && v.ids) f.id = site.valueOf(v.ids)\r\n                }\r\n                if ('copy' === this.target || this.api) {\r\n                  let q = []\r\n                  if ('id' in f && '' !== f.id && -1 != f.id) {\r\n                    q.push('id=' + f.id)\r\n                  } else {\r\n                    if (site.view.selected.length) q.push('id=' + site.view.selected.join(','))\r\n                  }\r\n                  if (v) {\r\n                    if (!f.time_range && v.time_range.filtered_index + '' !== v.time_range.index + '') {\r\n                      q.push(\r\n                        'time_range=' +\r\n                          site.data.meta.times[d].value[v.time_range.filtered_index[0]] +\r\n                          ',' +\r\n                          site.data.meta.times[d].value[v.time_range.filtered_index[1]]\r\n                      )\r\n                    }\r\n                    if (!v.features) v.features = {}\r\n                    Object.keys(v.features).forEach(k => {\r\n                      if (!(k in f)) {\r\n                        let fv = site.valueOf(v.features[k])\r\n                        if (Array.isArray(fv)) fv = fv.join(',')\r\n                        f[k] = fv\r\n                        q.push(k + '=' + fv)\r\n                      }\r\n                    })\r\n                    if (site.view.filters.size) site.view.filter_state(q, v.parsed.time_agg)\r\n                  }\r\n                  Object.keys(f).forEach(k => {\r\n                    if (!patterns.exclude_query.test(k) && !(k in v.features)) q.push(k + '=' + f[k])\r\n                  })\r\n                  const k = s.endpoint + (q.length ? '?' + q.join('&') : '')\r\n                  if (this.api) {\r\n                    window.location.href = k\r\n                  } else {\r\n                    navigator.clipboard.writeText(k).then(\r\n                      () => {\r\n                        if ('Copied!' !== e.innerText) {\r\n                          this.text = e.innerText\r\n                          e.innerText = 'Copied!'\r\n                          setTimeout(() => {\r\n                            e.innerText = this.text\r\n                          }, 500)\r\n                          site.gtag('event', 'export', {event_category: 'api link'})\r\n                        }\r\n                      },\r\n                      e => {\r\n                        if (e !== this.e.innerText) {\r\n                          this.text = this.e.innerText\r\n                          this.e.innerText = e\r\n                          setTimeout(() => {\r\n                            this.e.innerText = this.text\r\n                          }, 1500)\r\n                        }\r\n                      }\r\n                    )\r\n                  }\r\n                } else {\r\n                  if (v && 'selection' in v) {\r\n                    if (!f.time_range)\r\n                      f.time_range =\r\n                        site.data.meta.times[d].value[v.time_range.filtered_index[0]] +\r\n                        ',' +\r\n                        site.data.meta.times[d].value[v.time_range.filtered_index[1]]\r\n                    site.data.export(f as Generic, v.selection.all, true)\r\n                  } else site.data.export(f as Generic, site.data.entities, true, true)\r\n                  site.gtag('event', 'export', {event_category: 'download'})\r\n                }\r\n              }\r\n            : () => {\r\n                Object.keys(this.settings.effects).forEach(k => {\r\n                  this.settings.effects[k] === '' || -1 == this.settings.effects[k]\r\n                    ? site.inputs[k].reset()\r\n                    : site.inputs[k].set(this.settings.effects[k])\r\n                })\r\n              }\r\n          : 'refresh' === this.target\r\n          ? site.global_update\r\n          : 'reset_selection' === this.target\r\n          ? site.global_reset\r\n          : 'reset_storage' === this.target\r\n          ? site.clear_storage\r\n          : () => {\r\n              if (this.target in site.inputs) site.inputs[this.target].reset()\r\n            }\r\n      )\r\n  }\r\n  update() {\r\n    let n = +(0 !== this.site.view.selected.length)\r\n    this.site.view.filters.forEach(f => (n += +f.active))\r\n    if (n) {\r\n      this.notification.innerText = n + ''\r\n      this.notification.classList.remove('hidden')\r\n    } else {\r\n      this.notification.classList.add('hidden')\r\n    }\r\n  }\r\n}\r\n","import type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport class InputButtonGroup extends BaseInput {\r\n  type: 'buttongroup' = 'buttongroup'\r\n  options: NodeListOf<HTMLInputElement>\r\n  values: (string | number)[] = []\r\n  source: string | number\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    e.addEventListener('click', this.listen)\r\n    this.options = e.querySelectorAll('input')\r\n  }\r\n  get() {\r\n    for (let i = this.options.length; i--; ) {\r\n      if (this.options[i].checked) {\r\n        this.set(i)\r\n        break\r\n      }\r\n    }\r\n  }\r\n  set(v: string | number) {\r\n    this.previous = this.value()\r\n    this.current_index = 'string' === typeof v ? this.values.indexOf(v) : v\r\n    if (-1 !== this.current_index) {\r\n      this.source =\r\n        this.values[this.current_index] in this.site.inputs\r\n          ? (this.site.valueOf(this.values[this.current_index]) as string)\r\n          : this.values[this.current_index]\r\n      this.options[this.current_index].checked = true\r\n    } else this.source = undefined\r\n    this.site.request_queue(this.id)\r\n  }\r\n  listen(e: MouseEvent) {\r\n    this.set((e.target as HTMLInputElement).value)\r\n  }\r\n  add(value: string, display?: string, noadd?: boolean) {\r\n    const input = document.createElement('input'),\r\n      label = document.createElement('label')\r\n    input.autocomplete = 'off'\r\n    input.className = 'btn-check'\r\n    input.type = 'radio'\r\n    input.name = this.e.id + '_options'\r\n    input.id = this.e.id + '_option' + this.e.childElementCount\r\n    input.value = value\r\n    label.innerText = display || this.site.data.format_label(value)\r\n    label.className = 'btn btn-primary'\r\n    label.dataset.for = this.e.firstElementChild.id\r\n    if (!noadd) {\r\n      this.e.appendChild(input)\r\n      this.e.appendChild(label)\r\n    }\r\n    return input\r\n  }\r\n}\r\n","import {BaseInput} from './index'\r\nimport type Community from '../index'\r\nimport type {Generic, ObjectIndex, OptionSets, ResourceField} from '../../types'\r\nimport {loader, options_filter, set_current_options} from '../common_methods'\r\n\r\nexport type SelectSpec = {\r\n  group?: string\r\n  filters?: Generic\r\n}\r\n\r\nexport class InputSelect extends BaseInput {\r\n  type: 'select' = 'select'\r\n  e: HTMLSelectElement\r\n  default: string | number\r\n  current_filter: {[index: string]: string} = {}\r\n  groups: {e: HTMLElement[]; by_name: {[index: string]: HTMLElement}}\r\n  options: HTMLOptionElement[]\r\n  values: ObjectIndex = {}\r\n  display: ObjectIndex = {}\r\n  option_sets: OptionSets = {}\r\n  current_set = ''\r\n  sensitive = false\r\n  loader?: (...args: any) => void\r\n  filter = options_filter\r\n  reformat_label = false\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    e.addEventListener('change', this.listen)\r\n    this.options = [...e.querySelectorAll('option')]\r\n    if (this.optionSource && this.site.patterns.ids.test(this.optionSource)) {\r\n      this.loader = loader.bind(this)\r\n      e.addEventListener('click', this.loader)\r\n      this.deferred = true\r\n    } else if (\r\n      'number' === typeof this.default &&\r\n      this.default > -1 &&\r\n      this.options.length &&\r\n      this.default < this.options.length\r\n    ) {\r\n      this.default = this.options[this.default].value || this.options[this.default].dataset.value\r\n    }\r\n    if (this.options.length) {\r\n      this.reformat_label = true\r\n      this.options.forEach((e, i) => {\r\n        e.dataset.value = e.value\r\n        this.values[e.value] = i\r\n        if (this.reformat_label) this.reformat_label = e.value === e.innerText\r\n      })\r\n      const group: NodeListOf<HTMLOptGroupElement> = e.querySelectorAll('optgroup')\r\n      if (group.length) {\r\n        this.groups = {e: [], by_name: {}}\r\n        group.forEach(e => {\r\n          const name = e.dataset.group\r\n          this.groups.e.push(e)\r\n          this.groups.by_name[name] = e\r\n        })\r\n      }\r\n    }\r\n  }\r\n  init() {\r\n    this.options.forEach((e, i) => {\r\n      if (this.reformat_label) e.innerText = this.site.data.format_label(e.value)\r\n      this.display[e.innerText] = i\r\n    })\r\n  }\r\n  set_current = set_current_options\r\n  get() {\r\n    this.set(this.e.selectedIndex)\r\n  }\r\n  set(v: string | number) {\r\n    if ('string' === typeof v && !(v in this.values) && this.site.patterns.number.test(v)) v = +v\r\n    if ('number' === typeof v) v = this.options[v] ? this.options[v].value : v\r\n    if (!(v in this.values) && v in this.display) v = this.options[this.display[v]].value\r\n    if (v !== this.source) {\r\n      this.e.selectedIndex = v in this.values ? this.values[v] : -1\r\n      this.source = v\r\n      this.site.request_queue(this.id)\r\n    }\r\n  }\r\n  listen(e: MouseEvent) {\r\n    this.set((e.target as HTMLSelectElement).selectedIndex)\r\n  }\r\n  add(value: string, display?: string, noadd?: boolean, meta?: ResourceField) {\r\n    const e = document.createElement('option')\r\n    e.value = value\r\n    e.innerText = display || this.site.data.format_label(value)\r\n    if (meta && meta.info) {\r\n      e.title = (meta.info.description || meta.info.short_description) as string\r\n    }\r\n    if (!noadd) this.e.appendChild(e)\r\n    this.values[value] = this.display[e.innerText] = this.options.length\r\n    this.options.push(e)\r\n    return e\r\n  }\r\n}\r\n","import {BaseInput} from './index'\r\nimport type Community from '../index'\r\nimport type {LogicalObject} from '../../types'\r\n\r\nexport type NumberSpec = {}\r\n\r\nexport class InputNumber extends BaseInput {\r\n  type: 'number' = 'number'\r\n  e: HTMLInputElement\r\n  default: string | number\r\n  source: number\r\n  parsed = {min: -Infinity, max: Infinity}\r\n  min: string | number\r\n  default_min: boolean\r\n  min_ref: number\r\n  min_indicator?: HTMLElement\r\n  max: string | number\r\n  default_max: boolean\r\n  max_ref: number\r\n  max_indicator?: HTMLElement\r\n  step?: number\r\n  current_default: number\r\n  previous: number\r\n  off_default?: boolean\r\n  value: () => number\r\n  ref: boolean\r\n  range: [number, number]\r\n  depends: LogicalObject\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    e.addEventListener('change', this.listen)\r\n    this.update = this.update.bind(this)\r\n    const up = e.parentElement.parentElement.querySelector('.number-up')\r\n    const down = e.parentElement.parentElement.querySelector('.number-down')\r\n    if (down) {\r\n      down.addEventListener('click', () => {\r\n        this.set(Math.max(this.parsed.min, this.value() - 1))\r\n      })\r\n    }\r\n    if (up) {\r\n      up.addEventListener('click', () => {\r\n        this.set(Math.min(this.parsed.max, this.value() + 1))\r\n      })\r\n    }\r\n  }\r\n  get() {\r\n    this.set(this.e.value)\r\n  }\r\n  set(v: string | number, check?: boolean) {\r\n    if (!v) v = null\r\n    if ('string' === typeof v) v = parseFloat(v)\r\n    if (isFinite(v) && v !== this.source) {\r\n      this.previous = parseFloat(this.e.value)\r\n      if (check) {\r\n        if (isFinite(this.parsed.min) && v < this.parsed.min) {\r\n          v = this.parsed.min\r\n        } else if (isFinite(this.parsed.max) && v > this.parsed.max) {\r\n          v = this.parsed.max\r\n        }\r\n      }\r\n      this.off_default = v !== this.current_default\r\n      this.source = v\r\n      this.e.value = v + ''\r\n      this.current_index = v - this.parsed.min\r\n      if ('range' === this.e.type) {\r\n        ;(this.e.nextElementSibling.firstElementChild as HTMLElement).innerText = this.e.value\r\n      }\r\n      this.site.request_queue(this.id)\r\n    }\r\n  }\r\n  listen() {\r\n    this.set(this.e.value, true)\r\n  }\r\n  async update() {\r\n    const view = this.site.dataviews[this.view],\r\n      variable = this.site.valueOf(this.variable || view.y) as string\r\n    // if (!view.time_range) view.time_range = {time: []}\r\n    let d = view.get ? view.get.dataset() : (this.site.valueOf(this.dataset) as string),\r\n      min = (this.site.valueOf(this.min) || view.time) as string | number | undefined,\r\n      max = (this.site.valueOf(this.max) || view.time) as string | number | undefined\r\n    if ('string' === typeof min && this.site.patterns.minmax.test(min))\r\n      min = (this.site.inputs[this.min] as InputNumber).min\r\n    if ('string' === typeof max && this.site.patterns.minmax.test(max))\r\n      max = (this.site.inputs[this.max] as InputNumber).max\r\n    this.parsed.min = isNaN(this.min_ref)\r\n      ? 'undefined' === typeof min\r\n        ? view.time_range.time[0]\r\n        : 'number' === typeof min\r\n        ? min\r\n        : min in this.site.data.variables\r\n        ? this.site.data.variables[min].info[d || this.site.data.variables[min].datasets[0]].min\r\n        : parseFloat(min)\r\n      : this.min_ref\r\n    this.parsed.max = isNaN(this.max_ref)\r\n      ? 'undefined' === typeof max\r\n        ? view.time_range.time[1]\r\n        : 'number' === typeof max\r\n        ? max\r\n        : max in this.site.data.variables\r\n        ? this.site.data.variables[max].info[d || this.site.data.variables[max].datasets[0]].max\r\n        : parseFloat(max)\r\n      : this.min_ref\r\n    if (this.default_min) {\r\n      this.current_default = this.parsed.min\r\n    } else if (this.default_max) {\r\n      this.current_default = this.parsed.max\r\n    }\r\n    if (this.ref && variable in this.site.data.variables) {\r\n      this.range[0] = isNaN(this.min_ref) ? Math.max(view.time_range.time[0], this.parsed.min) : this.min_ref\r\n      this.e.min = this.range[0] + ''\r\n      this.range[1] = isNaN(this.max_ref) ? Math.min(view.time_range.time[1], this.parsed.max) : this.max_ref\r\n      this.e.max = this.range[1] + ''\r\n      if (!this.depends[view.y]) {\r\n        this.depends[view.y] = true\r\n        this.site.add_dependency(view.y, {type: 'update', id: this.id})\r\n      }\r\n      if (this.source > this.parsed.max || this.source < this.parsed.min) this.reset()\r\n      // this.variable = await this.site.data.get_variable(variable, this.view)\r\n    } else {\r\n      this.e.min = this.parsed.min + ''\r\n      if (this.parsed.min > this.source || (!this.source && this.default_min)) this.set(this.parsed.min)\r\n      this.e.max = this.parsed.max + ''\r\n      if (this.parsed.max < this.source || (!this.source && this.default_max)) this.set(this.parsed.max)\r\n    }\r\n  }\r\n}\r\n","import type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport class InputRadio extends BaseInput {\r\n  type: 'radio' = 'radio'\r\n  options: NodeListOf<HTMLInputElement>\r\n  values: (string | number)[] = []\r\n  source: string | number\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    this.options = e.querySelectorAll('input')\r\n    this.options.forEach(o => {\r\n      this.values.push(o.value)\r\n      o.addEventListener('click', this.listen)\r\n    })\r\n    if ('number' === typeof this.default && this.options[this.default]) this.default = this.values[this.default]\r\n  }\r\n  get() {\r\n    for (let i = this.options.length; i--; ) {\r\n      if (this.options[i].checked) {\r\n        this.set(i)\r\n        break\r\n      }\r\n    }\r\n  }\r\n  set(v: string | number) {\r\n    this.current_index = 'string' === typeof v ? this.values.indexOf(v) : v\r\n    if (-1 !== this.current_index) {\r\n      this.source =\r\n        this.values[this.current_index] in this.site.inputs\r\n          ? (this.site.valueOf(this.values[this.current_index]) as string)\r\n          : this.values[this.current_index]\r\n      this.options[this.current_index].checked = true\r\n    } else this.source = undefined\r\n    this.site.request_queue(this.id)\r\n  }\r\n  listen(e: MouseEvent) {\r\n    this.set((e.target as HTMLInputElement).value)\r\n  }\r\n  add(value: string, display?: string, noadd?: boolean) {\r\n    const e = document.createElement('div'),\r\n      s = 'TRUE' === this.e.dataset.switch,\r\n      input = document.createElement('input'),\r\n      label = document.createElement('label')\r\n    e.className = 'form-check' + (s ? ' form-switch' : '')\r\n    e.appendChild(input)\r\n    e.appendChild(label)\r\n    input.autocomplete = 'off'\r\n    input.className = 'form-check-input'\r\n    if (s) input.role = 'switch'\r\n    input.type = 'radio'\r\n    input.name = this.e.id + '_options'\r\n    input.id = this.e.id + '_option' + this.e.childElementCount\r\n    input.value = value\r\n    label.innerText = display || this.site.data.format_label(value)\r\n    label.className = 'form-check-label'\r\n    label.setAttribute('for', e.firstElementChild.id)\r\n    if (!noadd) this.e.appendChild(e)\r\n    return input\r\n  }\r\n}\r\n","import type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport class InputSwitch extends BaseInput {\r\n  type: 'switch' = 'switch'\r\n  e: HTMLInputElement\r\n  source: boolean\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    e.addEventListener('change', this.listen)\r\n  }\r\n  get() {\r\n    this.set(this.e.checked)\r\n  }\r\n  set(v: string | boolean) {\r\n    if ('string' === typeof v) v = 'on' === v || 'true' === v\r\n    if (v !== this.source) {\r\n      this.previous = this.e.checked\r\n      this.e.checked = this.source = v\r\n      this.site.request_queue(this.id)\r\n    }\r\n  }\r\n  listen(e: MouseEvent) {\r\n    this.set(this.e.checked)\r\n  }\r\n}\r\n","import type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport class InputCheckbox extends BaseInput {\r\n  type: 'checkbox' = 'checkbox'\r\n  options: NodeListOf<HTMLInputElement>\r\n  values: (string | number)[] = []\r\n  source: (string | number)[]\r\n  current_index: number[]\r\n  off_default: boolean\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    this.options = e.querySelectorAll('input')\r\n    this.options.forEach(o => {\r\n      this.values.push(o.value)\r\n      o.addEventListener('click', this.listen)\r\n    })\r\n    if ('string' === typeof this.default) this.default = this.default.split(',')\r\n    this.get()\r\n  }\r\n  get() {\r\n    this.source = []\r\n    this.current_index = []\r\n    this.off_default = false\r\n    this.options.forEach((o, i) => {\r\n      if (o.checked) {\r\n        this.source.push(this.values[i])\r\n        this.current_index.push(i)\r\n      } else {\r\n        this.off_default = true\r\n      }\r\n    })\r\n    this.site.request_queue(this.id)\r\n  }\r\n  set(v: string | number | (string | number)[]) {\r\n    if (Array.isArray(v)) {\r\n      this.source = []\r\n      this.current_index = []\r\n      this.off_default = false\r\n      this.values.forEach((cv, i) => {\r\n        if (-1 !== v.indexOf(cv)) {\r\n          this.source.push(cv)\r\n          this.current_index.push(i)\r\n          this.options[i].checked = true\r\n        } else {\r\n          this.off_default = true\r\n          this.options[i].checked = false\r\n        }\r\n      })\r\n    } else {\r\n      if ('string' === typeof v) {\r\n        this.set('' === v ? this.values : v.split(','))\r\n        return\r\n      } else {\r\n        if (-1 !== v) {\r\n          this.options[v].checked = true\r\n          this.off_default = false\r\n          this.options.forEach(o => {\r\n            if (!o.checked) this.off_default = true\r\n          })\r\n        }\r\n      }\r\n    }\r\n    this.site.request_queue(this.id)\r\n  }\r\n  listen(e: MouseEvent) {\r\n    const input = e.target as HTMLInputElement\r\n    if (input.checked) {\r\n      this.source.push(input.value)\r\n      this.current_index.push(this.values.indexOf(input.value))\r\n      this.off_default = false\r\n      this.options.forEach(o => {\r\n        if (!o.checked) this.off_default = true\r\n      })\r\n    } else {\r\n      let i = this.source.indexOf(input.value)\r\n      if (i !== -1) {\r\n        this.off_default = true\r\n        this.source.splice(i, 1)\r\n        this.current_index.splice(i, 1)\r\n      }\r\n    }\r\n    this.site.request_queue(this.id)\r\n  }\r\n  add(value: string, display?: string, noadd?: boolean) {\r\n    const e = document.createElement('div'),\r\n      s = 'TRUE' === this.e.dataset.switch,\r\n      input = document.createElement('input'),\r\n      label = document.createElement('label')\r\n    e.className = 'form-check' + (s ? ' form-switch' : '')\r\n    e.appendChild(input)\r\n    e.appendChild(label)\r\n    input.autocomplete = 'off'\r\n    input.className = 'form-check-input'\r\n    if (s) input.role = 'switch'\r\n    input.type = 'checkbox'\r\n    input.name = this.e.id + '_options'\r\n    input.id = this.e.id + '_option' + this.e.childElementCount\r\n    input.value = value\r\n    label.innerText = display || this.site.data.format_label(value)\r\n    label.className = 'form-check-label'\r\n    label.setAttribute('for', e.firstElementChild.id)\r\n    if (!noadd) this.e.appendChild(e)\r\n    return input\r\n  }\r\n}\r\n","import type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport class InputText extends BaseInput {\r\n  type: 'text' = 'text'\r\n  default: string | number\r\n  e: HTMLInputElement\r\n  source: string\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    e.addEventListener('change', this.listen)\r\n  }\r\n  get() {\r\n    this.set(this.e.value)\r\n  }\r\n  set(v: string) {\r\n    this.previous = this.e.checked\r\n    this.e.value = this.source = v\r\n    this.site.request_queue(this.id)\r\n  }\r\n  listen(e: MouseEvent) {\r\n    this.set(this.e.value)\r\n  }\r\n}\r\n","import type {\r\n  Circle,\r\n  Control,\r\n  FeatureGroup,\r\n  GeoJSONOptions,\r\n  Layer,\r\n  LeafletEvent,\r\n  LeafletMouseEvent,\r\n  Map,\r\n  Polygon,\r\n} from 'leaflet'\r\nimport DataHandler from '../../data_handler/index'\r\nimport type {Entity, Generic, MeasureInfo, Summary} from '../../types'\r\nimport Community, {Dependency} from '../index'\r\nimport {BaseOutput} from './index'\r\nimport type {SiteDataView} from '../dataview'\r\nimport {palettes} from '../palettes'\r\nimport type {InputNumber} from '../inputs/number'\r\nimport {fill_overlay_properties_options} from '../utils'\r\nimport type {SiteInputs} from '../inputs/index'\r\n\r\ntype LayerSource = {\r\n  name?: string\r\n  url: string\r\n  time?: number\r\n  id_property?: string\r\n  processed?: boolean\r\n  property_summaries?: {}\r\n}\r\nexport type MapLayer = {\r\n  name?: string\r\n  url: string\r\n  id_property?: string\r\n  time?: number | string\r\n  retrieved?: boolean\r\n  processed?: boolean\r\n  property_summaries?: {\r\n    [index: string]: [number, number, number]\r\n  }\r\n  callbacks?: Function[]\r\n}\r\ntype Tiles = {url: string; options?: {[index: string]: any}}\r\ntype Options = {[index: string]: boolean | number | string | (number | string)[]}\r\ntype LayerFilter = {\r\n  feature: string\r\n  operator: string\r\n  value: string\r\n  check?: Function\r\n}\r\ntype Overlay = {\r\n  variable: string\r\n  source: string | LayerSource[]\r\n  filter?: LayerFilter | LayerFilter[]\r\n}\r\nexport type MapSpec = {\r\n  shapes?: MapLayer[]\r\n  overlays?: Overlay[]\r\n  options: Options\r\n  tiles?: Tiles | {light: Tiles; dark: Tiles}\r\n}\r\n\r\nexport type MeasureLayer = {\r\n  source?: string | LayerSource[]\r\n  filter?: LayerFilter[]\r\n}\r\n\r\ntype MapParsed = {\r\n  dataset?: string\r\n  color?: string\r\n  time?: number\r\n  view?: SiteDataView\r\n  palette?: string\r\n  summary?: Summary\r\n}\r\n\r\nexport class OutputMap extends BaseOutput {\r\n  type: 'map' = 'map'\r\n  time: string\r\n  parsed: MapParsed = {}\r\n  clickto?: SiteInputs\r\n  layers: {[index: string]: FeatureGroup} = {}\r\n  overlays: Overlay[] = []\r\n  map: Map\r\n  overlay: FeatureGroup<Layer>\r\n  displaying: FeatureGroup<Layer>\r\n  overlay_control: Control\r\n  tiles: {[index: string]: any} = {}\r\n  fresh_shapes = false\r\n  has_time = false\r\n  by_time: number[] = []\r\n  queue: number | NodeJS.Timeout\r\n  spec: MapSpec\r\n  options: Options\r\n  triggers: {[index: string]: MeasureLayer} = {}\r\n  vstate = ''\r\n  cstate = ''\r\n  reference_options: Generic = {}\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.queue_init = this.queue_init.bind(this)\r\n    this.mouseover = this.mouseover.bind(this)\r\n    this.mouseout = this.mouseout.bind(this)\r\n    this.click = this.click.bind(this)\r\n    this.show_overlay = this.show_overlay.bind(this)\r\n    this.color = this.e.dataset.color\r\n    this.options = this.spec.options\r\n    Object.keys(this.options).forEach(k => {\r\n      const opt = this.options[k]\r\n      if ('string' === typeof opt && opt in site.inputs) this.reference_options[k] = opt\r\n    })\r\n    if (!this.e.style.height) this.e.style.height = this.options.height ? (this.options.height as string) : '400px'\r\n  }\r\n  init() {\r\n    const dep: Dependency = {type: 'update', id: this.id},\r\n      view = this.site.dataviews[this.view]\r\n    if (view) {\r\n      if (view.time_agg in this.site.inputs) this.site.add_dependency(view.time_agg as string, dep)\r\n      if (view.y) this.site.add_dependency(view.y, dep)\r\n    } else this.view = this.site.defaults.dataview\r\n    this.site.add_dependency(this.view, dep)\r\n    if (this.color in this.site.inputs) this.site.add_dependency(this.color, dep)\r\n    if (this.time) this.site.add_dependency(this.time, dep)\r\n    const click_ref = this.e.dataset.click\r\n    if (click_ref in this.site.inputs) this.clickto = this.site.inputs[click_ref]\r\n    if (this.options.overlays_from_measures && this.site.data.variable_info) {\r\n      if (Array.isArray(this.spec.overlays)) this.overlays = this.spec.overlays\r\n      Object.keys(this.site.data.variable_info).forEach(variable => {\r\n        const info = this.site.data.variable_info[variable] as MeasureInfo\r\n        if (info.layer && info.layer.source) {\r\n          const source: {url: string; time: number}[] = [],\r\n            layer: Overlay = {variable: variable, source: source}\r\n          if ('string' === typeof info.layer.source && this.site.patterns.time_ref.test(info.layer.source)) {\r\n            const temp = info.layer.source\r\n            for (\r\n              let range = this.site.data.meta.ranges[variable], y = range[0], max = range[1] + 1, time;\r\n              y < max;\r\n              y++\r\n            ) {\r\n              time = this.site.data.meta.overall.value[y]\r\n              source.push({url: temp.replace(this.site.patterns.time_ref, time + ''), time: time})\r\n            }\r\n          }\r\n          this.site.patterns.time_ref.lastIndex = 0\r\n          if (info.layer.filter && (Array.isArray(info.layer.filter) || 'feature' in info.layer.filter))\r\n            layer.filter = info.layer.filter\r\n          this.overlays.push(layer)\r\n        }\r\n      })\r\n    }\r\n    this.queue_init()\r\n  }\r\n  queue_init() {\r\n    const theme = this.site.spec.settings.theme_dark ? 'dark' : 'light',\r\n      showing = this.deferred || !this.tab || this.tab.classList.contains('show')\r\n    if (showing && window.L) {\r\n      this.map = window.L.map(this.e, this.options)\r\n      this.overlay = window.L.featureGroup().addTo(this.map)\r\n      this.displaying = window.L.featureGroup().addTo(this.map)\r\n      this.overlay_control = window.L.control\r\n        .layers()\r\n        .setPosition('topleft')\r\n        .addOverlay(this.overlay, 'Overlay')\r\n        .addTo(this.map)\r\n      const tiles = this.spec.tiles\r\n      if (tiles) {\r\n        if ('url' in tiles) {\r\n          this.tiles[theme] = window.L.tileLayer(tiles.url, tiles.options)\r\n          this.tiles[theme].addTo(this.map)\r\n        } else {\r\n          Object.keys(tiles).forEach((k: 'dark' | 'light') => {\r\n            this.tiles[k] = window.L.tileLayer(tiles[k].url, tiles[k].options)\r\n            if (theme === k) this.tiles[k].addTo(this.map)\r\n          })\r\n        }\r\n      }\r\n      const time = this.site.data.meta.overall.value[this.site.dataviews[this.view].parsed.time_agg]\r\n      this.spec.shapes.forEach((shape: MapLayer, i: number) => {\r\n        const has_time = 'time' in shape\r\n        if (has_time) {\r\n          if (!this.has_time) {\r\n            this.has_time = true\r\n            this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n          }\r\n          this.by_time.push(+shape.time)\r\n        }\r\n        let k = shape.name\r\n        if (!k) shape.name = k = this.site.spec.metadata.datasets[i < this.site.spec.metadata.datasets.length ? i : 0]\r\n        const mapId = k + (has_time ? shape.time : '')\r\n        if (!(mapId in this.site.maps.queue)) this.site.maps.queue[mapId] = shape\r\n        this.site.data.inited[mapId + this.id] = false\r\n        if (\r\n          (this.site.data.loaded[k] || k === this.site.spec.settings.background_shapes) &&\r\n          (k === mapId || (time && this.by_time.length && shape.time == this.match_time(time)))\r\n        )\r\n          this.retrieve_layer(shape)\r\n      })\r\n      if (this.has_time) this.by_time.sort()\r\n      if (Array.isArray(this.overlays)) {\r\n        this.overlays.forEach(l => {\r\n          if ('string' === typeof l.source) l.source = [{url: l.source}]\r\n          const source = l.source\r\n          source.forEach(s => {\r\n            s.processed = false\r\n            s.property_summaries = {}\r\n            this.site.maps.queue[s.url] = s\r\n          })\r\n          this.triggers[l.variable] = {source}\r\n          const fs = l.filter\r\n          if (fs) {\r\n            const fa = Array.isArray(fs) ? fs : [fs]\r\n            this.triggers[l.variable].filter = fa\r\n            fa.forEach(f => {\r\n              f.check = DataHandler.checks[f.operator]\r\n            })\r\n          }\r\n        })\r\n      }\r\n      this.update()\r\n    } else {\r\n      this.deferred = true\r\n      setTimeout(this.queue_init, showing ? 0 : 2000)\r\n    }\r\n  }\r\n  match_time(time: number) {\r\n    let i = this.by_time.length\r\n    for (; i--; ) if (!i || this.by_time[i] <= time) break\r\n    return this.by_time[i]\r\n  }\r\n  show(e: Entity) {\r\n    if (e.layer && e.layer[this.id]) {\r\n      const highlight_style = {\r\n          color: 'var(--border-highlight)',\r\n          weight: (this.site.spec.settings.polygon_outline as number) + 1,\r\n          fillOpacity: 1,\r\n        },\r\n        layer = e.layer[this.id]\r\n      if ('has_time' in layer) {\r\n        if (!this.site.data.inited[this.parsed.dataset + this.id]) {\r\n          const time = this.match_time(\r\n            this.site.data.meta.overall.value[\r\n              this.site.data.variables[this.parsed.color].time_range[this.parsed.dataset][0] + this.parsed.time\r\n            ]\r\n          )\r\n          if (layer[time]) (layer[time] as Polygon).setStyle(highlight_style)\r\n        }\r\n      } else if (layer.setStyle) {\r\n        layer.setStyle(highlight_style)\r\n      }\r\n    }\r\n  }\r\n  revert(e: Entity) {\r\n    if (e.layer && e.layer[this.id]) {\r\n      const default_style = {\r\n          color: 'var(--border)',\r\n          weight: this.site.spec.settings.polygon_outline as number,\r\n          fillOpacity: 0.7,\r\n        },\r\n        layer = e.layer[this.id]\r\n      if ('has_time' in layer) {\r\n        if (!this.site.data.inited[this.parsed.dataset + this.id]) {\r\n          const time = this.match_time(\r\n            this.site.data.meta.overall.value[\r\n              this.site.data.variables[this.parsed.color].time_range[this.parsed.dataset][0] + this.parsed.time\r\n            ]\r\n          )\r\n          if (layer[time]) (layer[time] as Polygon).setStyle(default_style)\r\n        }\r\n      } else {\r\n        layer.setStyle(default_style)\r\n      }\r\n    }\r\n  }\r\n  mouseover(e: LeafletEvent) {\r\n    e.target.setStyle({\r\n      color: 'var(--border-highlight)',\r\n    })\r\n    this.site.subs.update(\r\n      this.id,\r\n      'show',\r\n      this.site.data.entities[e.target.feature.properties[e.target.source.id_property]]\r\n    )\r\n  }\r\n  mouseout(e: LeafletEvent) {\r\n    this.site.subs.update(\r\n      this.id,\r\n      'revert',\r\n      this.site.data.entities[e.target.feature.properties[e.target.source.id_property]]\r\n    )\r\n    e.target.setStyle({\r\n      color: 'var(--border)',\r\n    })\r\n  }\r\n  click(e: LeafletEvent) {\r\n    if (this.clickto) this.clickto.set(e.target.feature.properties[e.target.source.id_property])\r\n  }\r\n  async update(entity?: Entity, caller?: SiteInputs, pass?: boolean) {\r\n    if ((this.queue as number) > 0) clearTimeout(this.queue)\r\n    this.queue = -1\r\n    if (!pass) {\r\n      if (!this.tab || this.tab.classList.contains('show'))\r\n        this.queue = setTimeout(() => this.update(void 0, void 0, true), 50)\r\n    } else {\r\n      if (this.view && this.displaying) {\r\n        const parsed = this.parsed,\r\n          view = this.site.dataviews[this.view],\r\n          d = view.get.dataset(),\r\n          time = this.site.valueOf(view.time_agg),\r\n          map_time = this.has_time ? this.match_time(time as number) : '',\r\n          inited = d + map_time + this.id in this.site.data.inited,\r\n          mapId = inited ? d + map_time : d\r\n        if (this.site.maps.queue && mapId in this.site.maps.queue && !this.site.data.inited[mapId + this.id]) {\r\n          if (!inited || null !== time)\r\n            this.retrieve_layer(this.site.maps.queue[mapId], () => this.update(void 0, void 0, true))\r\n          return\r\n        }\r\n        if (!view.valid[d] && this.site.data.inited[d]) {\r\n          view.state = ''\r\n          view.update()\r\n        }\r\n        parsed.view = view\r\n        parsed.dataset = d\r\n        const vstate =\r\n            view.value() +\r\n            mapId +\r\n            this.site.spec.settings.background_shapes +\r\n            this.site.spec.settings.background_top +\r\n            this.site.spec.settings.background_polygon_outline +\r\n            this.site.data.inited[this.options.background_shapes as string],\r\n          a = view.selection.all,\r\n          s =\r\n            view.selection[this.site.spec.settings.background_shapes && this.options.background_shapes ? 'ids' : 'all'],\r\n          c = this.site.valueOf(this.color || view.y) as string\r\n        if (this.site.spec.settings.map_overlay && c in this.triggers) {\r\n          this.show_overlay(this.triggers[c], this.site.data.meta.overall.value[view.parsed.time_agg])\r\n        } else {\r\n          this.overlay_control.remove()\r\n          this.overlay.clearLayers()\r\n        }\r\n        if (this.site.data.inited[mapId + this.id] && view.valid[d]) {\r\n          const ys = this.time\r\n              ? (this.site.inputs[this.time] as InputNumber)\r\n              : view.time_agg\r\n              ? view.time_agg in this.site.inputs\r\n                ? (this.site.inputs[view.time_agg] as InputNumber)\r\n                : parseInt(view.time_agg as string)\r\n              : 0,\r\n            time_input = 'number' !== typeof ys\r\n          parsed.palette = (this.site.valueOf(view.palette) || this.site.spec.settings.palette) as string\r\n          if (!(parsed.palette in palettes)) parsed.palette = this.site.defaults.palette\r\n          const varc = await this.site.data.get_variable(c, this.site.dataviews[this.view]),\r\n            summary = varc.views[this.view].summaries[d],\r\n            time =\r\n              (time_input && ys.parsed ? (ys.value() as number) - this.site.data.meta.times[d].range[0] : 0) -\r\n              varc.time_range[d][0]\r\n          parsed.summary = summary\r\n          parsed.time = time\r\n          parsed.color = c\r\n          const subset = !time_input && summary.n[ys] === view.n_selected.dataset ? 'rank' : 'subset_rank'\r\n          if (vstate !== this.vstate) {\r\n            ;(this.map as any)._zoomAnimated = 'none' !== this.site.spec.settings.map_animations\r\n            Object.keys(this.reference_options).forEach(k => {\r\n              this.options[k] = this.site.valueOf(this.reference_options[k])\r\n              if ('zoomAnimation' === k) (this.map as any)._zoomAnimated = this.options[k]\r\n            })\r\n            this.displaying.clearLayers()\r\n            this.fresh_shapes = true\r\n            this.vstate = ''\r\n            let n = 0\r\n            Object.keys(s).forEach(k => {\r\n              const skl = s[k].layer && s[k].layer[this.id]\r\n              if (skl) {\r\n                const fg = k in a,\r\n                  cl = 'has_time' in skl ? (skl[map_time] as Polygon) : skl\r\n                if (cl && (fg || this.options.background_shapes === this.site.data.entities[k].group)) {\r\n                  n++\r\n                  ;(cl.options as GeoJSONOptions).interactive = fg\r\n                  cl.addTo(this.displaying)\r\n                  if (fg) {\r\n                    if (this.site.spec.settings.background_top) cl.bringToBack()\r\n                  } else {\r\n                    if (!this.site.spec.settings.background_top) cl.bringToBack()\r\n                    cl.setStyle({\r\n                      fillOpacity: 0,\r\n                      color: 'var(--border-highlight)',\r\n                      weight: this.site.spec.settings.background_polygon_outline as number,\r\n                    })\r\n                  }\r\n                  if (!this.vstate) this.vstate = vstate\r\n                }\r\n              }\r\n            })\r\n            this.overlay.bringToFront()\r\n            if (n)\r\n              if ('fly' === this.site.spec.settings.map_animations) {\r\n                setTimeout(() => this.map.flyToBounds(this.displaying.getBounds()), 400)\r\n              } else {\r\n                this.map.fitBounds(this.displaying.getBounds())\r\n              }\r\n          }\r\n\r\n          // coloring\r\n          const k =\r\n            c +\r\n            this.vstate +\r\n            parsed.palette +\r\n            time +\r\n            this.site.spec.settings.polygon_outline +\r\n            this.site.spec.settings.color_by_order +\r\n            this.site.spec.settings.color_scale_center\r\n          if (k !== this.cstate) {\r\n            this.cstate = k\r\n            const ls = (this.displaying as any)._layers\r\n            const n = summary.n[time]\r\n            Object.keys(ls).forEach(id => {\r\n              const lsi = ls[id]\r\n              if (d === lsi.entity.group) {\r\n                const e = a[lsi.entity.features.id],\r\n                  es = e && e.views[this.view][subset]\r\n                lsi.setStyle({\r\n                  fillOpacity: 0.7,\r\n                  color: 'var(--border)',\r\n                  fillColor:\r\n                    e && c in es\r\n                      ? this.site.get_color(e.get_value(c, time), parsed.palette, summary, time, es[c][time], n)\r\n                      : this.site.defaults.missing,\r\n                  weight: this.site.spec.settings.polygon_outline,\r\n                })\r\n              }\r\n            })\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  async retrieve_layer(source: MapLayer, callback?: Function) {\r\n    const mapId = source.name ? source.name + (source.time || '') : source.url\r\n    if (!('_raw' in this.site.spec.map)) this.site.spec.map._raw = {}\r\n    if (source.url in this.site.spec.map._raw) {\r\n      this.process_layer(source)\r\n      this.site.maps.queue[mapId].retrieved = true\r\n      callback && callback()\r\n    } else {\r\n      if (this.site.maps.queue[mapId] && 'retrieved' in this.site.maps.queue[mapId]) {\r\n        if (callback) {\r\n          if (!this.site.maps.queue[mapId].callbacks) this.site.maps.queue[mapId].callbacks = []\r\n          this.site.maps.queue[mapId].callbacks.push(callback)\r\n        }\r\n      } else {\r\n        this.site.maps.queue[mapId].retrieved = false\r\n        const f = new window.XMLHttpRequest()\r\n        f.onreadystatechange = () => {\r\n          if (4 === f.readyState && 200 === f.status) {\r\n            this.site.spec.map._raw[source.url] = f.responseText\r\n            if (source.name) {\r\n              this.site.maps.queue[mapId].retrieved = true\r\n            }\r\n            if (this.site.maps.queue[mapId].callbacks) {\r\n              if (callback) this.site.maps.queue[mapId].callbacks.push(callback)\r\n              this.site.maps.queue[mapId].callbacks.forEach(f => f())\r\n            } else callback && callback()\r\n          }\r\n        }\r\n        f.open('GET', source.url, true)\r\n        f.send()\r\n      }\r\n    }\r\n  }\r\n  process_layer(source: MapLayer) {\r\n    const has_time = 'time' in source,\r\n      layerId = source.name + (has_time ? source.time : '')\r\n    this.layers[layerId] = window.L.geoJSON(JSON.parse(this.site.spec.map._raw[source.url]), {\r\n      onEachFeature: (f, l: Polygon) => {\r\n        l.on({\r\n          mouseover: this.mouseover,\r\n          mouseout: this.mouseout,\r\n          click: this.click,\r\n        })\r\n        l.setStyle({weight: 0, fillOpacity: 0})\r\n        ;(l as any).source = source\r\n        const p = l.feature.properties\r\n        let id = p[source.id_property]\r\n        if (!(id in this.site.data.entities) && this.site.patterns.leading_zeros.test(id))\r\n          id = p[source.id_property] = id.replace(this.site.patterns.leading_zeros, '')\r\n        if (!(id in this.site.data.entities)) {\r\n          this.site.data.entities[id] = {layer: {}, features: {id: id}}\r\n        }\r\n        const entity = this.site.data.entities[id]\r\n        if (!('layer' in entity)) entity.layer = {}\r\n        if (has_time) {\r\n          if (!(this.id in entity.layer)) entity.layer[this.id] = {has_time: true}\r\n          ;(entity.layer[this.id] as {[index: string]: Polygon})[source.time as string] = l\r\n        } else entity.layer[this.id] = l\r\n        ;(l as any).entity = entity\r\n        if (entity.features)\r\n          Object.keys(p).forEach(f => {\r\n            if (!(f in entity.features)) {\r\n              if (\r\n                'name' === f.toLowerCase() &&\r\n                (!('name' in entity.features) || entity.features.id === entity.features.name)\r\n              ) {\r\n                entity.features[f.toLowerCase()] = p[f]\r\n              } else {\r\n                entity.features[f] = p[f]\r\n              }\r\n            }\r\n          })\r\n      },\r\n    })\r\n    this.site.data.inited[layerId + this.id] = true\r\n    if (this.site.maps.waiting && this.site.maps.waiting[source.name]) {\r\n      for (let i = this.site.maps.waiting[source.name].length; i--; ) {\r\n        this.site.request_queue(this.site.maps.waiting[source.name][i])\r\n      }\r\n    }\r\n  }\r\n  show_overlay(o: MeasureLayer, time: number) {\r\n    let i = 0,\r\n      source = ''\r\n    if ('string' === typeof o.source) {\r\n      source = o.source\r\n    } else {\r\n      for (i = o.source.length; i--; ) {\r\n        if (!o.source[i].time || time === o.source[i].time) {\r\n          if (o.source[i].name) delete o.source[i].name\r\n          source = o.source[i].url\r\n          break\r\n        }\r\n      }\r\n    }\r\n    if (source) {\r\n      if (source in this.site.spec.map._raw) {\r\n        if (!(source in this.layers)) {\r\n          const property_summaries: {[index: string]: [number, number, number]} = {}\r\n          if (!this.site.maps.queue[source].processed) {\r\n            this.site.maps.queue[source].property_summaries = property_summaries\r\n          }\r\n          this.layers[source] = window.L.geoJSON(JSON.parse(this.site.spec.map._raw[source]), {\r\n            pointToLayer: (point, coords) => window.L.circleMarker(coords),\r\n            onEachFeature: l => {\r\n              const props = l.properties\r\n              if (props) {\r\n                Object.keys(props).forEach(f => {\r\n                  const v = props[f]\r\n                  if ('number' === typeof v) {\r\n                    if (!(f in property_summaries)) property_summaries[f] = [Infinity, -Infinity, 0]\r\n                    if (v < property_summaries[f][0]) property_summaries[f][0] = v\r\n                    if (v > property_summaries[f][1]) property_summaries[f][1] = v\r\n                  }\r\n                })\r\n              }\r\n            },\r\n          }).on('mouseover', (l: LeafletMouseEvent) => {\r\n            const layer = l.propagatedFrom\r\n            if (layer && !layer._tooltip) {\r\n              const props = layer.feature && layer.feature.properties\r\n              if (props) {\r\n                const e = document.createElement('table')\r\n                Object.keys(props).forEach(f => {\r\n                  const v = props[f],\r\n                    tr = document.createElement('tr')\r\n                  let td = document.createElement('td')\r\n                  tr.appendChild(td)\r\n                  td.innerText = f\r\n                  tr.appendChild((td = document.createElement('td')))\r\n                  td.innerText = v\r\n                  e.appendChild(tr)\r\n                })\r\n                layer.bindTooltip(e)\r\n                layer.openTooltip()\r\n              }\r\n            }\r\n          })\r\n          Object.keys(property_summaries).forEach(f => {\r\n            property_summaries[f][2] = property_summaries[f][1] - property_summaries[f][0]\r\n            if (!property_summaries[f][2]) delete property_summaries[f]\r\n          })\r\n          this.site.maps.overlay_property_selectors.forEach(u => {\r\n            if (!(source in u.option_sets)) {\r\n              fill_overlay_properties_options(u, source, u.option_sets)\r\n              u.dataset = source\r\n              u.variable = ''\r\n            }\r\n          })\r\n        }\r\n        this.site.maps.overlay_property_selectors.forEach(u => {\r\n          u.dataset = source\r\n          this.site.conditionals.options(u)\r\n        })\r\n        this.overlay.clearLayers()\r\n        let n = 0\r\n        const summaries = this.site.spec.settings.circle_property && this.site.maps.queue[source].property_summaries,\r\n          prop_summary = summaries && summaries[this.site.spec.settings.circle_property as string]\r\n        this.layers[source].eachLayer((l: Circle) => {\r\n          if (o.filter) {\r\n            for (let i = o.filter.length; i--; ) {\r\n              if (!o.filter[i].check(l.feature.properties[o.filter[i].feature], o.filter[i].value)) return\r\n            }\r\n          }\r\n          n++\r\n          l.setRadius(\r\n            prop_summary\r\n              ? ((l.feature.properties[this.site.spec.settings.circle_property as string] - prop_summary[0]) /\r\n                  prop_summary[2] +\r\n                  0.5) *\r\n                  (this.site.spec.settings.circle_radius as number)\r\n              : (this.site.spec.settings.circle_radius as number)\r\n          ).setStyle({\r\n            weight: this.site.spec.settings.polygon_outline as number,\r\n            color: 'white',\r\n            opacity: 0.5,\r\n            fillOpacity: 0.5,\r\n            fillColor: 'black',\r\n          })\r\n          l.addTo(this.overlay)\r\n        })\r\n        if (n) this.overlay_control.addTo(this.map)\r\n      } else return this.retrieve_layer(o.source[i] as LayerSource, () => this.show_overlay(o, time))\r\n    }\r\n  }\r\n}\r\n","import type {SiteInputs} from '../inputs/index'\r\nimport {BaseOutput} from './index'\r\nimport Community from '../index'\r\nimport {Entity, Summary} from '../../types'\r\nimport type {Layout, Config, Data, PlotData, PlotlyHTMLElement} from 'plotly.js'\r\nimport {SiteDataView} from '../dataview'\r\n\r\nexport type PlotlySpec = {\r\n  [index: string]: Layout | Config | Data | string[] | string\r\n  layout: Layout\r\n  config: Config\r\n  data: Data\r\n  subto?: string[]\r\n}\r\n\r\ntype PlotlyTrace = {\r\n  x?: number[]\r\n  y?: number[]\r\n  line?: {color: string}\r\n  median?: number[]\r\n  q3?: number[]\r\n  q1?: number[]\r\n  upperfence: number[]\r\n  lowerfence: number[]\r\n}\r\n\r\nexport class OutputPlotly extends BaseOutput {\r\n  type: 'plotly' = 'plotly'\r\n  e: PlotlyHTMLElement\r\n  dark_theme: boolean\r\n  clickto?: SiteInputs\r\n  previous_span = 1\r\n  base_trace?: string\r\n  traces: {[index: string]: string} = {}\r\n  parsed: {\r\n    x?: string\r\n    y?: string\r\n    dataset?: string\r\n    color?: string\r\n    palette?: string\r\n    time?: number\r\n    base_trace?: string\r\n    summary?: Summary\r\n    y_range?: number[]\r\n    x_range?: number[]\r\n    view?: SiteDataView\r\n  } = {}\r\n  style?: Layout\r\n  time: string\r\n  spec: PlotlySpec\r\n  queue: number | NodeJS.Timeout = -1\r\n  state: string = ''\r\n  reference_options: {[index: string]: string} = {}\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.queue_init = this.queue_init.bind(this)\r\n    this.mouseover = this.mouseover.bind(this)\r\n    this.mouseout = this.mouseout.bind(this)\r\n    this.click = this.click.bind(this)\r\n    this.x = e.dataset.x\r\n    this.y = e.dataset.y\r\n    this.color = e.dataset.color\r\n    this.time = e.dataset.colorTime\r\n    Object.keys(this.spec).forEach(k => {\r\n      const opt = this.spec[k]\r\n      if ('string' === typeof opt && opt in site.inputs) this.reference_options[k] = opt\r\n    })\r\n    if (this.tab) {\r\n      document.getElementById(e.parentElement.getAttribute('aria-labelledby')).addEventListener(\r\n        'click',\r\n        function (this: OutputPlotly) {\r\n          if (!this.e.parentElement.classList.contains('active')) {\r\n            setTimeout(this.update, 155)\r\n            setTimeout(this.site.page.trigger_resize, 155)\r\n          }\r\n        }.bind(this)\r\n      )\r\n    }\r\n  }\r\n  init() {\r\n    if (this.x && !(this.x in this.site.data.variables)) {\r\n      this.site.add_dependency(this.x, {type: 'update', id: this.id})\r\n    }\r\n    if (this.y && !(this.y in this.site.data.variables)) {\r\n      this.site.add_dependency(this.y, {type: 'update', id: this.id})\r\n    }\r\n    if (this.color && !(this.color in this.site.data.variables)) {\r\n      this.site.add_dependency(this.color, {type: 'update', id: this.id})\r\n    }\r\n    if (this.time in this.site.inputs) {\r\n      this.site.add_dependency(this.time, {type: 'update', id: this.id})\r\n    }\r\n    if (this.view) {\r\n      this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n      this.site.add_dependency(this.view + '_filter', {type: 'update', id: this.id})\r\n      if (this.site.dataviews[this.view].time_agg in this.site.dataviews)\r\n        this.site.add_dependency(this.site.dataviews[this.view].time_agg as string, {type: 'update', id: this.id})\r\n    } else this.view = this.site.defaults.dataview\r\n    this.spec.data.forEach((p: PlotData, i: number) => {\r\n      Object.keys(p).forEach(k => {\r\n        if (this.site.patterns.period.test(k)) {\r\n          const es = k.split('.'),\r\n            n = es.length - 1\r\n          let pl: {[index: string]: string | {[index: string]: string}} = null\r\n          es.forEach((e, ei) => {\r\n            pl = pl ? (pl[e] = ei === n ? p[k] : {}) : (p[e] = {})\r\n          })\r\n        }\r\n      })\r\n      if (!('textfont' in p)) p.textfont = {}\r\n      if (!('color' in p.textfont)) p.textfont.color = this.site.defaults.background_highlight\r\n      if (!('line' in p)) p.line = {}\r\n      if (!('color' in p.line)) p.line.color = this.site.defaults.background_highlight\r\n      if (!('marker' in p)) p.marker = {}\r\n      p.marker.size = 8\r\n      if (!('color' in p.marker)) p.marker.color = this.site.defaults.background_highlight\r\n      if (!('line' in p.marker)) p.marker.line = {}\r\n      if (!('color' in p.marker.line)) p.marker.line.color = this.site.defaults.background_highlight\r\n      if (!('text' in p)) p.text = []\r\n      if (!('x' in p)) p.x = []\r\n      if ('box' === p.type) {\r\n        p.hoverinfo = 'none'\r\n      } else if (!('y' in p)) p.y = []\r\n      this.traces[p.type] = JSON.stringify(p)\r\n      if (!i) {\r\n        this.base_trace = p.type\r\n        if (this.base_trace in this.site.inputs)\r\n          this.site.add_dependency(this.base_trace, {type: 'update', id: this.id})\r\n      }\r\n    })\r\n    const click_ref = this.e.dataset.click\r\n    if (click_ref in this.site.inputs) this.clickto = this.site.inputs[click_ref]\r\n    this.queue_init()\r\n  }\r\n  show(e: Entity) {\r\n    this.revert()\r\n    let trace = this.make_data_entry(\r\n      e,\r\n      0,\r\n      0,\r\n      'hover_line',\r\n      this.site.defaults['border_highlight_' + this.site.spec.settings.theme_dark]\r\n    )\r\n    if (trace) {\r\n      trace.line.width = 4\r\n      trace.marker.size = 12\r\n      Plotly.addTraces(this.e, trace, this.e.data.length)\r\n    }\r\n  }\r\n  revert() {\r\n    const data = this.e.data\r\n    if (data.length && 'hover_line' === data[data.length - 1].name) Plotly.deleteTraces(this.e, data.length - 1)\r\n  }\r\n  queue_init() {\r\n    const showing = this.deferred || !this.tab || this.tab.classList.contains('show')\r\n    if (showing && window.Plotly) {\r\n      Plotly.newPlot(this.e, this.spec.data, this.spec.layout, this.spec.config)\r\n      this.e.on('plotly_hover', this.mouseover).on('plotly_unhover', this.mouseout).on('plotly_click', this.click)\r\n      this.update_theme()\r\n      this.update()\r\n    } else {\r\n      this.deferred = true\r\n      setTimeout(this.queue_init, showing ? 0 : 2000)\r\n    }\r\n  }\r\n  mouseover(d: PlotMouseEvent) {\r\n    if (d.points && 1 === d.points.length && this.e.data[d.points[0].fullData.index]) {\r\n      Plotly.restyle(this.e, {'line.width': 5}, d.points[0].fullData.index)\r\n      this.site.subs.update(this.id, 'show', this.site.data.entities[d.points[0].data.id])\r\n    }\r\n  }\r\n  mouseout(d: PlotMouseEvent) {\r\n    if (d.points && 1 === d.points.length && this.e.data[d.points[0].fullData.index]) {\r\n      Plotly.restyle(this.e, {'line.width': 2}, d.points[0].fullData.index)\r\n      this.site.subs.update(this.id, 'revert', this.site.data.entities[d.points[0].data.id])\r\n    }\r\n  }\r\n  click(d: PlotMouseEvent) {\r\n    this.clickto && this.clickto.set(d.points[0].data.id)\r\n  }\r\n  async update(pass?: boolean) {\r\n    if ((this.queue as number) > 0) clearTimeout(this.queue)\r\n    this.queue = -1\r\n    if (!pass) {\r\n      if (!this.tab || this.tab.classList.contains('show')) this.queue = setTimeout(() => this.update(true), 50)\r\n    } else {\r\n      if (this.e.layout) {\r\n        const v = this.site.dataviews[this.view],\r\n          s = v.selection && v.selection.all,\r\n          d = v.get.dataset(),\r\n          y = this.site.inputs[this.time || v.time_agg],\r\n          parsed = this.parsed\r\n        if (this.site.data.inited[d] && v.valid[d] && v.time_range.filtered.length) {\r\n          parsed.base_trace = this.site.valueOf(this.base_trace) as string\r\n          parsed.x = this.site.valueOf(this.x) as string\r\n          parsed.y = this.site.valueOf(this.y) as string\r\n          parsed.color = this.site.valueOf(this.color || v.y || parsed.y) as string\r\n          const varx = await this.site.data.get_variable(parsed.x, v),\r\n            vary = await this.site.data.get_variable(parsed.y, v),\r\n            varcol = await this.site.data.get_variable(parsed.color, v)\r\n          parsed.x_range = varx.time_range[d]\r\n          parsed.y_range = vary.time_range[d]\r\n          parsed.view = v\r\n          parsed.dataset = d\r\n          parsed.palette = (this.site.valueOf(v.palette) || this.site.spec.settings.palette) as string\r\n          if (!(parsed.palette in this.site.palettes)) parsed.palette = this.site.defaults.palette\r\n          parsed.time =\r\n            (y ? (y.value() as number) - this.site.data.meta.times[d].range[0] : 0) - varcol.time_range[d][0]\r\n          parsed.summary = varcol.views[this.view].summaries[d]\r\n          const ns = parsed.summary.n,\r\n            display_time = ns[parsed.time] ? parsed.time : 0,\r\n            summary = vary.views[this.view].summaries[d],\r\n            n = ns[display_time],\r\n            subset = n !== v.n_selected.dataset,\r\n            rank = subset ? 'subset_rank' : 'rank',\r\n            order = subset ? varcol.views[this.view].order[d][display_time] : varcol.info[d].order[display_time],\r\n            traces = []\r\n          let i = parsed.summary.missing[display_time],\r\n            k: string,\r\n            b: PlotlyTrace,\r\n            fn = order ? order.length : 0,\r\n            settings = this.site.spec.settings,\r\n            lim = (settings.trace_limit as number) || 0,\r\n            jump,\r\n            state =\r\n              v.value() +\r\n              v.get.time_filters() +\r\n              d +\r\n              parsed.x +\r\n              parsed.y +\r\n              parsed.time +\r\n              parsed.palette +\r\n              parsed.color +\r\n              settings.summary_selection +\r\n              settings.color_scale_center +\r\n              settings.color_by_order +\r\n              settings.trace_limit +\r\n              settings.show_empty_times\r\n          lim = jump = lim && lim < n ? Math.ceil(Math.min(lim / 2, n / 2)) : 0\r\n          Object.keys(this.reference_options).forEach(\r\n            (k: keyof PlotlySpec) => (this.spec[k] = this.site.valueOf(this.reference_options[k]))\r\n          )\r\n          for (; i < fn; i++) {\r\n            if (order[i][0] in s) {\r\n              k = order[i][0]\r\n              const e = s[k]\r\n              state += k\r\n              traces.push(this.make_data_entry(e, e.views[this.view][rank][parsed.color][parsed.time], n))\r\n              if (lim && !--jump) break\r\n            }\r\n          }\r\n          if (lim && i < fn) {\r\n            for (jump = i, i = fn - 1; i > jump; i--) {\r\n              if (order[i][0] in s) {\r\n                k = order[i][0]\r\n                const e = s[k]\r\n                state += k\r\n                traces.push(this.make_data_entry(e, e.views[this.view][rank][parsed.color][parsed.time], n))\r\n                if (!--lim) break\r\n              }\r\n            }\r\n          }\r\n          state += traces.length && traces[0].type\r\n          if (settings.boxplots && 'box' in this.traces && s[k]) {\r\n            state += 'box' + settings.iqr_box\r\n            b = JSON.parse(this.traces.box)\r\n            traces.push(b)\r\n            b.line.color = this.site.defaults.border\r\n            b.median = summary.median\r\n            b.q3 = summary.q3\r\n            b.q1 = summary.q1\r\n            if (settings.iqr_box) {\r\n              b.upperfence = []\r\n              b.lowerfence = []\r\n              b.q1.forEach((q1, i) => {\r\n                if (isNaN(b.median[i])) b.median[i] = 0\r\n                const n = (b.q3[i] - q1) * 1.5,\r\n                  med = b.median[i]\r\n                b.q3[i] = isNaN(b.q3[i]) ? med : Math.max(med, b.q3[i])\r\n                b.upperfence[i] = b.q3[i] + n\r\n                b.q1[i] = isNaN(b.q1[i]) ? med : Math.min(med, q1)\r\n                b.lowerfence[i] = q1 - n\r\n              })\r\n            } else {\r\n              b.upperfence = summary.max\r\n              b.lowerfence = summary.min\r\n            }\r\n            if (settings.show_empty_times) {\r\n              b.x = b.q1.map((_, i) => s[k].get_value(parsed.x, i + parsed.y_range[0]))\r\n            } else {\r\n              b.x = []\r\n              for (i = b.q1.length; i--; ) {\r\n                if (ns[i]) {\r\n                  b.x[i] = s[k].get_value(parsed.x, i + parsed.y_range[0])\r\n                }\r\n              }\r\n            }\r\n          }\r\n          if (state !== this.state) {\r\n            if ('boolean' !== typeof this.e.layout.yaxis.title)\r\n              this.e.layout.yaxis.title =\r\n                this.site.data.format_label(parsed.y) +\r\n                ((settings.trace_limit as number) < v.n_selected.all ? ' (' + settings.trace_limit + ' extremes)' : '')\r\n            if ('boolean' !== typeof this.e.layout.xaxis.title)\r\n              this.e.layout.xaxis.title = this.site.data.format_label(parsed.x)\r\n            this.e.layout.yaxis.autorange = false\r\n            this.e.layout.yaxis.range = [Infinity, -Infinity]\r\n            if (!b) b = {upperfence: summary.max, lowerfence: summary.min}\r\n            let any_skipped = false\r\n            summary.min.forEach((min, i) => {\r\n              if (settings.show_empty_times || ns[i]) {\r\n                const l = Math.min(b.lowerfence[i], min),\r\n                  u = Math.max(b.upperfence[i], summary.max[i])\r\n                if (this.e.layout.yaxis.range[0] > l) this.e.layout.yaxis.range[0] = l\r\n                if (this.e.layout.yaxis.range[1] < u) this.e.layout.yaxis.range[1] = u\r\n              } else any_skipped = true\r\n            })\r\n            const r = (this.e.layout.yaxis.range[1] - this.e.layout.yaxis.range[0]) / 10\r\n            this.e.layout.yaxis.range[0] -= r\r\n            this.e.layout.yaxis.range[1] += r\r\n            if (this.e.layout.yaxis.range[1] > 100) {\r\n              const yinfo = vary.info[d].info\r\n              if (yinfo && 'percent' === (yinfo.aggregation_method || yinfo.type)) this.e.layout.yaxis.range[1] = 100\r\n            }\r\n            if (this.site.data.variables[parsed.x].is_time) {\r\n              const start = v.time_range.filtered[0],\r\n                end = v.time_range.filtered[1],\r\n                adj = any_skipped && end > start ? Math.log(end - start) : 0.5\r\n              if (this.e.layout.xaxis.autorange) {\r\n                this.e.layout.xaxis.autorange = false\r\n                this.e.layout.xaxis.type = 'linear'\r\n                this.e.layout.xaxis.dtick = 1\r\n                this.e.layout.xaxis.range = [start - adj, end + adj]\r\n              } else {\r\n                this.e.layout.xaxis.range[0] = start - adj\r\n                this.e.layout.xaxis.range[1] = end + adj\r\n              }\r\n            }\r\n            if (b.lowerfence.length < this.previous_span) {\r\n              Plotly.newPlot(this.e, traces, this.e.layout, this.e.config)\r\n              this.e\r\n                .on('plotly_hover', this.mouseover)\r\n                .on('plotly_unhover', this.mouseout)\r\n                .on('plotly_click', this.click)\r\n            } else {\r\n              Plotly.react(this.e, traces, this.e.layout, this.e.config)\r\n            }\r\n            setTimeout(this.site.page.trigger_resize, 300)\r\n            this.previous_span = b.lowerfence.length\r\n            this.state = state\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  make_data_entry(e: Entity, rank: number, total: number, name?: string, color?: string) {\r\n    const data = this.site.data\r\n    if (e.data && this.parsed.x in data.variables) {\r\n      const x = data.get_value({variable: this.parsed.x, entity: e}),\r\n        y = data.get_value({variable: this.parsed.y, entity: e}),\r\n        t = JSON.parse(this.traces[this.base_trace]),\r\n        yr = data.variables[this.parsed.y].time_range[this.parsed.dataset],\r\n        xr = data.variables[this.parsed.x].time_range[this.parsed.dataset],\r\n        n = Math.min(yr[1], xr[1]) + 1,\r\n        ns = this.parsed.summary.n\r\n      for (let i = Math.max(yr[0], xr[0]); i < n; i++) {\r\n        if (this.site.spec.settings.show_empty_times || ns[i - this.parsed.y_range[0]]) {\r\n          t.text.push(e.features.name)\r\n          t.x.push(this.parsed.x_range[0] <= i && i <= this.parsed.x_range[1] ? x[i - this.parsed.x_range[0]] : NaN)\r\n          t.y.push(this.parsed.y_range[0] <= i && i <= this.parsed.y_range[1] ? y[i - this.parsed.y_range[0]] : NaN)\r\n        }\r\n      }\r\n      t.type = this.parsed.base_trace\r\n      t.color =\r\n        t.line.color =\r\n        t.marker.color =\r\n        t.textfont.color =\r\n          color ||\r\n          this.site.get_color(\r\n            e.get_value(this.parsed.color, this.parsed.time),\r\n            this.parsed.palette,\r\n            this.parsed.summary,\r\n            this.parsed.time,\r\n            rank,\r\n            total\r\n          ) ||\r\n          this.site.defaults.border\r\n      if ('bar' === t.type) t.marker.line.width = 0\r\n      t.name = name || e.features.name\r\n      t.id = e.features.id\r\n      return t\r\n    }\r\n  }\r\n  update_theme() {\r\n    if (this.dark_theme !== this.site.spec.settings.theme_dark) {\r\n      this.dark_theme = this.site.spec.settings.theme_dark as boolean\r\n      const s = getComputedStyle(document.body)\r\n      if (!('style' in this)) {\r\n        this.style = this.spec.layout\r\n        if (!('font' in this.style)) this.style.font = {}\r\n        if (!('modebar' in this.style)) this.style.modebar = {}\r\n        if (!('font' in this.style.xaxis)) this.style.xaxis.font = {}\r\n        if (!('font' in this.style.yaxis)) this.style.yaxis.font = {}\r\n      }\r\n      this.style.paper_bgcolor = s.backgroundColor\r\n      this.style.plot_bgcolor = s.backgroundColor\r\n      this.style.font.color = s.color\r\n      this.style.modebar.bgcolor = s.backgroundColor\r\n      this.style.modebar.color = s.color\r\n      if (this.e._fullLayout.xaxis.showgrid) this.style.xaxis.gridcolor = s.borderColor\r\n      if (this.e._fullLayout.yaxis.showgrid) this.style.yaxis.gridcolor = s.borderColor\r\n      this.style.xaxis.font.color = s.color\r\n      this.style.yaxis.font.color = s.color\r\n      Plotly.relayout(this.e, this.spec.layout)\r\n    }\r\n  }\r\n}\r\n","import type {SiteInputs} from '../inputs/index'\r\nimport {BaseOutput} from './index'\r\nimport type Community from '../index'\r\nimport type {Entity, ObjectIndex, Order, Summary, Variables} from '../../types'\r\nimport DataHandler from '../../data_handler/index'\r\n\r\ntype TableVariableSpec = {name: string; title?: string; source?: 'data' | 'features'}\r\ntype TableOrderSpec = [number, string][]\r\ntype TableFeatureSpec = {title?: string; name?: string}[]\r\nexport type DataTableSpec = {\r\n  [index: string]:\r\n    | boolean\r\n    | string\r\n    | string[]\r\n    | TableFeatureSpec\r\n    | TableOrderSpec\r\n    | TableVariableSpec\r\n    | TableVariableSpec[]\r\n  variables?: string | string[] | TableVariableSpec | TableVariableSpec[]\r\n  order?: TableOrderSpec\r\n  features?: string | TableFeatureSpec\r\n  variable_source?: string\r\n}\r\ntype TableRowRef = {\r\n  time: number\r\n  entity: {get_value: Function; features: {[index: string]: number}; variables: Variables}\r\n  int: boolean\r\n  offset: number\r\n  variable: string\r\n}\r\ntype TableRowGen = {\r\n  int: boolean\r\n  variable: string\r\n  time_range: number[]\r\n  renderer?: (o: OutputDataTable, e: Entity) => void\r\n}\r\ninterface DataTableRow {\r\n  node: () => HTMLTableRowElement\r\n  scrollTo: (animate?: boolean) => void\r\n  selector: {\r\n    rows: number\r\n    cols: number\r\n    opts: {\r\n      order: string\r\n      search: string\r\n      page: string\r\n    }\r\n  }\r\n}\r\ninterface DataTableCell extends HTMLTableCellElement {\r\n  _DT_CellIndex: {row: number; column: number}\r\n}\r\ninterface DataTablesMouseEvent extends MouseEvent {\r\n  target: DataTableCell\r\n}\r\n\r\nexport class OutputDataTable extends BaseOutput {\r\n  type: 'datatable' = 'datatable'\r\n  table: DataTables.Api\r\n  style: HTMLStyleElement\r\n  clickto?: SiteInputs\r\n  spec: DataTableSpec\r\n  parsed: {\r\n    summary?: Summary\r\n    order?: Order\r\n    time: number\r\n    color: string\r\n    dataset?: string\r\n    time_index: ObjectIndex\r\n    time_range?: number[]\r\n  } = {time: 0, color: '', time_index: {}}\r\n  time: string\r\n  queue: number | NodeJS.Timeout = -1\r\n  pending: number | NodeJS.Timeout = -1\r\n  state: string = ''\r\n  reference_options: {[index: string]: string} = {}\r\n  header: {\r\n    title: string\r\n    data?: string | Function\r\n    type?: string\r\n    render?: Function\r\n    dataset?: string\r\n    variable?: string\r\n  }[] = []\r\n  rows: {[index: string]: DataTableRow} = {}\r\n  rowIds: {[index: number]: string} = {}\r\n  variable_header = false\r\n  variables: TableVariableSpec | TableVariableSpec[]\r\n  current_filter: {[index: string]: string} = {}\r\n  varstate: string\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.queue_init = this.queue_init.bind(this)\r\n    this.mouseover = this.mouseover.bind(this)\r\n    this.mouseout = this.mouseout.bind(this)\r\n    this.click = this.click.bind(this)\r\n    e.appendChild(document.createElement('thead'))\r\n    e.appendChild(document.createElement('tbody'))\r\n    this.style = document.head.appendChild(document.createElement('style'))\r\n    e.addEventListener('mouseover', this.mouseover)\r\n    e.addEventListener('mouseout', this.mouseout)\r\n    Object.keys(this.spec).forEach(k => {\r\n      const opt = this.spec[k]\r\n      if ('string' === typeof opt && opt in site.inputs) this.reference_options[k] = opt\r\n    })\r\n    if ('string' === typeof this.spec.variables) this.spec.variable_source = this.spec.variables\r\n    if (this.tab) {\r\n      document.getElementById(e.parentElement.getAttribute('aria-labelledby')).addEventListener(\r\n        'click',\r\n        function (this: OutputDataTable) {\r\n          if (!this.e.parentElement.classList.contains('active')) {\r\n            setTimeout(this.update, 155)\r\n            setTimeout(this.site.page.trigger_resize, 155)\r\n          }\r\n        }.bind(this)\r\n      )\r\n    }\r\n  }\r\n  init() {\r\n    this.parsed.dataset = this.site.dataviews[this.view].get.dataset()\r\n    if (this.spec.variables) {\r\n      if ('string' === typeof this.spec.variables) {\r\n        if (this.spec.variables in this.site.inputs) {\r\n          this.site.add_dependency(this.spec.variables, {type: 'update', id: this.id})\r\n          this.spec.variables = this.site.valueOf(this.spec.variables) as string | string[]\r\n          this.spec.single_variable = 'string' === typeof this.spec.variables\r\n        } else if (!this.spec.single_variable) {\r\n          this.spec.variables = [{name: this.spec.variables}]\r\n        }\r\n      }\r\n    } else this.spec.variables = Object.keys(this.site.data.variables)\r\n    if (Array.isArray(this.spec.variables)) {\r\n      const vars = this.spec.variables as string[]\r\n      if (vars.length && 'string' === typeof vars[0]) {\r\n        this.variables = vars.map((v: string): TableVariableSpec => {\r\n          return {\r\n            name: v,\r\n          }\r\n        })\r\n      }\r\n    } else if ('string' === typeof this.spec.variables) {\r\n      this.variables = {name: this.spec.variables}\r\n    }\r\n    const time = this.site.data.meta.times[this.parsed.dataset]\r\n    if (this.spec.single_variable) {\r\n      const c = this.variables as TableVariableSpec\r\n      this.header.push({title: 'Name', data: 'entity.features.name'})\r\n      if (time && time.is_single) this.variable_header = true\r\n      const t = c.name in this.site.data.variables && this.site.data.variables[c.name].time_range[this.parsed.dataset]\r\n      if (t)\r\n        for (let n = t[1] - t[0] + 1; n--; ) {\r\n          this.header[n + 1] = {\r\n            title: this.variable_header ? c.title || this.site.data.format_label(c.name) : time.value[n + t[0]] + '',\r\n            data: this.site.data.get_value,\r\n            render: DataHandler.retrievers.row_time.bind({\r\n              i: n,\r\n              o: t[0],\r\n              format_value: this.site.data.format_value.bind(this.site.data),\r\n            }),\r\n          }\r\n        }\r\n      this.spec.order = [[this.header.length - 1, 'dsc']]\r\n    } else if (this.spec.wide) {\r\n      if (this.spec.features) {\r\n        if ('string' === typeof this.spec.features) this.spec.features = [{name: this.spec.features}]\r\n        this.spec.features.forEach(f => {\r\n          this.header.push({\r\n            title: f.title || f.name,\r\n            data: 'entity.features.' + f.name.replace(this.site.patterns.all_periods, '\\\\.'),\r\n          })\r\n        })\r\n      }\r\n      const vars = this.variables as TableVariableSpec[]\r\n      for (let i = vars.length; i--; ) {\r\n        const c = vars[i]\r\n        if (!c.source) c.source = c.name in this.site.data.variables ? 'data' : 'features'\r\n        this.header.push(\r\n          'features' === c.source\r\n            ? {\r\n                title: c.title || this.site.data.format_label(c.name),\r\n                data: 'entity.features.' + c.name.toLowerCase().replace(this.site.patterns.all_periods, '\\\\.'),\r\n              }\r\n            : {\r\n                title: c.title || this.site.data.format_label(c.name),\r\n                render: async function (\r\n                  this: {o: OutputDataTable; c: TableVariableSpec},\r\n                  d: number[],\r\n                  type: string,\r\n                  row: TableRowRef\r\n                ) {\r\n                  if ('data' === this.c.source) {\r\n                    if (this.c.name in this.o.site.data.variables) {\r\n                      const v = await this.o.site.data.get_variable(this.c.name, this.o.site.dataviews[this.o.view])\r\n                      const i = row.time - v.time_range[this.o.parsed.dataset][0]\r\n                      return i < 0 ? NaN : row.entity.get_value(this.c.name, i)\r\n                    } else return NaN\r\n                  } else\r\n                    return this.c.source in row.entity && this.c.name in row.entity[this.c.source]\r\n                      ? row.entity[this.c.source][this.c.name]\r\n                      : NaN\r\n                }.bind({o: this, c}),\r\n              }\r\n        )\r\n      }\r\n    } else {\r\n      if (!time.is_single) {\r\n        this.header.push({\r\n          title: 'Year',\r\n          data: 'entity.time.value',\r\n          render: function (d: number[], type: string, row: TableRowRef) {\r\n            const t = row.time + row.offset\r\n            return d && t >= 0 && t < d.length ? d[t] : NaN\r\n          },\r\n        })\r\n      }\r\n      if (this.spec.features) {\r\n        if ('string' === typeof this.spec.features) this.spec.features = [{name: this.spec.features}]\r\n        this.spec.features.forEach(f => {\r\n          this.header.splice(0, 0, {\r\n            title: f.title || f.name,\r\n            data: 'entity.features.' + f.name.replace(this.site.patterns.all_periods, '\\\\.'),\r\n          })\r\n        })\r\n      }\r\n      this.header.push({\r\n        title: 'Variable',\r\n        data: function (row: TableRowRef) {\r\n          return row.variable in row.entity.variables\r\n            ? row.entity.variables[row.variable].meta.short_name\r\n            : row.variable\r\n        },\r\n      })\r\n      this.header.push({\r\n        title: 'Value',\r\n        data: this.site.data.get_value,\r\n        render: (d: (string | number)[], type: string, row: TableRowRef) => {\r\n          return d\r\n            ? 'number' === typeof d[row.time]\r\n              ? this.site.data.format_value(d[row.time] as number, row.int)\r\n              : d[row.time]\r\n            : ''\r\n        },\r\n      })\r\n    }\r\n    if (this.view) {\r\n      this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n      this.site.add_dependency(this.view + '_filter', {type: 'update', id: this.id})\r\n      this.site.add_dependency(this.site.dataviews[this.view].time_agg as string, {type: 'update', id: this.id})\r\n    } else this.view = this.site.defaults.dataview\r\n    const click_ref = this.e.dataset.click\r\n    if (click_ref in this.site.inputs) {\r\n      this.clickto = this.site.inputs[click_ref]\r\n      this.e.addEventListener('click', this.click)\r\n    }\r\n    this.queue_init()\r\n  }\r\n  show(e: Entity) {\r\n    if (e.features && e.features.id in this.rows) {\r\n      if (this.site.spec.settings.table_autoscroll) {\r\n        this.rows[e.features.id].scrollTo('smooth' === this.site.spec.settings.table_scroll_behavior)\r\n      }\r\n      if ((this.pending as number) > 0) clearTimeout(this.pending)\r\n      this.pending = -1\r\n      const row = this.rows[e.features.id].node()\r\n      if (row) {\r\n        row.classList.add('highlighted')\r\n      } else {\r\n        this.pending = setTimeout(\r\n          function (this: DataTableRow) {\r\n            const row = this.node()\r\n            if (row) row.classList.add('highlighted')\r\n          }.bind(this.rows[e.features.id]),\r\n          0\r\n        )\r\n      }\r\n    }\r\n  }\r\n  revert() {\r\n    if ((this.pending as number) > 0) clearTimeout(this.pending)\r\n    this.e.querySelectorAll('tr.highlighted').forEach(e => e.classList.remove('highlighted'))\r\n  }\r\n  queue_init() {\r\n    const showing = this.deferred || !this.tab || this.tab.classList.contains('show')\r\n    if (showing && 'jQuery' in window && 'DataTable' in window && 'get' in this.site.dataviews[this.view]) {\r\n      this.spec.columns = this.header\r\n      this.table = $(this.e).DataTable(this.spec)\r\n      this.update()\r\n    } else {\r\n      this.deferred = true\r\n      setTimeout(this.queue_init, showing ? 0 : 2000)\r\n    }\r\n  }\r\n  async update(pass?: boolean) {\r\n    if ((this.queue as number) > 0) clearTimeout(this.queue)\r\n    this.queue = -1\r\n    if (!pass) {\r\n      if (!this.tab || this.tab.classList.contains('show')) this.queue = setTimeout(() => this.update(true), 50)\r\n    } else {\r\n      if (this.table) {\r\n        let vn =\r\n          this.spec.variable_source &&\r\n          (this.site.valueOf(this.spec.variable_source) as string).replace(this.site.patterns.all_periods, '\\\\.')\r\n        const v = this.site.dataviews[this.view],\r\n          d = v.get.dataset()\r\n        if (!this.site.data.inited[d]) return\r\n        const settings = this.site.spec.settings,\r\n          times = this.site.data.meta.times[d],\r\n          state =\r\n            d +\r\n            v.value() +\r\n            v.get.time_filters() +\r\n            settings.digits +\r\n            vn +\r\n            settings.theme_dark +\r\n            settings.show_empty_times,\r\n          update = state !== this.state,\r\n          time = this.site.valueOf(v.time_agg),\r\n          variable = await this.site.data.get_variable(vn, v)\r\n        this.parsed.time_range = variable ? variable.time_range[d] : times.info.time_range[d]\r\n        this.parsed.time = ('number' === typeof time ? time - times.range[0] : 0) - this.parsed.time_range[0]\r\n        if (update) {\r\n          this.rows = {}\r\n          this.rowIds = {}\r\n          this.table.clear()\r\n          let redraw = true\r\n          if (v.valid[d]) {\r\n            this.state = state\r\n            Object.keys(this.reference_options).forEach(\r\n              k => (this.spec[k] = this.site.valueOf(this.reference_options[k]) as string)\r\n            )\r\n            if (!Array.isArray(this.variables)) {\r\n              this.parsed.time_index = {}\r\n              this.parsed.dataset = d\r\n              this.parsed.color = vn\r\n              this.parsed.summary = this.view in variable.views ? variable.views[this.view].summaries[d] : undefined\r\n              this.parsed.order =\r\n                this.view in variable.views ? variable.views[this.view].order[d][this.parsed.time] : undefined\r\n              if (this.header.length < 2 || d !== this.header[1].dataset || vn !== this.header[1].variable) {\r\n                this.table.destroy()\r\n                $(this.e).empty()\r\n                this.header = [{title: 'Name', data: 'entity.features.name', type: 'string'}]\r\n                if (-1 !== this.parsed.time_range[0]) {\r\n                  for (let n = this.parsed.time_range[2]; n--; ) {\r\n                    this.header[n + 1] = {\r\n                      dataset: d,\r\n                      variable: vn,\r\n                      type: 'string' === variable.type ? 'string' : 'num',\r\n                      title: this.variable_header\r\n                        ? this.variables.title || this.site.data.format_label(vn)\r\n                        : times.value[n + this.parsed.time_range[0]] + '',\r\n                      data: this.site.data.get_value,\r\n                      render: DataHandler.retrievers.row_time.bind({\r\n                        i: n,\r\n                        o: this.parsed.time_range[0],\r\n                        format_value: this.site.data.format_value.bind(this.site.data),\r\n                      }),\r\n                    }\r\n                  }\r\n                } else this.state = ''\r\n                this.spec.order[0][0] = this.header.length - 1\r\n                this.spec.columns = this.header\r\n                this.table = $(this.e).DataTable(this.spec)\r\n              }\r\n              const n = this.header.length,\r\n                ns = this.parsed.summary.n\r\n              let reset\r\n              for (let i = 1, show = false, nshowing = 0; i < n; i++) {\r\n                show =\r\n                  v.times[i - 1 + this.parsed.time_range[0]] && ((settings.show_empty_times as boolean) || !!ns[i - 1])\r\n                this.table.column(i).visible(show, false)\r\n                if (show) {\r\n                  this.parsed.time_index[times.value[i - 1 + this.parsed.time_range[0]]] = ++nshowing\r\n                  reset = false\r\n                }\r\n              }\r\n              if (reset) this.state = ''\r\n            }\r\n            if (this.spec.wide) {\r\n              Object.keys(v.selection.all).forEach(k => {\r\n                if (vn) {\r\n                  if (vn in v.selection.all[k].views[this.view].summary) {\r\n                    this.rows[k] = this.table.row.add({\r\n                      dataset: d,\r\n                      variable: vn,\r\n                      offset: this.parsed.time_range[0],\r\n                      entity: v.selection.all[k],\r\n                      int:\r\n                        d in this.site.data.variables[vn].info &&\r\n                        'integer' === this.site.data.variables[vn].info[d].type,\r\n                    }) as unknown as DataTableRow\r\n                    this.rowIds[this.rows[k].selector.rows] = k\r\n                  }\r\n                } else {\r\n                  for (let i = times.n; i--; ) {\r\n                    this.rows[k] = this.table.row.add({\r\n                      time: i,\r\n                      entity: v.selection.all[k],\r\n                    }) as unknown as DataTableRow\r\n                    this.rowIds[this.rows[k].selector.rows] = k\r\n                  }\r\n                }\r\n              })\r\n            } else if (Array.isArray(this.variables)) {\r\n              if (this.spec.filters)\r\n                Object.keys(this.spec.filters).forEach(f => {\r\n                  this.current_filter[f] = this.site.valueOf(f) as string\r\n                })\r\n              const va: TableRowGen[] = []\r\n              let varstate = '' + this.parsed.dataset + v.get.single_id() + v.get.features() + settings.digits\r\n              for (let i = this.variables.length; i--; ) {\r\n                vn = this.variables[i].name\r\n                pass = !this.spec.filters\r\n                const variable = await this.site.data.get_variable(vn, v)\r\n                if (vn in this.site.data.variables && 'meta' in variable) {\r\n                  if (this.spec.filters) {\r\n                    for (const c in this.current_filter)\r\n                      if (c in variable.meta) {\r\n                        pass = variable.meta[c as keyof typeof variable.meta] === this.current_filter[c]\r\n                        if (!pass) break\r\n                      }\r\n                  } else pass = true\r\n                }\r\n                if (pass) {\r\n                  varstate += vn\r\n                  va.push({\r\n                    variable: vn,\r\n                    int: this.site.patterns.int_types.test(this.site.data.variables[vn].type),\r\n                    time_range: variable.time_range[d],\r\n                    renderer: function (o, e) {\r\n                      const k = e.features.id,\r\n                        r = this.time_range,\r\n                        n = r[1]\r\n                      for (let i = r[0]; i <= n; i++) {\r\n                        o.rows[k] = o.table.row.add({\r\n                          offset: this.time_range[0],\r\n                          time: i - this.time_range[0],\r\n                          dataset: d,\r\n                          variable: this.variable,\r\n                          entity: e,\r\n                          int: this.int,\r\n                        }) as unknown as DataTableRow\r\n                        o.rowIds[o.rows[k].selector.rows] = k\r\n                      }\r\n                    },\r\n                  })\r\n                }\r\n              }\r\n              if (varstate === this.varstate) return\r\n              this.varstate = varstate\r\n              Object.keys(v.selection.all).forEach(k => {\r\n                const e = v.selection.all[k]\r\n                if (this.spec.single_variable) {\r\n                  if (vn in e.views[this.view].summary && variable.code in e.data) {\r\n                    this.rows[k] = this.table.row.add({\r\n                      offset: this.parsed.time_range[0],\r\n                      dataset: d,\r\n                      variable: vn,\r\n                      entity: e,\r\n                      int: this.site.patterns.int_types.test(this.site.data.variables[vn].type),\r\n                    }) as unknown as DataTableRow\r\n                    this.rowIds[this.rows[k].selector.rows] = k\r\n                  }\r\n                } else {\r\n                  va.forEach(v => {\r\n                    if (this.site.data.variables[v.variable].code in e.data) v.renderer(this, e)\r\n                  })\r\n                }\r\n              })\r\n            }\r\n          }\r\n          redraw ? this.table.draw() : this.table.columns.adjust().draw(false)\r\n        }\r\n        if (this.parsed.time > -1 && this.header.length > 1 && v.time_range.filtered_index) {\r\n          if (this.style.sheet.cssRules.length) this.style.sheet.deleteRule(0)\r\n          if (this.parsed.time_index[time as number])\r\n            this.style.sheet.insertRule(\r\n              '#' +\r\n                this.id +\r\n                ' td:nth-child(' +\r\n                (this.parsed.time_index[time as number] + 1) +\r\n                '){background-color: var(--background-highlight)}',\r\n              0\r\n            )\r\n          if (!update && this.site.spec.settings.table_autosort) {\r\n            this.table.order([this.parsed.time + 1, 'dsc']).draw()\r\n          }\r\n          if (this.site.spec.settings.table_autoscroll) {\r\n            const w = this.e.parentElement.getBoundingClientRect().width,\r\n              col = this.table.column(this.parsed.time + 1),\r\n              h = col.header().getBoundingClientRect()\r\n            if (h)\r\n              this.e.parentElement.scroll({\r\n                left: h.x - this.e.getBoundingClientRect().x + h.width + 16 - w,\r\n                behavior: (this.site.spec.settings.table_scroll_behavior as ScrollBehavior) || 'smooth',\r\n              })\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  mouseover(e: DataTablesMouseEvent) {\r\n    if (e.target._DT_CellIndex && e.target._DT_CellIndex.row in this.rowIds) {\r\n      const id = this.rowIds[e.target._DT_CellIndex.row],\r\n        row = this.rows[id].node()\r\n      if (row) row.classList.add('highlighted')\r\n      if (id in this.site.data.entities) {\r\n        this.site.subs.update(this.id, 'show', this.site.data.entities[id])\r\n      }\r\n    }\r\n  }\r\n  mouseout(e: DataTablesMouseEvent) {\r\n    if (e.target._DT_CellIndex && e.target._DT_CellIndex.row in this.rowIds) {\r\n      const id = this.rowIds[e.target._DT_CellIndex.row],\r\n        row = this.rows[id].node()\r\n      if (row) row.classList.remove('highlighted')\r\n      if (id in this.site.data.entities) {\r\n        this.site.subs.update(this.id, 'revert', this.site.data.entities[id])\r\n      }\r\n    }\r\n  }\r\n  click(e: DataTablesMouseEvent) {\r\n    if (this.clickto && e.target._DT_CellIndex && e.target._DT_CellIndex.row in this.rowIds) {\r\n      const id = this.rowIds[e.target._DT_CellIndex.row]\r\n      if (id in this.site.data.entities) this.clickto.set(id)\r\n    }\r\n  }\r\n}\r\n","import type {Entity, ObjectIndex, Order, Summary, Variable} from '../../types'\r\nimport type {SiteDataView} from '../dataview'\r\nimport type Community from '../index'\r\nimport type {SiteInputs} from '../inputs/index'\r\nimport type {DataTableSpec} from './datatables'\r\nimport {BaseOutput} from './index'\r\n\r\nexport class OutputTable extends BaseOutput {\r\n  type: 'table' = 'table'\r\n  clickto?: SiteInputs\r\n  spec: DataTableSpec\r\n  parsed: {\r\n    summary?: Summary\r\n    order?: Order\r\n    time?: number\r\n    color?: string\r\n    dataset?: string\r\n    time_index?: ObjectIndex\r\n    time_range?: number[]\r\n    variable?: Variable\r\n  } = {}\r\n  time: string\r\n  queue: number | NodeJS.Timeout = -1\r\n  state: string = ''\r\n  reference_options: {[index: string]: string} = {}\r\n  header: {\r\n    title: string\r\n    data?: string | Function\r\n    type?: string\r\n    render?: Function\r\n    dataset?: string\r\n    variable?: string\r\n  }[] = []\r\n  rows: {[index: string]: HTMLTableRowElement} = {}\r\n  parts = {\r\n    head: document.createElement('thead'),\r\n    body: document.createElement('tbody'),\r\n  }\r\n  current_variable = ''\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.mouseover = this.mouseover.bind(this)\r\n    this.mouseout = this.mouseout.bind(this)\r\n    this.click = this.click.bind(this)\r\n    this.parts.head.appendChild(document.createElement('tr'))\r\n    e.appendChild(this.parts.head)\r\n    e.appendChild(this.parts.body)\r\n    Object.keys(this.spec).forEach(k => {\r\n      const opt = this.spec[k]\r\n      if ('string' === typeof opt && opt in site.inputs) this.reference_options[k] = opt\r\n    })\r\n    if ('string' === typeof this.spec.variables) this.spec.variable_source = this.spec.variables\r\n    e.addEventListener('mouseover', this.mouseover)\r\n    e.addEventListener('mouseout', this.mouseout)\r\n    if (this.tab) {\r\n      document.getElementById(e.parentElement.getAttribute('aria-labelledby')).addEventListener(\r\n        'click',\r\n        function (this: OutputTable) {\r\n          if (!e.parentElement.classList.contains('active')) {\r\n            setTimeout(this.update, 155)\r\n            setTimeout(this.site.page.trigger_resize, 155)\r\n          }\r\n        }.bind(this)\r\n      )\r\n    }\r\n  }\r\n  init() {\r\n    if (this.spec.variable_source in this.site.inputs)\r\n      this.site.add_dependency(this.spec.variable_source, {type: 'update', id: this.id})\r\n    if (this.view) {\r\n      this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n      this.site.add_dependency(this.view + '_filter', {type: 'update', id: this.id})\r\n      this.site.add_dependency(this.site.dataviews[this.view].time_agg as string, {type: 'update', id: this.id})\r\n    } else this.view = this.site.defaults.dataview\r\n    const click_ref = this.e.dataset.click\r\n    if (click_ref in this.site.inputs) {\r\n      if (this.e.dataset.click) this.e.classList.add('interactive')\r\n      this.clickto = this.site.inputs[click_ref]\r\n      this.e.addEventListener('click', this.click)\r\n    }\r\n    this.update()\r\n  }\r\n  show(e: Entity) {\r\n    if (e.features) {\r\n      const row = this.rows[e.features.id]\r\n      if (row && row.parentElement) {\r\n        row.classList.add('highlighted')\r\n        if (this.site.spec.settings.table_autoscroll) {\r\n          const h = this.e.parentElement.getBoundingClientRect().height,\r\n            top = row.getBoundingClientRect().y - row.parentElement.getBoundingClientRect().y\r\n          this.e.parentElement.scroll({\r\n            top: h > this.e.scrollHeight - top ? this.e.parentElement.scrollHeight : top,\r\n            behavior: (this.site.spec.settings.table_scroll_behavior as ScrollBehavior) || 'smooth',\r\n          })\r\n        }\r\n      }\r\n    }\r\n  }\r\n  revert(e: Entity) {\r\n    if (e.features && e.features.id in this.rows) {\r\n      this.rows[e.features.id].classList.remove('highlighted')\r\n    }\r\n  }\r\n  createHeader(v: SiteDataView) {\r\n    const dataset = this.parsed.dataset,\r\n      time = this.site.data.meta.times[dataset],\r\n      tr = this.parts.head.firstElementChild,\r\n      range = this.parsed.variable.time_range[dataset],\r\n      start = range[0],\r\n      end = range[1] + 1,\r\n      ns = this.parsed.summary.n\r\n    let th = document.createElement('th'),\r\n      span = document.createElement('span')\r\n    this.parsed.time_index = {}\r\n    tr.innerHTML = ''\r\n    tr.appendChild(th)\r\n    th.appendChild(span)\r\n    span.innerText = 'Name'\r\n    for (let i = start, nshowing = 0; i < end; i++) {\r\n      if (v.times[i] && (this.site.spec.settings.show_empty_times || ns[i - start])) {\r\n        this.parsed.time_index[time.value[i]] = nshowing++\r\n        tr.appendChild((th = document.createElement('th')))\r\n        th.appendChild((span = document.createElement('span')))\r\n        span.innerText = time.value[i] + ''\r\n      }\r\n    }\r\n  }\r\n  appendRows(v: SiteDataView) {\r\n    const es = this.parsed.order,\r\n      variable = this.parsed.variable,\r\n      times = this.site.data.meta.times[this.parsed.dataset].value,\r\n      range = variable.time_range[this.parsed.dataset],\r\n      start = range[0],\r\n      dn = range[1] - start + 1,\r\n      selection = v.selection.all\r\n    this.current_variable = variable.code + this.parsed.dataset\r\n    this.parts.body.innerHTML = ''\r\n    for (let n = es.length; n--; ) {\r\n      const id = es[n][0]\r\n      if (id in selection) {\r\n        const e = this.site.data.entities[id],\r\n          d = e.data[variable.code],\r\n          tr = document.createElement('tr')\r\n        this.rows[id] = tr\r\n        tr.dataset.entityId = id\r\n        let td = document.createElement('td')\r\n        td.innerText = e.features.name\r\n        tr.appendChild(td)\r\n        if (Array.isArray(d)) {\r\n          for (let i = 0; i < dn; i++) {\r\n            if (v.times[i + start] && times[i + start] in this.parsed.time_index) {\r\n              tr.appendChild((td = document.createElement('td')))\r\n              td.innerText = this.site.data.format_value(d[i]) as string\r\n              if (i === this.parsed.time) td.classList.add('highlighted')\r\n            }\r\n          }\r\n        } else {\r\n          tr.appendChild((td = document.createElement('td')))\r\n          td.innerText = this.site.data.format_value(d) as string\r\n          td.dataset.entityId = id\r\n          td.classList.add('highlighted')\r\n        }\r\n        this.parts.body.appendChild(tr)\r\n      }\r\n    }\r\n    if (\r\n      this.site.spec.settings.table_autoscroll &&\r\n      this.parts.head.firstElementChild.childElementCount > 2 &&\r\n      this.parts.head.firstElementChild.childElementCount > this.parsed.time + 1\r\n    ) {\r\n      const w = this.e.parentElement.getBoundingClientRect().width,\r\n        col = this.parts.head.firstElementChild.children[this.parsed.time + 1].getBoundingClientRect()\r\n      this.e.parentElement.scroll({\r\n        left: col.x - this.e.getBoundingClientRect().x + col.width + 16 - w,\r\n        behavior: (this.site.spec.settings.table_scroll_behavior as ScrollBehavior) || 'smooth',\r\n      })\r\n    }\r\n  }\r\n  async update(pass?: boolean) {\r\n    if ((this.queue as number) > 0) clearTimeout(this.queue)\r\n    this.queue = -1\r\n    if (!pass) {\r\n      if (!this.tab || this.tab.classList.contains('show')) this.queue = setTimeout(() => this.update(true), 50)\r\n    } else {\r\n      let vn =\r\n        this.spec.variable_source &&\r\n        (this.site.valueOf(this.spec.variable_source) as string).replace(this.site.patterns.all_periods, '\\\\.')\r\n      const v = this.site.dataviews[this.view],\r\n        d = v.get.dataset(),\r\n        time = this.site.valueOf(v.time_agg),\r\n        state =\r\n          d +\r\n          v.value() +\r\n          v.get.time_filters() +\r\n          this.site.spec.settings.digits +\r\n          vn +\r\n          time +\r\n          this.site.spec.settings.show_empty_times\r\n      if (!this.site.data.inited[d]) return\r\n      if (state !== this.state) {\r\n        this.state = state\r\n        Object.keys(this.reference_options).forEach(\r\n          k => (this.spec[k] = this.site.valueOf(this.reference_options[k]) as string)\r\n        )\r\n        const variable = await this.site.data.get_variable(vn, v)\r\n        this.parsed.dataset = d\r\n        this.parsed.color = vn\r\n        this.parsed.variable = variable\r\n        this.parsed.time_range = variable.time_range[d]\r\n        this.parsed.time =\r\n          ('number' === typeof time ? time - this.site.data.meta.times[d].range[0] : 0) - this.parsed.time_range[0]\r\n        this.parsed.summary = variable.views[this.view].summaries[d]\r\n        this.parsed.order = variable.views[this.view].order[d][this.parsed.time]\r\n        this.createHeader(v)\r\n        this.appendRows(v)\r\n      }\r\n    }\r\n  }\r\n  mouseover(e: MouseEvent) {\r\n    const target = e.target as HTMLElement,\r\n      row = 'TD' === target.tagName ? target.parentElement : target,\r\n      id = row.dataset.entityId\r\n    if (id) {\r\n      row.classList.add('highlighted')\r\n      this.site.subs.update(this.id, 'show', this.site.data.entities[id])\r\n    }\r\n  }\r\n  mouseout(e: MouseEvent) {\r\n    const target = e.target as HTMLElement,\r\n      row = 'TD' === target.tagName ? target.parentElement : target,\r\n      id = row.dataset.entityId\r\n    if (id) {\r\n      row.classList.remove('highlighted')\r\n      this.site.subs.update(this.id, 'revert', this.site.data.entities[id])\r\n    }\r\n  }\r\n  click(e: MouseEvent) {\r\n    const target = e.target as HTMLElement,\r\n      row = 'TD' === target.tagName ? target.parentElement : target,\r\n      id = row.dataset.entityId\r\n    if (this.clickto && id) this.clickto.set(id)\r\n  }\r\n}\r\n","import DataHandler from '../../data_handler/index'\r\nimport type {SiteCondition} from '../../types'\r\nimport type Community from '../index'\r\nimport {tooltip_trigger} from '../utils'\r\nimport {BaseOutput} from './index'\r\n\r\ntype Text = {\r\n  text: string[]\r\n  parts: HTMLElement\r\n  button?: {[index: string]: {text: string[]; type: string; target: string | string[]; trigger: () => void}}\r\n  condition?: SiteCondition[]\r\n}\r\ntype TextSpec = {\r\n  text: Text[]\r\n  condition?: SiteCondition[]\r\n}\r\n\r\nexport class OutputText extends BaseOutput {\r\n  type: 'text' = 'text'\r\n  spec: TextSpec\r\n  text: Text[] | Text[][]\r\n  condition: SiteCondition[]\r\n  depends: Map<string, {id: string; parsed?: string}> = new Map()\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.update = this.update.bind(this)\r\n    this.prep = this.prep.bind(this)\r\n    this.text = this.spec.text\r\n    this.condition = this.spec.condition || []\r\n  }\r\n  init() {\r\n    this.text.forEach(oi => {\r\n      if (Array.isArray(oi)) {\r\n        this.e.appendChild(document.createElement('span'))\r\n        oi.forEach(this.prep)\r\n      } else {\r\n        this.prep(oi)\r\n        this.e.appendChild(oi.parts)\r\n      }\r\n    })\r\n    this.condition.forEach(c => {\r\n      if (c.id in this.site.inputs) this.site.add_dependency(c.id, {type: 'display', id: this.id})\r\n    })\r\n    this.depends.forEach(d => this.site.add_dependency(d.id, {type: 'update', id: this.id}))\r\n    this.update()\r\n  }\r\n  update() {\r\n    this.depends.forEach(d => {\r\n      d.parsed = this.site.valueOf(d.id) as string\r\n      const u = this.site.inputs[d.id]\r\n      if (u) {\r\n        if ('values' in u && 'options' in u && !Array.isArray(u.values) && d.parsed in u.values) {\r\n          d.parsed = u.options[u.values[d.parsed]].innerText\r\n        } else {\r\n          d.parsed =\r\n            'display' in u && d.parsed in u.display\r\n              ? (u.display[d.parsed] as string)\r\n              : this.site.data.format_label(d.parsed)\r\n        }\r\n      }\r\n    })\r\n    this.text.forEach((o, i) => {\r\n      let pass = true,\r\n        s: Text\r\n      if (Array.isArray(o)) {\r\n        for (let t = o.length; t--; ) {\r\n          if ('condition' in o[t]) {\r\n            for (let c = o[t].condition.length; c--; ) {\r\n              pass = o[t].condition[c].check()\r\n              if (!pass) break\r\n            }\r\n          }\r\n          if (pass) {\r\n            s = o[t]\r\n            break\r\n          }\r\n        }\r\n      } else {\r\n        if ('condition' in o) {\r\n          for (let t = o.condition.length; t--; ) {\r\n            pass = o.condition[t].check()\r\n            if (!pass) break\r\n          }\r\n        }\r\n        if (pass) s = o\r\n      }\r\n      if (pass) {\r\n        s.text.forEach((k, i) => {\r\n          if (Array.isArray(k)) {\r\n            k.forEach(ki => {\r\n              if (\r\n                'default' === ki.id ||\r\n                DataHandler.checks[ki.type](this.site.valueOf(ki.id), this.site.valueOf(ki.value))\r\n              )\r\n                k = ki.text\r\n            })\r\n          }\r\n          if (this.depends.has(k)) {\r\n            ;(s.parts.children[i] as HTMLElement).innerText = this.depends.get(k).parsed\r\n          } else if (k in s.button) {\r\n            let text = ''\r\n            s.button[k].text.forEach(b => {\r\n              text = (this.depends.has(b) ? this.depends.get(b).parsed : b) + text\r\n            })\r\n            ;(s.parts.children[i] as HTMLElement).innerText = text\r\n          } else (s.parts.children[i] as HTMLElement).innerText = k\r\n        })\r\n        if (Array.isArray(this.text[i])) {\r\n          this.e.children[i].innerHTML = ''\r\n          this.e.children[i].appendChild(s.parts)\r\n        } else s.parts.classList.remove('hidden')\r\n      } else {\r\n        if (Array.isArray(o)) {\r\n          o.forEach(p => p.parts.classList.add('hidden'))\r\n        } else {\r\n          o.parts.classList.add('hidden')\r\n        }\r\n      }\r\n    })\r\n  }\r\n  prep(text: Text) {\r\n    if (!('button' in text)) text.button = {}\r\n    if ('string' === typeof text.text) text.text = [text.text]\r\n    text.parts = document.createElement('span')\r\n    text.text.forEach(k => {\r\n      if (k in text.button) {\r\n        const p = text.button[k],\r\n          button = document.createElement('button')\r\n        text.parts.appendChild(button)\r\n        button.type = 'button'\r\n        p.trigger = tooltip_trigger.bind({id: this.id + p.text, note: p.target, wrapper: button})\r\n        if ('note' === p.type) {\r\n          button.setAttribute('aria-description', p.target as string)\r\n          button.dataset.of = this.id + p.text\r\n          button.className = 'has-note'\r\n          button.addEventListener('mouseover', p.trigger)\r\n          button.addEventListener('focus', p.trigger)\r\n          button.addEventListener('blur', this.site.page.tooltip_clear)\r\n        } else {\r\n          button.className = 'btn btn-link'\r\n          if (!Array.isArray(p.target)) p.target = [p.target]\r\n          const m = new Map()\r\n          p.target.forEach(t => {\r\n            const u = this.site.inputs[t],\r\n              k = p.type as keyof typeof u\r\n            if (u && 'function' === typeof u[k]) m.set(t, u[k])\r\n          })\r\n          if (m.size) {\r\n            button.setAttribute('aria-label', p.text.join(''))\r\n            button.addEventListener(\r\n              'click',\r\n              function (this: Map<string, () => void>) {\r\n                this.forEach(f => f())\r\n              }.bind(m)\r\n            )\r\n          }\r\n        }\r\n      } else {\r\n        text.parts.appendChild(document.createElement('span'))\r\n      }\r\n      if (k in this.site.inputs) this.depends.set(k, {id: k, parsed: ''})\r\n    })\r\n    if ('condition' in text) {\r\n      for (let i = text.condition.length; i--; ) {\r\n        const c = text.condition[i]\r\n        if (c.id) {\r\n          if ('default' === c.id) {\r\n            c.check = function () {\r\n              return true\r\n            }\r\n          } else {\r\n            this.depends.set(c.id, c)\r\n            c.site = this.site\r\n            c.check = function (this: SiteCondition) {\r\n              return (\r\n                'default' === this.id ||\r\n                DataHandler.checks[this.type](this.site.valueOf(this.id), this.site.valueOf(this.value))\r\n              )\r\n            }.bind(c)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","adopt","then","apply","SuppressedError","defaults","file_format","table_format","features","ID","Name","feature_conditions","variables","filter_by","conditions","options","filter_components","group_checks","v","this","includes","indexOf","excludes","export_checks","a","include","vars","i","length","vector_summary","vec","range","Array","isArray","n","Math","min","r","missing","first","Infinity","mean","sum","max","last","on","isNaN","Number","patterns","seps","comma","word_start","single_operator","greater","less","operator_start","component","number","non_letter_num","entity","time_range","feats","sep","group","meta","times","op","time","tr","Object","keys","forEach","f","yn","y","k","vc","code","data","trange","NaN","push","join","ranges","exporter","query_string","entities","in_browser","all_data","data_ready","query","parse_query","params.options","params.defaults","row_writers","res","statusCode","headers","body","inc","split","exc","exclude","JSON","parse","stringify","rows","rw","bind","no_filter","no_feature_filter","in_group","dataset","operator","malformed","ii","format_label","variable_codes","name","vi","overall","map","first_entity","id","filter","pass","substring","check","passes_feature_filter","s","adjs","c","info","co","time_component","passes_filter","filename","short_name","toLowerCase","replace","document","createElement","appendChild","rel","target","download","href","URL","createObjectURL","Blob","type","setTimeout","dispatchEvent","MouseEvent","revokeObjectURL","removeChild","t","is_time","d","row","offset","o","format_value","int","settings","digits","toFixed","label","l","w","toUpperCase","sets","loaded","site_file","schema","fields","ids","_meta","is_single","sort","datasets","views","full_name","measure","long_name","variable_info","load_id_maps","id_maps","metadata","has_map","data_maps","retrieved","resource","entity_features","map_entities","queue","map_content","entity_info","ingest_map","window","require","get","req","protocol","host","path","end","XMLHttpRequest","onreadystatechange","url","fi","readyState","status","Error","responseText","open","send","m","field","hooks","data_load","sort_a1","b","init","inited_summary","view_names","view","order","selected_order","selected_summaries","summaries","state","table","ny","da","entity_count","at","Uint32Array","Uint16Array","Uint8Array","is_string","summary","rank","subset_rank","dak","ev","level_ids","freeze","eview","isFrozen","filled","q3","norm_median","break_median","lower_median_min","lower_median_range","upper_median_min","upper_median_range","norm_mean","break_mean","lower_mean_min","lower_mean_range","upper_mean_min","upper_mean_range","median","q1","mode","levels","seal","quantile","p","x","ap","bp","ceil","floor","calculate","full","data_processed","summaryId","init_summary","summary_ready","variable","valid","summary_set","summary_selection","selection","all","mo","mso","subset","n_selected","mss","ms","moy","msoy","oi","en","present","isFinite","bmd","bme","data_queue","id_vars","vn","ve","g","inited","retriever","DataHandler","retrievers","infos","si","overwrite","entity_tree","parents","children","relations","id_length","sl","get_value","data_promise","onload","prototype","hasOwnProperty","call","all_data_ready","ps","any","category","variant","desc","replace_dynamic","lastIndex","exec","ss","test","prepare_source","default","q","aq","aqi","tf","checks","undefined","adj","multi","condition","constructor","dataview","dynamic_load","references","load_requests","retrieve","ingest_data","formatter.value","formatter.label","ingester.data","ingester.map","ingester.id_maps","summary.init","calculate_summary","summary.calculate","map_variables","mapper.variables","mapper.entities","parser.query","export","get_variable","partial_init","dataviews","measure_info","base","bn","categories","variants","cats","cn","cs","vs","assign","temp","long_description","short_description","parser.measure_info","_references","package","dp","resources","equals","palette","background_highlight","border","border_highlight_true","border_highlight_false","GlobalView","site","registered","Map","selected","select_ids","filters","states","id_state","filter_state","parsed","agg","as_state","time_agg","active","id_filter","inputs","page","modal","entity_inputs","source","period","all_periods","properties","minmax","int_types","end_punct","mustache","measure_name","http","bool","leading_zeros","url_spaces","hashes","embed_setting","location_string","time_ref","pre_colon","exclude_query","space","has_html","bracket_content","html_tags","html_attributes","id_escapes","repo","basename","storage","location","pathname","perm","localStorage","copy","set","opt","getItem","setItem","Subscriptions","subs","add","update","fun","tu","outputs","u","keymap","Enter","NumpadEnter","ArrowUp","Home","ArrowDown","End","Escape","Tab","Time","toggle_input","enable","classList","contains","removeAttribute","remove","input_element","setAttribute","fill_ids_options","out","onend","loader","removeEventListener","set_current","current_set","values","display","current","disp","combobox","ck","sensitive","groups","by_name","accordion","listbox","ugroup","ee","className","innerText","role","for","lastElementChild","querySelectorAll","fill_levels_options","lk","tooltip_trigger","spec","hide_tooltips","tooltip","showing","firstElementChild","note","wrapper","getBoundingClientRect","style","left","width","top","height","make_summary_table","formatter","parent","additional","h","th","td","lower","make_variable_source","div","span","date_accessed","location_url","cv","uv","parseFloat","valueOf","conditionals","reset","max_indicator","min_indicator","no_view","va","option_sets","optionSource","url_set","url_options","ck_suffix","firstChild","textContent","clearable","fill_variables_options","fresh","selection_subset","innerHTML","ns","selectedIndex","setting","theme","plotly","update_theme","tiles","removeFrom","addTo","history","replaceState","Date","now","hide_url_parameters","get_options_url","script_style","sheet","insertRule","deleteRule","mu","overlay","clearLayers","overlay_control","tag_id","gtag","analytics_storage","global_update","event_category","event_label","filtered","filtered_index","index","time_filters","dependencies","ci","passive","tv","su","retain_state","current_default","palettes","rdylbu7","colors","orrd7","gnbu7","brbg7","puor7","prgn6","reds5","greens5","paired4","greys4","grey","brown","purple","prgn","puor","rdbu","vik","lajolla","BaseInput","input","current_index","previous","optionsource","selectionsubset","depends","elementCount","getAttribute","autotype","parentElement","trigger","addEventListener","tagName","querySelector","tooltip_clear","options_filter","current_filter","set_current_options","to","deferred","request_queue","time_funs","component_fun","SiteDataView","id_source","variable_values","feature_values","full_filter","add_dependency","compile","reparse","size","passed","failed","single_id","ids_check","comp_fun","clear","value_type","InputCombobox","super","hover_index","cleared_selection","expanded","container","reformat_label","resize","toggle","highlight","filterer","close","set_selected","use_display","search","childElementCount","focus","et","action","strict","preventDefault","filter_index","clear_highlight","filter_reset","nextElementSibling","previousElementSibling","port","item","scrollTo","scrollTop","bottom","button","ou","screen","option","create","main","lab","floating","of","autocomplete","title","tabIndex","splice","onchange","noadd","description","TutorialManager","tutorials","elements","resetter","backdrop","menu","frame","header","dialog","timer","progress","continue","in_progress","waiting","current_step","current_time","site_elements","site_reset","start_tutorial","progress_tutorial","execute_step","end_tutorial","insertAdjacentElement","start","manager","n_steps","steps","before","setting_display","part","retrieve_element","current_site_element","text","error","event","click","console","isClick","clearTimeout","focuser","clearInterval","running_timer","handle_object","obj","do_action","set_value","current_element","Event","KeyboardEvent","trimStart","after","scrollIntoView","wait","disabled","disable_continue","availHeight","marginLeft","setInterval","make_variable_reference","author","j","family","given","year","journal","volume","fontStyle","version","doi","PageMenu","timeout","hide","has_toggler","toggler","side","top_menu","content_bounds","right","right_menu","bottom_menu","left_menu","content","trigger_resize","Page","menus","sources","origin","source_file","variable_filters","entity_filters","outer_right","render_credits","show_variable_info","load_screen","getElementById","wrap","navbar","panel","navcolor","hash","backgroundColor","hide_logo","hide_title","hide_navcontent","brand","nav","hide_panels","panels","init_panel","head","theme_dark","init_variable_info","init_filter","global_reset","close_menus","reverse","registered_inputs","marginTop","bw","ul","tags","set_description","unit","aggregation_method","citations","_references_parsed","reference","element","link","filter_select","filter_table","add_filter_condition","presets","select","Dataset","First","Last","heads","cells","format","checked","comp_select","selectedOptions","value_select","value_source","delete","credit_output","credits","li","InputVirtual","value_types","percent","minute","minutes","dollars","BaseOutput","tab","InfoPart","ref","show_summary","caller","color","summary_levels","endpoint","notification","effects","api","fv","navigator","clipboard","writeText","clear_storage","buttongroup","listen","up","down","off_default","min_ref","max_ref","default_min","default_max","radio","switch","checkbox","has_default","processed","parts","minHeight","show","revert","var","parse_variables","subto","fill_summary_table","viewFilter","ei","layers","overlays","fresh_shapes","has_time","by_time","triggers","vstate","cstate","reference_options","queue_init","mouseover","mouseout","show_overlay","dep","click_ref","clickto","overlays_from_measures","layer","L","featureGroup","displaying","control","setPosition","addOverlay","tileLayer","shapes","shape","mapId","maps","background_shapes","match_time","retrieve_layer","property_summaries","fs","fa","highlight_style","weight","polygon_outline","fillOpacity","setStyle","default_style","feature","id_property","map_time","background_top","background_polygon_outline","map_overlay","ys","parseInt","time_input","varc","_zoomAnimated","map_animations","skl","fg","cl","interactive","bringToBack","bringToFront","flyToBounds","getBounds","fitBounds","color_by_order","color_scale_center","ls","_layers","lsi","es","fillColor","get_color","callback","_raw","process_layer","callbacks","layerId","geoJSON","onEachFeature","pointToLayer","point","coords","circleMarker","props","propagatedFrom","_tooltip","bindTooltip","openTooltip","overlay_property_selectors","fill_overlay_properties_options","circle_property","prop_summary","eachLayer","setRadius","circle_radius","opacity","previous_span","traces","colorTime","pl","textfont","line","marker","hoverinfo","base_trace","trace","make_data_entry","Plotly","addTraces","deleteTraces","newPlot","layout","config","points","fullData","restyle","varx","vary","varcol","x_range","y_range","display_time","jump","fn","lim","trace_limit","show_empty_times","boxplots","iqr_box","box","upperfence","lowerfence","med","_","yaxis","xaxis","autorange","any_skipped","yinfo","log","dtick","react","total","yr","xr","dark_theme","getComputedStyle","font","modebar","paper_bgcolor","plot_bgcolor","bgcolor","_fullLayout","showgrid","gridcolor","borderColor","relayout","datatable","time_index","pending","rowIds","variable_header","variable_source","single_variable","render","row_time","wide","table_autoscroll","table_scroll_behavior","node","columns","$","DataTable","destroy","empty","nshowing","column","visible","selector","varstate","renderer","draw","cssRules","table_autosort","scroll","behavior","_DT_CellIndex","current_variable","scrollHeight","createHeader","appendRows","dn","entityId","col","legend","bins","lock","cooldown","integer","ticks","center","current_palette","scale","string","po","var_info","ep","pn","nc","refresh","odd","remake","prop","background","clientX","relatedTarget","prep","ki","has","registered_outputs","tree","lock_after","parsed_query","rule_conditions","dataLayer","poly_channel","ch","pos","coefs","pow","run_queue","rules","rule","us","drop_load_screen","new_display","selectionSubset","removeItem","reload","fire","refresh_conditions","is_view","is_global","dd","di","conditional","du","ri","utils.toggle_input","args","tracking","arguments","visibility","tutorial","uid","_n","which","pal","centered","fixed","stat","center_source","upper","bound_ref","value_range"],"mappings":"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","x_google_ignoreList":[0]}