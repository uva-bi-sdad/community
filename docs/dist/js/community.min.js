!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e={rdylbu7:{name:"Red-Yellow-Blue (7)",type:"discrete",colors:["#d73027","#fc8d59","#fee090","#adadad","#e0f3f8","#91bfdb","#4575b4"]},orrd7:{name:"Orange-Red (7)",type:"discrete",colors:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"]},gnbu7:{name:"Green-Blue (7)",type:"discrete",colors:["#a8ddb5","#ccebc5","#f0f9e8","#adadad","#4eb3d3","#2b8cbe","#08589e"]},brbg7:{name:"Brown-Teal (7)",type:"discrete",colors:["#8c510a","#d8b365","#f6e8c3","#adadad","#c7eae5","#5ab4ac","#01665e"]},puor7:{name:"Purple-Orange (7)",type:"discrete",colors:["#b35806","#f1a340","#fee0b6","#adadad","#d8daeb","#998ec3","#542788"]},prgn6:{name:"Purple-Green (6)",type:"discrete",colors:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"]},reds5:{name:"Red (5)",type:"discrete",colors:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"]},greens5:{name:"Green (5)",type:"discrete",colors:["#ffffcc","#c2e699","#78c679","#31a354","#006837"]},paired4:{name:"Blue-Green (4)",type:"discrete",colors:["#1f78b4","#a6cee3","#b2df8a","#33a02c"]},greys4:{name:"Grey (4)",type:"discrete",colors:["#f7f7f7","#cccccc","#969696","#525252"]},grey:{name:"Grey",type:"continuous",colors:[[[70,70,70],[80,80,80]],[150,150,150],[[230,230,230],[-80,-80,-80]]]},brown:{name:"Brown",type:"continuous",colors:[[[131,30,0],[62,85,95]],[193,115,95],[[255,200,190],[-62,-85,-95]]]},purple:{name:"Purple",type:"continuous",colors:[[[90,14,213],[52.5,89,16]],[142.5,103,229],[[195,192,245],[-52.5,-89,-16]]]},prgn:{name:"Purple-Green",type:"continuous-divergent",colors:[[[27,120,55],[207,107,168.5]],[234,227,223.5],[[118,42,131],[116,185,92.5]]]},puor:{name:"Purple-Orange",type:"continuous-divergent",colors:[[[179,88,6],[56,133,202.5]],[235,221,208.5],[[84,39,136],[151,182,72.5]]]},rdbu:{name:"Red-Blue",type:"continuous-divergent",colors:[[[69,117,180],[170,116.5,16]],[239,233.5,196],[[215,48,39],[24,185.5,157]]]},vik:{name:"vik",type:"continuous-polynomial",colors:[[97.031,18.4251,.4149],[461.7602,637.5326,244.4647],[-2434.798,-2838.5427,-5893.4695],[9665.3469,14405.823,44072.722],[-2575.9109,-25871.106,-109792.1319],[-42510.0569,8528.3288,120953.8594],[63342.3061,14006.291,-59644.4457],[-26045.0391,-8868.9621,10155.5667]]},lajolla:{name:"lajolla",type:"continuous-polynomial",colors:[[256.0016,255.9138,204.945],[-187.6735,-46.2889,-768.5655],[1022.785,-1057.5602,1782.0325],[-2032.382,1490.8271,-1785.9056],[966.8373,-617.1949,567.7715]]}},t={seps:/[\s,/._-]+/g,period:/\./,all_periods:/\./g,word_start:/\b(\w)/g,settings:/^settings?\./,features:/^features?\./,filter:/^filter\./,data:/^data\./,variables:/^variables?\./,properties:/prop/,palette:/^pal/,datasets:/^dat/,variable:/^var/,levels:/^lev/,ids:/^ids/,minmax:/^m[inax]{2}$/,int_types:/^(?:year|int|integer)$/,end_punct:/[.?!]$/,mustache:/\{(.*?)\}/g,measure_name:/(?:^measure|_name)$/,http:/^https?:\/\//,bool:/^(?:true|false)$/,number:/^[\d-][\d.,]*$/,leading_zeros:/^0+/,url_spaces:/%20/g,hashes:/#/g,embed_setting:/^(?:hide_|navcolor|close_menus)/,median:/^med/i,location_string:/^[^?]*/,time_ref:/\{time\}/g,pre_colon:/^[^:]*:/,exclude_query:/^(?:features|time_range|id)$/,space:/\s+/,has_equation:/<math/,bracket_content:/(?:^|>)[^<]*(?:<|$)/,math_tags:/^(?:semantics|annotation|annotation\-xml|m)/,math_attributes:/^(?:xmlns|display|displaystyle|style|encoding|stretchy|alttext|scriptlevel|fence|math)/,id_escapes:/(?<=#[^\s]+)([.[\](){}?*-])/g,repo:/\.com\/([^\/]+\/[^\/]+)/,basename:/^.*\//},i={percent:function(e){return e+"%"},"drive time":function(e){return e+" minutes"},minutes:function(e){return e+" minutes"},dollars:function(e){return"$"+e},"Mb/s":function(e){return e+" Mbps"}},a={time:"time",dataview:"default_view",palette:"vik",background_highlight:"#adadad",border:"#7e7e7e",border_highlight_true:"#ffffff",border_highlight_false:"#000000",missing:"#00000000"},s={dataset:"Overall",filtered:"Filtered",children:"Unfiltered selection",all:"Selection"};var n=function(){function e(e,i,a){var s=this;this.container=document.createElement("div"),this.backdrop=document.createElement("div"),this.highlight=document.createElement("div"),this.menu=document.createElement("div"),this.frame=document.createElement("div"),this.header=document.createElement("p"),this.dialog=document.createElement("p"),this.timer=document.createElement("div"),this.progress=document.createElement("div"),this.continue=document.createElement("button"),this.in_progress="",this.waiting=!1,this.current_step=0,this.current_time=0,this.tutorials=e,this.site_elements=i||{},this.site_reset=a||function(){},this.start_tutorial=this.start_tutorial.bind(this),this.progress_tutorial=this.progress_tutorial.bind(this),this.execute_step=this.execute_step.bind(this),this.end_tutorial=this.end_tutorial.bind(this),document.body.appendChild(this.menu),this.menu.id="community_tutorials_menu",this.menu.className="modal fade",this.menu.tabIndex=-1;var n=document.createElement("div");this.menu.appendChild(n),n.className="modal-dialog modal-dialog-scrollable",n.appendChild(n=document.createElement("div")),n.className="modal-content",n.appendChild(n=document.createElement("div")),n.className="modal-header",n.appendChild(n=document.createElement("p")),n.className="modal-title h5",n.innerText="Tutorials";var r=document.createElement("button");n.insertAdjacentElement("afterend",r),r.type="button",r.className="btn-close",r.setAttribute("data-bs-dismiss","modal"),r.setAttribute("aria-label","Close");var l=document.createElement("div");this.menu.lastElementChild.lastElementChild.appendChild(l),l.className="modal-body",Object.keys(e).forEach((function(i){var a=e[i],n=document.createElement("div"),r=document.createElement("div"),o=document.createElement("button");a.manager=s,a.n_steps=a.steps.length;var d=document.createElement("div");if(l.appendChild(n),n.className="tutorial-listing card",n.appendChild(d),d.className="card-header",d.innerText=a.title||i,n.appendChild(d=document.createElement("div")),d.className="card-body",d.appendChild(r),r.appendChild(document.createElement("p")),r.firstElementChild.innerText=a.description||"",a.steps.length&&a.steps[0].before&&!Array.isArray(a.steps[0].before)){var c=a.steps[0].before,h=document.createElement("div"),p=document.createElement("span");h.className="tutorial-initial-settings",h.appendChild(p),p.innerText="Initial Settings",p.className="h6",Object.keys(a.steps[0].before).forEach((function(e,i){var a=document.createElement("p"),s=document.createElement("span");s.className="syntax-variable",s.innerText=e.replace(t.settings,""),a.appendChild(s),(s=document.createElement("span")).className="syntax-operator",s.innerText=" = ",a.appendChild(s),(s=document.createElement("span")).className="syntax-value",s.innerText=c[e],a.appendChild(s),h.appendChild(a)})),r.appendChild(h)}d.appendChild(o),o.type="button",o.className="btn",o.innerText="Start",o.dataset.name=i,o.addEventListener("click",s.start_tutorial)})),document.body.appendChild(this.container),this.container.appendChild(this.backdrop),this.container.className="tutorial-container hidden",this.container.addEventListener("keyup",this.progress_tutorial),this.backdrop.addEventListener("click",this.progress_tutorial),this.backdrop.className="tutorial-backdrop",this.container.appendChild(this.highlight),this.highlight.className="tutorial-highlight",this.highlight.addEventListener("click",this.progress_tutorial),this.container.appendChild(this.frame),this.frame.className="tutorial-frame",this.frame.style.left="50%",this.frame.tabIndex=-1,this.frame.appendChild(n=document.createElement("div")),this.frame.id="community_tutorial_frame",this.frame.role="dialog",this.frame.setAttribute("aria-labelledby","community_tutorial_description"),n.className="tutorial-step card",n.appendChild(n=document.createElement("div")),n.className="card-header",n.appendChild(this.header),this.header.className="card-title",this.header.id="community_tutorial_title",r=document.createElement("button"),n.appendChild(r),r.type="button",r.className="btn-close",r.setAttribute("aria-label","Close Tutorial"),r.addEventListener("click",this.end_tutorial),this.frame.firstElementChild.appendChild(n=document.createElement("div")),n.className="card-body",n.appendChild(this.dialog),this.dialog.role="status",this.dialog.id="community_tutorial_description",this.dialog.setAttribute("aria-labelledby","community_tutorial_progress"),this.dialog.setAttribute("aria-live","polite"),n.lastElementChild.className="card-text",this.frame.firstElementChild.appendChild(n=document.createElement("div")),n.className="tutorial-footer card-footer",n.appendChild(this.progress),this.progress.role="progressbar",this.progress.id="community_tutorial_progress",n.appendChild(this.timer),this.timer.role="timer",n.appendChild(this.continue),this.continue.addEventListener("click",this.progress_tutorial),this.continue.type="button",this.continue.className="btn",this.continue.innerText="Next",this.continue.setAttribute("aria-controls","community_tutorial_frame")}return e.prototype.retrieve_element=function(e){var i;if(e in this.site_elements)this.current_site_element=this.site_elements[e],i=this.current_site_element.e;else if("nav:"===e.substring(0,4).toLowerCase()){var a=e.replace(t.pre_colon,"");document.querySelectorAll(".nav-item button").forEach((function(e){a===e.innerText&&(i=e)}))}else try{i=document.querySelector(e.replace(t.id_escapes,"\\$1"))}catch(e){}return i},e.prototype.start_tutorial=function(e,t){if(this.end_tutorial(),document.querySelectorAll("[data-bs-dismiss]").forEach((function(e){return e.click()})),this.in_progress=t||e.target.dataset.name,!(this.in_progress in this.tutorials))return console.error("tutorial does not exist:",this.in_progress),void(this.in_progress="");this.container.classList.remove("hidden"),this.header.innerText=this.tutorials[this.in_progress].title||this.in_progress,this.current_step=0,this.current_time=0,this.dialog.innerText="Starting tutorial "+this.header.innerText,this.timer.innerText="",this.continue.innerText="Next",this.tutorials[this.in_progress].reset&&this.site_reset(),this.progress_tutorial()},e.prototype.progress_tutorial=function(e){var i=this,a=!e||!e.code;if(a||"Escape"!==e.code||this.end_tutorial(),this.in_progress&&!this.waiting&&(a||"Enter"===e.code||"ArrowRight"===e.code)){this.waiting=!0,clearTimeout(this.focuser),clearInterval(this.running_timer);var s,n=this.tutorials[this.in_progress],r=function(e){Object.keys(e).forEach((function(a){t.number.test(a)?o(e[a]):a in i.site_elements&&i.site_elements[a].set&&i.site_elements[a].set(e[a])}))},l=function(e){if(i.current_site_element&&i.current_site_element.set)i.current_site_element.set(e);else{var t="value"in i.current_element?i.current_element:i.current_element.querySelector("input");t&&(t.value=e,t.dispatchEvent(new Event("change")),t.dispatchEvent(new KeyboardEvent("keydown",{code:"Enter"})))}},o=function(e){if("set"===(e=String(e)))"option"in s&&l(s.option);else if("click"===e)i.current_site_element&&i.current_site_element.toggle&&e===i.current_site_element.id?i.current_site_element.expanded||i.current_site_element.toggle({target:i.current_element}):i.current_element&&i.current_element.click();else if("close"===e)document.querySelectorAll("[data-bs-dismiss]").forEach((function(e){return e.click()}));else if("value"===e.substring(0,5))l(e.replace(t.pre_colon,"").trimStart());else{var a=i.retrieve_element(e);a&&a.click()}};this.current_step>0&&"after"in(s=n.steps[this.current_step-1])&&(Array.isArray(s.after)?s.after.forEach(o):r(s.after)),this.current_step>=n.n_steps?this.end_tutorial():(this.current_site_element=void 0,s=n.steps[this.current_step],this.current_element=this.retrieve_element(s.focus),"before"in s&&(Array.isArray(s.before)?s.before.forEach(o):r(s.before)),this.current_step===n.n_steps-1&&(this.continue.innerText="Finish"),this.current_element&&this.current_element.scrollIntoView&&this.current_element.scrollIntoView(),setTimeout(this.execute_step,"wait"in s?s.wait:400))}},e.prototype.execute_step=function(){var e=this;if(this.in_progress){var t=this.tutorials[this.in_progress],i=t.steps[this.current_step];if(!this.current_element){var a=this.retrieve_element(i.focus);return a?(this.current_element=a,a.scrollIntoView&&a.scrollIntoView(),void setTimeout(this.execute_step,0)):(console.error("failed to retrieve element",i.focus),this.end_tutorial())}this.continue.disabled=!!i.disable_continue;var s=this.current_element.getBoundingClientRect(),n=this.frame.getBoundingClientRect();this.highlight.style.top=s.top+"px",this.highlight.style.left=s.left+"px",this.highlight.style.width=s.width+"px",this.highlight.style.height=s.height+"px",this.frame.style.top=(s.y<screen.availHeight/2?s.y+s.height+10:s.y-n.height-10)+"px",this.frame.style.marginLeft=-n.width/2+"px",i.time?(this.current_time=i.time,this.timer.innerText=i.time+"",this.running_timer=setInterval((function(){e.current_time--,e.timer.innerText=e.current_time+"",e.current_time<=0&&(clearInterval(e.running_timer),e.progress_tutorial())}),1e3)):this.timer.innerText="",this.progress.innerText="Step "+(this.current_step+1)+" of "+t.n_steps,this.dialog.innerText=i.description,this.current_step++,this.waiting=!1,this.focuser=setTimeout((function(){return e.continue.focus()}),0)}},e.prototype.end_tutorial=function(){this.in_progress="",this.current_step=0,this.container.classList.add("hidden"),this.waiting=!1,clearTimeout(this.focuser)},e}();const r=function(r,l,o){const d="button.has-note::after,.button-wrapper.has-note button::before,.has-note legend::before,.has-note label::before,.wrapper.has-note > div > label::before{display:none}",c={setting:function(e){const t=e.value(),i=t?"dark":"light";t!==o.settings[e.setting]&&(o.settings[e.setting]=t,"theme_dark"===e.setting?(t?l.body.classList.replace("light-theme","dark-theme"):l.body.classList.replace("dark-theme","light-theme"),o.plotly&&Object.keys(o.plotly).forEach((e=>R(o.plotly[e].u))),o.map&&Object.keys(o.map).forEach((e=>{const t=o.map[e].u;t&&i in t.tiles&&(Object.keys(t.tiles).forEach((e=>{i!==e&&t.tiles[e].removeFrom(t.map)})),t.tiles[i].addTo(t.map))}))):"hide_url_parameters"===e.setting?r.history.replaceState(Date.now(),"",o.settings.hide_url_parameters?r.location.protocol+"//"+r.location.host+r.location.pathname:te()):"hide_tooltips"===e.setting?t?_.script_style.sheet.insertRule(d,0):_.script_style.sheet.removeRule(0):"map_overlay"===e.setting?Object.keys(o.map).forEach((e=>{"_"!==e[0]&&(t?o.map[e].u.update():(o.map[e].u.overlay.clearLayers(),o.map[e].u.overlay_control.remove()))})):"tracking"===e.setting?(t&&o.tag_id&&!dataLayer.length&&(ae("js",new Date),ae("config",o.tag_id),ae("consent","default",{analytics_storage:"denied"})),ae("consent","update",{analytics_storage:t?"granted":"denied"})):ce(),ae("event","setting",{event_category:e.setting,event_label:t}),u.set(e.setting,o.settings[e.setting]))},options:function(e){const i=!e.view||!o.dataviews[e.view].selection,s=se(e.dataset||i||o.dataviews[e.view].dataset)||a.dataset,n=se(e.variable),r=s+(n||""),l="combobox"===e.type;if(r in e.option_sets||(t.variable.test(e.optionSource)?(-1===e.default&&(e.default=a.variable),q(e,s,e.option_sets)):t.levels.test(e.optionSource)?O(e,s,n,e.option_sets):t.ids.test(e.optionSource)&&A(e,s,e.option_sets)),r in e.option_sets){const a=r!==e.current_set&&(e.sensitive||!e.current_set),s=e[l?"listbox":"e"];if(a||e.filter||e.selection_subset){a&&(s.innerHTML="",e.values=e.option_sets[r].values,e.display=e.option_sets[r].display,e.options=e.option_sets[r].options);let n=0;if("ID"===e.variable||t.ids.test(e.optionSource)){const t=e.value();let r=-1===t||""===t?e.subset:e.selection_subset,l={};if(!i)if(r in C&&(r=se(r)),"siblings"===r){const e=o.data.entity_tree&&o.data.entity_tree[t];if(e){const t=Object.keys(e.parents);t.length&&(l={},t.forEach((e=>{l={...l,...o.data.entity_tree[e].children}})))}}else l=o.dataviews[e.view].selection[r];e.options.forEach((t=>{a&&!e.groups&&s.appendChild(t),i||(t.value||t.dataset.value)in l?(t.classList.remove("hidden"),n++):t.classList.add("hidden")}))}else a?e.options.forEach((t=>{t.classList.remove("hidden"),e.groups||s.appendChild(t),n++})):n++;a&&e.groups&&e.groups.e.forEach((e=>s.appendChild(e))),S(e,n),e.current_set=r,a&&(l?e.source=[]:(e.e.selectedIndex=-1,e.source=""),e.id in o.url_options?e.set(o.url_options[e.id]):e.state in e.values?e.set(e.state):e.reset()),e.filter&&e.filter()}}},set_current:function(){this.values=this.option_sets[this.dataset].values,this.display=this.option_sets[this.dataset].display,this.options=this.option_sets[this.dataset].options,this.source="",this.id in o.url_options?this.set(o.url_options[this.id]):this.state in this.values?this.set(this.state):this.reset()},min:async function(e,i){let a,s=i.value(),n=e.value(),r=C[e.view||i.view];t.minmax.test(s)&&(s=i.parsed.min),r&&r.y&&(a=se(r.y),a in o.data.variables&&(r.time_range.time.length||await c.time_range(r,e,!0),s=Math.max(r.time_range.time[0],parseFloat(s))),e.update()),e.e.min=void 0===e.parsed.min?parseFloat(s):Math.max(e.parsed.min,parseFloat(s)),e.e.value?"number"==typeof n&&isFinite(n)&&n<s&&e.set(s):e.reset(),e.min_indicator&&(e.min_indicator.firstElementChild.innerText=s)},max:async function(e,i){let a,s=i.value(),n=e.value(),r=C[e.view||i.view];t.minmax.test(s)&&(s=i.parsed.max),r&&r.y&&(a=se(r.y),a in o.data.variables&&(r.time_range.time.length||await c.time_range(r,e,!0),s=Math.min(r.time_range.time[1],parseFloat(s))),e.update()),e.e.max=void 0===e.parsed.max?parseFloat(s):Math.min(e.parsed.max,parseFloat(s)),e.e.value?"number"==typeof n&&isFinite(n)&&n>s&&e.set(s):e.reset(),e.max_indicator&&(e.max_indicator.firstElementChild.innerText=s)},dataview:function(e){(e=e||C[a.dataview]).value()!==e.state&&C._entity_filter.registered[e.parsed.dataset]&&(o.data.inited[e.parsed.dataset]?(e.valid=!0,e.n_selected.ids=0,e.n_selected.children=0,e.n_selected.features=0,e.n_selected.variables=0,e.n_selected.dataset=0,e.n_selected.filtered=0,e.n_selected.full_filter=0,e.n_selected.all=0,e.selection.ids={},e.selection.children={},e.selection.features={},e.selection.variables={},e.selection.dataset={},e.selection.filtered={},e.selection.full_filter={},e.selection.all={},C._base_filter.c.forEach((e=>{e.passed=0,e.failed=0})),C._entity_filter.entities.forEach((t=>{const i=e.check(t),a=t.features.id;i.all=0,i.ids&&(e.selection.ids[a]=t,e.n_selected.ids++,i.all++),i.features&&(e.selection.features[a]=t,e.n_selected.features++,i.all++),i.variables&&(e.selection.variables[a]=t,e.n_selected.variables++,i.all++),i.dataset&&(e.selection.dataset[a]=t,e.n_selected.dataset++,i.all++),i.dataset&&i.ids&&(e.selection.children[a]=t,e.n_selected.children++),i.features&&i.variables&&(e.selection.full_filter[a]=t,e.n_selected.full_filter++),i.variables&&i.features&&i.ids&&(e.selection.filtered[a]=t,e.n_selected.filtered++),4===i.all&&(e.selection.all[a]=t,e.n_selected.all++)})),pe(e.id)):(e.valid=!1,o.data.data_queue[e.parsed.dataset][e.id]=function(){return c.dataview(e)}))},time_filters:function(e){e.time_range.filtered[0]=1/0,e.time_range.filtered[1]=-1/0;const t=e.get.dataset(),i=o.data.meta.times[t],a=e.time_range.filtered_index+"";if(o.data.inited[t]){for(let t=i.n;t--;){let a=!1;if(t>=e.time_range.index[0]&&t<=e.time_range.index[1])for(let s=e.time_filters.length;s--;){const n={},r=e.time_filters[s];if(r.value in n||(n[r.value]=se(r.value)),a=DataHandler.checks[r.type](i.value[t],n[r.value]),!a)break}e.times[t]=a,a&&(e.time_range.filtered[0]>i.value[t]&&(e.time_range.filtered[0]=i.value[t]),e.time_range.filtered[1]<i.value[t]&&(e.time_range.filtered[1]=i.value[t]))}if(e.time_range.filtered_index=[e.time_range.index[0]+e.time_range.filtered[0]-e.time_range.time[0],e.time_range.index[1]+e.time_range.filtered[1]-e.time_range.time[1]],a!==e.time_range.filtered_index+""){const t=w[e.id+"_filter"];t&&t.forEach((t=>{"update"===t.type?C[t.id].update():t.type in c&&c[t.type](C[t.id],e)}))}}},time_range:async function(e,t,i){const s=t&&t.value(),n=e.get.dataset(),r=e.time?se(e.time):a.time,l=r in o.data.variables?o.data.variables[r].info[n].min:1,d=w[e.id+"_time"],h=s in o.data.variables?s:se(e.y);let p=h&&await o.data.get_variable(h,e.id);if(p){const t=n+h!=e.time_range.dataset+e.time_range.variable;p=p.time_range[n],-1!==p[0]&&(e.time_range.dataset=n,e.time_range.variable=h,e.time_range.index[0]=p[0],e.time_range.time[0]=e.time_range.filtered[0]=l+p[0],e.time_range.index[1]=p[1],e.time_range.time[1]=e.time_range.filtered[1]=l+p[1]),!i&&d&&(d.forEach((i=>{const a=C[i.id],s=a.value();"min"===i.type?(t||isFinite(e.time_range.time[0])&&parseFloat(a.e.min)!==e.time_range.time[0])&&(a.e.min=e.time_range.time[0],(t||!v.retain_state||e.time_range.time[0]>s)&&(a.current_default=e.time_range.time[0],a.set(a.current_default))):"max"===i.type&&(t||isFinite(e.time_range.time[1])&&parseFloat(a.e.max)!==e.time_range.time[1])&&(a.e.max=e.time_range.time[1],(t||!v.retain_state||e.time_range.time[1]<s||s<e.time_range.time[0])&&(a.current_default=e.time_range.time[1],a.set(a.current_default)))})),c.time_filters(e))}else e.time_range.dataset=n,e.time_range.index[0]=0,e.time_range.time[0]=e.time_range.filtered[0]=1,e.time_range.index[1]=0,e.time_range.time[1]=e.time_range.filtered[1]=1},id_filter:function(){const e={};C._entity_filter.selected=[],C._entity_filter.select_ids=e,o.metadata.datasets&&o.metadata.datasets.forEach((t=>{if(t in _.modal.filter.entity_inputs){const i=_.modal.filter.entity_inputs[t].value(),a=[];i&&i.length&&(i.forEach((t=>{const i=o.data.entities[t];i&&(a.push(t),C._entity_filter.selected.push(t),e[t]=!0,i.relations&&(Object.keys(i.relations.parents).forEach((t=>e[t]=!0)),Object.keys(i.relations.children).forEach((t=>e[t]=!0))))})),_.modal.filter.entity_inputs[t].source=a)}}))}},h={button:{init:function(e){e.target=e.e.getAttribute("data-target"),"copy"===e.target&&(e.settings.endpoint=o.endpoint),"filter"===e.target?(e.e.setAttribute("data-bs-toggle","modal"),e.e.setAttribute("data-bs-target","#filter_display"),e.notification=l.createElement("span"),e.notification.className="filter-notification hidden",e.e.parentElement.appendChild(e.notification),M("_base_filter",{type:"update",id:e.id}),M("_entity_filter",{type:"update",id:e.id}),e.update=h.button.update.bind(e),o.data&&e.update()):e.e.addEventListener("click",e.settings.effects?"export"===e.target||"copy"===e.target?function(){const i={},a=this.settings,s=C[a.dataview],n=s&&s.parsed.dataset;if(Object.keys(a.query).forEach((e=>i[e]=se(a.query[e]))),s&&(!("include"in i)&&s.y&&(i.include=se(s.y)),!("id"in i)&&s.ids&&(i.id=se(s.ids))),"copy"===this.target||this.api){let l=[];"id"in i&&""!==i.id&&-1!=i.id?l.push("id="+i.id):C._entity_filter.selected.length&&l.push("id="+C._entity_filter.selected.join(",")),s&&(i.time_range||s.time_range.filtered_index+""==s.time_range.index+""||l.push("time_range="+o.data.meta.times[n].value[s.time_range.filtered_index[0]]+","+o.data.meta.times[n].value[s.time_range.filtered_index[1]]),s.features||(s.features={}),Object.keys(s.features).forEach((e=>{e in i||(i[e]=se(s.features[e]),Array.isArray(i[e])&&(i[e]=i[e].join(",")),l.push(e+"="+i[e]))})),C._base_filter.c.size&&C._base_filter.value(l,s.parsed.time_agg)),Object.keys(i).forEach((e=>{t.exclude_query.test(e)||e in s.features||l.push(e+"="+i[e])}));const d=a.endpoint+(l.length?"?"+l.join("&"):"");this.api?r.location.href=d:navigator.clipboard.writeText(d).then((()=>{"Copied!"!==e.e.innerText&&(e.text=e.e.innerText,e.e.innerText="Copied!",setTimeout((function(){e.e.innerText=e.text}),500),ae("event","export",{event_category:"api link"}))}),(t=>{t!==e.e.innerText&&(e.text=e.e.innerText,e.e.innerText=t,setTimeout((function(){e.e.innerText=e.text}),1500))}))}else s&&"selection"in s?(i.time_range||(i.time_range=o.data.meta.times[n].value[s.time_range.filtered_index[0]]+","+o.data.meta.times[n].value[s.time_range.filtered_index[1]]),o.data.export(i,s.selection.all,!0)):o.data.export(i,o.data.entities,!0,!0),ae("event","export",{event_category:"download"})}.bind(e):function(){Object.keys(this.settings.effects).forEach((e=>{""===this.settings.effects[e]||-1==this.settings.effects[e]?C[e].reset():C[e].set(this.settings.effects[e])}))}.bind(e):"refresh"===e.target?ce:"reset_selection"===e.target?he:"reset_storage"===e.target?W:function(){this.target in C&&C[this.target].reset()}.bind(e))},update:function(){let e=Number(0!==C._entity_filter.selected.length);C._base_filter.c.forEach((t=>e+=t.active)),e?(this.notification.innerText=e,this.notification.classList.remove("hidden")):this.notification.classList.add("hidden")}},buttongroup:{retrieve:function(){for(let e=this.options.length;e--;)if(this.options[e].checked){this.set(e);break}},setter:function(e){this.previous=this.value(),this.current_index="string"==typeof e?this.values.indexOf(e):e,-1!==this.current_index?(this.source=this.values[this.current_index]in C?C[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,pe(this.id)},listener:function(e){this.set(e.target.value)},adder:function(e,t,i,a){let s=[l.createElement("input"),l.createElement("label")];return s[0].className="btn-check",s[0].type="radio",s[0].name=this.e.id+"_options",s[0].autocomplete="off",s[0].value=t,s[0].id=this.e.id+"_option"+e,s[1].className="btn btn-primary",s[1].innerText=i||o.data.format_label(t),s[1].setAttribute("for",s[0].id),a||(this.e.appendChild(s[0]),this.e.appendChild(s[1])),s[0]}},radio:{retrieve:function(){for(let e=this.options.length;e--;)if(this.options[e].checked){this.set(e);break}},setter:function(e){this.current_index="string"==typeof e?this.values.indexOf(e):e,-1!==this.current_index?(this.source=this.values[this.current_index]in C?C[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,pe(this.id)},listener:function(e){this.set(e.target.value)},adder:function(e,t,i){const a=l.createElement("div"),s="TRUE"===this.e.getAttribute("data-switch");return a.className="form-check"+(s?" form-switch":""),a.appendChild(l.createElement("input")),a.appendChild(l.createElement("label")),a.firstElementChild.autocomplete="off",a.firstElementChild.className="form-check-input",s&&(a.firstElementChild.role="switch"),a.firstElementChild.type="radio",a.firstElementChild.name=this.e.id+"_options",a.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,a.firstElementChild.value=e,a.lastElementChild.innerText=t||o.data.format_label(e),a.lastElementChild.className="form-check-label",a.lastElementChild.setAttribute("for",a.firstElementChild.id),i||this.e.appendChild(a),a.firstElementChild}},checkbox:{retrieve:function(){this.source=[],this.current_index=[],this.off_default=!1,this.options.forEach((e=>{e.checked?(this.source.push(this.values[J]),this.current_index.push(J)):this.off_default=!0})),pe(this.id)},setter:function(e){if("object"==typeof e)this.source=[],this.current_index=[],this.off_default=!1,this.values.forEach(((t,i)=>{-1!==e.indexOf(t)?(this.source.push(t),this.current_index.push(i),this.options[i].checked=!0):(this.off_default=!0,this.options[i].checked=!1)}));else{if("string"==typeof e)return this.set(""===e?this.values:e.split(","));-1!==e&&(this.options[e].checked=!0,this.off_default=!1,this.options.forEach((e=>{e.checked||(this.off_default=!0)})))}pe(this.id)},listener:function(e){if(e.target.checked)this.source.push(e.target.value),this.current_index.push(this.values.indexOf(e.target.value)),this.off_default=!1,this.options.forEach((e=>{e.checked||(this.off_default=!0)}));else{let t=this.source.indexOf(e.target.value);-1!==t&&(this.off_default=!0,this.source.splice(t,1),this.current_index.splice(t,1))}pe(this.id)},adder:function(e,t,i){let a=l.createElement("div"),s="TRUE"===this.e.getAttribute("data-switch");return a.className="form-check"+(s?" form-switch":""),a.appendChild(l.createElement("input")),a.appendChild(l.createElement("label")),a.firstElementChild.autocomplete="off",a.firstElementChild.className="form-check-input",s&&(a.firstElementChild.role="switch"),a.firstElementChild.type="checkbox",a.firstElementChild.name=this.e.id+"_options",a.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,a.firstElementChild.value=e,a.lastElementChild.innerText=t||o.data.format_label(e),a.lastElementChild.className="form-check-label",a.lastElementChild.setAttribute("for",a.firstElementChild.id),i||this.e.appendChild(a),a.firstElementChild}},switch:{retrieve:function(){this.set(this.e.checked)},setter:function(e){"string"==typeof e&&(e="on"===e||"true"===e),e!==this.source&&(this.previous=this.e.checked,this.e.checked=this.source=e,pe(this.id))},listener:function(){this.set(this.e.checked)}},number:{init:function(e){const t=e.e.parentElement.parentElement.querySelector(".number-up"),i=e.e.parentElement.parentElement.querySelector(".number-down");i&&i.addEventListener("click",function(){this.set(Math.max(this.parsed.min,this.value()-1))}.bind(e)),t&&t.addEventListener("click",function(){this.set(Math.min(this.parsed.max,this.value()+1))}.bind(e))},retrieve:function(){this.set(this.e.value)},setter:function(e,t){e||(e=null),"string"==typeof e&&(e=parseFloat(e)),isFinite(e)&&e!==this.source&&(this.previous=parseFloat(this.e.value),t&&(isFinite(this.parsed.min)&&e<this.parsed.min?e=this.parsed.min:isFinite(this.parsed.max)&&e>this.parsed.max&&(e=this.parsed.max)),this.off_default=e!==this.current_default,this.e.value=this.source=e,this.current_index=e-this.parsed.min,"range"===this.e.type&&(this.e.nextElementSibling.firstElementChild.innerText=this.e.value),pe(this.id))},listener:function(e){this.set(this.e.value,!0)}},intext:{retrieve:function(){this.set(this.e.value)},setter:function(e,t){this.previous=this.e.value,this.e.value=this.source=e,pe(this.id)},listener:function(e){this.set(this.e.value,!0)}},text:{init:function(e){o.text&&e.id in o.text&&(e.text=o.text[e.id].text,e.condition=o.text[e.id].condition||[],e.depends=new Map,e.text.forEach((t=>{"text"in t?(N(e,t),e.e.appendChild(t.parts)):(e.e.appendChild(l.createElement("span")),t.forEach((t=>N(e,t))))})),e.condition.forEach((t=>{t.id in C&&M(t.id,{type:"display",id:e.id})})),e.depends.forEach((t=>M(t.id,{type:"update",id:e.id}))),e.update=h.text.update.bind(e)),e.update()},update:function(){Object.keys(this.reference_options).forEach((e=>this.options[e]=se(this.reference_options[e]))),this.depends.forEach((e=>{e.parsed=se(e.id),e.u?e.u.options?e.parsed=e.u.options[e.u.values[e.parsed]].innerText:e.parsed=e.u.display&&e.parsed in e.u.display?e.u.display[e.parsed]:o.data.format_label(e.parsed):e.parsed in o.data.entities&&(e.parsed=o.data.entities[e.parsed].features.name)})),this.text.forEach(((e,t)=>{let i=!0;if(e.length){for(let t=e.length;t--;)if("condition"in e[t]){for(let a=e[t].condition.length;a--&&(i=e[t].condition[a].check(),i););if(i){e=e[t];break}}}else if("condition"in e)for(let t=e.condition.length;t--&&(i=e.condition[t].check(),i););i?(e.text.forEach(((t,i)=>{if(Array.isArray(t)&&t.forEach((e=>{("default"===e.id||DataHandler.checks[e.type](se(e.id),se(e.value)))&&(t=e.text)})),this.depends.has(t))e.parts.children[i].innerText=this.depends.get(t).parsed;else if(t in e.button){let a="";e.button[t].text.forEach((e=>{a=(this.depends.has(e)?this.depends.get(e).parsed:e)+a})),e.parts.children[i].innerText=a}else e.parts.children[i].innerText=t})),this.text[t].length?(this.e.children[t].innerHTML="",this.e.children[t].appendChild(e.parts)):e.parts.classList.remove("hidden")):e.parts.classList.add("hidden")}))}},select:{retrieve:function(){this.set(this.e.selectedIndex)},setter:function(e){"string"==typeof e&&!(e in this.values)&&t.number.test(e)&&(e=Number(e)),"number"==typeof e&&(e=this.options[e]?this.options[e].value:e),!(e in this.values)&&e in this.display&&(e=this.options[this.display[e]].value),e!==this.source&&(this.e.selectedIndex=e in this.values?this.values[e]:-1,this.source=e,pe(this.id))},listener:function(e){this.set(e.target.selectedIndex)},adder:function(e,t,i,a){const s=l.createElement("option");return s.value=e,s.innerText=t||o.data.format_label(e),i&&i.info&&(s.title=i.info.description||i.info.short_description),a||this.e.appendChild(s),s}},combobox:{create:function(e,i,a,s){s=s||"created_combobox_"+ ++_.elementCount;const n=l.createElement("div");let r=l.createElement("div"),d=l.createElement("div");a&&(o.combobox||(o.combobox={}),o.combobox[s]=a),r.className="wrapper combobox-wrapper",a&&a.floating&&(r.appendChild(d),d.className="form-floating",d.dataset.of=s,r=d),r.appendChild(n),n.id=s,n.setAttribute("data-autoType","combobox"),n.className="auto-input form-select combobox combobox-component",n.role="combobox",n.appendChild(d=l.createElement("div")),d.className="combobox-selection combobox-component",d.appendChild(l.createElement("span")),d.lastElementChild.className="combobox-component",d.lastElementChild.setAttribute("aria-live","assertive"),d.lastElementChild.setAttribute("aria-atomic","true"),d.lastElementChild.setAttribute("aria-role","log"),d.appendChild(d=l.createElement("input")),d.setAttribute("aria-haspopup","listbox"),d.setAttribute("aria-expanded","false"),d.setAttribute("aria-controls",s+"-listbox"),d.className="combobox-input combobox-component",d.type="text",d.role="combobox",d.id=s+"-input",d.autocomplete="off",a&&a.clearable&&(r.firstElementChild.appendChild(d=l.createElement("button")),d.type="button",d.className="btn-close",d.title="clear selection"),r.appendChild(d=l.createElement("div")),d.className="combobox-options combobox-component",d.setAttribute("aria-labelledby",s+"-label"),d.role="listbox",d.tabindex="-1",d.id=s+"-listbox",r.appendChild(d=l.createElement("label")),d.id=s+"-label",d.innerText=e,d.setAttribute("for",s+"-input"),h.init_input(n);const c=C[s];let p=0;return c.options=[],i&&(Array.isArray(i)?i.forEach((e=>{const t=o.data.format_label(e);c.display[t]=p,c.values[e]=p++,c.options.push(c.add(e,t))})):(c.groups={e:[],by_name:{}},Object.keys(i).forEach((e=>{const a=i[e],s=l.createElement("div"),n=c.id+"_group_"+e.replace(t.seps,"-");s.className="combobox-group combobox-component",s.setAttribute("aria-labelledby",n),s.appendChild(l.createElement("label")),s.firstElementChild.innerText=e,s.firstElementChild.id=n,s.firstElementChild.className="combobox-group-label combobox-component",c.groups.by_name[e]=s,c.groups.e.push(s),a.forEach((t=>c.groups.by_name[e].appendChild(c.add(t,t,!0)))),c.listbox.appendChild(s)})),Object.keys(c.groups.by_name).forEach((e=>{c.groups.by_name[e].querySelectorAll(".combobox-option").forEach((t=>{c.options.push(t),t.setAttribute("data-group",e),c.values[t.dataset.value]=p,c.display[t.innerText]=p++}))})))),c},init:function(e){if(e.hover_index=-1,e.cleared_selection="",e.expanded=!1,e.settings.use_display=e.settings.search||e.settings.multi,e.listbox=e.e.parentElement.children[1],e.options=e.listbox.querySelectorAll(".combobox-option"),e.options.length){e.values={},e.display={},e.options.forEach(((t,i)=>{e.values[t.dataset.value]=i,e.display[t.innerText]=i}));const t=e.listbox.querySelectorAll(".combobox-group");t.length&&(e.groups={e:[],by_name:{}},t.forEach((t=>{const i=t.dataset.group;e.groups.e[i]=t,e.groups.by_name[i]=t})))}e.container=l.createElement("div"),e.container.className="combobox-options-container combobox-component hidden",_.overlay.appendChild(e.container),e.container.appendChild(e.listbox),e.selection=e.e.firstElementChild.firstElementChild,e.input_element=e.e.firstElementChild.lastElementChild,2===e.e.childElementCount&&e.e.lastElementChild.addEventListener("click",function(){this.e.classList.contains("locked")||(this.cleared_selection="",this.set([]),this.input_element.focus())}.bind(e)),e.value=function(){return this.source?this.settings.multi?this.source:this.source.length?this.source[0]:"":se(this.default)}.bind(e),e.set_selected=function(e){if(e in this.values){const t=this.options[this.values[e]];t.classList.add("selected"),t.setAttribute("aria-selected","true")}}.bind(e),e.input_element.addEventListener("focus",function(){this.e.classList.add("focused")}.bind(e)),e.input_element.addEventListener("blur",function(){this.e.classList.remove("focused")}.bind(e)),e.listbox.addEventListener("click",e.set),e.close=function(t){!this.expanded||t&&t.target.classList&&t.target.classList.contains("combobox-component")||(this.settings.use_display&&""===this.selection.innerText&&this.source.length&&(this.selection.innerText=this.cleared_selection),""!==this.input_element.value&&setTimeout(this.set,0),this.e.setAttribute("aria-expanded","false"),this.expanded=!1,this.container.classList.add("hidden"),r.removeEventListener("click",e.close))}.bind(e),e.resize=function(){const e=this.e.getBoundingClientRect();this.container.style.left=e.x+"px",this.container.style.width=e.width+"px",r.screen.height/2>e.y?(this.container.style.top=e.y+e.height+"px",this.container.style.bottom=""):(this.container.style.top="",this.container.style.bottom=-e.y+"px")}.bind(e),r.addEventListener("resize",e.resize),e.toggle=function(e){e.button||this.e.classList.contains("disabled")||"BUTTON"===e.target.tagName||(this.expanded?e.target!==this.input_element&&this.close():(o.combobox&&Object.keys(o.combobox).forEach((e=>{if(e!==this.id){const t=C[e];t.expanded&&t.close()}})),this.container.classList.remove("hidden"),""!==this.selection.innerText&&(this.cleared_selection=this.selection.innerText),this.cleared_selection in this.display&&this.highlight({target:this.options[this.display[this.cleared_selection]]}),this.settings.use_display&&(this.selection.innerText=""),r.addEventListener("click",this.close),this.e.setAttribute("aria-expanded","true"),e&&e.target===this.input_element||setTimeout((()=>this.input_element.focus()),0),this.resize(),this.expanded=!0))}.bind(e),e.e.addEventListener("mousedown",e.toggle),e.highlight=function(e){if(!e||!e.target||e.target.dataset.value in this.values){this.groups||(this.settings.accordion=!1),e&&e.target&&e.target.dataset.value?this.hover_index=this.values[e.target.dataset.value]:-1===this.hover_index&&this.source&&(this.hover_index=this.values[this.source[0]]),void 0===this.hover_index&&(this.hover_index=-1);const t=this.options[this.hover_index];if(t){const i=this.listbox.querySelector(".highlighted");if(i&&i.classList.remove("highlighted"),e&&"mouseover"===e.type)e.target.classList.add("highlighted");else{if(t.classList.add("highlighted"),this.settings.accordion){const e=t.parentElement.parentElement;e.classList.contains("show")||(e.classList.add("show"),e.previousElementSibling.firstElementChild.classList.remove("collapsed"),e.previousElementSibling.firstElementChild.setAttribute("aria-expanded","true"))}this.input_element.setAttribute("aria-activedescendant",t.id);const e=this.container.getBoundingClientRect(),i=t.getBoundingClientRect();let a=e.top;this.groups&&t.getAttribute("data-group")&&(a+=this.groups.by_name[t.getAttribute("data-group")].firstElementChild.getBoundingClientRect().height),a>i.top?this.container.scrollTo(0,this.container.scrollTop+i.top-a):e.bottom<i.bottom&&this.container.scrollTo(0,this.container.scrollTop+i.bottom-e.bottom)}}}}.bind(e),e.listbox.addEventListener("mouseover",e.highlight),e.settings.accordion&&e.listbox.addEventListener("show.bs.collapse",(t=>{(-1===e.hover_index?"":e.options[e.hover_index].getAttribute("data-group"))!==t.target.getAttribute("data-group")&&(e.highlight({target:t.target.firstElementChild.firstElementChild}),e.input_element.focus())})),e.clear_highlight=function(){-1!==this.hover_index&&(this.options[this.hover_index].classList.remove("highlighted"),this.hover_index=-1)}.bind(e),e.filter_reset=function(){this.groups&&this.groups.e.forEach((e=>e.firstElementChild.firstElementChild.classList.remove("hidden"))),this.input_element.value="",this.filter_index=[],this.options.forEach(((e,t)=>{e.classList.contains("hidden")||this.filter_index.push(t)})),this.listbox.querySelectorAll(".filter-hidden").forEach((e=>e.classList.remove("filter-hidden")))}.bind(e),e.settings.search&&(e.filterer=function(e){const t=this.input_element.value.toLowerCase();""===t?this.filter_reset():(this.filter_index=[],this.groups&&this.groups.e.forEach((e=>e.firstElementChild.firstElementChild.classList.add("hidden"))),this.options.forEach(((e,i)=>{if(!e.classList.contains("hidden")&&e.innerText.toLowerCase().includes(t)){e.classList.remove("filter-hidden"),this.filter_index.push(i);const t=e.getAttribute("data-group");if(t&&(this.groups.by_name[t].firstElementChild.firstElementChild.classList.remove("hidden"),this.settings.accordion)){const e=this.groups.by_name[t];e.firstElementChild.nextElementSibling.classList.add("show"),e.firstElementChild.firstElementChild.classList.remove("collapsed"),e.firstElementChild.firstElementChild.setAttribute("aria-expanded","true")}}else e.classList.add("filter-hidden")})))}.bind(e),e.input_element.addEventListener("keyup",e.filterer)),e.input_element.addEventListener("keydown",function(e){const i=m[e.code];if(i){if("close"===i)this.close();else if("select"===i){if(!this.expanded)return this.toggle({target:this.input_element});this.set(e)}else if("move"===i){const i=this.input_element.value;this.settings.strict||this.expanded&&""===i?(e.preventDefault(),"ArrowUp"===e.code?this.filter_index&&this.filter_index.length?(this.hover_index=this.filter_index.indexOf(this.hover_index)-1,this.hover_index=this.filter_index[0>this.hover_index?0:this.hover_index]):this.hover_index=Math.max(0,this.hover_index-1):"ArrowDown"===e.code?this.filter_index&&this.filter_index.length?(this.hover_index=this.filter_index.indexOf(this.hover_index)+1,this.hover_index=this.filter_index[this.filter_index.length-1<this.hover_index?this.filter_index.length-1:this.hover_index]):this.hover_index=Math.min(this.options.length-1,this.hover_index+1):"Home"===e.code?this.hover_index=0:"End"===e.code&&(this.hover_index=this.options.length-1),this.expanded?this.highlight():this.set(this.hover_index)):t.number.test(i)&&this.set(Number(i)+("ArrowUp"===e.code?1:-1))}}else this.expanded?this.clear_highlight():this.toggle({target:this.input_element})}.bind(e))},retrieve:function(){this.source=[],this.listbox.querySelectorAll(".selected").forEach((e=>this.source.push(e.dataset.value))),pe(this.id)},setter:function(e,i){if(e||(e=this.input_element.value),e.target&&(this.settings.accordion?"BUTTON":"LABEL")===e.target.tagName)return;let a=!1,s=-1;if(e.target&&(s=this.hover_index,-1!==s&&(this.options[s].classList.contains("hidden")||this.options[s].classList.contains("filter-hidden"))&&(s=-1),e=-1===s?"INPUT"===e.target.tagName?this.input_element.value:e.target.dataset.value||e.target.innerText:this.options[s].dataset.value||this.options[s].innerText,i=this.settings.multi),this.filter_reset(),"object"==typeof e&&(this.settings.multi?(this.listbox.querySelectorAll(".selected").forEach((e=>{e.classList.remove("selected"),e.setAttribute("aria-selected","false")})),this.source=-1===e?[]:e,e.forEach(this.set_selected)):e=e[0]),Array.isArray(this.source)||(this.source=[]),"object"==typeof e&&this.settings.multi)a=!0;else if(this.settings.strict&&"string"==typeof e&&!(e in this.values)&&t.number.test(e)&&(e=Number(e)),"number"!==this.value_type&&"number"==typeof e&&this.options[e]&&(e=this.options[e].dataset.value),"string"==typeof e&&e in this.display&&(e=this.options[this.display[e]].dataset.value),this.settings.strict&&!(e in this.values)&&(e=this.default),s=this.source.indexOf(e),-1===s){if(a=!0,-1===e||""===e?this.source=[]:this.settings.multi?this.source.push(e):this.source[0]=e,e in this.values){if(!this.settings.multi){const e=this.listbox.querySelector(".selected");e&&(e.classList.remove("selected"),e.setAttribute("aria-selected","false"))}this.set_selected(e)}}else if(i&&(a=!0,this.source.splice(s,1),e in this.values)){const t=this.options[this.values[e]];t.classList.remove("selected"),t.setAttribute("aria-selected","false")}!this.settings.multi&&this.expanded&&(this.input_element.focus(),this.close(),this.filter_reset());const n=this.source.length?this.settings.multi?this.source.length+" of "+this.options.length+" selected":this.source[0]in this.values?this.options[this.values[this.source[0]]].firstChild.textContent:this.settings.strict||-1===this.source[0]?"":this.source[0]:"";this.settings.use_display?this.selection.innerText=n:this.input_element.value=n,this.onchange&&this.onchange(),a&&pe(this.id)},adder:function(e,t,i,a){const s=l.createElement("div");return s.id=this.id+"_"+e,s.role="option",s.setAttribute("aria-selected","false"),s.tabindex="0",s.className="combobox-option combobox-component",s.dataset.value=e,s.innerText=t||o.data.format_label(e),a&&a.info&&(s.appendChild(l.createElement("p")),s.lastElementChild.className="combobox-option-description combobox-component",s.lastElementChild.innerText=a.info.description||a.info.short_description||""),i||this.listbox.appendChild(s),s}},plotly:{init:function(e){e.previous_span=1,e.id in o.plotly&&(e.x=e.e.getAttribute("data-x"),e.y=e.e.getAttribute("data-y"),e.color=e.e.getAttribute("data-color"),e.time=e.e.getAttribute("data-colorTime"),e.click=e.e.getAttribute("data-click"),e.click in C&&(e.clickto=C[e.click]),e.parsed={},e.traces={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.tab&&l.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){this.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(ee,155))}.bind(e)),e.show=function(t){e.revert();let i=D(this,t,0,0,"hover_line",a["border_highlight_"+o.settings.theme_dark]);i&&(i.line.width=4,i.marker.size=12,Plotly.addTraces(this.e,i,this.e.data.length))},e.revert=function(){this.e.data.length&&"hover_line"===this.e.data[this.e.data.length-1].name&&Plotly.deleteTraces(this.e,this.e.data.length-1)},e.options&&(o.plotly[e.id].u=e),o.plotly[e.id].data.forEach(((i,s)=>{Object.keys(i).forEach((e=>{if(t.period.test(e)){const t=e.split("."),a=t.length-1;let s=null;t.forEach(((t,n)=>{s=s?s[t]=n===a?i[e]:{}:i[t]={}}))}})),"textfont"in i||(i.textfont={}),"color"in i.textfont||(i.textfont.color=a.background_highlight),"line"in i||(i.line={}),"color"in i.line||(i.line.color=a.background_highlight),"marker"in i||(i.marker={}),i.marker.size=8,"color"in i.marker||(i.marker.color=a.background_highlight),"line"in i.marker||(i.marker.line={}),"color"in i.marker.line||(i.marker.line.color=a.background_highlight),"text"in i||(i.text=[]),"x"in i||(i.x=[]),"box"===i.type?i.hoverinfo="none":"y"in i||(i.y=[]),e.traces[i.type]=JSON.stringify(i),s||(e.base_trace=i.type,e.base_trace in C&&M(e.base_trace,{type:"update",id:e.id}))})),e.x&&!(e.x in o.data.variables)&&M(e.x,{type:"update",id:e.id}),e.y&&!(e.y in o.data.variables)&&M(e.y,{type:"update",id:e.id}),e.color&&!(e.color in o.data.variables)&&M(e.color,{type:"update",id:e.id}),e.time in C&&M(e.time,{type:"update",id:e.id}),e.view?(M(e.view,{type:"update",id:e.id}),M(e.view+"_filter",{type:"update",id:e.id}),C[e.view].time_agg in C&&M(C[e.view].time_agg,{type:"update",id:e.id})):e.view=a.dataview,e.queue=this.queue_init.bind(e)())},queue_init:function(){const e=this.deferred||!this.tab||this.tab.classList.contains("show");e&&r.Plotly?(Plotly.newPlot(this.e,this.options),this.e.on("plotly_hover",h.plotly.mouseover.bind(this)).on("plotly_unhover",h.plotly.mouseout.bind(this)).on("plotly_click",h.plotly.click.bind(this)),R(this),this.update()):(this.deferred=!0,setTimeout(this.queue,e?0:2e3))},mouseover:function(e){e.points&&1===e.points.length&&this.e.data[e.points[0].fullData.index]&&(Plotly.restyle(this.e,{"line.width":5},e.points[0].fullData.index),B(this.id,"show",o.data.entities[e.points[0].data.id]))},mouseout:function(e){e.points&&1===e.points.length&&this.e.data[e.points[0].fullData.index]&&(Plotly.restyle(this.e,{"line.width":2},e.points[0].fullData.index),B(this.id,"revert",o.data.entities[e.points[0].data.id]))},click:function(e){this.clickto&&this.clickto.set(e.points[0].data.id)},update:async function(t){if(this.queue>0&&clearTimeout(this.queue),this.queue=-1,t){if(this.e.layout){const t=C[this.view],i=t.selection&&t.selection.all,s=t.get.dataset(),n=C[this.time||t.time_agg],r=this.parsed;if(o.data.inited[s]&&i&&t.time_range.filtered.length){r.base_trace=se(this.base_trace),r.x=se(this.x),r.y=se(this.y),r.color=se(this.color||t.y||r.y);const l=await o.data.get_variable(r.x,this.view),d=await o.data.get_variable(r.y,this.view),c=await o.data.get_variable(r.color,this.view);r.x_range=l.time_range[s],r.y_range=d.time_range[s],r.view=t,r.dataset=s,r.palette=se(t.palette)||o.settings.palette,r.palette in e||(r.palette=a.palette),r.time=(n?n.value()-o.data.meta.times[s].range[0]:0)-c.time_range[s][0],r.summary=c.views[this.view].summaries[s];const p=r.summary.n,u=p[r.time]?r.time:0,m=d.views[this.view].summaries[s],f=r.summary.missing[u],b=p[u],_=b!==t.n_selected.dataset,g=_?"subset_rank":"rank",v=_?c.views[this.view].order[s][u]:c.info[s].order[u],y=[];let E,x,C,w=r.summary.missing[u],k=v?v.length:0,T=o.settings.trace_limit||0,L=t.value()+t.get.time_filters()+s+r.x+r.y+r.time+r.palette+r.color+o.settings.summary_selection+o.settings.color_scale_center+o.settings.color_by_order+o.settings.trace_limit+o.settings.show_empty_times;for(T=C=T&&T<b?Math.ceil(Math.min(T/2,b/2)):0,Object.keys(this.reference_options).forEach((e=>this.options[e]=se(this.reference_options[e])));w<k;w++)if(v[w][0]in i){E=v[w][0];const e=i[E];if(L+=E,y.push(D(this,e,e.views[this.view][g][r.color][r.time]-f,b)),T&&!--C)break}if(T&&w<k)for(C=w,w=k-1;w>C;w--)if(v[w][0]in i){E=v[w][0];const e=i[E];if(L+=E,y.push(D(this,e,e.views[this.view][g][r.color][r.time]-f,b)),!--T)break}if(L+=y.length&&y[0].type,o.settings.boxplots&&"box"in this.traces&&i[E])if(L+="box"+o.settings.iqr_box,x=JSON.parse(this.traces.box),y.push(x),x.line.color=a.border,x.median=m.median,x.q3=m.q3,x.q1=m.q1,o.settings.iqr_box?(x.upperfence=[],x.lowerfence=[],x.q1.forEach(((e,t)=>{isNaN(x.median[t])&&(x.median[t]=0);const i=1.5*(x.q3[t]-e),a=x.median[t];x.q3[t]=isNaN(x.q3[t])?a:Math.max(a,x.q3[t]),x.upperfence[t]=x.q3[t]+i,x.q1[t]=isNaN(x.q1[t])?a:Math.min(a,e),x.lowerfence[t]=e-i}))):(x.upperfence=m.max,x.lowerfence=m.min),o.settings.show_empty_times)x.x=x.q1.map(((e,t)=>i[E].get_value(r.x,t+r.y_range[0])));else for(x.x=[],w=x.q1.length;w--;)p[w]&&(x.x[w]=i[E].get_value(r.x,w+r.y_range[0]));if(L!==this.state){"boolean"!=typeof this.e.layout.yaxis.title&&(this.e.layout.yaxis.title=o.data.format_label(r.y)+(o.settings.trace_limit<t.n_selected.all?" ("+o.settings.trace_limit+" extremes)":"")),"boolean"!=typeof this.e.layout.xaxis.title&&(this.e.layout.xaxis.title=o.data.format_label(r.x)),this.e.layout.yaxis.autorange=!1,this.e.layout.yaxis.range=[1/0,-1/0],x||(x={upperfence:m.max,lowerfence:m.min});let e=!1;m.min.forEach(((t,i)=>{if(o.settings.show_empty_times||p[i]){const e=Math.min(x.lowerfence[i],t),a=Math.max(x.upperfence[i],m.max[i]);this.e.layout.yaxis.range[0]>e&&(this.e.layout.yaxis.range[0]=e),this.e.layout.yaxis.range[1]<a&&(this.e.layout.yaxis.range[1]=a)}else e=!0}));const i=(this.e.layout.yaxis.range[1]-this.e.layout.yaxis.range[0])/10;if(this.e.layout.yaxis.range[0]-=i,this.e.layout.yaxis.range[1]+=i,this.e.layout.yaxis.range[1]>100){const e=d.info[s].info;e&&"percent"===(e.aggregation_method||e.type)&&(this.e.layout.yaxis.range[1]=100)}if(o.data.variables[r.x].is_time){const i=t.time_range.filtered[0],a=t.time_range.filtered[1],s=e&&a>i?Math.log(a-i):.5;this.e.layout.xaxis.autorange?(this.e.layout.xaxis.autorange=!1,this.e.layout.xaxis.type="linear",this.e.layout.xaxis.dtick=1,this.e.layout.xaxis.range=[i-s,a+s]):(this.e.layout.xaxis.range[0]=i-s,this.e.layout.xaxis.range[1]=a+s)}x.lowerfence.length<this.previous_span?(Plotly.newPlot(this.e,y,this.e.layout,this.e.config),this.e.on("plotly_hover",h.plotly.mouseover.bind(this)).on("plotly_unhover",h.plotly.mouseout.bind(this)).on("plotly_click",h.plotly.click.bind(this))):Plotly.react(this.e,y,this.e.layout,this.e.config),setTimeout(ee,300),this.previous_span=x.lowerfence.length,this.state=L}}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))}},map:{init:function(e){e.color=e.e.getAttribute("data-color"),e.time=e.e.getAttribute("data-colorTime"),e.click=e.e.getAttribute("data-click"),e.click&&e.click in C&&(e.clickto=C[e.click]),e.parsed={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.show=function(t){if(t.layer&&t.layer[this.id]){const i={color:"var(--border-highlight)",weight:o.settings.polygon_outline+1,fillOpacity:1};if(o.data.inited[this.parsed.dataset+e.id])t.layer[this.id].setStyle&&t.layer[this.id].setStyle(i);else{const e=o.map[this.id].match_time(o.data.meta.overall.value[o.data.variables[this.parsed.color].time_range[this.parsed.dataset][0]+this.parsed.time]);t.layer[this.id][e]&&t.layer[this.id][e].setStyle(i)}}},e.revert=function(e){if(e.layer&&e.layer[this.id]){const t={color:"var(--border)",weight:o.settings.polygon_outline,fillOpacity:.7};if(o.data.inited[this.parsed.dataset+this.id])e.layer[this.id].setStyle(t);else{const i=o.map[this.id].match_time(o.data.meta.overall.value[o.data.variables[this.parsed.color].time_range[this.parsed.dataset][0]+this.parsed.time]);e.layer[this.id][i]&&e.layer[this.id][i].setStyle(t)}}};const i={type:"update",id:e.id};if(e.view?(C[e.view].time_agg in C&&M(C[e.view].time_agg,i),C[e.view].y&&M(C[e.view].y,i)):e.view=a.dataview,M(e.view,i),e.color in C&&M(e.color,i),e.time&&M(e.time,i),e.e.style.height||(e.e.style.height=e.options.height?e.options.height:"400px"),e.options.overlays_from_measures&&o.data.variable_info){Array.isArray(o.map[e.id].overlays)||(o.map[e.id].overlays=[]);const i=o.map[e.id].overlays;Object.keys(o.data.variable_info).forEach((e=>{const a=o.data.variable_info[e];if(a.layer&&a.layer.source){if("string"==typeof a.layer.source&&t.time_ref.test(a.layer.source)){const i=a.layer.source;a.layer.source=[];for(let s,n=o.data.meta.ranges[e],r=n[0],l=n[1]+1;r<l;r++)s=o.data.meta.overall.value[r],a.layer.source.push({url:i.replace(t.time_ref,s),time:s})}t.time_ref.lastIndex=0;const s={variable:e,source:a.layer.source};a.layer.filter&&(Array.isArray(a.layer.filter)||a.layer.filter.feature)&&(s.filter=a.layer.filter),i.push(s)}}))}e.queue=this.queue_init.bind(e)()},queue_init:function(){const e=o.settings.theme_dark?"dark":"light",t=this.deferred||!this.tab||this.tab.classList.contains("show");if(t&&r.L){if(this.map=L.map(this.e,this.options),this.options=this.map.options,this.overlay=L.featureGroup().addTo(this.map),this.displaying=L.featureGroup().addTo(this.map),this.overlay_control=L.control.layers().setPosition("topleft").addOverlay(this.overlay,"Overlay").addTo(this.map),this.tiles={},this.id in o.map){const t=o.map[this.id].tiles;o.map[this.id].u=this,t&&(t.url?(this.tiles[e]=L.tileLayer(t.url,t.options),this.tiles[e].addTo(this.map)):Object.keys(t).forEach((i=>{this.tiles[i]=L.tileLayer(t[i].url,t[i].options),e===i&&this.tiles[i].addTo(this.map)}))),"_raw"in o.map||(o.map._raw={}),"_queue"in o.map||(o.map._queue={}),"_layers"in o.map[this.id]||(o.map[this.id]._layers={});const i=o.data.meta.overall.value[C[this.view].parsed.time_agg],a=[];o.map[this.id].shapes.forEach(((e,t)=>{const s="time"in e;s&&(o.map[this.id].has_time||(o.map[this.id].has_time=!0,M(this.view,{type:"update",id:this.id})),a.push(Number(e.time)));let n=e.name;n||(e.name=n=o.metadata.datasets[t<o.metadata.datasets.length?t:0]);const r=n+(s?e.time:"");r in o.map._queue||(o.map._queue[r]=e),o.data.inited[r+this.id]=!1,(o.data.loaded[n]||n===this.options.background_shapes)&&(n===r||i&&o.map[this.id].match_time&&e.time==o.map[this.id].match_time(i))&&le(this,e)})),o.map[this.id].has_time&&(a.sort(),o.map[this.id].match_time=function(e){let t=a.length;for(;t--&&(t&&!(a[t]<=e)););return a[t]}.bind(a)),o.map[this.id].triggers={},o.map[this.id].overlay_summaries={},Array.isArray(o.map[this.id].overlays)&&o.map[this.id].overlays.forEach((e=>{"string"==typeof e.source&&(e.source=[{url:e.source}]);const t=e.source;t.forEach((e=>{e.processed=!1,e.property_summaries={},o.map._queue[e.url]=e})),o.map[this.id].triggers[e.variable]={source:t};const i=e.filter;if(i){const t=Array.isArray(i)?i:[i];o.map[this.id].triggers[e.variable].filter=t,t.forEach((e=>{e.check=DataHandler.checks[e.operator]}))}}))}}else this.deferred=!0,setTimeout(this.queue,t?0:2e3)},mouseover:function(e){e.target.setStyle({color:"var(--border-highlight)"}),B(this.id,"show",o.data.entities[e.target.feature.properties[e.target.source.id_property]])},mouseout:function(e){B(this.id,"revert",o.data.entities[e.target.feature.properties[e.target.source.id_property]]),e.target.setStyle({color:"var(--border)"})},click:function(e){this.clickto&&this.clickto.set(e.target.feature.properties[e.target.source.id_property])},update:async function(t,i,s){if(this.queue>0&&clearTimeout(this.queue),this.queue=-1,s){if(this.view&&this.displaying){const t=this.parsed,i=o.dataviews[this.view],s=i.get.dataset(),n=se(i.time_agg),r=o.map[this.id].has_time?o.map[this.id].match_time(n):"",l=s+r+this.id in o.data.inited,d=l?s+r:s;if(o.map._queue&&d in o.map._queue&&!o.data.inited[d+this.id])return void(l&&null===n||le(this,o.map._queue[d],(()=>this.update(void 0,void 0,!0))));!i.valid&&o.data.inited[s]&&(i.state="",c.dataview(i,void 0,!0)),t.view=i,t.dataset=s;const h=i.value()+d+o.settings.background_shapes+o.settings.background_top+o.settings.background_polygon_outline+o.data.inited[this.options.background_shapes],p=i.selection.all,u=i.selection[o.settings.background_shapes&&this.options.background_shapes?"ids":"all"],m=se(this.color||i.y);if(o.settings.map_overlay&&m in o.map[this.id].triggers?oe(this,o.map[this.id].triggers[m],o.data.meta.overall.value[i.parsed.time_agg]):(this.overlay_control.remove(),this.overlay.clearLayers()),o.data.inited[d+this.id]&&u&&i.valid){const n=this.time?C[this.time]:i.time_agg?i.time_agg in C?C[i.time_agg]:parseInt(i.time_agg):0;t.palette=se(i.palette)||o.settings.palette,t.palette in e||(t.palette=a.palette);const l=await o.data.get_variable(m,this.view),d=l.views[this.view].summaries[s],c=(n.parsed?n.value()-o.data.meta.times[s].range[0]:0)-l.time_range[s][0];t.summary=d,t.time=c,t.color=m;const f=d.n[n]===i.n_selected.dataset?"rank":"subset_rank";if(h!==this.vstate){this.map._zoomAnimated="none"!==o.settings.map_animations,Object.keys(this.reference_options).forEach((e=>{this.options[e]=se(this.reference_options[e]),"zoomAnimation"===e&&(this.map._zoomAnimated=this.options[e])})),this.displaying.clearLayers(),this.fresh_shapes=!0,this.vstate=!1;let e=0;Object.keys(u).forEach((t=>{const i=u[t].layer;if(i&&i[this.id]){const a=t in p,s=i[this.id].has_time?i[this.id][r]:i[this.id];s&&(a||this.options.background_shapes===o.data.entities[t].group)&&(e++,s.options.interactive=a,s.addTo(this.displaying),a?o.settings.background_top&&s.bringToBack():(o.settings.background_top||s.bringToBack(),s.setStyle({fillOpacity:0,color:"var(--border-highlight)",weight:o.settings.background_polygon_outline})),this.vstate||(this.vstate=h))}})),this.overlay.bringToFront(),e&&("fly"===o.settings.map_animations?setTimeout((()=>this.map.flyToBounds(this.displaying.getBounds())),400):this.map.fitBounds(this.displaying.getBounds()))}const b=m+this.vstate+t.palette+c+o.settings.polygon_outline+o.settings.color_by_order+o.settings.color_scale_center;if(b!==this.cstate)if(this.cstate=b,o.map[this.id]){const e=this.displaying._layers,i=d.n[c],n=d.missing[c];Object.keys(e).forEach((r=>{const l=e[r];if(s===l.entity.group){const e=p[l.entity.features.id],s=e&&e.views[this.view][f];l.setStyle({fillOpacity:.7,color:"var(--border)",fillColor:e&&m in s?T(e.get_value(m,c),t.palette,d,c,s[m][c]-n,i):a.missing,weight:o.settings.polygon_outline})}}))}else"_waiting"in o.map||(o.map._waiting={}),s in o.map._waiting||(o.map._waiting[s]=[]),-1===o.map._waiting[s].indexOf(this.id)&&o.map._waiting[s].push(this.id),-1===o.map._waiting[s].indexOf(this.view)&&o.map._waiting[s].push(this.view)}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(void 0,void 0,!0)),50))}},info:{init:function(e){function a(e,a){const s={parent:e,text:a,parsed:{},ref:!0,selection:!1,get:function(a,s){if(this.ref){if(a){if("features"in this.parsed)return a.features[this.parsed.features];if("data"in this.parsed){if("value"===this.text?this.parsed.data=se(e.options.variable||s.color||s.y||C[e.view].y):this.text in C&&(this.parsed.data=se(this.text)),!(this.parsed.data in o.data.variables))return this.parsed.data;const n=o.data.variables[this.parsed.data],r=o.data.format_value(a.get_value(this.parsed.data,this.parent.time),!n||!n.type||t.int_types.test(n.type));let l=n.meta.unit||n.meta.type;return n.meta.aggregation_method&&!(l in i)&&(l=n.meta.aggregation_method),NaN!==r&&l in i?i[l](r):r}}return"data"in this.parsed?o.data.meta.times[this.parent.dataset].value[this.parent.time_agg]:"variables"in this.parsed&&(this.value_source||this.parent.v in o.data.variable_info)?o.data.variable_info[se(this.value_source||this.parent.v)][this.parsed.variables]:this.text}return this.text}};if("value"===a)s.parsed.data=e.options.variable;else if("summary"===a)e.options.show_summary=!0,s.parsed.summary=F(e.e);else if("filter"===a){const e=l.createElement("table");e.className="info-filter",s.parsed.filter=e}return t.features.test(a)?s.parsed.features=a.replace(t.features,""):t.data.test(a)?s.parsed.data=a.replace(t.data,""):t.variables.test(a)?s.parsed.variables=a.replace(t.variables,""):s.ref=!1,s}if(e.depends={},e.has_default=e.options.default&&(e.options.default.title||e.options.default.body),I(e.view,e),e.options.floating&&(l.body.appendChild(e.e),e.e.classList.add("hidden"),l.addEventListener("mousemove",(function(t){if(e.showing){const i=_.content.getBoundingClientRect();e.e.style.top=(t.y>i.height/2?t.y-e.e.getBoundingClientRect().height-10:t.y+10)+"px",e.e.style.left=(t.x>i.width/2?t.x-e.e.getBoundingClientRect().width-10:t.x+10)+"px"}}))),e.show=function(e,t){this.update(e,t),this.showing=!0,this.options.floating&&this.e.classList.remove("hidden"),this.parts.title&&(this.selection?this.parts.title.base.classList.add("hidden"):this.parts.title.default.classList.add("hidden"),this.parts.title.temp.classList.remove("hidden")),this.parts.body&&(this.selection?this.parts.body.base.classList.add("hidden"):this.parts.body.default.classList.add("hidden"),this.parts.body.temp.classList.remove("hidden"))},e.revert=function(){this.showing=!1,this.options.floating?this.e.classList.add("hidden"):(this.parts.title&&(this.selection?this.parts.title.base.classList.remove("hidden"):this.has_default&&this.parts.title.default.classList.remove("hidden"),this.parts.title.temp.classList.add("hidden")),this.parts.body&&(this.selection?this.parts.body.base.classList.remove("hidden"):this.has_default&&this.parts.body.default.classList.remove("hidden"),this.parts.body.temp.classList.add("hidden")))},e.parts={},e.options.title&&(e.parts.title=a(e,e.options.title),"variables"in e.parts.title.parsed&&t.measure_name.test(e.parts.title.parsed.variables)?(e.parts.title.base=l.createElement("button"),e.parts.title.base.type="button",e.parts.title.base.setAttribute("data-bs-toggle","modal"),e.parts.title.base.setAttribute("data-bs-target","#variable_info_display"),e.parts.title.base.addEventListener("click",P.bind(e))):e.parts.title.base=l.createElement("p"),e.parts.title.base.appendChild(l.createElement("span")),e.parts.title.temp=l.createElement("p"),e.parts.title.default=l.createElement("p"),e.parts.title.temp.className=e.parts.title.base.className=e.parts.title.default.className="info-title hidden",e.has_default&&e.options.default.title&&(e.e.appendChild(e.parts.title.default),e.parts.title.default.innerText=e.options.default.title),e.parts.title.ref||(e.parts.title.base.firstElementChild.innerText=e.parts.title.get()),e.e.appendChild(e.parts.title.base),e.e.appendChild(e.parts.title.temp),e.parts.title.base.classList.add("hidden"),e.parts.title.temp.classList.add("hidden")),e.options.body){e.parts.body={base:l.createElement("div"),temp:l.createElement("div"),default:l.createElement("div"),rows:[]},e.parts.body.temp.className=e.parts.body.base.className=e.parts.body.default.className="info-body hidden",e.has_default&&e.options.default.body&&(e.parts.body.default.innerText=e.options.default.body);let i=0;e.options.body.forEach(((s,n)=>{const r={name:a(e,s.name),value:a(e,s.value)};e.parts.body.rows[n]=r,r.base=l.createElement("div"),e.parts.body.base.appendChild(r.base),r.temp=l.createElement("div"),e.parts.body.temp.appendChild(r.temp),r.temp.className=r.base.className="info-body-row-"+s.style,i+=24+("stack"===s.style?24:0),r.name&&(e.options.variable_info&&"variables"in r.name.parsed&&t.measure_name.test(r.name.parsed.variables)?(r.base.appendChild(l.createElement("button")),r.base.lastElementChild.type="button",r.base.lastElementChild.setAttribute("data-bs-toggle","modal"),r.base.lastElementChild.setAttribute("data-bs-target","#variable_info_display"),r.base.lastElementChild.addEventListener("click",P.bind(e))):r.base.appendChild(l.createElement("div")),r.temp.appendChild(l.createElement("div")),r.temp.lastElementChild.className=r.base.lastElementChild.className="info-body-row-name",r.temp.lastElementChild.innerText=r.base.lastElementChild.innerText=r.name.get()),r.value&&(r.base.appendChild(l.createElement("div")),r.temp.appendChild(l.createElement("div")),"summary"in r.value.parsed?r.base.lastElementChild.appendChild(r.value.parsed.summary):"filter"in r.value.parsed?r.base.lastElementChild.appendChild(r.value.parsed.filter):(r.temp.lastElementChild.className=r.base.lastElementChild.className="info-body-row-value"+("statement"===r.value.parsed.variables?" statement":""),r.name.ref&&"value"===r.value.text&&(r.value.ref=!0),r.value.ref||(r.temp.lastElementChild.innerText=r.base.lastElementChild.innerText=r.value.get())))})),e.e.style.minHeight=i+"px",e.e.appendChild(e.parts.body.base),e.e.appendChild(e.parts.body.default),e.e.appendChild(e.parts.body.temp)}e.update()},update:async function(e,t,i){const a=o.dataviews[this.view],s=C[a.time_agg];if(this.v=se(this.options.variable||t&&(t.color||t.y)||a.y),this.dataset=a.get.dataset(),s&&!(this.dataset in o.data.meta.times))return void(this.id in o.data.data_queue[this.dataset]||(o.data.data_queue[this.dataset][this.id]=this.update));this.time_agg=s?s.value()-o.data.meta.times[this.dataset].range[0]:0;const n=this.v in o.data.variables&&o.data.variables[this.v].time_range[this.dataset];this.time=n?this.time_agg-n[0]:0,this.options.show_summary&&(this.var=this.v&&await o.data.get_variable(this.v,this.view),this.summary=this.view in this.var.views&&this.var.views[this.view].summaries[this.dataset]),this.processed||(this.processed=!0,this.options.floating||(M(this.view,{type:"update",id:this.id}),a.y in C&&M(a.y,{type:"update",id:this.id}),s&&M(a.time_agg,{type:"update",id:this.id}),this.options.variable in C&&M(this.options.variable,{type:"update",id:this.id})),this.parts.body&&this.parts.body.rows.forEach((e=>{!e.value.ref&&e.value.text in C&&"variables"in e.name.parsed&&(e.name.value_source=e.value.value_source=e.value.text,e.value.ref=!0,e.value.parsed.data="")}))),e?(this.parts.title&&(this.parts.title.temp.innerText=this.parts.title.get(e,t)),this.parts.body&&this.parts.body.rows.forEach((i=>{i.name.ref&&(i.name.value_source&&(i.name.value_source=i.value.text),U=i.name.get(e,t),"object"!=typeof U&&(i.temp.firstElementChild.innerText=G(U,i.value.parsed.variables,this,e))),i.value.ref&&(i.value.value_source&&(i.value.value_source=i.value.text),U=i.value.get(e,t),"object"!=typeof U&&(i.temp.lastElementChild.innerText=G(U,i.value.parsed.variables,this,e)))}))):this.options.floating||(this.queue>0&&clearTimeout(this.queue),this.queue=-1,i?((e=o.data.entities[a.get.ids(!0)])?(this.selection=!0,this.parts.title&&(this.parts.title.value_source&&(p.title.value_source=p.value.text),this.parts.title.base.classList.remove("hidden"),this.parts.title.default.classList.add("hidden")),this.parts.body&&this.has_default&&this.parts.body.default.classList.add("hidden")):(this.selection=!1,this.parts.title&&(this.has_default?(this.parts.title.base.classList.add("hidden"),this.parts.title.default.classList.remove("hidden")):this.parts.title.ref&&"features"in this.parts.title.parsed||this.parts.title.base.classList.remove("hidden")),this.parts.body&&(this.parts.body.base.classList.add("hidden"),this.has_default&&this.parts.body.default.classList.remove("hidden"))),this.parts.title&&(this.parts.title.base.firstElementChild.innerText=this.parts.title.get(e,t)),this.parts.body&&(this.options.subto||this.parts.body.base.classList.remove("hidden"),this.parts.body.rows.forEach((i=>{if("summary"in i.value.parsed)!function(e,t,i){const a=e.lastElementChild.children;f.summary.forEach(((e,s)=>{a[s].innerText=o.data.format_value(t[e][i],0===s)}))}(i.value.parsed.summary,this.summary,this.time);else if("filter"in i.value.parsed){const e=i.value.parsed.filter;let t=0;if(e.innerHTML="",C._entity_filter.selected.length){t++;const i=l.createElement("tr");i.className="filter-display";let a=l.createElement("td");i.appendChild(a),a.appendChild(l.createElement("span")),a.lastElementChild.className="syntax-variable",a.lastElementChild.innerText="Select Entities",a=l.createElement("td"),i.appendChild(a),a.appendChild(l.createElement("span")),a.lastElementChild.className="syntax-operator",a.lastElementChild.innerText=":",a=l.createElement("td"),i.appendChild(a),a.setAttribute("colspan",2),a.appendChild(l.createElement("span")),a.lastElementChild.className="syntax-value";let s="";C._entity_filter.selected.forEach((e=>{const t=o.data.entities[e];s+=(s?", ":"")+(t&&t.features?t.features.name:e)})),a.lastElementChild.innerText=s,e.appendChild(i)}C._base_filter.c.forEach((i=>{const a=i.passed+i.failed;if(i.active&&a){const s=i.passed+"/"+a;i.e.children[1].lastElementChild.innerText=s,t++;const n=l.createElement("tr"),r=o.data.variable_info[i.variable];n.className="filter-display";let d=l.createElement("td");n.appendChild(d),d.appendChild(l.createElement("span")),d.lastElementChild.className="syntax-variable",d.lastElementChild.title=i.variable,d.lastElementChild.innerText=r.short_name,d.appendChild(l.createElement("span")),d.lastElementChild.innerText=" (",d.appendChild(l.createElement("span")),d.lastElementChild.className="syntax-component",d.lastElementChild.innerText=i.component,d.appendChild(l.createElement("span")),d.lastElementChild.innerText=")",d=l.createElement("td"),n.appendChild(d),d.appendChild(l.createElement("span")),d.lastElementChild.className="syntax-operator",d.lastElementChild.innerText=i.operator,d=l.createElement("td"),n.appendChild(d),d.appendChild(l.createElement("span")),d.lastElementChild.className="syntax-value",d.lastElementChild.innerText="number"==typeof i.value?o.data.format_value(i.value):i.value,d=l.createElement("td"),n.appendChild(d),d.appendChild(l.createElement("span")),d.lastElementChild.innerText="("+(i.value_source?i.value_source+"; ":"")+s+")",e.appendChild(n)}})),this.e.classList[t?"remove":"add"]("hidden")}if(!("variables"in i.value.parsed)&&!("summary"in i.value.parsed)||a.y in this.depends?"filter"in i.value.parsed&&!("_base_filter"in this.depends)&&(this.depends._base_filter=!0,M("_base_filter",{type:"update",id:this.id})):(this.depends[a.y]=!0,M(a.y,{type:"update",id:this.id})),i.name.ref){i.name.value_source&&(i.name.value_source=i.value.text);const a=i.name.get(e,t);"object"!=typeof a&&(i.base.firstElementChild.innerText=a)}if(i.value.ref){const a=i.value.get(e,t);"object"==typeof a?Array.isArray(a)&&"sources"===i.value.parsed.variables&&(i.base.innerHTML="",i.base.appendChild(l.createElement("table")),i.base.lastElementChild.className="source-table",i.base.firstElementChild.appendChild(l.createElement("thead")),i.base.firstElementChild.firstElementChild.appendChild(l.createElement("tr")),i.base.firstElementChild.firstElementChild.firstElementChild.appendChild(l.createElement("th")),i.base.firstElementChild.firstElementChild.firstElementChild.appendChild(l.createElement("th")),i.base.firstElementChild.firstElementChild.firstElementChild.firstElementChild.innerText="Source",i.base.firstElementChild.firstElementChild.firstElementChild.lastElementChild.innerText="Accessed",i.base.firstElementChild.appendChild(l.createElement("tbody")),a.forEach((e=>{i.base.firstElementChild.lastElementChild.appendChild(z(e,!0))}))):i.base.lastElementChild.innerText=G(a,i.value.parsed.variables,this,e)}})))):this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(void 0,void 0,!0)),50))),this.revert()}},datatable:{init:function(e){e.e.appendChild(l.createElement("thead")),e.e.appendChild(l.createElement("tbody")),e.click=e.e.getAttribute("data-click"),e.features=e.options.features,e.parsed={summary:{},order:[],time:-1,color:"",dataset:C[e.view].get.dataset(),time_index:{}},e.header=[],e.rows={},e.rowIds={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0;const i=o.data.meta.times[e.parsed.dataset];if(e.style=l.head.appendChild(l.createElement("style")),e.tab&&l.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){this.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(ee,155))}.bind(e)),e.e.addEventListener("mouseover",h.datatable.mouseover.bind(e)),e.e.addEventListener("mouseout",h.datatable.mouseout.bind(e)),e.click&&(e.click in C&&(e.clickto=C[e.click]),e.e.addEventListener("click",h.datatable.click.bind(e))),e.show=function(e){if(e.features&&e.features.id in this.rows){o.settings.table_autoscroll&&this.rows[e.features.id].scrollTo("smooth"===o.settings.table_scroll_behavior),this.pending>0&&clearTimeout(this.pending),this.pending=-1;const t=this.rows[e.features.id].node();t?t.classList.add("highlighted"):this.pending=setTimeout(function(){const e=this.node();e&&e.classList.add("highlighted")}.bind(this.rows[e.features.id]),0)}},e.revert=function(){this.pending>0&&clearTimeout(this.pending),this.e.querySelectorAll("tr.highlighted").forEach((e=>e.classList.remove("highlighted")))},e.options.variable_source=e.options.variables,e.options.variables?"string"==typeof e.options.variables&&(e.options.variables in C?(M(e.options.variables,{type:"update",id:e.id}),e.options.variables=se(e.options.variables),e.options.single_variable="string"==typeof e.options.variables):e.options.single_variable||(e.options.single_variable=[{name:e.options.single_variable}])):e.options.variables=Object.keys(o.data.variables),"string"!=typeof e.options.variables&&e.options.variables.length&&"string"===e.options.variables[0]&&(e.options.variables=e.options.variables.map((e=>{}))),e.options.single_variable){const t=e.options.variables,a=t.name||t;e.header.push({title:"Name",data:"entity.features.name"}),i&&i.is_single&&(e.variable_header=!0);const s=a in o.data.variables&&o.data.variables[a].time_range[e.parsed.dataset];if(s)for(let n=s[1]-s[0]+1;n--;)e.header[n+1]={title:e.variable_header?t.title||o.data.format_label(a):i.value[n+s[0]]+"",data:o.data.get_value,render:DataHandler.retrievers.row_time.bind({i:n,o:s[0],format_value:o.data.format_value.bind(o.data)})};e.options.order=[[e.header.length-1,"dsc"]]}else if(e.options.wide){e.features&&("string"==typeof e.features&&(e.features=[{name:e.features}]),e.features.forEach((i=>{e.header.push({title:i.title||i.name,data:"entity.features."+i.name.replace(t.all_periods,"\\.")})})));for(let i=e.options.variables.length;i--;){"string"==typeof e.options.variables[i]&&(e.options.variables[i]={name:e.options.variables[i]});const a=e.options.variables[i];a.source||(a.source=a.name in o.data.variables?"data":"features"),e.header.push("features"===a.source?{title:a.title||o.data.format_label(a.name),data:"entity.features."+a.name.toLowerCase().replace(t.all_periods,"\\.")}:{title:a.title||o.data.format_label(a.name),render:async function(e,t,i){if("data"===this.c.source){if(this.c.name in o.data.variables){const e=await o.data.get_variable(this.c.name,this.o.view),t=i.time-e.time_range[this.o.parsed.dataset][0];return t<0?NaN:i.entity.get_value(this.c.name,t)}return NaN}return this.c.source in i.entity&&this.c.name in i.entity[this.c.source]?i.entity[this.c.source][this.c.name]:NaN}.bind({o:e,c:a})})}}else e.filters=e.options.filters,e.current_filter={},i.is_single||e.header.push({title:"Year",data:"entity.time.value",render:function(e,t,i){const a=i.time+i.offset;return e&&a>=0&&a<e.length?e[a]:NaN}}),e.features&&("string"==typeof e.features&&(e.features=[{name:e.features}]),e.features.forEach((i=>{e.header.splice(0,0,{title:i.title||i.name,data:"entity.features."+i.name.replace(t.all_periods,"\\.")})}))),e.header.push({title:"Variable",data:function(e){return e.variable in e.entity.variables?e.entity.variables[e.variable].meta.short_name:e.variable}}),e.header.push({title:"Value",data:o.data.get_value,render:function(e,t,i){return e?"number"==typeof e[i.time]?o.data.format_value(e[i.time],i.int):e[i.time]:""}});e.view?(M(e.view,{type:"update",id:e.id}),M(e.view+"_filter",{type:"update",id:e.id}),M(C[e.view].time_agg,{type:"update",id:e.id})):e.view=a.dataview,e.queue=this.queue_init.bind(e)()},queue_init:function(){const e=this.deferred||!this.tab||this.tab.classList.contains("show");e&&r.jQuery&&r.DataTable&&"get"in o.dataviews[this.view]?(this.options.columns=this.header,this.table=$(this.e).DataTable(this.options),this.update()):(this.deferred=!0,setTimeout(this.queue,e?0:2e3))},update:async function(e){if(this.queue>0&&clearTimeout(this.queue),this.queue=-1,e){if(this.table){let i=this.options.variable_source&&se(this.options.variable_source).replace(t.all_periods,"\\.");const a=C[this.view],s=a.get.dataset();if(!o.data.inited[s])return;const n=o.data.meta.times[s],r=s+a.value()+a.get.time_filters()+o.settings.digits+i+o.settings.theme_dark+o.settings.show_empty_times,l=r!==this.state,d=se(a.time_agg),c=await o.data.get_variable(i,this.view);if(this.parsed.time_range=c?c.time_range[s]:n.info.time_range[s],this.parsed.time=("number"==typeof d?d-n.range[0]:0)-this.parsed.time_range[0],l){if(this.rows={},this.rowIds={},this.table.clear(),a.valid){if(this.state=r,Object.keys(this.reference_options).forEach((e=>this.options[e]=se(this.reference_options[e]))),this.options.single_variable){if(this.parsed.time_index={},this.parsed.dataset=s,this.parsed.color=i,this.parsed.summary=this.view in c.views&&c.views[this.view].summaries[s],this.parsed.order=this.view in c.views&&c.views[this.view].order[s][this.parsed.time],this.header.length<2||s!==this.header[1].dataset||i!==this.header[1].variable){if(this.table.destroy(),$(this.e).empty(),this.header=[{title:"Name",data:"entity.features.name",type:"string"}],-1!==this.parsed.time_range[0])for(let e=this.parsed.time_range[2];e--;)this.header[e+1]={dataset:s,variable:i,type:"string"===c.type?"string":"num",title:this.variable_header?this.options.variables.title||o.data.format_label(i):n.value[e+this.parsed.time_range[0]]+"",data:o.data.get_value,render:DataHandler.retrievers.row_time.bind({i:e,o:this.parsed.time_range[0],format_value:o.data.format_value.bind(o.data)})};else this.state="";this.options.order[0][0]=this.header.length-1,this.options.columns=this.header,this.table=$(this.e).DataTable(this.options)}const e=this.header.length,t=this.parsed.summary.n;let r;for(let i=1,s=!1,l=0;i<e;i++)s=a.times[i-1+this.parsed.time_range[0]]&&(o.settings.show_empty_times||t[i-1]),this.table.column(i).visible(s,!1),s&&(this.parsed.time_index[n.value[i-1+this.parsed.time_range[0]]]=++l,r=!1);r&&(this.state="")}if(this.options.wide)Object.keys(a.selection.all).forEach((e=>{if(i)i in a.selection.all[e].views[this.view].summary&&(this.rows[e]=this.table.row.add({dataset:s,variable:i,offset:this.parsed.time_range[0],entity:a.selection.all[e],int:t.int_types.test(o.data.variables[i].type)}),this.rowIds[this.rows[e].selector.rows]=e);else for(let t=n.n;t--;)this.rows[e]=this.table.row.add({time:t,entity:a.selection.all[e]}),this.rowIds[this.rows[e].selector.rows]=e}));else{this.filters&&Object.keys(this.filters).forEach((e=>{this.current_filter[X]=se(e)}));const n=[];let r=""+this.parsed.dataset+a.get.ids(!0)+a.get.features()+o.settings.digits;for(let a=this.options.variables.length;a--;){i=this.options.variables[a].name||this.options.variables[a],e=!this.filters;const l=await o.data.get_variable(i,this.view);if(i in o.data.variables&&"meta"in l)if(this.options.filters){for(const t in this.current_filter)if(t in l.meta&&!(e=l.meta[t]===this.current_filter[t]))break}else e=!0;e&&(r+=i,n.push({variable:i,int:t.int_types.test(o.data.variables[i].type),time_range:l.time_range[s],renderer:function(e,t){const i=t.features.id,a=this.time_range,n=a[1];for(let r=a[0];r<=n;r++)e.rows[i]=e.table.row.add({offset:this.time_range[0],time:r-this.time_range[0],dataset:s,variable:this.variable,entity:t,int:this.int}),e.rowIds[e.rows[i].selector.rows]=i}}))}if(r===this.varstate)return;this.varstate=r,Object.keys(a.selection.all).forEach((e=>{const r=a.selection.all[e];this.options.single_variable?i in r[a].summary&&c.code in r.data&&(this.rows[e]=this.table.row.add({offset:this.parsed.time_range[0],dataset:s,variable:i,entity:r,int:t.int_types.test(o.data.variables[i].type)}),this.rowIds[this.rows[e].selector.rows]=e):n.forEach((e=>{o.data.variables[e.variable].code in r.data&&e.renderer(this,r)}))}))}}this.table.draw()}if(this.parsed.time>-1&&this.header.length>1&&a.time_range.filtered_index&&(this.dark_highlight=o.settings.theme_dark,this.style.sheet.rules.length&&this.style.sheet.removeRule(0),this.parsed.time_index[d]&&this.style.sheet.insertRule("#"+this.id+" td:nth-child("+(this.parsed.time_index[d]+1)+"){background-color: var(--background-highlight)}",0),!l&&o.settings.table_autosort&&this.table.order([this.parsed.time+1,"dsc"]).draw(),o.settings.table_autoscroll)){const e=this.e.parentElement.getBoundingClientRect().width,t=this.table.column(this.parsed.time+1).header().getBoundingClientRect();t&&this.e.parentElement.scroll({left:t.x-this.e.getBoundingClientRect().x+t.width+16-e,behavior:o.settings.table_scroll_behavior||"smooth"})}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))},mouseover:function(e){if(e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row],i=this.rows[t].node();i&&i.classList.add("highlighted"),t in o.data.entities&&B(this.id,"show",o.data.entities[t])}},mouseout:function(e){if(e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row],i=this.rows[t].node();i&&i.classList.remove("highlighted"),t in o.data.entities&&B(this.id,"revert",o.data.entities[t])}},click:function(e){if(this.clickto&&e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row];t in o.data.entities&&this.clickto.set(t)}}},table:{init:function(e){e.click=e.e.getAttribute("data-click"),e.features=e.options.features,e.parsed={summary:{},order:[],time:0,color:"",dataset:a.dataview,time_index:{}},e.header=[],e.rows={},e.parts={head:l.createElement("thead"),body:l.createElement("tbody")},e.parts.head.appendChild(l.createElement("tr")),e.e.appendChild(e.parts.head),e.e.appendChild(e.parts.body),e.click&&e.e.classList.add("interactive"),e.options.variable_source=e.options.variables,e.options.variables in C&&M(e.options.variables,{type:"update",id:e.id}),e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.tab&&l.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){this.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(ee,155))}.bind(e)),e.e.addEventListener("mouseover",h.table.mouseover.bind(e)),e.e.addEventListener("mouseout",h.table.mouseout.bind(e)),e.click&&(e.click in C&&(e.clickto=C[e.click]),e.e.addEventListener("click",h.table.click.bind(e))),e.show=function(e){if(e.features){const t=this.rows[e.features.id];if(t&&t.parentElement&&(t.classList.add("highlighted"),o.settings.table_autoscroll)){const e=this.e.parentElement.getBoundingClientRect().height,i=t.getBoundingClientRect().y-t.parentElement.getBoundingClientRect().y;this.e.parentElement.scroll({top:e>this.e.scrollHeight-i?this.e.parentElement.scrollHeight:i,behavior:o.settings.table_scroll_behavior||"smooth"})}}}.bind(e),e.revert=function(e){e.features&&e.features.id in this.rows&&this.rows[e.features.id].classList.remove("highlighted")}.bind(e),e.createHeader=function(e){const t=this.parsed.dataset,i=o.data.meta.times[t],a=this.parts.head.firstElementChild,s=this.parsed.variable.time_range[t],n=s[0],r=s[1]+1,d=this.parsed.summary.n;this.parsed.time_index={},a.innerHTML="",a.appendChild(l.createElement("th")),a.lastElementChild.appendChild(l.createElement("span")),a.firstElementChild.lastElementChild.innerText="Name";for(let t=n,s=0;t<r;t++)e.times[t]&&(o.settings.show_empty_times||d[t-n])&&(this.parsed.time_index[i.value[t]]=s++,a.appendChild(l.createElement("th")),a.lastElementChild.appendChild(l.createElement("span")),a.lastElementChild.lastElementChild.innerText=i.value[t])}.bind(e),e.appendRows=function(e){const t=this.parsed.order,i=this.parsed.variable,a=o.data.meta.times[this.parsed.dataset].value,s=i.time_range[this.parsed.dataset],n=s[0],r=s[1]-n+1,d=e.selection.all;this.current_variable=i.code+this.parsed.dataset,this.parts.body.innerHTML="";for(let s=t.length;s--;){const c=t[s][0];if(c in d){const t=o.data.entities[c],s=t.data[i.code],d=l.createElement("tr");this.rows[c]=d,d.setAttribute("data-entityId",c);let h=l.createElement("td");if(h.innerText=t.features.name,d.appendChild(h),1===r)d.appendChild(h=l.createElement("td")),h.innerText=o.data.format_value(s),h.setAttribute("data-entityId",c),h.classList.add("highlighted");else for(let t=0;t<r;t++)e.times[t+n]&&a[t+n]in this.parsed.time_index&&(d.appendChild(h=l.createElement("td")),h.innerText=o.data.format_value(s[t]),t===this.parsed.time&&h.classList.add("highlighted"));this.parts.body.appendChild(d)}}if(o.settings.table_autoscroll&&this.parts.head.firstElementChild.childElementCount>2&&this.parts.head.firstElementChild.childElementCount>this.parsed.time+1){const e=this.e.parentElement.getBoundingClientRect().width,t=this.parts.head.firstElementChild.children[this.parsed.time+1].getBoundingClientRect();this.e.parentElement.scroll({left:t.x-this.e.getBoundingClientRect().x+t.width+16-e,behavior:o.settings.table_scroll_behavior||"smooth"})}}.bind(e),e.view?(M(e.view,{type:"update",id:e.id}),M(e.view+"_filter",{type:"update",id:e.id}),M(C[e.view].time_agg,{type:"update",id:e.id})):e.view=a.dataview,e.update()},update:async function(e){if(this.queue>0&&clearTimeout(this.queue),this.queue=-1,e){let e=this.options.variable_source&&se(this.options.variable_source).replace(t.all_periods,"\\.");const i=C[this.view],a=i.get.dataset(),s=se(i.time_agg),n=a+i.value()+i.get.time_filters()+o.settings.digits+e+s+o.settings.show_empty_times;if(!o.data.inited[a])return;if(n!==this.state){this.state=n,Object.keys(this.reference_options).forEach((e=>this.options[e]=se(this.reference_options[e])));const t=await o.data.get_variable(e,this.view);this.parsed.dataset=a,this.parsed.color=e,this.parsed.variable=t,this.parsed.time_range=t.time_range[a],this.parsed.time=("number"==typeof s?s-o.data.meta.times[a].range[0]:0)-this.parsed.time_range[0],this.parsed.summary=t.views[this.view].summaries[a],this.parsed.order=t.views[this.view].order[a][this.parsed.time],this.createHeader(i),this.appendRows(i)}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))},mouseover:function(e){const t="TD"===e.target.tagName?e.target.parentElement:e.target,i=t.getAttribute("data-entityId");i&&(t.classList.add("highlighted"),B(this.id,"show",o.data.entities[i]))},mouseout:function(e){const t="TD"===e.target.tagName?e.target.parentElement:e.target,i=t.getAttribute("data-entityId");i&&(t.classList.remove("highlighted"),B(this.id,"revert",o.data.entities[i]))},click:function(e){const t=("TD"===e.target.tagName?e.target.parentElement:e.target).getAttribute("data-entityId");this.clickto&&t&&this.clickto.set(t)}},legend:{init:function(e){M(e.view,{type:"update",id:e.id});const t=C[e.view];if(t.time_agg in C&&M(t.time_agg,{type:"update",id:e.id}),e.palette||(t.palette?(e.palette=t.palette,t.palette in C&&M(t.palette,{type:"update",id:e.id})):e.palette="settings.palette"in C?"settings.palette":o.settings.palette),e.variable=e.e.getAttribute("data-variable"),e.variable?e.variable in C&&M(e.variable,{type:"update",id:e.id}):t.y in C&&M(t.y,{type:"update",id:e.id}),e.palette in C){const t=C[e.palette];t.e&&t.e.addEventListener("change",e.update)}e.parsed={summary:{},order:[],selection:{},time:0,color:"",rank:!1},e.state="",e.queue={lock:!1,cooldown:-1,trigger:function(){this.mouseover(this.queue.e)}.bind(e)},e.queue.reset=function(){this.lock=!1}.bind(e.queue),e.parts={ticks:e.e.querySelector(".legend-ticks"),scale:e.e.querySelector(".legend-scale"),summary:e.e.querySelector(".legend-summary")},e.parts.ticks.setAttribute("data-of",e.id),e.parts.scale.setAttribute("data-of",e.id),e.parts.summary.setAttribute("data-of",e.id),e.mouseover=h.legend.mouseover.bind(e),e.e.addEventListener("mousemove",e.mouseover),e.e.addEventListener("mouseout",h.legend.mouseout.bind(e)),e.e.addEventListener("click",h.legend.click.bind(e)),e.click=e.e.getAttribute("data-click"),e.click in C&&(e.clickto=C[e.click]),e.ticks={center:e.parts.summary.appendChild(l.createElement("div")),min:e.parts.summary.appendChild(l.createElement("div")),max:e.parts.summary.appendChild(l.createElement("div")),entity:e.parts.ticks.appendChild(l.createElement("div"))},Object.keys(e.ticks).forEach((t=>{e.ticks[t].setAttribute("data-of",e.id),e.ticks[t].className="legend-tick",e.ticks[t].appendChild(U=l.createElement("div")),U.setAttribute("data-of",e.id),U.appendChild(l.createElement("p")),U.lastElementChild.setAttribute("data-of",e.id),"m"!==t.substring(0,1)&&(U.appendChild(l.createElement("p")),U.lastElementChild.setAttribute("data-of",e.id),U.appendChild(l.createElement("p")),U.lastElementChild.setAttribute("data-of",e.id),"entity"===t?e.ticks[t].firstElementChild.lastElementChild.classList.add("entity"):e.ticks[t].firstElementChild.firstElementChild.classList.add("summary"))})),e.ticks.entity.firstElementChild.classList.add("hidden"),e.ticks.max.className="legend-tick-end max",e.ticks.min.className="legend-tick-end min",e.ticks.center.style.left="50%",e.show=function(e,t){if(e&&"parsed"in t&&e.features.name){const i=C[this.view],a=t.parsed.summary,s=a&&"string"===a.type,n=a&&!s?a.min[t.parsed.time]:0,r=a?s?a.levels.length-n:a.range[t.parsed.time]:1,l=a.n[t.parsed.time],d=l===i.n_selected.dataset?"rank":"subset_rank",c=o.data.entities[e.features.id].views[this.view],h=e.get_value(t.parsed.color,t.parsed.time),p=100*((s?h in a.level_ids:"number"==typeof h)?o.settings.color_by_order?NaN:Math.max(0,Math.min(1,r?((s?a.level_ids[h]:h)-n)/r:.5)):NaN),u=this.ticks.entity,m=u.firstElementChild.children[1];if(isFinite(p))m.parentElement.classList.remove("hidden"),m.innerText=o.data.format_value(h,this.integer),u.style.left=p+"%",u.firstElementChild.firstElementChild.innerText=(p>96||p<4)&&e.features.name.length>13?e.features.name.substring(0,12)+"":e.features.name;else if(o.settings.color_by_order&&t.parsed.color in c[d]){const i=c[d][t.parsed.color][t.parsed.time],a=l>1?i/(l-1)*100:0;u.firstElementChild.firstElementChild.innerText=i>-1&&(a>96||a<4)&&e.features.name.length>13?e.features.name.substring(0,12)+"":e.features.name,i>-1&&(m.parentElement.classList.remove("hidden"),m.innerText="# "+(l-i),u.style.left=a+"%")}u.style.marginLeft=-u.getBoundingClientRect().width/2+"px"}},e.revert=function(){this.ticks.entity.firstElementChild.classList.add("hidden")},e.update()},update:async function(){const i=C[this.view],n=se(this.variable||i.y),r=i.get.dataset(),d=await o.data.get_variable(n,this.view),c=se(i.time_agg);if(null!==c&&i.valid&&d&&this.view in d.views){const i=("number"==typeof c?c-o.data.meta.times[r].range[0]:0)-d.time_range[r][0],h=d.views[this.view].summaries[r],p=se(this.palette).toLowerCase(),u=p in e?p:o.settings.palette in e?o.settings.palette:a.palette,m=e[u].colors,f=this.parts.scale,b=this.ticks;if(this.parsed.summary=h,this.parsed.order=d.views[this.view].order[r][i],this.parsed.time=i,this.parsed.color=n,h&&i<h.n.length){this.integer=!o.data.variable_info[n]||!o.data.variable_info[n].type||t.int_types.test(o.data.variables[n].type);const a=o.settings.color_by_order!==this.parsed.rank,r=f.querySelectorAll("span"),c=e[u].odd,p="discrete"===e[u].type?m.length!==r.length-c:!f.firstElementChild||"SPAN"!==f.firstElementChild.tagName;if(u+o.settings.color_scale_center!==this.current_palette||a)if(this.current_palette=u+o.settings.color_scale_center,this.parsed.rank=o.settings.color_by_order,p&&(f.innerHTML=""),"discrete"===e[u].type){let e,t=0,i=Math.ceil(m.length/2);if(p){f.appendChild(e=l.createElement("div")),e.dataset.of=this.id,e.style.left=0;const a=1/(i-c/2)*100+"%";for(;t<i;t++)e.appendChild(l.createElement("span")),e.lastElementChild.dataset.of=this.id,e.lastElementChild.style.backgroundColor=m[t],e.lastElementChild.style.width=a;for(c&&(e.lastElementChild.style.width=1/(i-c/2)*100/2+"%"),f.appendChild(e=l.createElement("div")),e.dataset.of=this.id,e.style.right=0,t=Math.floor(m.length/2),i=m.length;t<i;t++)e.appendChild(l.createElement("span")),e.lastElementChild.dataset.of=this.id,e.lastElementChild.style.backgroundColor=m[t],e.lastElementChild.style.width=a;c&&(e.firstElementChild.style.width=1/(i-c/2)*100/2+"%")}else{for(;t<i;t++)r[t].style.backgroundColor=m[t];for(t=Math.floor(m.length/2),i=m.length;t<i;t++)r[t+c].style.backgroundColor=m[t]}}else p&&(f.appendChild(l.createElement("span")),f.appendChild(l.createElement("span"))),f.firstElementChild.style.background="linear-gradient(0.25turn, rgb("+m[2][0][0]+", "+m[2][0][1]+", "+m[2][0][2]+"), rgb("+m[1][0]+", "+m[1][1]+", "+m[1][2]+"))",f.lastElementChild.style.background="linear-gradient(0.25turn, rgb("+m[1][0]+", "+m[1][1]+", "+m[1][2]+"), rgb("+m[0][0][0]+", "+m[0][0][1]+", "+m[0][0][2]+"))";if("string"===d.type)b.center.classList.remove("hidden"),b.min.firstElementChild.firstElementChild.innerText=d.levels[0],b.max.firstElementChild.firstElementChild.innerText=d.levels[d.levels.length-1];else if(o.settings.color_by_order)b.center.classList.add("hidden"),b.min.firstElementChild.firstElementChild.innerText="# "+(h.n[i]?h.n[i]:0),b.max.firstElementChild.firstElementChild.innerText="# "+(h.n[i]?1:0);else{const e=""+h.n[i]+h.min[i]+h.max[i]+o.settings.digits+o.settings.color_scale_center+o.settings.summary_selection;(p||a||e!==this.state)&&(this.state=e,b.center.classList.remove("hidden"),b.min.firstElementChild.firstElementChild.innerText=h.n[i]&&isFinite(h.min[i])?o.data.format_value(h.min[i],this.integer):NaN,b.max.firstElementChild.firstElementChild.innerText=h.n[i]&&isFinite(h.max[i])?o.data.format_value(h.max[i],this.integer):NaN,"none"===o.settings.color_scale_center?(b.center.firstElementChild.lastElementChild.innerText=s[o.settings.summary_selection]+" median",b.center.firstElementChild.children[1].innerText=o.data.format_value(h.median[i]),b.center.style.left=100*h.norm_median[i]+"%"):(b.center.firstElementChild.lastElementChild.innerText=s[o.settings.summary_selection]+" "+o.settings.color_scale_center,b.center.firstElementChild.children[1].innerText=o.data.format_value(h[o.settings.color_scale_center][i]),b.center.style.left=100*h["norm_"+o.settings.color_scale_center][i]+"%"),b.center.style.marginLeft=-b.center.getBoundingClientRect().width/2+"px")}o.settings.color_by_order||"none"===o.settings.color_scale_center?(f.firstElementChild.style.width="50%",f.lastElementChild.style.width="50%"):(f.firstElementChild.style.width=100*h["norm_"+o.settings.color_scale_center][i]+"%",f.lastElementChild.style.width=100-100*h["norm_"+o.settings.color_scale_center][i]+"%")}}},mouseover:function(e){if(this.queue.lock)this.queue.cooldown>0&&clearTimeout(this.queue.cooldown),this.queue.e=e,this.queue.cooldown=setTimeout(this.queue.trigger,100);else{this.queue.lock=!0;const t=this.parts.scale.getBoundingClientRect(),i=(Math.max(t.x,Math.min(t.x+t.width,e.clientX))-t.x)/t.width;let a=!1;if(o.settings.color_by_order)this.parsed.order&&this.parsed.order.length&&(a=o.data.entities[this.parsed.order[Math.max(this.parsed.summary.missing[this.parsed.time],Math.min(this.parsed.order.length-1,Math.floor((this.parsed.order.length-1)*i)))][0]]);else if("min"in this.parsed.summary){const e=this.parsed.summary.min[this.parsed.time],t=e+i*(this.parsed.summary.max[this.parsed.time]-e);let s,n;if(this.parsed.order&&this.parsed.order.length&&(n=this.parsed.summary.missing[this.parsed.time],n<this.parsed.order.length))if(1!==this.parsed.order.length&&i){for(s=this.parsed.order.length-2;s>=n&&!((this.parsed.order[s][1]+this.parsed.order[s+1][1])/2<=t);--s);s++,a=o.data.entities[this.parsed.order[s][0]]}else a=o.data.entities[this.parsed.order[n][0]]}a&&(this.show(a,this),this.entity&&a.features.id===this.entity.features.id||(this.entity?B(this.id,"revert",this.entity):this.entity=a,B(this.id,"show",a),this.entity=a)),setTimeout(this.queue.reset,200)}},mouseout:function(e){e.relatedTarget&&this.id!==e.relatedTarget.getAttribute("data-of")&&(this.queue.cooldown>0&&clearTimeout(this.queue.cooldown),this.queue.cooldown=-1,this.revert(),this.entity&&(B(this.id,"revert",this.entity),this.entity=!1))},click:function(){this.clickto&&this.entity&&(this.revert(),this.clickto.set(this.entity.features.id))}},credits:{init:function(e){const t=o.credit_output&&o.credit_output[e.id];e.exclude=t&&t.exclude||[],e.add=t&&t.add||{},e.e.appendChild(l.createElement("ul")),e.credits={...o.credits,...e.add},Object.keys(e.credits).forEach((t=>{if(-1===e.exclude.indexOf(t)){const i=e.credits[t];let a;e.e.lastElementChild.appendChild(a=l.createElement("li")),"url"in i&&(a.appendChild(a=l.createElement("a")),a.href=i.url,a.target="_blank",a.rel="noreferrer"),a.innerText=i.name,"version"in i&&(a.appendChild(l.createElement("span")),a.lastElementChild.className="version-tag",a.lastElementChild.innerText=i.version),"description"in i&&(a.parentElement.appendChild(l.createElement("p")),a.parentElement.lastElementChild.innerText=i.description)}}))}},init_input:function(e){const i={type:e.getAttribute("data-autoType"),source:void 0,value:function(){const e=se(this.source);return void 0===e?se(this.default):e},default:e.getAttribute("data-default"),optionSource:e.getAttribute("data-optionSource"),depends:e.getAttribute("data-depends"),variable:e.getAttribute("data-variable"),dataset:e.getAttribute("data-dataset"),view:e.getAttribute("data-view"),id:e.id||e.optionSource||"ui"+_.elementCount++,note:e.getAttribute("aria-description")||"",current_index:-1,previous:"",e:e,values:[],display:[],data:[],input:!0};if(i.settings=i.type in o&&i.id in o[i.type]?o[i.type][i.id]:{},i.wrapper=i.e.parentElement.classList.contains("wrapper")?i.e.parentElement:i.e.parentElement.parentElement,i.wrapper&&(i.note&&i.wrapper.classList.add("has-note"),i.wrapper.setAttribute("data-of",i.id),["div","span","label","fieldset","legend","input","button"].forEach((e=>{const t=i.wrapper.querySelectorAll(e);t.length&&t.forEach((e=>e.setAttribute("data-of",i.id)))}))),i.note){i.wrapper.addEventListener("mouseover",ne.bind(i));const e="DIV"!==i.e.tagName?i.e:i.e.querySelector("input");e&&(e.addEventListener("focus",ne.bind(i)),e.addEventListener("blur",re))}if(t.number.test(i.default)&&(i.default=Number(i.default)),i.type in h){const e=h[i.type];e.setter&&(i.set=e.setter.bind(i),i.reset=function(){this.set(se(this.default))}.bind(i)),e.retrieve&&(i.get=e.retrieve.bind(i)),e.adder&&(i.add=e.adder.bind(i)),e.listener&&(i.listen=e.listener.bind(i)),e.init&&e.init(i),i.options||(i.options=i.e.querySelectorAll("select"===i.type?"option":"input")),i.optionSource&&t.ids.test(i.optionSource)?(i.loader=function(){this.e.classList.contains("locked")||(this.deferred=!1,this.e.removeEventListener("click",this.loader),pe(this.id))}.bind(i),i.e.addEventListener("click",i.loader),i.deferred=!0):"number"==typeof i.default&&i.default>-1&&i.options&&i.options.length&&i.default<i.options.length&&(i.default=i.options[i.default].value||i.options[i.default].dataset.value),C[i.id]=i}},init_output:function(e,t){const i={type:e.getAttribute("data-autoType"),view:e.getAttribute("data-view")||a.dataview,id:e.id||"out"+t,note:e.getAttribute("aria-description")||"",reference_options:{},e:e};i.note&&i.e.addEventListener("mouseover",ne.bind(i)),i.options=i.type in o?o[i.type][i.id]:void 0,i.options&&i.options.dataview&&(i.view=i.options.dataview),i.type in h&&"update"in h[i.type]&&(i.update=h[i.type].update.bind(i)),i.options&&("options"in i.options&&(i.options=i.options.options),Object.keys(i.options).forEach((e=>{i.options[e]in C&&(i.reference_options[e]=i.options[e])})),"subto"in i.options&&("string"==typeof i.options.subto&&(i.options.subto=[i.options.subto]),Array.isArray(i.options.subto)&&i.options.subto.forEach((e=>I(e,i))))),C[i.id]=i,i.type in h&&"init"in h[i.type]&&(!i.view||C[i.view].parsed.dataset in o.data.inited?h[i.type].init(i):o.data.data_queue[C[i.view].parsed.dataset][i.id]=h[i.type].init.bind(null,i))}},u={name:r.location.pathname||"default",perm:r.localStorage||{setItem:function(){},getItem:function(){},removeItem:function(){}},set:function(e,t){const i=JSON.parse(this.perm.getItem(this.name))||{};i[e]=t,this.perm.setItem(this.name,JSON.stringify(i))},get:function(e){const t=JSON.parse(this.perm.getItem(this.name));return t?e?t[e]:t:void 0}},m={Enter:"select",NumpadEnter:"select",ArrowUp:"move",Home:"move",ArrowDown:"move",End:"move",Escape:"close",Tab:"close"},f={Time:["first","selected","last"],summary:["missing","min","q1","mean","median","q3","max"]},b={number:function(e){return this-e.range[0]},first:function(e){return 0},selected:function(e,t){return t.time_agg-e.range[0]},last:function(e){return e.range[1]-e.range[0]}},_={load_screen:l.getElementById("load_screen"),wrap:l.getElementById("site_wrap"),navbar:l.querySelector(".navbar"),content:l.querySelector(".content"),overlay:l.createElement("div"),menus:l.getElementsByClassName("menu-wrapper"),panels:l.getElementsByClassName("panel"),elementCount:0},g={_timeout:0},v={retain_state:!0},y={},E={},x={},C={_entity_filter:{id:"_entity_filter",registered:{},entities:new Map,selected:[],select_ids:{},value:function(e,t){return Object.keys(this.select_ids).join(",")}},_base_filter:{id:"_base_filter",c:new Map,value:function(e,t){const i=!e;return i&&(e=[]),C._base_filter.c.forEach((s=>{const n="selected"===s.component?o.data.meta.overall.value[void 0===t?C[a.dataview].parsed.time_agg:t]:s.time_component?o.data.meta.overall.value[s.component]:s.component;s.value&&e.push(s.variable+"["+n+"]"+s.operator+s.value+(i?s.active:""))})),e.join("&")}}},w={},k={};if(_.overlay.className="content-overlay",l.body.appendChild(_.overlay),l.body.className=u.get("theme_dark")||o.settings.theme_dark?"dark-theme":"light-theme",_.content){let e=_.menus.length,t=_.navbar?_.navbar.getBoundingClientRect().height:0;for(;e--;)if(_.menus[e].classList.contains("menu-top")){t=_.menus[e].getBoundingClientRect().height;break}_.content.style.top=t+"px"}function T(i,s,n,r,l,d){if(isNaN(i))return a.missing;const c="none"!==o.settings.color_scale_center&&!o.settings.color_by_order,h="discrete"===e[s].type,p=e[s].colors,u=e[s].odd,m="string"===n.type,f=m?0:n.min[r],b=m?n.levels.length-f:n.range[r],_="none"===o.settings.color_scale_center||t.median.test(o.settings.color_scale_center)?"median":"mean",g=o.settings.color_by_order?c?n["break_"+_][r]/d:.5:isNaN(n["norm_"+_][r])?.5:n["norm_"+_][r],v=h?c&&!o.settings.color_by_order?Math.ceil(p.length/2)-u/2:p.length:1,y=o.settings.color_by_order?l/d:b?((m?n.level_ids[i]:i)-f)/b:.5,E=y>(c?g:.5);let x=c?b?E?(y-g-n["upper_"+_+"_min"][r])/n["upper_"+_+"_range"][r]:(y+g-n["lower_"+_+"_min"][r])/n["lower_"+_+"_range"][r]:1:y;return h||(x=Math.max(0,Math.min(1,x)),E&&(x=1-x),c||(x*=2)),(m?i in n.level_ids:"number"==typeof i)?h?p[Math.max(0,Math.min(p.length-1,Math.floor(c&&E?v+v*x:v*x)))]:"rgb("+(E?p[0][0][0]+x*p[0][1][0]+", "+(p[0][0][1]+x*p[0][1][1])+", "+(p[0][0][2]+x*p[0][1][2]):p[2][0][0]+x*p[2][1][0]+", "+(p[2][0][1]+x*p[2][1][1])+", "+(p[2][0][2]+x*p[2][1][2]))+")":a.missing}function N(e,t){if("button"in t||(t.button={}),"string"==typeof t.text&&(t.text=[t.text]),t.parts=l.createElement("span"),t.text.forEach((i=>{if(i in t.button){const a=t.button[i];if(t.parts.appendChild(l.createElement("button")),t.parts.lastElementChild.type="button",a.trigger=ne.bind({id:e.id+a.text,note:a.target,wrapper:t.parts.lastElementChild}),"note"===a.type)t.parts.lastElementChild.setAttribute("aria-description",a.target),t.parts.lastElementChild.setAttribute("data-of",e.id+a.text),t.parts.lastElementChild.className="has-note",t.parts.lastElementChild.addEventListener("mouseover",a.trigger),t.parts.lastElementChild.addEventListener("focus",a.trigger),t.parts.lastElementChild.addEventListener("blur",re);else{t.parts.lastElementChild.className="btn btn-link",Array.isArray(a.target)||(a.target=[a.target]);const e=new Map;a.target.forEach((t=>{const i=C[t];i&&"function"==typeof i[a.type]&&e.set(t,i[a.type])})),e.size&&(t.parts.lastElementChild.setAttribute("aria-label",a.text.join("")),t.parts.lastElementChild.addEventListener("click",function(){this.forEach((e=>e()))}.bind(e)))}}else t.parts.appendChild(l.createElement("span"));i in C&&e.depends.set(i,{id:i,u:C[i],parsed:""})})),"condition"in t)for(let i=t.condition.length;i--;){const a=t.condition[i];a.id&&("default"===a.id?a.check=function(){return!0}:(e.depends.set(a.id,a),a.check=function(){return"default"===this.id||DataHandler.checks[this.type](se(this.id),se(this.value))}.bind(a)))}}function A(e,i,a,s){if(!(i in o.data.sets))return void(o.data.data_queue[i][e.id]=function(){e.e.removeEventListener("click",e.loader),A(e,i,a,s),e.set_current(),e.current_set=i});a[i]={options:[],values:{},display:{}};const n=e.values,r=a[i].options,d=a[i].values,c=a[i].display,h="combobox"===e.type;let p=!e.sensitive&&!!e.current_set,u=0;e.settings.group&&(e.groups={e:[],by_name:{}},h&&e.settings.accordion&&(e.listbox.classList.add("accordion"),e.listbox.id=e.id+"-listbox")),Object.keys(o.data.entities).forEach((a=>{const s=o.data.entities[a];if(i===s.group)if(p&&!(a in n)&&(e.sensitive=!0,p=!1),e.groups){let i=s.features[e.settings.group]||["No Group"];Array.isArray(i)||(i=[i]);for(let n=i.length;n--;){const r=i[n];if(!(r in e.groups.by_name)){const i=l.createElement(h?"div":"optgroup");if(h){const a=e.id+"_"+r.replace(t.seps,"-");let s;e.settings.accordion?(i.setAttribute("data-group",r),i.className="combobox-group accordion-item combobox-component",i.appendChild(s=l.createElement("div")),s.className="accordion-header combobox-component",s.appendChild(s=l.createElement("button")),s.id=a+"-label",s.innerText=r,s.type="button",s.className="accordion-button combobox-component collapsed",s.setAttribute("data-bs-toggle","collapse"),s.setAttribute("data-bs-target","#"+a),s.setAttribute("aria-expanded","false"),s.setAttribute("aria-controls",a),i.appendChild(s=l.createElement("div")),s.id=a,s.className="combobox-component accordion-collapse collapse",s.setAttribute("data-bs-parent","#"+e.id+"-listbox"),s.appendChild(s=l.createElement("div")),s.className="accordion-body combobox-component",s.role="group",s.setAttribute("aria-labelledby",a+"-label")):(i.className="combobox-group combobox-component",i.id=a,i.role="group",i.appendChild(s=l.createElement("div")),s.appendChild(s=l.createElement("label")),s.for=a,s.innerText=r,s.id=a+"-label",s.for=a,s.className="combobox-group-label combobox-component")}else i.label=r;e.groups.by_name[r]=i,e.groups.e.push(i)}const o=e.add(a,s.features.name,!0);o.setAttribute("data-group",r),h&&e.settings.accordion?e.groups.by_name[r].lastElementChild.lastElementChild.appendChild(o):e.groups.by_name[r].appendChild(o)}}else r.push(e.add(a,s.features.name)),d[a]=u,c[s.features.name]=u++})),e.settings.group&&(u=0,Object.keys(e.groups.by_name).forEach((t=>{e.groups.by_name[t].querySelectorAll(h?".combobox-option":"option").forEach((e=>{r.push(e),d[h?e.dataset.value:e.value]=u,c[e.innerText]=u++}))}))),s&&s()}function q(e,i,s){s[i]={options:[],values:{},display:{}};const n=e.values,r=s[i].options,d=s[i].values,c=s[i].display,h="combobox"===e.type;let p=!e.sensitive&&!!e.current_set,u=0;e.settings.group&&(e.groups={e:[],by_name:{}},h&&e.settings.accordion&&(e.listbox.classList.add("accordion"),e.listbox.id=e.id+"-listbox"));const m=o.url_options[e.id];let f=!1;m&&!(m in o.data.variables)&&(o.url_options[e.id]=m.replace(t.pre_colon,""),o.url_options[e.id]in o.data.variables||(f=!0)),o.data.info[i].schema.fields.forEach((i=>{const a=o.data.variables[i.name];if(a&&!a.is_time){const a=o.data.format_label(i.name);if(p&&!(V in n)&&(e.sensitive=!0,p=!1),e.groups){let s=i.info&&i.info[e.settings.group]||["No Group"];Array.isArray(s)||(s=[s]);for(let n=s.length;n--;){const r=s[n];if(!(r in e.groups.by_name)){const i=l.createElement(h?"div":"optgroup");if(h){const a=e.id+"_"+r.replace(t.seps,"-");let s;e.settings.accordion?(i.setAttribute("data-group",r),i.className="combobox-group accordion-item combobox-component",i.appendChild(s=l.createElement("div")),s.className="accordion-header combobox-component",s.appendChild(s=l.createElement("button")),s.id=a+"-label",s.innerText=r,s.type="button",s.className="accordion-button combobox-component collapsed",s.setAttribute("data-bs-toggle","collapse"),s.setAttribute("data-bs-target","#"+a),s.setAttribute("aria-expanded","false"),s.setAttribute("aria-controls",a),i.appendChild(s=l.createElement("div")),s.id=a,s.className="combobox-component accordion-collapse collapse",s.setAttribute("data-bs-parent","#"+e.id+"-listbox"),s.appendChild(s=l.createElement("div")),s.className="accordion-body combobox-component",s.role="group",s.setAttribute("aria-labelledby",a+"-label")):(i.className="combobox-group combobox-component",i.role="group",i.appendChild(s=l.createElement("div")),s.appendChild(s=l.createElement("label")),s.for=a,s.innerText=r,s.id=a,s.className="combobox-group-label combobox-component")}else i.label=r;e.groups.by_name[r]=i,e.groups.e.push(i)}const o=e.add(i.name,a,!0,i);o.setAttribute("data-group",r),h&&e.settings.accordion?e.groups.by_name[r].lastElementChild.lastElementChild.appendChild(o):e.groups.by_name[r].appendChild(o)}}else r.push(e.add(i.name,a,!0,i)),r[u].id=e.id+"-option"+u,d[i.name]=u,c[a]=u++;f&&m===i.name.replace(t.pre_colon,"")&&(o.url_options[e.id]=i.name,f=!1)}})),e.settings.group&&(u=0,Object.keys(e.groups.by_name).forEach((t=>{e.groups.by_name[t].querySelectorAll(h?".combobox-option":"option").forEach((t=>{r.push(t),r[u].id=e.id+"-option"+u,d[h?t.dataset.value:t.value]=u,c[t.firstChild&&t.firstChild.textContent||t.innerText]=u++}))}))),e.settings.clearable||e.default in o.data.variables||(e.default=a.variable)}function O(e,t,i,a){const s=o.data.variables[i].info[t],n="string"===s.type?"levels":"ids",r=s[n];if(r){const s=t+i;a[s]={options:[],values:{},display:{}};const n=e.values,l=a[s].options,o=a[s].values,d=a[s].display;let c=!e.sensitive&&!!e.current_set,h=0;Object.keys(r).forEach((t=>{const i=r[t];c&&!(t in n)&&(e.sensitive=!0,c=!1),l.push(e.add(i.id,i.name,!0)),o[i.id]=h,d[i.name]=h++}))}else"ids"===n&&(o.data.data_queue[t][e.id]=function(){return O(e,t,i,a)})}function S(e,t){t&&!e.e.classList.contains("locked")?(e.e.removeAttribute("disabled"),e.e.classList.remove("disabled"),e.input_element&&e.input_element.removeAttribute("disabled")):(e.e.setAttribute("disabled","true"),e.e.classList.add("disabled"),e.input_element&&e.input_element.setAttribute("disabled","true"))}function j(e,t){return e.id in k&&t.id in k?k[e.id]._n.children-k[t.id]._n.children:-1/0}function M(e,t){e in w||(w[e]=[]),t.uid||(t.uid=JSON.stringify(t));const i=w[e];for(let e=i.length;e--;)if(t.uid===i[e].uid)return;i.push(t),e in k||(k[e]={_n:{children:0,parents:0},children:{},parents:{}}),t.id in k||(k[t.id]={_n:{children:0,parents:0},children:{},parents:{}}),k[e].children[t.id]=k[t.id],k[e]._n.children++,k[t.id].parents[e]=k[e],k[t.id]._n.parents++,i.sort(j),pe(e)}function I(e,t){e in y||(y[e]=[]),y[e].push(t)}function B(e,t,i){if(e in y)for(let a=y[e].length;a--;)t in y[e][a]&&y[e][a][t](i,C[e])}function R(e){if(e.dark_theme!==o.settings.theme_dark){e.dark_theme=o.settings.theme_dark;const t=getComputedStyle(l.body);"style"in e||(e.style=e.options.layout,"font"in e.style||(e.style.font={}),"modebar"in e.style||(e.style.modebar={}),"font"in e.style.xaxis||(e.style.xaxis.font={}),"font"in e.style.yaxis||(e.style.yaxis.font={})),e.style.paper_bgcolor=t.backgroundColor,e.style.plot_bgcolor=t.backgroundColor,e.style.font.color=t.color,e.style.modebar.bgcolor=t.backgroundColor,e.style.modebar.color=t.color,e.e._fullLayout.xaxis.showgrid&&(e.style.xaxis.gridcolor=t.borderColor),e.e._fullLayout.yaxis.showgrid&&(e.style.yaxis.gridcolor=t.borderColor),e.style.xaxis.font.color=t.color,e.style.yaxis.font.color=t.color,Plotly.relayout(e.e,e.options.layout)}}function D(e,t,i,s,n,r){if(t.data&&e.parsed.x in o.data.variables){const l=o.data.get_value({variable:e.parsed.x,entity:t}),d=o.data.get_value({variable:e.parsed.y,entity:t}),c=JSON.parse(e.traces[e.base_trace]),h=o.data.variables[e.parsed.y].time_range[e.parsed.dataset],p=o.data.variables[e.parsed.x].time_range[e.parsed.dataset],u=Math.min(h[1],p[1])+1,m=e.parsed.summary.n;for(let i=Math.max(h[0],p[0]);i<u;i++)(o.settings.show_empty_times||m[i-e.parsed.y_range[0]])&&(c.text.push(t.features.name),c.x.push(e.parsed.x_range[0]<=i&&i<=e.parsed.x_range[1]?l[i-e.parsed.x_range[0]]:NaN),c.y.push(e.parsed.y_range[0]<=i&&i<=e.parsed.y_range[1]?d[i-e.parsed.y_range[0]]:NaN));return c.type=e.parsed.base_trace,c.color=c.line.color=c.marker.color=c.textfont.color=r||T(t.get_value(e.parsed.color,e.parsed.time),e.parsed.palette,e.parsed.summary,e.parsed.time,i,s)||a.border,"bar"===c.type&&(c.marker.line.width=0),c.name=n||t.features.name,c.id=t.features.id,c}}function F(e,t,i){e.classList.add("info-summary-wrapper");const a=l.createElement("table");return a.className="info-summary",a.appendChild(l.createElement("tr")),a.appendChild(l.createElement("tr")),i&&Object.keys(i).forEach((e=>{a.firstElementChild.appendChild(l.createElement("th")),a.firstElementChild.lastElementChild.innerText=e,a.lastElementChild.appendChild(l.createElement("td")),a.lastElementChild.lastElementChild.innerText=i[e]})),["NAs","Min","Q1","Mean","Median","Q3","Max"].forEach((e=>{const i=e.toLowerCase();t&&!(i in t)||(a.firstElementChild.appendChild(l.createElement("th")),a.firstElementChild.lastElementChild.innerText=e,a.lastElementChild.appendChild(l.createElement("td")),a.lastElementChild.lastElementChild.innerText=t?o.data.format_value(t[i]):"NA")})),e.appendChild(a),a}function H(e){Array.isArray(e.author)||(e.author=[e.author]);const i=l.createElement("li"),a=e.author.length;let s="",n=1===a?"":2===a?" & ":", & ";for(let t=a;t--;){const i=e.author[t];s=(t?n:"")+("string"==typeof i?i:i.family)+(i.given?", "+i.given.substring(0,1)+".":"")+s,n=", "}return i.innerHTML=s+" ("+e.year+"). "+e.title+"."+(e.journal?" <em>"+e.journal+(e.volume?", "+e.volume:"")+"</em>"+(e.page?", "+e.page:"")+".":"")+(e.version?" Version "+e.version+".":"")+(e.doi||e.url?(e.doi?" doi: ":" url: ")+(e.doi||e.url?'<a rel="noreferrer" target="_blank" href="'+(e.doi?"https://doi.org/"+e.doi:e.url)+'">'+(e.doi||e.url.replace(t.http,""))+"</a>":""):""),i}function z(e,t){const i=l.createElement(t?"tr":"div");let a;return t?(e.name&&(i.appendChild(a=l.createElement("td")),e.url?(a.appendChild(a=l.createElement("a")),a.target="_blank",a.rel="noreferrer",a.href=e.url):a.appendChild(l.createElement("span")),i.firstElementChild.firstElementChild.innerText=e.name),e.date_accessed&&(i.appendChild(a=l.createElement("td")),a.appendChild(l.createElement("span")),a.firstElementChild.innerText=e.date_accessed)):(i.className="card",e.name&&(i.appendChild(a=l.createElement("div")),a.className="card-header",e.url?(a.appendChild(a=l.createElement("a")),a.target="_blank",a.rel="noreferrer",a.href=e.url):a.appendChild(l.createElement("span")),i.firstElementChild.firstElementChild.innerText=e.name),i.appendChild(l.createElement("div")),i.lastElementChild.className="card-body",e.location&&(i.lastElementChild.appendChild(a=l.createElement("p")),a.appendChild(l.createElement("span")),a.lastElementChild.innerText="Location: ",a.appendChild(l.createElement("span")),e.location_url?(a.lastElementChild.appendChild(a=l.createElement("a")),a.target="_blank",a.rel="noreferrer",a.href=e.location_url,a.innerText=e.location):a.lastElementChild.innerText=e.location),e.date_accessed&&(i.lastElementChild.appendChild(a=l.createElement("p")),a.appendChild(l.createElement("span")),a.lastElementChild.innerText="Date Accessed: ",a.appendChild(l.createElement("span")),a.lastElementChild.innerText=e.date_accessed)),i}function P(){const e=C[this.view],i=se(this.v||e.y),a=o.data.variable_info[i];if(_.modal.info.header.firstElementChild.innerText=a.short_name,_.modal.info.title.innerText=a.long_name,function(e,i){var a=i.long_description||i.description||i.short_description||"",s=t.has_equation.test(a);if(s)for(var n=a.split(t.bracket_content),r=n.length;r--;){var l=n[r];if(l&&"/"!==l.substring(0,1)){var o=l.split(t.space),d=o.length;if(!(s=t.math_tags.test(o[0])))break;for(var c=1;c<d&&(s=t.math_attributes.test(o[c]));c++);if(!s)break}}e[s?"innerHTML":"innerText"]=a}(_.modal.info.description,a),_.modal.info.name.lastElementChild.innerText=i,_.modal.info.type.lastElementChild.innerText=a.unit||a.aggregation_method||a.type||"",a.sources&&a.sources.length?(_.modal.info.sources.lastElementChild.innerHTML="",_.modal.info.sources.classList.remove("hidden"),a.sources.forEach((e=>{_.modal.info.sources.lastElementChild.appendChild(z(e))}))):_.modal.info.sources.classList.add("hidden"),a.citations&&a.citations.length){if(_.modal.info.references.lastElementChild.innerHTML="",_.modal.info.references.classList.remove("hidden"),"string"==typeof a.citations&&(a.citations=[a.citations]),"references"in o.data&&(delete o.data.variable_info._references,delete o.data.references),!("_references"in o.data.variable_info)){const e={};o.data.variable_info._references=e,Object.keys(o.data.info).forEach((t=>{const i=o.data.info[t];"_references"in i&&Object.keys(i._references).forEach((t=>{t in e||(e[t]={reference:i._references[t],element:H(i._references[t])})}))}))}const e=o.data.variable_info._references;a.citations.forEach((t=>{t in e&&_.modal.info.references.lastElementChild.appendChild(e[t].element)}))}else _.modal.info.references.classList.add("hidden");if("origin"in a){_.modal.info.origin.classList.remove("hidden");const e=_.modal.info.origin.lastElementChild;e.innerHTML="","string"==typeof a.origin&&(a.origin=[a.origin]),a.origin.forEach((i=>{const a=l.createElement("li"),s=t.repo.exec(i)[1];let n=l.createElement("a");n.href="https://github.com/"+s,n.target="_blank",n.rel="noreferrer",n.innerText=s,a.appendChild(n),a.appendChild(l.createElement("span")),a.lastElementChild.innerText=" / ",n=l.createElement("a"),n.href=i,n.target="_blank",n.rel="noreferrer",n.innerText=i.replace(t.basename,""),a.appendChild(n),e.appendChild(a)}))}else _.modal.info.origin.classList.add("hidden")}function G(e,a,s,n){if("statement"===a)for(let a,r;a=t.mustache.exec(e);)if("value"===a[1]){r=n?o.data.format_value(n.get_value(s.v,s.time),t.int_types.test(o.data.variables[s.v].type)):NaN;const l=o.data.variable_info[s.v];let d=l.unit||l.type;l.aggregation_method&&!(d in i)&&(d=l.aggregation_method),e=e.replace(a[0],NaN!==r&&d in i?i[d](r):r),t.mustache.lastIndex=0}else n&&("region_name"===a[1]?(e=e.replace(a[0],n.features.name),t.mustache.lastIndex=0):t.features.test(a[1])?(e=e.replace(a[0],n.features[a[1].replace(t.features,"")]),t.mustache.lastIndex=0):t.variables.test(a[1])?(e=e.replace(a[0],n.variables[s.v][a[1].replace(t.variables,"")]),t.mustache.lastIndex=0):t.data.test(a[1])&&(e=e.replace(a[0],n.get_value(a[1].replace(t.data,""),s.time)),t.mustache.lastIndex=0));return e}let V,J,U,Q,X;if(r.dataLayer||(r.dataLayer=[]),o.query=V=r.location.search.replace("?",""),o.url_options={},V)for(U=V.split("&"),J=U.length;J--;)X=U[J].split("="),X.length<2&&X.push("true"),X[1]=t.bool.test(X[1])?!!X[1]||"true"===X[1]:X[1].replace(t.url_spaces," "),o.url_options[X[0]]=X[1],t.settings.test(X[0])&&u.set(X[0].replace(t.settings,""),X[1]);if(("embedded"in o.url_options||"hide_navbar"in o.url_options)&&("hide_logo"in o.url_options||(o.url_options.hide_logo=!0),"hide_title"in o.url_options||(o.url_options.hide_title=!0),"hide_navcontent"in o.url_options||(o.url_options.hide_navcontent=!0),"hide_panels"in o.url_options||(o.url_options.hide_panels=!0),"embedded"in o.url_options&&!("close_menus"in o.url_options)&&(o.url_options.close_menus=!0)),U=_.navbar,U&&(U.querySelectorAll("button").forEach((e=>{const t=l.querySelector(e.getAttribute("data-bs-target"));t&&"false"===t.getAttribute("data-bs-backdrop")&&(t.addEventListener("show.bs.offcanvas",(function(){_.content_bounds.outer_right=t.getBoundingClientRect().width,Z(void 0,!0),setTimeout(ee,200)})),t.addEventListener("hide.bs.offcanvas",(function(){_.content_bounds.outer_right=0,Z(void 0,!0),setTimeout(ee,200)})))})),"navcolor"in o.url_options&&(""===o.url_options.navcolor&&(o.url_options.navcolor=r.location.hash),U.style.backgroundColor=o.url_options.navcolor.replace("%23","#")),o.url_options.hide_logo&&o.url_options.hide_title&&o.url_options.hide_navcontent?U.classList.add("hidden"):(U=l.querySelector(".navbar-brand"),U&&(o.url_options.hide_logo&&"IMG"===U.firstElementChild.tagName&&U.firstElementChild.classList.add("hidden"),o.url_options.hide_title&&"IMG"!==U.lastElementChild.tagName&&U.lastElementChild.classList.add("hidden")),o.url_options.hide_navcontent&&(l.querySelector(".navbar-toggler").classList.add("hidden"),U=l.querySelector(".navbar-nav"),U&&U.classList.add("hidden"))),o.url_options.hide_panels&&_.panels.length))for(J=_.panels.length;J--;)_.panels[J].classList.add("hidden");if(u.copy=u.get(),u.copy)for(const e in o.settings)if(e in u.copy){let i=u.copy[e];t.bool.test(i)?i=!!i||"true"===i:t.number.test(i)&&(i=parseFloat(i)),o.settings[e]=i}function Y(e,t,i){const a=i.length;let s=i[0][e]+t*i[1][e],n=2;for(;n<a;n++)s+=Math.pow(t,n)*i[n][e];return Math.max(0,Math.min(255,s))}function K(){o.data&&!o.data.inited||clearTimeout(o.data.inited.load_screen),_.wrap.style.visibility="visible",_.load_screen.style.display="none",o.tutorials&&"tutorial"in o.url_options&&setTimeout(_.tutorials.start_tutorial.bind(_.tutorials,{target:{dataset:{name:o.url_options.tutorial}}}),0)}function W(){r.localStorage&&u.perm.removeItem(u.name),r.location.reload()}function Z(e,t){const i=_[t?"wrap":"content"];t||(i.style.top=(_.top_menu&&"open"===_.top_menu.state?_.top_menu.getBoundingClientRect().height:_.content_bounds.top+(!_.top_menu&&!_.left_menu&&!_.right_menu||_.right_menu&&"open"===_.right_menu.state||_.left_menu&&"open"===_.left_menu.state?0:40))+"px",i.style.bottom=_.content_bounds.bottom+(_.bottom_menu&&"closed"!==_.bottom_menu.state?_.bottom_menu.getBoundingClientRect().height:0)+"px",i.style.left=_.content_bounds.left+(_.left_menu&&"closed"!==_.left_menu.state?_.left_menu.getBoundingClientRect().width:0)+"px"),i.style.right=_.content_bounds[t?"outer_right":"right"]+(_.right_menu&&"closed"!==_.right_menu.state?_.right_menu.getBoundingClientRect().width:0)+"px"}function ee(){"undefined"==typeof module&&r.dispatchEvent(new Event("resize"))}function te(){let e="";return x._u.forEach((i=>{const a=C[i];if(a.input&&!t.settings.test(i)&&(!a.range||a.range[0]!==a.range[1])){let t=a.value();("off_default"in a?a.off_default:t!==a.default)&&(Array.isArray(t)&&(t=t.join(",")),""!==t&&null!=t&&"-1"!=t&&(e+=(e?"&":"?")+i+"="+t))}})),o.data&&C._base_filter.c.size&&(e+=(e?"&":"?")+C._base_filter.value([])),r.location.protocol+"//"+r.location.host+r.location.pathname+e}function ie(){function i(e,i){i=i||{};const s=l.createElement("tr"),n={e:s,variable:e,component:i.component||"last",operator:i.operator||">=",value:i.value||0,active:!0,id:e+"_"+Date.now(),passed:0,failed:0,info:o.data.variables[e].info,view:C[a.dataview]},r=n.view.get.dataset(),d=n.info[r].time_range,c=o.data.meta.overall.value;let p;C._base_filter.c.set(n.id,n),i.time_component&&(n.component=String(c[n.component])),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("p")),p.id=n.id,p.className="cell-text",p.innerText=n.info[r].info.short_name,s.lastElementChild.appendChild(l.createElement("p")),n.summary={f:n,update:function(){const e=this.f.view.get.dataset(),t=this.f.info[e].time_range,i=o.data.meta.overall.value;if(e!==this.add.Dataset){this.add.Dataset=e,this.add.First=i[t[0]]||"NA",this.add.Last=i[t[1]]||"NA";const a=this.f.info[e];for(let e=this.table.firstElementChild.childElementCount;e--;){const t=this.table.firstElementChild.children[e].innerText,i=t.toLowerCase();this.table.lastElementChild.children[e].innerText=i in a?o.data.format_value(a[i]):this.add[t]}}},add:{Dataset:r,First:c[d[0]]||"NA",Last:c[d[1]]||"NA"}},n.summary.table=F(s.lastElementChild.lastElementChild,n.info[r],n.summary.add),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("p")),p.setAttribute("aria-describedby",n.id),p.className="cell-text",p.innerText="0/0",s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("label")),p.innerText="Active",p.className="filter-label",p.id=n.id+"_switch",s.lastElementChild.appendChild(p=l.createElement("div")),p.className="form-check form-switch filter-form-input",p.appendChild(p=l.createElement("input")),p.className="form-check-input",p.type="checkbox",p.role="switch",p.setAttribute("aria-labelledby",n.id+"_switch"),p.setAttribute("aria-describedby",n.id),p.checked=!0,p.addEventListener("change",function(){n.active=!n.active,pe("_base_filter")}.bind(n)),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("label")),p.innerText="Component",p.className="filter-label",p.id=n.id+"_component";const u=h.combobox.create("component",f.Time);u.default=n.component,u.set(n.component),s.lastElementChild.appendChild(u.e.parentElement),u.e.parentElement.removeChild(u.e.parentElement.lastElementChild),u.e.parentElement.classList.add("filter-form-input"),u.e.setAttribute("aria-labelledby",n.id+"_component"),u.input_element.setAttribute("aria-labelledby",n.id+"_component"),u.input_element.setAttribute("aria-describedby",n.id),u.listbox.setAttribute("aria-labelledby",n.id+"_component"),u.onchange=function(){n.component=this.value(),pe("_base_filter")}.bind(u),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("label")),p.innerText="Operator",p.className="filter-label",p.id=n.id+"_operator",s.lastElementChild.appendChild(p=l.createElement("select")),p.className="form-select filter-form-input",p.setAttribute("aria-labelledby",n.id+"_operator"),p.setAttribute("aria-describedby",n.id),p.addEventListener("change",(e=>{n.operator=e.target.selectedOptions[0].value,pe("_base_filter")})),[">=","=","!=","<="].forEach((e=>{p.appendChild(l.createElement("option")),p.lastElementChild.value=p.lastElementChild.innerText=e,e===n.operator&&(p.lastElementChild.selected=!0)})),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("label")),p.innerText="Value",p.className="filter-label",p.id=n.id+"_value";const m=h.combobox.create("component",["min","q1","median","mean","q3","max"]);m.value_type="number",m.default=n.value,m.set(n.value),s.lastElementChild.appendChild(m.e.parentElement),m.e.parentElement.removeChild(m.e.parentElement.lastElementChild),m.e.parentElement.classList.add("filter-form-input"),m.e.setAttribute("aria-labelledby",n.id+"_value"),m.input_element.setAttribute("aria-labelledby",n.id+"_value"),m.input_element.setAttribute("aria-describedby",n.id),m.listbox.setAttribute("aria-labelledby",n.id+"_value"),m.onchange=async function(e){if(e.value=this.value(),t.number.test(e.value))e.value=Number(e.value),e.value_source="";else{e.view.reparse();const t=await o.data.get_variable(e.variable,e.view.id),i=t&&t.views[e.view.id].summaries[e.view.parsed.dataset];if(i&&e.value in i){const t=e.view.parsed.variable_values.get(e.id);e.value_source=e.value,e.value=i[e.value][t.comp_fun(t,e.view.parsed)]}}pe("_base_filter")}.bind(m,n),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("label")),p.innerText="Remove",p.className="filter-label",p.id=n.id+"_remove",s.lastElementChild.appendChild(p=l.createElement("button")),p.className="btn-close filter-form-input",p.type="button",p.setAttribute("aria-labelledby",n.id+"_remove"),p.setAttribute("aria-describedby",n.id),p.addEventListener("mouseup",function(e){1===e.which&&(this.e.parentElement.removeChild(this.e),C._base_filter.c.delete(this.id),C._base_filter.c.size||_.modal.filter.variable_filters.lastElementChild.classList.add("hidden"),pe("_base_filter"))}.bind(n)),pe("_base_filter"),_.modal.filter.conditions.lastElementChild.appendChild(s),_.modal.filter.variable_filters.lastElementChild.classList.remove("hidden")}o.data.variables&&(a.variable=Object.keys(o.data.variables),a.variable=a.variable[a.variable.length-1]),o.map||(o.map={}),o.map._overlay_property_selectors||(o.map._overlay_property_selectors=[]),x._u.forEach((async i=>{if(C[i].type in h){const s=C[i],n="combobox"===s.type;if(s.optionSource)if(t.palette.test(s.optionSource))s.options=[],Object.keys(e).forEach((t=>s.options.push(s.add(t,e[t].name)))),-1===s.default&&(s.default=a.palette);else if(t.datasets.test(s.optionSource))-1===s.default&&(s.default=a.dataset),s.options=[],o.metadata.datasets.forEach((e=>s.options.push(s.add(e))));else{s.sensitive=!1,s.option_sets={},t.properties.test(s.optionSource)&&o.map._overlay_property_selectors.push(s),s.depends&&M(s.depends,{type:"options",id:s.id}),s.dataset in C&&M(s.dataset,{type:"options",id:s.id}),s.view&&M(s.view,{type:"options",id:s.id});const e=se(s.dataset)||a.dataset;s.dataset||(s.dataset=e),e in o.data.info&&c.options(s)}if(n||"select"===s.type){if(s.set_current=c.set_current.bind(s),Array.isArray(s.values)){s.values={},s.display={};let e=!0;const t="select"===s.type;s.options.forEach((i=>{t&&(i.dataset.value=i.value),e&&(e=i.dataset.value===i.innerText)})),s.options.forEach(((t,i)=>{s.values[t.dataset.value]=i,e&&(t.innerText=o.data.format_label(t.dataset.value)),s.display[t.innerText]=i})),s.default in s.values||s.default in C||(s.default=Number(s.default),isNaN(s.default)&&(s.default=-1),-1!==s.default&&s.default<s.options.length?s.default=s.options[s.default].dataset.value:s.default=-1),s.source="",s.id in o.url_options?s.set(o.url_options[s.id]):s.reset()}s.subset=s.e.getAttribute("data-subset")||"all",s.selection_subset=s.e.getAttribute("data-selectionSubset")||s.subset,s.type in o&&s.id in o[s.type]&&(s.settings=o[s.type][s.id],s.settings.filters&&(s.filters=s.settings.filters,s.current_filter={},Object.keys(s.filters).forEach((e=>{M(s.filters[e],{type:"filter",id:s.id})})),s.filter=function(){let e;Object.keys(this.filters).forEach((e=>{this.current_filter[e]=se(this.filters[e])})),Object.keys(this.values).forEach(((t,i)=>{let a=!1;if(t in o.data.variables&&"meta"in o.data.variables[t])for(const e in this.current_filter)if(e in o.data.variables[t].meta&&(a=o.data.variables[t].meta[e]===this.current_filter[e],!a))break;a&&!e&&(e=t),this.options[i].classList[a?"remove":"add"]("hidden")})),this.current_index=this.values[this.value()],e&&(-1===this.current_index||this.options[this.current_index].classList.contains("hidden"))&&this.set(e)}.bind(s)))}else if("number"===s.type){if(s.min=s.e.getAttribute("min"),s.min_ref=parseFloat(s.min),s.min_indicator=s.e.parentElement.parentElement.querySelector(".indicator-min"),s.min_indicator&&s.min_indicator.addEventListener("click",function(){this.set(this.parsed.min)}.bind(s)),s.max=s.e.getAttribute("max"),s.max_ref=parseFloat(s.max),s.max_indicator=s.e.parentElement.parentElement.querySelector(".indicator-max"),s.max_indicator&&s.max_indicator.addEventListener("click",function(){this.set(this.parsed.max)}.bind(s)),s.ref=isNaN(s.min_ref)||isNaN(s.max_ref),s.range=[s.min_ref,s.max_ref],s.step=parseFloat(s.e.step)||1,s.parsed={min:void 0,max:void 0},s.depends={},s.default_max="max"===s.default||"last"===s.default,s.default_min="min"===s.default||"first"===s.default,s.update=async function(){const e=C[this.view],i=se(this.variable||e.y);e.time_range||(e.time_range={time:[]});let a=e.get?e.get.dataset():se(this.dataset),s=se(this.min)||e.time,n=se(this.max)||e.time;t.minmax.test(s)&&(s=C[this.min][s]),t.minmax.test(n)&&(n=C[this.max][n]),this.parsed.min=isNaN(this.min_ref)?void 0===s?e.time_range.time[0]:"number"==typeof s?s:s in o.data.variables?o.data.variables[s].info[a||o.data.variables[s].datasets[0]].min:parseFloat(s):this.min_ref,this.parsed.max=isNaN(this.max_ref)?void 0===n?e.time_range.time[1]:"number"==typeof n?n:n in o.data.variables?o.data.variables[n].info[a||o.data.variables[n].datasets[0]].max:parseFloat(n):this.min_ref,this.default_min?this.current_default=this.parsed.min:this.default_max&&(this.current_default=this.parsed.max),this.ref&&i in o.data.variables?(this.range[0]=this.e.min=isNaN(this.min_ref)?Math.max(e.time_range.time[0],this.parsed.min):this.min_ref,this.range[1]=this.e.max=isNaN(this.max_ref)?Math.min(e.time_range.time[1],this.parsed.max):this.max_ref,this.depends[e.y]||(this.depends[e.y]=!0,M(e.y,{type:"update",id:this.id})),(this.source>this.parsed.max||this.source<this.parsed.min)&&this.reset(),this.variable=await o.data.get_variable(i,this.view)):(this.e.min=this.parsed.min,(this.parsed.min>this.source||!this.source&&this.default_min)&&this.set(this.parsed.min),this.e.max=this.parsed.max,(this.parsed.max<this.source||!this.source&&this.default_max)&&this.set(this.parsed.max))}.bind(s),s.view&&M(s.view,{type:"update",id:s.id}),s.max in o.data.variables?s.view&&M(s.view+"_time",{type:"max",id:s.id}):s.max in C?M(s.max,{type:"max",id:s.id}):s.e.max=parseFloat(s.max),s.min in o.data.variables?s.view&&M(s.view+"_time",{type:"min",id:s.id}):s.min in C?M(s.min,{type:"min",id:s.id}):s.e.min=parseFloat(s.min),void 0!==s.default&&(t.number.test(s.default)?s.default=Number(s.default):s.reset=s.default_max?function(){this.range&&(this.current_default=se(this.range[1]),this.set(this.current_default))}.bind(s):s.default_max?function(){this.range&&(this.current_default=se(this.range[0]),this.set(this.current_default))}.bind(s):this.default in C?function(){this.current_default=se(this.default),this.set(this.current_default)}.bind(s):function(){}),s.variable){const e=-1===o.metadata.datasets.indexOf(s.dataset)?a.dataset:s.dataset;s.variable in C?M(s.variable,{type:"update",id:s.id}):s.variable in o.data.variables&&(s.e.min=s.min=s.parsed.min=s.range[0]=o.data.variables[s.variable].info[e].min,s.e.max=s.max=s.parsed.max=s.range[1]=o.data.variables[s.variable].info[e].max)}}else"checkbox"===s.type&&(s.source=[],s.current_index=[],s.default=s.default.split(","));Array.isArray(s.values)&&(s.values.length||(s.values=[],s.options.length&&s.options.forEach((e=>s.values.push(e.value||e.dataset.value)))),s.values.length&&!(s.default in C)&&-1===s.values.indexOf(s.default)&&(s.default=parseInt(s.default),s.default=s.values.length>s.default?s.values[s.default]:"")),n||"select"===s.type||"number"===s.type||"intext"===s.type?(s.e.addEventListener("change",s.listen),s.e.parentElement.lastElementChild&&s.e.parentElement.lastElementChild.classList.contains("select-reset")&&s.e.parentElement.lastElementChild.addEventListener("click",s.reset)):"switch"===s.type?("boolean"!=typeof s.default&&(s.default=s.e.checked),s.e.addEventListener("change",s.listen)):s.listen&&s.options.forEach((e=>e.addEventListener("click",s.listen))),t.settings.test(s.id)&&(s.setting=s.id.replace(t.settings,""),null==s.default&&s.setting in o.settings&&(s.default=o.settings[s.setting]),M(s.id,{type:"setting",id:s.id})),s.view||(s.view=a.dataview);const r=o.url_options[s.id]||u.get(s.id.replace(t.settings,""));r?s.set(t.bool.test(r)?!!r||"true"===r:r):s.reset&&s.reset()}})),Object.keys(o.dataviews).forEach((e=>{const t=o.dataviews[e];C[e]=t,t.id=e,t.value=function(){if(this.get)return this.reparse(),""+this.parsed.dataset+C._entity_filter.entities.size+o.data.inited[this.parsed.dataset]+this.parsed.id_source+Object.keys(this.parsed.ids)+this.parsed.features+this.parsed.variables+o.settings.summary_selection}.bind(t),"string"==typeof t.palette&&t.palette in C&&M(t.palette,{type:"dataview",id:e}),"string"==typeof t.dataset&&t.dataset in C&&M(t.dataset,{type:"dataview",id:e}),"string"==typeof t.ids&&t.ids in C&&M(t.ids,{type:"dataview",id:e}),t.time_range={dataset:"",variable:"",index:[],time:[],filtered:[]},M(e,{type:"time_range",id:e}),M("_base_filter",{type:"dataview",id:e}),M("_entity_filter",{type:"dataview",id:e}),t.x in C&&M(t.x,{type:"time_range",id:e}),t.y in C&&M(t.y,{type:"time_range",id:e}),t.features&&Object.keys(t.features).forEach((i=>{"string"==typeof t.features[i]&&t.features[i]in C&&M(t.features[i],{type:"dataview",id:e})})),t.variables&&t.variables.forEach((i=>{"variable"in i?i.variable in C&&M(i.variable,{type:"dataview",id:e}):t.variables.splice(J,1),"type"in i?i.type in C&&M(i.type,{type:"dataview",id:e}):i.type="=","value"in i?i.value in C&&M(i.value,{type:"dataview",id:e}):i.value=0})),function(e){e.times=[],e.time_filters&&(e.time_filters=[{variable:a.time,type:">=",value:"filter.time_min"},{variable:a.time,type:"<=",value:"filter.time_max"}],M(e.id+"_time",{type:"min",id:"filter.time_min"}),M(e.id+"_time",{type:"max",id:"filter.time_max"}),e.time_filters.forEach((t=>{t.value in C&&M(t.value,{type:"time_filters",id:e.id})})));e.selection={ids:{},features:{},variables:[],dataset:{},filtered:{},full_filter:{},all:{}},e.n_selected={ids:0,features:0,variables:0,dataset:0,filtered:0,full_filter:0,all:0},e.get={dataset:function(){let t=a.dataset;return"string"==typeof e.dataset&&e.dataset in C?(t=se(C[e.dataset].value()),t in o.data.data_queue||(t=a.dataset,C[e.dataset].set(t))):t=se(e.dataset),t in o.data.data_queue?t:a.dataset},ids:function(t){const i=se("string"==typeof e.ids&&e.ids in C?C[e.ids].value():e.ids);if(""!==i&&-1!=i){if(t)return i;const e={},a=o.data.entities[i];return e[i]=!0,a&&a.relations&&Object.keys(a.relations.children).forEach((t=>e[t]=!0)),e}return!(t||!C._entity_filter.selected.length)&&C._entity_filter.select_ids},features:function(){let t="";return e.features&&Object.keys(e.features).forEach((i=>{t+=i+se(e.features[i])})),t},variables:function(){if(e.variables||C._base_filter.c.size){e.parsed.variable_values.size||e.reparse();let t="";return e.parsed.variable_values.forEach((e=>{e.filter.summary.update(),t+=e.name+e.operator+e.component+e.value+e.active})),t}return""},time_filters:function(){let t="";return e.time_filters&&e.time_filters.forEach((e=>{t+=e.value in C?se(e.value):e.value})),t}},e.ids_check=function(e,t){return!e||t in e},e.parsed={dataset:"",ids:"",features:"",variables:"",time_filters:"",time_agg:0,id_source:"",variable_values:new Map,feature_values:{}},e.reparse=function(){if(this.parsed.dataset=this.get.dataset(),this.parsed.ids=this.get.ids(),this.parsed.time_filters=this.get.time_filters(),this.parsed.time_agg=this.parsed.dataset in o.data.meta.times?se(this.time_agg)-o.data.meta.times[this.parsed.dataset].range[0]:0,"string"==typeof this.ids&&this.ids in C&&("virtual"===C[this.ids].type&&C[this.ids].source in C||"depends"in C[this.ids]&&C[this.ids].depends in C)&&(this.parsed.id_source="virtual"===C[this.ids].type?se(C[C[this.ids].source].dataset):C[C[this.ids].depends].value()),this.features){this.parsed.feature_values={};for(let e in this.features)e in this.features&&(this.parsed.feature_values[e]={value:se(this.features[e])},this.parsed.feature_values[e].operator="string"==typeof this.parsed.feature_values[e].value?"equals":"includes");this.parsed.features=this.get.features()}else this.parsed.features="";this.parsed.variable_values.clear(),C._base_filter.c.size&&C._base_filter.c.forEach((e=>{this.parsed.variable_values.set(e.id,{filter:e,name:e.variable,range:o.data.variables[e.variable].info[this.parsed.dataset].time_range,operator:e.operator,value:e.value?Number(e.value):NaN,value_type:"number",component:e.component,active:e.active,comp_fun:de(e.component)})})),this.variables||this.parsed.variable_values.size?(this.variables&&this.variables.forEach((e=>{const t=se(e.value);this.parsed.variable_values.set(this.parsed.variable_values.size,{name:e.variable,operator:e.operator,value:t,component:e.component,active:!0,comp_fun:de(e.component)})})),this.parsed.variables=this.get.variables()):this.parsed.variables=""}.bind(e),e.checks={dataset:function(e){return this.parsed.dataset===e.group}.bind(e),ids:function(e){return e.features&&this.ids_check(this.parsed.ids,e.features.id)}.bind(e),features:function(e){if(e.features){let t,i,a=!0;for(t in this.parsed.feature_values)if(t in this.parsed.feature_values&&(i=this.parsed.feature_values[t],a=DataHandler.checks[i.operator](i.value,se(e.features[t])),!a))break;return a}return!0}.bind(e),variables:function(e){if(e.data){let t=!0;return this.parsed.variable_values.forEach((i=>{if(i.active&&!isNaN(i.value)){const a=e.get_value(i.name,i.comp_fun(i,this.parsed)),s=!isNaN(a)&&DataHandler.checks[i.operator](a,i.value);i.filter[s?"passed":"failed"]++,t&&!s&&(t=!1)}else i.filter.failed++})),t}return!0}.bind(e)},e.check=function(e){return{ids:!this.ids||this.checks.ids(e),features:!this.features||this.checks.features(e),variables:!this.variables&&!C._base_filter.c.size||this.checks.variables(e),dataset:!this.dataset||this.checks.dataset(e)}}.bind(e)}(t),c.dataview(t),t.reparse()})),l.querySelectorAll(".auto-output").forEach(h.init_output),U=_.modal.filter,U.body.className="filter-dialog",U.body.appendChild(U.entity_filters=l.createElement("div")),U.entity_filters.appendChild(l.createElement("p")),U.entity_filters.lastElementChild.className="h6",U.entity_filters.lastElementChild.innerText="Select Entities",U.entity_filters.lastElementChild.appendChild(l.createElement("span")),U.entity_filters.lastElementChild.lastElementChild.className="note",U.entity_filters.lastElementChild.lastElementChild.innerText="(click disabled selectors to load)",U.entity_filters.appendChild(l.createElement("div")),U.entity_filters.lastElementChild.className="row",U.entity_inputs={},Object.keys(o.data.loaded).reverse().forEach((e=>{const t=h.combobox.create(e,void 0,{search:!0,multi:!0,clearable:!0},"filter."+e);U.entity_inputs[e]=t,U.entity_filters.lastElementChild.appendChild(l.createElement("div")),U.entity_filters.lastElementChild.lastElementChild.className="col-sm",U.entity_filters.lastElementChild.lastElementChild.appendChild(t.e.parentElement),t.e.parentElement.classList.add("form-floating"),t.listbox.classList.add("multi"),t.option_sets={},t.dataset=e,t.loader=function(){o.data.retrieve(this.dataset,o.data.info[this.dataset].site_file),this.e.removeEventListener("click",this.loader)}.bind(t),o.data.loaded[e]||t.e.addEventListener("click",t.loader),t.onchange=function(){c.id_filter(),pe("_entity_filter")}.bind(t),t.set_current=c.set_current.bind(t),A(t,e,t.option_sets,function(){this.set_current(),S(this,!!this.options.length),Object.keys(this.values).forEach((e=>{C._entity_filter.entities.set(e,o.data.entities[e])})),C._entity_filter.registered[e]=!0,this.set(this.id in o.url_options?o.url_options[this.id].split(","):-1)}.bind(t)),S(t,!!t.options.length)})),U.body.appendChild(U.variable_filters=l.createElement("div")),U.variable_filters.appendChild(l.createElement("p")),U.variable_filters.lastElementChild.className="h6",U.variable_filters.lastElementChild.innerText="Variable Conditions",U.variable_filters.appendChild(Q=l.createElement("div")),Q.className="row",Q.appendChild(l.createElement("div")),Q.lastElementChild.className="col",Q.lastElementChild.appendChild(X=l.createElement("div"));const s=h.combobox.create("Add Variable Condition",void 0,{strict:!0,search:!0,clearable:!0,floating:!0,accordion:!0,group:"category"},"filter_variable_dropdown");s.input=!1,s.settings.filter_table=l.querySelector(".filter-body"),s.onchange=function(){const e=this.value();if(e in o.data.variables){i(e),this.selection.innerText="";const t=l.querySelectorAll(".filter-body .combobox-input");t&&t.length&&t[t.length-1].focus()}}.bind(s),s.view=a.dataview,s.option_sets={},s.optionSource="variables",M(a.dataview,{type:"options",id:s.id}),X.appendChild(s.e.parentElement),U.variable_filters.appendChild(Q=l.createElement("div")),Q.className="hidden",Q.appendChild(U.conditions=Q=l.createElement("table")),Q.className="table",Q.appendChild(Q=l.createElement("thead")),Q.className="filter-header",U.conditions.appendChild(l.createElement("tbody")),U.conditions.lastElementChild.className="filter-body",Q.appendChild(Q=l.createElement("tr")),["Variable","Result","Active","Component","Operator","Value","Remove"].forEach((e=>{if(Q.appendChild(l.createElement("th")),"Component"===e||"Result"===e){const t="Component"===e?{wrapper:l.createElement("label"),id:"filter_component_header",note:"Component refers to which single value to filter on for each entity; select a dynamic time reference, or enter a time."}:{wrapper:l.createElement("label"),id:"filter_result_header",note:"Passing / total entities across loaded datasets."};Q.lastElementChild.appendChild(t.wrapper),Q.lastElementChild.className="has-note",t.wrapper.innerText=e,t.wrapper.id=t.id,t.wrapper.setAttribute("data-of",t.id),t.wrapper.setAttribute("aria-description",t.note),Q.lastElementChild.addEventListener("mouseover",ne.bind(t))}else Q.lastElementChild.innerText=e})),U.variable_filters.lastElementChild.appendChild(Q=l.createElement("p")),Q.className="note",Q.innerText="Summaries are across time within each unfiltered dataset.",x._u=Object.keys(C),o.query&&(o.parsed_query=o.data.parse_query(o.query),o.parsed_query.variables.conditions.length&&o.parsed_query.variables.conditions.forEach((e=>{o.data.variable_info[e.name]&&i(e.name,e)})))}function ae(){o.settings.tracking&&r.dataLayer.push(arguments)}function se(e){return e in C&&(e=C[e]),e&&e.value&&(e=se(e.value())),e}function ne(){if(o.settings.hide_tooltips||this.id===_.tooltip.showing)return;_.tooltip.showing=this.id,_.tooltip.e.firstElementChild.innerText=this.note,_.tooltip.e.classList.remove("hidden");const e=this.wrapper.getBoundingClientRect(),t=_.tooltip.e.getBoundingClientRect();_.tooltip.e.style.left=Math.max(0,Math.min(e.x,e.x+e.width/2-t.width/2))+"px",_.tooltip.e.style.top=e.y+(e.y<t.height?e.height+5:-t.height-5)+"px"}function re(e){!_.tooltip.showing||"blur"!==e.type&&_.tooltip.showing===(e.target.getAttribute("data-of")||e.target.id)||(_.tooltip.showing="",_.tooltip.e.classList.add("hidden"))}async function le(e,i,a){const s=i.name?i.name+(i.time||""):i.url;if(i.url in o.map._raw)!function(e,i){let a,s;const n="time"in e,r=e.name+(n?e.time:"");if(o.map[i.id]._layers[r]=L.geoJSON(JSON.parse(o.map._raw[e.url]),{onEachFeature:(r,l)=>{l.on({mouseover:h.map.mouseover.bind(i),mouseout:h.map.mouseout.bind(i),click:h.map.click.bind(i)}),l.setStyle({weight:0,fillOpacity:0}),l.source=e,a=l.feature.properties,s=a[e.id_property],!(s in o.data.entities)&&t.leading_zeros.test(s)&&(s=a[e.id_property]=s.replace(t.leading_zeros,"")),s in o.data.entities?"layer"in o.data.entities[s]||(o.data.entities[s].layer={}):o.data.entities[s]={layer:{},features:{id:s}},n?(i.id in o.data.entities[s].layer||(o.data.entities[s].layer[i.id]={has_time:!0}),o.data.entities[s].layer[i.id][e.time]=l):o.data.entities[s].layer[i.id]=l,l.entity=o.data.entities[s],o.data.entities[s].features&&Object.keys(a).forEach((e=>{e in o.data.entities[s].features||("name"!==e.toLowerCase()||"name"in o.data.entities[s].features&&o.data.entities[s].features.id!==o.data.entities[s].features.name?o.data.entities[s].features[e]=a[e]:o.data.entities[s].features[e.toLowerCase()]=a[e])}))}}),o.data.inited[r+i.id]=!0,o.map._waiting&&o.map._waiting[e.name])for(let t=o.map._waiting[e.name].length;t--;)pe(o.map._waiting[e.name][t])}(i,e),o.map._queue[s].retrieved=!0,a&&a();else if(o.map._queue[s]&&"retrieved"in o.map._queue[s])a&&(o.map._queue[s].callbacks||(o.map._queue[s].callbacks=[]),o.map._queue[s].callbacks.push(a));else{o.map._queue[s].retrieved=!1;const e=new r.XMLHttpRequest;e.onreadystatechange=()=>{4===e.readyState&&200===e.status&&(o.map._raw[i.url]=e.responseText,i.name&&(o.map._queue[s].retrieved=!0),o.map._queue[s].callbacks?(a&&o.map._queue[s].callbacks.push(a),o.map._queue[s].callbacks.forEach((e=>e()))):a&&a())},e.open("GET",i.url,!0),e.send()}}function oe(e,t,i){let a=0,s="string"==typeof t.source?t.source:"";if(!s&&t.source)for(a=t.source.length;a--;)if(!t.source[a].time||i===t.source[a].time){t.source[a].name&&delete t.source[a].name,s=t.source[a].url;break}if(s){if(!(s in o.map._raw))return le(e,t.source[a],oe.bind(null,e,t,i));{if(!(s in o.map[e.id]._layers)){const t={};o.map._queue[s].processed||(o.map._queue[s].property_summaries=t),o.map[e.id]._layers[s]=L.geoJSON(JSON.parse(o.map._raw[s]),{pointToLayer:(e,t)=>L.circleMarker(t),onEachFeature:e=>{const i=e.properties;i&&Object.keys(i).forEach((e=>{const a=i[e];"number"==typeof a&&(e in t||(t[e]=[1/0,-1/0]),a<t[e][0]&&(t[e][0]=a),a>t[e][1]&&(t[e][1]=a))}))}}).on("mouseover",(e=>{const t=e.layer;if(t&&!t._tooltip){const e=t.feature&&t.feature.properties;if(e){const i=l.createElement("table");Object.keys(e).forEach((t=>{const a=e[t],s=l.createElement("tr");s.appendChild(l.createElement("td")),s.appendChild(l.createElement("td")),s.firstElementChild.innerText=t,s.lastElementChild.innerText=a,i.appendChild(s)})),t.bindTooltip(i),t.openTooltip()}}})),Object.keys(t).forEach((e=>{t[e].push(t[e][1]-t[e][0]),t[e][2]||delete t[e]})),o.map._overlay_property_selectors.forEach((e=>{s in e.option_sets||(!function(e,t,i){i[t]={options:[],values:{},display:{}};const a=e.values,s=i[t].options,n=i[t].values,r=i[t].display;e.type;let l=!e.sensitive&&!!e.current_set,d=0;e.settings.group&&(e.groups={e:[],by_name:{}}),Object.keys(o.map._queue[t].property_summaries).forEach((t=>{const i=o.data.format_label(t);l&&!(V in a)&&(e.sensitive=!0,l=!1),s.push(e.add(t,i)),s[d].id=e.id+"-option"+d,n[t]=d,r[i]=d++}))}(e,s,e.option_sets),e.dataset=s,e.variable="")}))}o.map._overlay_property_selectors.forEach((e=>{e.dataset=s,c.options(e)})),e.overlay.clearLayers();let i=0;const a=o.settings.circle_property&&o.map._queue[s].property_summaries,n=a&&a[o.settings.circle_property];o.map[e.id]._layers[s].eachLayer((a=>{if(t.filter)for(let e=t.filter.length;e--;)if(!t.filter[e].check(a.feature.properties[t.filter[e].feature],t.filter[e].value))return;i++,a.setRadius(n?((a.feature.properties[o.settings.circle_property]-n[0])/n[2]+.5)*o.settings.circle_radius:o.settings.circle_radius).setStyle({weight:o.settings.polygon_outline,color:"white",opacity:.5,fillOpacity:.5,fillColor:"black"}),a.addTo(e.overlay)})),i&&e.overlay_control.addTo(e.map)}}}function de(e){return"string"==typeof e&&t.number.test(e)&&-1===(e=o.data.meta.overall.value.indexOf(Number(e)))?function(){return NaN}:"number"==typeof e?b.number.bind(e):e in b?b[e]:function(){return NaN}}function ce(){v.retain_state=!1,x._u.forEach(pe)}function he(){v.retain_state=!1,x._u.forEach((e=>{!C[e].setting&&C[e].reset&&(C[e].reset(),pe(e))}))}function pe(e){g[e]=!0,g._timeout>0&&clearTimeout(g._timeout),g._timeout=setTimeout(ue,20),v.lock_after=e}function ue(){g._timeout>0&&clearTimeout(g._timeout),g._timeout=-1,x._u.forEach((e=>{if(g[e]){const t=function(e){if(e in w){const t=C[e],i=w[e],a=[],s=t&&t.value()+"";if(t&&(!v.retain_state||t.state!==s)){const n=o.dataviews[t.view],r=t.dataset?se(t.dataset):n?n.get.dataset():s;if(o.data.info&&r in o.data.loaded&&!o.data.loaded[r])return t.deferred||o.data.retrieve(r,o.data.info[r].site_file),r;t.state=s,i.forEach((e=>{"rule"===e.type?-1===a.indexOf(e.rule)&&a.push(e.rule):"function"==typeof C[e.id][e.type]?C[e.id][e.type]():c[e.type](C[e.id],t)})),a.forEach((e=>{let t=!1;const i=o.rules[e],a=i.condition.length;for(let e=0;e<a;e++){const a=i.condition[e];if(t=a.check(),a.any?t:!t)break}Object.keys(i.effects).forEach((e=>{const a=i.effects[e];t?"display"===e?a.e.classList.remove("hidden"):"lock"===e?a.forEach((e=>{e.e.classList.remove("locked"),S(e,!0)})):e in C&&C[e].set(se(a)):"display"===e?a.e.classList.contains("hidden")||(a.e.classList.add("hidden"),a.u&&a.u.reset&&a.u.reset(),a.e.querySelectorAll(".auto-input").forEach((e=>{e.id in C&&C[e.id].reset&&C[e.id].reset()}))):"lock"===e?a.forEach((e=>{e.e.classList.add("locked"),S(e)})):"default"in i&&e in C&&C[e].set(se(i.default))}))})),e===v.lock_after&&(v.retain_state=!0)}}}(e);if(t)return e in o.data.data_queue[t]||(o.data.data_queue[t][e]=ue),!1;g[e]=!1}}));let e=te();o.data.inited.first&&e!==o.state&&(o.state=e,Object.keys(o.url_options).forEach((i=>{t.embed_setting.test(i)&&(e+="&"+i+"="+("navcolor"===i?o.url_options[i].replace(t.hashes,"%23"):o.url_options[i]))})),o.settings.hide_url_parameters||r.history.replaceState(Date.now(),"",e),setTimeout(Z,50))}Object.keys(e).forEach((t=>{const i=e[t];if("continuous-polynomial"===i.type){const e=i.colors;i.type="discrete",i.colors=[];for(let t=0;t<255;t++){const a=t/255;i.colors.push("rgb("+Y(0,a,e)+", "+Y(1,a,e)+", "+Y(2,a,e)+")")}}i.odd=i.colors.length%2})),r.onload=function(){if(_.navbar=l.querySelector(".navbar"),_.navbar=_.navbar?_.navbar.getBoundingClientRect():{height:0},_.content=l.querySelector(".content"),_.menus=l.querySelectorAll(".menu-wrapper"),_.panels=l.querySelectorAll(".panel"),_.content_bounds={top:_.navbar.height,right:0,bottom:0,left:0,outer_right:0},_.script_style=l.head.appendChild(l.createElement("style")),o.settings.hide_tooltips&&_.script_style.sheet.insertRule(d,0),_.menu_toggler={hide:function(){_.menu_toggler.timeout=-1,this.classList.add("hidden"),Z()},toggle:function(e){if(_.menu_toggler.timeout>0&&clearTimeout(_.menu_toggler.timeout),_.menu_toggler.timeout=-1,"closed"===this.parentElement.state)this.parentElement.state="open",this.parentElement.firstElementChild.classList.remove("hidden"),this.parentElement.style[e]="0px",_.content.style[e]=this.parentElement.getBoundingClientRect()["left"===e||"right"===e?"width":"height"]+"px","top"!==e&&"bottom"!==e||(this.style[e]=_.content_bounds[e]+"px"),setTimeout(ee,300);else{if(this.parentElement.state="closed","left"===e||"right"===e)this.parentElement.style[e]=-this.parentElement.getBoundingClientRect().width+"px",_.content.style[e]=_.content_bounds[e]+"px";else{const t=this.parentElement.getBoundingClientRect();_.content.style[e]=_.content_bounds[e]+("top"===e?40:0)+"px",this.parentElement.style[e]=-t.height+("top"===e?_.content_bounds.top:0)+"px","top"!==e&&"bottom"!==e||(this.style[e]=t.height+"px")}_.menu_toggler.timeout=setTimeout(_.menu_toggler.hide.bind(this.parentElement.firstElementChild),300)}},timeout:-1},_.modal={info:{init:!1,e:l.createElement("div")},filter:{init:!1,e:l.createElement("div")}},_.load_screen=l.getElementById("load_screen"),o.settings.tracking&&o.tag_id&&(ae("js",new Date),ae("config",o.tag_id)),U=_.modal.info.e,l.body.appendChild(U),_.modal.info.init=!0,U.id="variable_info_display",U.className="modal fade",U.setAttribute("tabindex","-1"),U.setAttribute("aria-labelledby","variable_info_title"),U.ariaHidden="true",U.appendChild(l.createElement("div")),U.firstElementChild.className="modal-dialog modal-dialog-scrollable",U.firstElementChild.appendChild(l.createElement("div")),U.firstElementChild.firstElementChild.className="modal-content",U.firstElementChild.firstElementChild.appendChild(_.modal.info.header=l.createElement("div")),U=_.modal.info,U.header.className="modal-header",U.header.appendChild(l.createElement("p")),U.header.firstElementChild.className="h5 modal-title",U.header.firstElementChild.id="variable_info_title",U.header.appendChild(l.createElement("button")),U.header.lastElementChild.type="button",U.header.lastElementChild.className="btn-close",U.header.lastElementChild.setAttribute("data-bs-dismiss","modal"),U.header.lastElementChild.title="close",U.header.insertAdjacentElement("afterEnd",U.body=l.createElement("div")),U.body.className="modal-body",U.body.appendChild(U.title=l.createElement("p")),U.title.className="h4",U.body.appendChild(U.description=l.createElement("p")),U.body.appendChild(l.createElement("table")),U.body.lastElementChild.className="info-feature-table",U.body.lastElementChild.appendChild(U.name=l.createElement("tr")),U.name.appendChild(l.createElement("th")),U.name.firstElementChild.innerText="Name",U.name.appendChild(l.createElement("td")),U.body.lastElementChild.appendChild(U.type=l.createElement("tr")),U.type.appendChild(l.createElement("th")),U.type.firstElementChild.innerText="Type",U.type.appendChild(l.createElement("td")),U.body.appendChild(U.sources=l.createElement("div")),U.sources.appendChild(l.createElement("p")),U.sources.lastElementChild.innerText="Sources",U.sources.lastElementChild.className="h3",U.sources.appendChild(l.createElement("div")),U.sources.lastElementChild.className="sources-cards",U=_.modal.info,U.body.appendChild(U.references=l.createElement("div")),U.references.appendChild(l.createElement("p")),U.references.firstElementChild.className="h3",U.references.firstElementChild.innerText="References",U.references.appendChild(U=l.createElement("ul")),U.className="reference-list",U=_.modal.info,U.body.appendChild(U.origin=l.createElement("div")),U.origin.appendChild(l.createElement("p")),U.origin.firstElementChild.className="h3",U.origin.firstElementChild.innerText="Origin",U.origin.appendChild(U=l.createElement("ul")),U.className="origin-list",l.body.appendChild(U=_.modal.filter.e),_.modal.filter.init=!0,U.id="filter_display",U.className="modal fade",U.setAttribute("aria-labelledby","filter_title"),U.ariaHidden="true",U.appendChild(l.createElement("div")),U.firstElementChild.className="modal-dialog",U.firstElementChild.appendChild(l.createElement("div")),U.firstElementChild.firstElementChild.className="modal-content",U.firstElementChild.firstElementChild.appendChild(_.modal.filter.header=l.createElement("div")),U=_.modal.filter,U.header.className="modal-header",U.header.appendChild(l.createElement("p")),U.header.firstElementChild.className="h5 modal-title",U.header.firstElementChild.id="filter_title",U.header.firstElementChild.innerText="Filter",U.header.appendChild(l.createElement("button")),U.header.lastElementChild.type="button",U.header.lastElementChild.className="btn-close",U.header.lastElementChild.setAttribute("data-bs-dismiss","modal"),U.header.lastElementChild.title="close",U.header.insertAdjacentElement("afterEnd",U.body=l.createElement("div")),U.body.className="modal-body",U.body.appendChild(l.createElement("p")),U.body.lastElementChild.className="h6",U.body.lastElementChild.innerText="Time Range",U.body.appendChild(U.time_range=l.createElement("div")),U.time_range.className="row",U.time_range.appendChild(l.createElement("div")),U.time_range.lastElementChild.className="col",U.time_range.lastElementChild.appendChild(Q=l.createElement("div")),Q.className="form-floating text-wrapper wrapper",Q.appendChild(l.createElement("input")),Q.lastElementChild.className="form-control auto-input",Q.lastElementChild.setAttribute("data-autoType","number"),Q.lastElementChild.setAttribute("data-default","min"),Q.lastElementChild.max="filter.time_max",Q.lastElementChild.type="number",Q.lastElementChild.autoType="number",Q.lastElementChild.id="filter.time_min",Q.appendChild(l.createElement("label")),Q.lastElementChild.innerText="First Time",Q.lastElementChild.setAttribute("for","filter.time_min"),U.time_range.appendChild(l.createElement("div")),U.time_range.lastElementChild.className="col",U.time_range.lastElementChild.appendChild(Q=l.createElement("div")),Q.className="form-floating text-wrapper wrapper",Q.appendChild(l.createElement("input")),Q.lastElementChild.className="form-control auto-input",Q.lastElementChild.setAttribute("data-autoType","number"),Q.lastElementChild.setAttribute("data-default","max"),Q.lastElementChild.min="filter.time_min",Q.lastElementChild.type="number",Q.lastElementChild.autoType="number",Q.lastElementChild.id="filter.time_max",Q.appendChild(l.createElement("label")),Q.lastElementChild.innerText="Last Time",Q.lastElementChild.setAttribute("for","filter.time_max"),_.panels.length&&_.panels.forEach((e=>{const t=e.classList.contains("panel-left")?"left":"right";_.content_bounds[t]=e.getBoundingClientRect().width,e.style.marginTop=_.content_bounds.top+"px",e.lastElementChild.addEventListener("click",function(){const i=e.getBoundingClientRect().width,a=e.lastElementChild.getBoundingClientRect().width;"true"===e.lastElementChild.getAttribute("aria-expanded")?(_.content_bounds[t]=a,_.top_menu&&(_.top_menu.style[t]=a+"px"),_.bottom_menu&&(_.bottom_menu.style[t]=a+"px"),e.style[t]=-i+a+"px",e.lastElementChild.setAttribute("aria-expanded","false")):(_.content_bounds[t]=i,_.top_menu&&(_.top_menu.style[t]=i+"px"),_.bottom_menu&&(_.bottom_menu.style[t]=i+"px"),e.style[t]="0px",e.lastElementChild.setAttribute("aria-expanded","true")),Z(),setTimeout(ee,200)}.bind(e))})),_.menus.length&&_.menus.forEach((e=>{const t="BUTTON"===e.lastElementChild.tagName;e.state=e.getAttribute("data-state"),e.classList.contains("menu-top")?(_.top_menu=e,_.top_menu.style.left=_.content_bounds.left+"px",_.top_menu.style.right=_.content_bounds.right+"px",t&&(e.lastElementChild.addEventListener("click",_.menu_toggler.toggle.bind(e.lastElementChild,"top")),e.lastElementChild.style.top=_.content_bounds.top+"px")):e.classList.contains("menu-right")?(_.right_menu=e,_.right_menu.style.right=_.content_bounds.right+"px",t&&(e.lastElementChild.addEventListener("click",_.menu_toggler.toggle.bind(e.lastElementChild,"right")),e.lastElementChild.style.top=_.content_bounds.top+"px")):e.classList.contains("menu-bottom")?(_.bottom_menu=e,_.content_bounds.bottom=40,_.bottom_menu.style.left=_.content_bounds.left+"px",_.bottom_menu.style.right=_.content_bounds.right+"px",t&&e.lastElementChild.addEventListener("click",_.menu_toggler.toggle.bind(e.lastElementChild,"bottom"))):e.classList.contains("menu-left")&&(_.left_menu=e,_.left_menu.style.left=_.content_bounds.left+"px",t&&(e.lastElementChild.addEventListener("click",_.menu_toggler.toggle.bind(e.lastElementChild,"left")),e.lastElementChild.style.top=_.content_bounds.top+"px")),o.url_options.close_menus&&"open"===e.state&&e.lastElementChild.click()})),_.tooltip={e:l.createElement("div"),showing:""},_.tooltip.e.className="tooltip hidden",_.tooltip.e.appendChild(l.createElement("p")),l.body.appendChild(_.tooltip.e),l.body.addEventListener("mouseover",re),o.tutorials&&(_.tutorials=new n(o.tutorials,C,he),_.overlay.appendChild(_.tutorials.container)),o.dataviews){for(const e in o.dataviews)if(e in o.dataviews){a.dataview=e;break}}else o.dataviews={},o.dataviews[a.dataview]={};if(l.querySelectorAll(".auto-input").forEach(h.init_input),o.variables&&o.variables.length&&o.variables.forEach((e=>{const t=e.id,i={id:t,type:"virtual",source:e.default,previous:void 0,default:e.default,display:e.display,current_index:-1,values:[],states:e.states,update:function(){this.source=void 0;for(let e,t=this.states.length;t--;){e=!0;for(let i=this.states[t].condition.length;i--;){const a=this.states[t].condition[i];if(DataHandler.checks[a.type](se(a.id),se(a.value))){if(a.any){e=!0;break}}else e=!1}if(e){this.source=this.states[t].value;break}}if(this.source||(this.source=this.default),this.source!==this.previous)this.previous=this.source,pe(this.id);else if(this.source in C){const e=C[this.source].value();e!==this.previous&&(this.previous=e,pe(this.id))}},value:function(){return se(this.source)},set:function(e){if(-1!==this.values.indexOf(e))this.previous=this.source,this.source=e;else if(this.source){const t=C[this.source];("select"===t.type||"combobox"===t.type?e in t.values||e in t.display:-1!==t.values.indexOf(e))&&t.set(e)}pe(this.id)}};C[t]=i,i.source&&i.values.push(i.source);const a={};i.states.forEach((e=>{i.values.push(e.value),e.condition.forEach((e=>{a[e.id]={type:"update",id:t},M(e.id,{type:"update",id:t})}))})),i.values.forEach((e=>{e in C&&M(e,{type:"update",id:t})}))})),o.rules&&o.rules.length&&o.rules.forEach(((e,t)=>{if("display"in e.effects&&(e.effects.display={e:l.getElementById(e.effects.display)},U=e.effects.display.e.querySelector(".auto-input"),U)){const t=C[U.id];t.rule=e,e.effects.display.u=t}if("lock"in e.effects){const t=new Map;l.querySelectorAll("#"+e.effects.lock+" .auto-input").forEach((e=>t.set(e.id,C[e.id]))),e.effects.lock=t}e.condition.forEach((i=>{i.type in DataHandler.checks&&(i.check=function(){return DataHandler.checks[this.type](se(this.id),se(this.value))}.bind(i),i.id in C&&(M(i.id,{type:"rule",id:i.id,condition:i,rule:t}),i.id in E||(E[i.id]={}),E[i.id][t]=e),i.check()?Object.keys(e.effects).forEach((t=>{t in C&&C[t].set(se(e.effects[t]))})):i.default&&Object.keys(e.effects).forEach((e=>{e in C&&C[e].set(se(i.default))})))}))})),x._u=Object.keys(C),r.addEventListener("resize",Z),o.metadata.datasets||K(),!o.dataviews[a.dataview].dataset){if(1===o.metadata.datasets.length)a.dataset=o.metadata.datasets[0];else if(o.data){const e=o.data.info;for(let t=x._u.length;t--;){const i=C[x._u[t]];if(i.dataset in e){a.dataset=i.dataset;break}if(i.default in e){a.dataset=i.default;break}if("select"===i.type&&i.options[i.default]&&i.options[i.default].value in e){a.dataset=i.options[i.default].value;break}if(Array.isArray(i.values)&&i.values[i.default]&&i.values[i.default]in e){a.dataset=i.values[i.default];break}}a.dataset||(a.dataset=o.metadata.datasets[o.metadata.datasets.length-1])}x._u.forEach((e=>{const t=C[e];t.dataset||(t.dataset=a.dataset)})),o.dataviews[a.dataview].dataset=a.dataset}"undefined"==typeof DataHandler?o.data={}:(a.dataset=se(o.dataviews[a.dataview].dataset),"number"==typeof a.dataset&&(a.dataset=o.metadata.datasets[a.dataset]),o.data=new DataHandler(o,a,o.data,{init:ie,onload:function(){o.data.inited&&clearTimeout(o.data.inited.load_screen),setTimeout(K,600),delete this.onload},data_load:function(){Object.keys(w).forEach(pe)}})),_.load_screen&&o.data.inited?o.data.inited.load_screen=setTimeout(K,3e3):_.wrap.style.visibility="visible"}};"undefined"==typeof module?r(window,document,site):module.exports=r}));
//# sourceMappingURL=community.min.js.map
