!function(){const e=function(e,t,i){"use strict";const a={rdylbu7:{name:"Red-Yellow-Blue (7)",type:"discrete",colors:["#d73027","#fc8d59","#fee090","#adadad","#e0f3f8","#91bfdb","#4575b4"]},orrd7:{name:"Orange-Red (7)",type:"discrete",colors:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"]},gnbu7:{name:"Green-Blue (7)",type:"discrete",colors:["#a8ddb5","#ccebc5","#f0f9e8","#adadad","#4eb3d3","#2b8cbe","#08589e"]},brbg7:{name:"Brown-Teal (7)",type:"discrete",colors:["#8c510a","#d8b365","#f6e8c3","#adadad","#c7eae5","#5ab4ac","#01665e"]},puor7:{name:"Purple-Orange (7)",type:"discrete",colors:["#b35806","#f1a340","#fee0b6","#adadad","#d8daeb","#998ec3","#542788"]},prgn6:{name:"Purple-Green (6)",type:"discrete",colors:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"]},reds5:{name:"Red (5)",type:"discrete",colors:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"]},greens5:{name:"Green (5)",type:"discrete",colors:["#ffffcc","#c2e699","#78c679","#31a354","#006837"]},paired4:{name:"Blue-Green (4)",type:"discrete",colors:["#1f78b4","#a6cee3","#b2df8a","#33a02c"]},greys4:{name:"Grey (4)",type:"discrete",colors:["#f7f7f7","#cccccc","#969696","#525252"]},grey:{name:"Grey",type:"continuous",colors:[[[70,70,70],[80,80,80]],[150,150,150],[[230,230,230],[-80,-80,-80]]]},brown:{name:"Brown",type:"continuous",colors:[[[131,30,0],[62,85,95]],[193,115,95],[[255,200,190],[-62,-85,-95]]]},purple:{name:"Purple",type:"continuous",colors:[[[90,14,213],[52.5,89,16]],[142.5,103,229],[[195,192,245],[-52.5,-89,-16]]]},prgn:{name:"Purple-Green",type:"continuous-divergent",colors:[[[27,120,55],[207,107,168.5]],[234,227,223.5],[[118,42,131],[116,185,92.5]]]},puor:{name:"Purple-Orange",type:"continuous-divergent",colors:[[[179,88,6],[56,133,202.5]],[235,221,208.5],[[84,39,136],[151,182,72.5]]]},rdbu:{name:"Red-Blue",type:"continuous-divergent",colors:[[[69,117,180],[170,116.5,16]],[239,233.5,196],[[215,48,39],[24,185.5,157]]]},vik:{name:"vik",type:"continuous-polynomial",colors:[[97.031,18.4251,.4149],[461.7602,637.5326,244.4647],[-2434.798,-2838.5427,-5893.4695],[9665.3469,14405.823,44072.722],[-2575.9109,-25871.106,-109792.1319],[-42510.0569,8528.3288,120953.8594],[63342.3061,14006.291,-59644.4457],[-26045.0391,-8868.9621,10155.5667]]},lajolla:{name:"lajolla",type:"continuous-polynomial",colors:[[256.0016,255.9138,204.945],[-187.6735,-46.2889,-768.5655],[1022.785,-1057.5602,1782.0325],[-2032.382,1490.8271,-1785.9056],[966.8373,-617.1949,567.7715]]}},s={seps:/[\s,/._-]+/g,period:/\./,all_periods:/\./g,word_start:/\b(\w)/g,settings:/^settings\./,features:/^features\./,filter:/^filter\./,data:/^data\./,variables:/^variables\./,properties:/prop/,palette:/^pal/,datasets:/^dat/,variable:/^var/,levels:/^lev/,ids:/^ids/,minmax:/^m[inax]{2}$/,int_types:/^(?:year|int.*)$/,end_punct:/[.?!]$/,mustache:/\{(.*?)\}/g,measure_name:/(?:^measure|_name)$/,http:/^https?:\/\//,bool:/^(?:true|false)$/,number:/^[\d-][\d.,]*$/,leading_zeros:/^0+/,url_spaces:/%20/g,hashes:/#/g,embed_setting:/^(?:hide_|navcolor|close_menus)/,median:/^med/i,location_string:/^[^?]*/,time_ref:/\{time\}/g,pre_colon:/^[^:]*:/},n="button.has-note::after,.button-wrapper.has-note button::before,.has-note legend::before,.has-note label::before,.wrapper.has-note > div > label::before{display:none}",r={setting:function(a){const s=a.value(),r=s?"dark":"light";s!==i.settings[a.setting]&&(i.settings[a.setting]=s,"theme_dark"===a.setting?(s?t.body.classList.replace("light-theme","dark-theme"):t.body.classList.replace("dark-theme","light-theme"),i.plotly&&Object.keys(i.plotly).forEach((e=>D(i.plotly[e].u))),i.map&&Object.keys(i.map).forEach((e=>{const t=i.map[e].u;t&&r in t.tiles&&(Object.keys(t.tiles).forEach((e=>{r!==e&&t.tiles[e].removeFrom(t.map)})),t.tiles[r].addTo(t.map))}))):"hide_url_parameters"===a.setting?e.history.replaceState(Date.now(),"",i.settings.hide_url_parameters?e.location.protocol+"//"+e.location.host+e.location.pathname:Z()):"hide_tooltips"===a.setting?s?u.script_style.sheet.insertRule(n,0):u.script_style.sheet.removeRule(0):"map_overlay"===a.setting?Object.keys(i.map).forEach((e=>{"_"!==e[0]&&(s?i.map[e].u.update():(i.map[e].u.overlay.clearLayers(),i.map[e].u.overlay_control.remove()))})):"tracking"===a.setting?(s&&i.tag_id&&!dataLayer.length&&(te("js",new Date),te("config",i.tag_id),te("consent","default",{analytics_storage:"denied"})),te("consent","update",{analytics_storage:s?"granted":"denied"})):ce(),te("event","setting",{event_category:a.setting,event_label:s}),d.set(a.setting,i.settings[a.setting]))},options:function(e){const t=!e.view||!i.dataviews[e.view].selection,a=ie(e.dataset),n=ie(e.variable),r=a+(n||""),l="combobox"===e.type;if(r in e.option_sets||(s.variable.test(e.options_source)?q(e,a,e.option_sets):s.levels.test(e.options_source)?j(e,a,n,e.option_sets):s.ids.test(e.options_source)&&O(e,a,e.option_sets)),r in e.option_sets){const a=r!==e.current_set&&(e.sensitive||!e.current_set),s=e[l?"listbox":"e"];if(a||e.filter){a&&(s.innerHTML="",e.values=e.option_sets[r].values,e.display=e.option_sets[r].display,e.options=e.option_sets[r].options);var o=0;if("ID"===e.variable||"ids"===e.options_source){const n=e.value();let r=-1===n||""===n?e.subset:e.selection_subset,l={};if(!t)if(r in x&&(r=ie(r)),"siblings"===r){const e=i.data.entity_tree&&i.data.entity_tree[n];if(e){const t=Object.keys(e.parents);t.length&&(l={},t.forEach((e=>{l={...l,...i.data.entity_tree[e].children}})))}}else l=i.dataviews[e.view].selection[r];e.options.forEach((i=>{a&&!e.groups&&s.appendChild(i),t||i.value in l?(i.classList.remove("hidden"),o++):i.classList.add("hidden")}))}else a?e.options.forEach((t=>{t.classList.remove("hidden"),e.groups||s.appendChild(t),o++})):o++;a&&e.groups&&e.groups.e.forEach((e=>s.appendChild(e))),S(e,o),e.current_set=r,a&&(l?e.source=[]:(e.e.selectedIndex=-1,e.source=""),e.id in i.url_options?e.set(i.url_options[e.id]):e.state in e.values?e.set(e.state):e.reset()),e.filter&&e.filter()}}},min:async function(e,t){var a=t.value(),n=e.value(),l=x[e.view||t.view];s.minmax.test(a)&&(a=t.parsed.min),l&&l.y&&(ie(l.y)in i.data.variables&&(l.time_range.time.length||await r.time_range(l,e,!0),a=Math.max(l.time_range.time[0],parseFloat(a))),e.update()),e.e.min=void 0===e.parsed.min?parseFloat(a):Math.max(e.parsed.min,parseFloat(a)),e.e.value?"number"==typeof n&&isFinite(n)&&n<a&&e.set(a):e.reset(),e.min_indicator&&(e.min_indicator.firstElementChild.innerText=a)},max:async function(e,t){var a=t.value(),n=e.value(),l=x[e.view||t.view];s.minmax.test(a)&&(a=t.parsed.max),l&&l.y&&(ie(l.y)in i.data.variables&&(l.time_range.time.length||await r.time_range(l,e,!0),a=Math.min(l.time_range.time[1],parseFloat(a))),e.update()),e.e.max=void 0===e.parsed.max?parseFloat(a):Math.min(e.parsed.max,parseFloat(a)),e.e.value?"number"==typeof n&&isFinite(n)&&n>a&&e.set(a):e.reset(),e.max_indicator&&(e.max_indicator.firstElementChild.innerText=a)},dataview:function(e){(e=e||x[b.dataview]).value()!==e.state&&x._entity_filter.registered[e.parsed.dataset]&&(i.data.inited[e.parsed.dataset]?(e.valid=!0,e.n_selected.ids=0,e.n_selected.children=0,e.n_selected.features=0,e.n_selected.variables=0,e.n_selected.dataset=0,e.n_selected.filtered=0,e.n_selected.full_filter=0,e.n_selected.all=0,e.selection.ids={},e.selection.children={},e.selection.features={},e.selection.variables={},e.selection.dataset={},e.selection.filtered={},e.selection.full_filter={},e.selection.all={},x._base_filter.c.forEach((e=>{e.passed=0,e.failed=0})),x._entity_filter.entities.forEach((t=>{const i=e.check(t),a=t.features.id;i.all=0,i.ids&&(e.selection.ids[a]=t,e.n_selected.ids++,i.all++),i.features&&(e.selection.features[a]=t,e.n_selected.features++,i.all++),i.variables&&(e.selection.variables[a]=t,e.n_selected.variables++,i.all++),i.dataset&&(e.selection.dataset[a]=t,e.n_selected.dataset++,i.all++),i.dataset&&i.ids&&(e.selection.children[a]=t,e.n_selected.children++),i.features&&i.variables&&(e.selection.full_filter[a]=t,e.n_selected.full_filter++),i.variables&&i.features&&i.ids&&(e.selection.filtered[a]=t,e.n_selected.filtered++),4===i.all&&(e.selection.all[a]=t,e.n_selected.all++)})),pe(e.id)):(e.valid=!1,i.data.data_queue[e.parsed.dataset][e.id]=function(){return r.dataview(e)},i.data.loaded[e.parsed.dataset]&&i.data.load_id_maps()))},time_filters:function(e){e.time_range.filtered[0]=1/0,e.time_range.filtered[1]=-1/0;const t=e.get.dataset(),a=i.data.meta.times[t],s=C[e.id+"_filter"];if(i.data.inited[t]){for(let t=a.n;t--;){let i=!1;if(t>=e.time_range.index[0]&&t<=e.time_range.index[1])for(let s=e.time_filters.length;s--;){const n={},r=e.time_filters[s];if(r.value in n||(n[r.value]=ie(r.value)),i=DataHandler.prototype.checks[r.type](a.value[t],n[r.value]),!i)break}e.times[t]=i,i&&(e.time_range.filtered[0]>a.value[t]&&(e.time_range.filtered[0]=a.value[t]),e.time_range.filtered[1]<a.value[t]&&(e.time_range.filtered[1]=a.value[t]))}e.time_range.filtered_index=[e.time_range.index[0]+e.time_range.filtered[0]-e.time_range.time[0],e.time_range.index[1]+e.time_range.filtered[1]-e.time_range.time[1]],s&&s.forEach((t=>{"update"===t.type?x[t.id].update():t.type in r&&r[t.type](x[t.id],e)}))}},time_range:async function(e,t,a){const s=t&&t.value(),n=e.get.dataset(),l=e.time?ie(e.time):b.time,o=l in i.data.variables?i.data.variables[l].info[n].min:1,d=C[e.id+"_time"],c=s in i.data.variables?s:ie(e.y);if(i.data.inited[n]){var h=c&&await de(c,e.id);if(h){const t=n+c!=e.time_range.dataset+e.time_range.variable;-1!==(h=h.time_range[n])[0]&&(e.time_range.dataset=n,e.time_range.variable=c,e.time_range.index[0]=h[0],e.time_range.time[0]=e.time_range.filtered[0]=o+h[0],e.time_range.index[1]=h[1],e.time_range.time[1]=e.time_range.filtered[1]=o+h[1]),!a&&d&&(d.forEach((i=>{const a=x[i.id],s=a.value();"min"===i.type?(t||isFinite(e.time_range.time[0])&&parseFloat(a.e.min)!==e.time_range.time[0])&&(a.e.min=e.time_range.time[0],(t||!v.retain_state||e.time_range.time[0]>s)&&a.set(e.time_range.time[0])):"max"===i.type&&(t||isFinite(e.time_range.time[1])&&parseFloat(a.e.max)!==e.time_range.time[1])&&(a.e.max=e.time_range.time[1],(t||!v.retain_state||e.time_range.time[1]<s||s<e.time_range.time[0])&&a.set(e.time_range.time[1]))})),r.time_filters(e))}else e.time_range.dataset=n,e.time_range.index[0]=0,e.time_range.time[0]=e.time_range.filtered[0]=1,e.time_range.index[1]=0,e.time_range.time[1]=e.time_range.filtered[1]=1}},id_filter:function(){const e={};x._entity_filter.selected=[],x._entity_filter.select_ids=e,i.metadata.datasets&&i.metadata.datasets.forEach((t=>{if(t in u.modal.filter.entity_inputs){const a=u.modal.filter.entity_inputs[t].value(),s=[];a&&a.length&&(a.forEach((t=>{const a=i.data.entities[t];a&&(s.push(t),x._entity_filter.selected.push(t),e[t]=!0,a.relations&&(Object.keys(a.relations.parents).forEach((t=>e[t]=!0)),Object.keys(a.relations.children).forEach((t=>e[t]=!0))))})),u.modal.filter.entity_inputs[t].source=s)}}))}},l={button:{init:function(a){a.target=a.e.getAttribute("target"),"copy"===a.target&&(a.settings.endpoint=i.endpoint),"filter"===a.target?(a.e.setAttribute("data-bs-toggle","modal"),a.e.setAttribute("data-bs-target","#filter_display"),a.notification=t.createElement("span"),a.notification.className="filter-notification hidden",a.e.parentElement.appendChild(a.notification),B("_base_filter",{type:"update",id:a.id}),B("_entity_filter",{type:"update",id:a.id}),a.update=l.button.update.bind(a),i.data&&a.update()):a.e.addEventListener("click",a.settings.effects?"export"===a.target||"copy"===a.target?function(){const t={},s=this.settings,n=x[s.dataview],r=n&&n.parsed.dataset;if(Object.keys(s.query).forEach((e=>t[e]=ie(s.query[e]))),n&&(!("include"in t)&&n.y&&(t.include=ie(n.y)),!("id"in t)&&n.ids&&(t.id=ie(n.ids))),"copy"===this.target||this.api){var l=[];"include"in t&&l.push("include="+t.include),"dataset"in t&&l.push("dataset="+t.dataset),"id"in t&&""!==t.id&&-1!=t.id?l.push("id="+t.id):x._entity_filter.selected.length&&l.push("id="+x._entity_filter.selected.join(",")),n&&(t.time_range||l.push("time_range="+i.data.meta.times[r].value[n.time_range.filtered_index[0]]+","+i.data.meta.times[r].value[n.time_range.filtered_index[1]]),n.features&&Object.keys(n.features).forEach((e=>{e in t||(t[e]=ie(n.features[e]),Array.isArray(t[e])&&(t[e]=t[e].join(",")),l.push(e+"="+t[e]))})),x._base_filter.c.size&&x._base_filter.value(l,n.parsed.time_agg));const o=s.endpoint+(l.length?"?"+l.join("&"):"");this.api?e.location.href=o:navigator.clipboard.writeText(o).then((()=>{"Copied!"!==a.e.innerText&&(a.text=a.e.innerText,a.e.innerText="Copied!",setTimeout((function(){a.e.innerText=a.text}),500),te("event","export",{event_category:"api link"}))}),(e=>{e!==a.e.innerText&&(a.text=a.e.innerText,a.e.innerText=e,setTimeout((function(){a.e.innerText=a.text}),1500))}))}else n&&"selection"in n?(t.time_range||(t.time_range=i.data.meta.times[r].value[n.time_range.filtered_index[0]]+","+i.data.meta.times[r].value[n.time_range.filtered_index[1]]),i.data.export(t,n.selection.all,!0)):i.data.export(t,i.data.entities,!0,!0),te("event","export",{event_category:"download"})}.bind(a):function(){Object.keys(this.settings.effects).forEach((e=>{""===this.settings.effects[e]||-1==this.settings.effects[e]?x[e].reset():x[e].set(this.settings.effects[e])}))}.bind(a):"refresh"===a.target?ce:"reset_selection"===a.target?he:"reset_storage"===a.target?oe:function(){this.target in x&&x[this.target].reset()}.bind(a))},update:function(){let e=Number(0!==x._entity_filter.selected.length);x._base_filter.c.forEach((t=>e+=t.active)),e?(this.notification.innerText=e,this.notification.classList.remove("hidden")):this.notification.classList.add("hidden")}},buttongroup:{retrieve:function(){for(let e=this.options.length;e--;)if(this.options[e].checked){this.set(e);break}},setter:function(e){this.previous=this.value(),this.current_index="string"==typeof e?this.values.indexOf(e):e,-1!==this.current_index?(this.source=this.values[this.current_index]in x?x[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,pe(this.id)},listener:function(e){this.set(e.target.value)},adder:function(e,a,s,n){var r=[t.createElement("input"),t.createElement("label")];return r[0].className="btn-check",r[0].type="radio",r[0].name=this.e.id+"_options",r[0].autocomplete="off",r[0].value=a,r[0].id=this.e.id+"_option"+e,r[1].className="btn btn-primary",r[1].innerText=s||i.data.format_label(a),r[1].setAttribute("for",r[0].id),n||(this.e.appendChild(r[0]),this.e.appendChild(r[1])),r[0]}},radio:{retrieve:function(){for(let e=this.options.length;e--;)if(this.options[e].checked){this.set(e);break}},setter:function(e){this.current_index="string"==typeof e?this.values.indexOf(e):e,-1!==this.current_index?(this.source=this.values[this.current_index]in x?x[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,pe(this.id)},listener:function(e){this.set(e.target.value)},adder:function(e,a,s){const n=t.createElement("div"),r="TRUE"===this.e.getAttribute("switch");return n.className="form-check"+(r?" form-switch":""),n.appendChild(t.createElement("input")),n.appendChild(t.createElement("label")),n.firstElementChild.autocomplete="off",n.firstElementChild.className="form-check-input",r&&(n.firstElementChild.role="switch"),n.firstElementChild.type="radio",n.firstElementChild.name=this.e.id+"_options",n.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,n.firstElementChild.value=e,n.lastElementChild.innerText=a||i.data.format_label(e),n.lastElementChild.className="form-check-label",n.lastElementChild.setAttribute("for",n.firstElementChild.id),s||this.e.appendChild(n),n.firstElementChild}},checkbox:{retrieve:function(){this.source=[],this.current_index=[],this.options.forEach((e=>{e.checked&&(this.source.push(this.values[k]),this.current_index.push(k))})),pe(this.id)},setter:function(e){if("object"==typeof e)this.source=[],this.current_index=[],this.values.forEach(((e,t)=>{-1!==e.indexOf(e)?(this.source.push(e),this.current_index.push(t),this.options[t].checked=!0):this.options[t].checked=!1}));else{if("string"==typeof e)return this.set(e.split(","));-1!==e&&(this.options[e].checked=!0)}pe(this.id)},listener:function(e){if(e.target.checked)this.source.push(e.target.value),this.current_index.push(this.values.indexOf(e.target.value));else{var t=this.source.indexOf(e.target.value);-1!==t&&(this.source.splice(t,1),this.current_index.splice(t,1))}pe(this.id)},adder:function(e,a,s){var n=t.createElement("div"),r="TRUE"===this.e.getAttribute("switch");return n.className="form-check"+(r?" form-switch":""),n.appendChild(t.createElement("input")),n.appendChild(t.createElement("label")),n.firstElementChild.autocomplete="off",n.firstElementChild.className="form-check-input",r&&(n.firstElementChild.role="switch"),n.firstElementChild.type="checkbox",n.firstElementChild.name=this.e.id+"_options",n.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,n.firstElementChild.value=e,n.lastElementChild.innerText=a||i.data.format_label(e),n.lastElementChild.className="form-check-label",n.lastElementChild.setAttribute("for",n.firstElementChild.id),s||this.e.appendChild(n),n.firstElementChild}},switch:{retrieve:function(){this.set(this.e.checked)},setter:function(e){"string"==typeof e&&(e="on"===e),e!==this.source&&(this.previous=this.e.checked,this.e.checked=this.source=e,pe(this.id))},listener:function(){this.set(this.e.checked)}},number:{init:function(e){const t=e.e.parentElement.parentElement.querySelector(".number-up"),i=e.e.parentElement.parentElement.querySelector(".number-down");i&&i.addEventListener("click",function(){this.set(Math.max(this.parsed.min,this.value()-1))}.bind(e)),t&&t.addEventListener("click",function(){this.set(Math.min(this.parsed.max,this.value()+1))}.bind(e))},retrieve:function(){this.set(this.e.value)},setter:function(e,t){e||(e=null),"string"==typeof e&&(e=parseFloat(e)),isFinite(e)&&e!==this.source&&(this.previous=parseFloat(this.e.value),t&&(isFinite(this.parsed.min)&&e<this.parsed.min?e=this.parsed.min:isFinite(this.parsed.max)&&e>this.parsed.max&&(e=this.parsed.max)),this.e.value=this.source=e,this.current_index=e-this.parsed.min,"range"===this.e.type&&(this.e.nextElementSibling.firstElementChild.innerText=this.e.value),pe(this.id))},listener:function(e){this.set(this.e.value,!0)}},intext:{retrieve:function(){this.set(this.e.value)},setter:function(e,t){this.previous=this.e.value,this.e.value=this.source=e,pe(this.id)},listener:function(e){this.set(this.e.value,!0)}},text:{init:function(e){i.text&&e.id in i.text&&(e.text=i.text[e.id].text,e.condition=i.text[e.id].condition||[],e.depends=new Map,e.text.forEach((i=>{"text"in i?(A(e,i),e.e.appendChild(i.parts)):(e.e.appendChild(t.createElement("span")),i.forEach((t=>A(e,t))))})),e.condition.forEach((t=>{t.id in x&&B(t.id,{type:"display",id:e.id})})),e.depends.forEach((t=>B(t.id,{type:"update",id:e.id}))),e.update=l.text.update.bind(e)),e.update()},update:function(){Object.keys(this.reference_options).forEach((e=>this.options[e]=ie(this.reference_options[e]))),this.depends.forEach((e=>{e.parsed=ie(e.id),e.u?e.u.options?e.parsed=e.u.options["combobox"===e.u.type?e.u.values[e.parsed]:e.u.current_index].innerText:e.parsed=e.u.display&&e.parsed in e.u.display?e.u.display[e.parsed]:i.data.format_label(e.parsed):e.parsed in i.data.entities&&(e.parsed=i.data.entities[e.parsed].features.name)})),this.text.forEach(((e,t)=>{let i=!0;if(e.length){for(let t=e.length;t--;)if("condition"in e[t]){for(let a=e[t].condition.length;a--&&(i=e[t].condition[a].check(),i););if(i){e=e[t];break}}}else if("condition"in e)for(let t=e.condition.length;t--&&(i=e.condition[t].check(),i););i?(e.text.forEach(((t,i)=>{if(Array.isArray(t)&&t.forEach((e=>{("default"===e.id||DataHandler.prototype.checks[e.type](ie(e.id),ie(e.value)))&&(t=e.text)})),this.depends.has(t))e.parts.children[i].innerText=this.depends.get(t).parsed;else if(t in e.button){let a="";e.button[t].text.forEach((e=>{a=(this.depends.has(e)?this.depends.get(e).parsed:e)+a})),e.parts.children[i].innerText=a}else e.parts.children[i].innerText=t})),this.text[t].length?(this.e.children[t].innerHTML="",this.e.children[t].appendChild(e.parts)):e.parts.classList.remove("hidden")):e.parts.classList.add("hidden")}))}},select:{retrieve:function(){this.set(this.e.selectedIndex)},setter:function(e){"string"==typeof e&&!(e in this.values)&&s.number.test(e)&&(e=Number(e)),"number"==typeof e&&(e=this.options[e]?this.options[e].value:e),!(e in this.values)&&e in this.display&&(e=this.options[this.display[e]].value),e!==this.source&&(this.e.selectedIndex=e in this.values?this.values[e]:-1,this.source=e,pe(this.id))},listener:function(e){this.set(e.target.selectedIndex)},adder:function(e,a,s,n){const r=t.createElement("option");return r.value=e,r.innerText=a||i.data.format_label(e),s&&s.info&&(r.title=s.info.description||s.info.short_description),n||this.e.appendChild(r),r}},combobox:{create:function(e,a,n,r){r=r||"created_combobox_"+ ++u.elementCount;const o=t.createElement("div");let d=t.createElement("div");n&&(i.combobox||(i.combobox={}),i.combobox[r]=n),o.className="wrapper combobox-wrapper",o.appendChild(d),d.id=r,d.setAttribute("auto-type","combobox"),d.className="auto-input form-select combobox combobox-component",d.role="combobox",d.setAttribute("aria-haspopup","listbox"),d.setAttribute("aria-expanded","false"),d.setAttribute("aria-labelledby",r+"-label"),d.setAttribute("aria-controls",r+"-listbox"),d.appendChild(d=t.createElement("div")),d.className="combobox-selection combobox-component",d.appendChild(t.createElement("span")),d.lastElementChild.className="combobox-component",d.appendChild(d=t.createElement("input")),d.className="combobox-input combobox-component",d.type="text",d.setAttribute("aria-labelledby",r+"-label"),d.id=r+"-input",d.autocomplete="off",n&&n.clearable&&(o.firstElementChild.appendChild(d=t.createElement("button")),d.type="button",d.className="btn-close",d.title="clear selection"),o.appendChild(d=t.createElement("div")),d.className="combobox-options combobox-component",d.role="listbox",d.tabindex="-1",d.id=r+"-listbox",o.appendChild(d=t.createElement("label")),d.id=r+"-label",d.innerText=e,l.init_input(o.firstElementChild);const c=x[r];var h=0;return c.options=[],a&&(Array.isArray(a)?a.forEach((e=>{const t=i.data.format_label(e);c.display[t]=h,c.values[e]=h++,c.options.push(c.add(e,t))})):(c.groups={e:[],by_name:{}},Object.keys(a).forEach((e=>{const i=a[e],n=t.createElement("div"),r=c.id+"_group_"+e.replace(s.seps,"-");n.className="combobox-group combobox-component",n.role="group",n.setAttribute("aria-labelledby",r),n.appendChild(t.createElement("label")),n.firstElementChild.innerText=e,n.firstElementChild.id=r,n.firstElementChild.className="combobox-group-label combobox-component",c.groups.by_name[e]=n,c.groups.e.push(n),i.forEach((t=>c.groups.by_name[e].appendChild(c.add(t,t,!0)))),c.listbox.appendChild(n)})),Object.keys(c.groups.by_name).forEach((e=>{c.groups.by_name[e].querySelectorAll(".combobox-option").forEach((t=>{c.options.push(t),t.setAttribute("group",e),c.values[t.value]=h,c.display[t.innerText]=h++}))})))),c},init:function(a){a.hover_index=-1,a.cleared_selection="",a.expanded=!1,a.listbox=a.e.parentElement.children[1],a.container=t.createElement("div"),a.container.className="combobox-options-container combobox-component",a.container.style.display="none",u.overlay.appendChild(a.container),a.container.appendChild(a.listbox),a.selection=a.e.firstElementChild.firstElementChild,a.input_element=a.e.firstElementChild.lastElementChild,2===a.e.childElementCount&&a.e.lastElementChild.addEventListener("click",function(){this.e.classList.contains("locked")||(this.cleared_selection="",this.set([]),this.input_element.focus())}.bind(a)),a.value=function(){return this.source?this.settings.multi?this.source:this.source.length?this.source[0]:"":ie(this.default)}.bind(a),a.input_element.addEventListener("focus",function(){this.e.classList.add("focused")}.bind(a)),a.input_element.addEventListener("blur",function(){this.e.classList.remove("focused")}.bind(a)),a.listbox.addEventListener("click",a.set),a.close=function(t){!this.expanded||t&&t.target.classList&&t.target.classList.contains("combobox-component")||(""===this.selection.innerText&&(this.selection.innerText=this.cleared_selection),""!==this.input_element.value&&setTimeout(this.set,0),this.e.setAttribute("aria-expanded",!1),this.expanded=!1,this.container.style.display="none",e.removeEventListener("click",a.close))}.bind(a),a.resize=function(){const t=this.e.getBoundingClientRect();this.container.style.left=t.x+"px",this.container.style.width=t.width+"px",e.screen.height/2>t.y?(this.container.style.top=t.y+t.height+"px",this.container.style.bottom=""):(this.container.style.top="",this.container.style.bottom=-t.y+"px")}.bind(a),e.addEventListener("resize",a.resize),a.toggle=function(t){t.button||this.e.classList.contains("disabled")||"BUTTON"===t.target.tagName||(this.expanded?t.target!==this.input_element&&this.close():(i.combobox&&Object.keys(i.combobox).forEach((e=>{if(e!==this.id){const t=x[e];t.expanded&&t.close()}})),this.container.style.display="",this.settings.multi||(""!==this.selection.innerText&&(this.cleared_selection=this.selection.innerText),this.cleared_selection in this.display&&this.highlight({target:this.options[this.display[this.cleared_selection]]}),this.selection.innerText=""),e.addEventListener("click",this.close),this.e.setAttribute("aria-expanded",!0),t&&t.target===this.input_element||setTimeout((()=>this.input_element.focus()),0),this.resize(),this.expanded=!0))}.bind(a),a.e.addEventListener("mousedown",a.toggle),a.highlight=function(e){if(!e||!e.target||e.target.value in this.values){this.groups||(this.settings.accordion=!1),e&&e.target&&e.target.value?this.hover_index=this.values[e.target.value]:-1===this.hover_index&&this.source&&(this.hover_index=this.values[this.source[0]]),void 0===this.hover_index&&(this.hover_index=-1);const t=this.options[this.hover_index];if(t){const e=this.listbox.querySelector(".highlighted");if(e&&e.classList.remove("highlighted"),t.classList.add("highlighted"),this.settings.accordion){const e=t.parentElement.parentElement;e.classList.contains("show")||(e.classList.add("show"),e.previousElementSibling.firstElementChild.classList.remove("collapsed"),e.previousElementSibling.firstElementChild.setAttribute("aria-expanded",!0))}this.e.setAttribute("aria-activedescendant",t.id);const i=this.container.getBoundingClientRect(),a=t.getBoundingClientRect();let s=i.top;this.groups&&t.getAttribute("group")&&(s+=this.groups.by_name[t.getAttribute("group")].firstElementChild.getBoundingClientRect().height),s>a.top?this.container.scrollTo(0,this.container.scrollTop+a.top-s):i.bottom<a.bottom&&this.container.scrollTo(0,this.container.scrollTop+a.bottom-i.bottom)}}}.bind(a),a.listbox.addEventListener("mouseover",a.highlight),a.settings.accordion&&a.listbox.addEventListener("show.bs.collapse",(e=>{a.options[a.hover_index].getAttribute("group")!==e.target.getAttribute("group")&&(a.highlight({target:e.target.firstElementChild.firstElementChild}),a.input_element.focus())})),a.clear_highlight=function(){-1!==this.hover_index&&(this.options[this.hover_index].classList.remove("highlighted"),this.hover_index=-1)}.bind(a),a.filter_reset=function(){this.groups&&this.groups.e.forEach((e=>e.firstElementChild.firstElementChild.classList.remove("hidden"))),this.input_element.value="",this.filter_index=[],this.listbox.querySelectorAll(".filter-hidden").forEach((e=>e.classList.remove("filter-hidden")))}.bind(a),a.settings.search&&(a.filterer=function(e){const t=this.input_element.value.toLowerCase();""===t?this.filter_reset():(this.filter_index=[],this.groups&&this.groups.e.forEach((e=>e.firstElementChild.firstElementChild.classList.add("hidden"))),this.options.forEach(((e,i)=>{if(e.innerText.toLowerCase().includes(t)){e.classList.remove("filter-hidden"),this.filter_index.push(i);const t=e.getAttribute("group");if(t&&(this.groups.by_name[t].firstElementChild.firstElementChild.classList.remove("hidden"),this.settings.accordion)){const e=this.groups.by_name[t];e.firstElementChild.nextElementSibling.classList.add("show"),e.firstElementChild.firstElementChild.classList.remove("collapsed"),e.firstElementChild.firstElementChild.setAttribute("aria-expanded",!0)}}else e.classList.add("filter-hidden")})))}.bind(a),a.input_element.addEventListener("keyup",a.filterer)),a.input_element.addEventListener("keydown",function(e){const t=c[e.code];if(t)if("close"===t)this.close();else if("select"===t){if(!this.expanded)return this.toggle({target:this.input_element});this.set(e)}else"move"===t&&(e.preventDefault(),"ArrowUp"===e.code?this.filter_index&&this.filter_index.length?(this.hover_index=this.filter_index.indexOf(this.hover_index)-1,this.hover_index=this.filter_index[0>this.hover_index?0:this.hover_index]):this.hover_index=Math.max(0,this.hover_index-1):"ArrowDown"===e.code?this.filter_index&&this.filter_index.length?(this.hover_index=this.filter_index.indexOf(this.hover_index)+1,this.hover_index=this.filter_index[this.filter_index.length-1<this.hover_index?this.filter_index.length-1:this.hover_index]):this.hover_index=Math.min(this.options.length-1,this.hover_index+1):"Home"===e.code?this.hover_index=0:"End"===e.code&&(this.hover_index=this.options.length-1),this.expanded?this.highlight():this.set(this.hover_index));else this.expanded?this.clear_highlight():this.toggle({target:this.input_element})}.bind(a))},retrieve:function(){this.source=[],this.listbox.querySelectorAll(".selected").forEach((e=>this.source.push(e.value))),pe(this.id)},setter:function(e,t){if(e||(e=this.input_element.value),e.target&&(this.settings.accordion?"BUTTON":"LABEL")===e.target.tagName)return;let i=!1;var a=-1;if(e.target&&(-1!==(a=this.hover_index)&&(this.options[a].classList.contains("hidden")||this.options[a].classList.contains("filter-hidden"))&&(a=-1),e=-1===a?e.target.innerText||e.target.value:a,t=this.settings.multi),this.filter_reset(),"object"==typeof e&&(this.settings.multi?(this.listbox.querySelectorAll(".selected").forEach((e=>e.classList.remove("selected"))),this.source=-1===e?[]:e,e.forEach((e=>{e in this.values&&this.options[this.values[e]].classList.add("selected")}))):e=e[0]),Array.isArray(this.source)||(this.source=[]),"object"==typeof e&&this.settings.multi)i=!0;else if(this.settings.strict&&"string"==typeof e&&!(e in this.values)&&s.number.test(e)&&(e=Number(e)),"number"==typeof e&&e>-1&&e<this.options.length&&(e=this.options[e].value),"string"===e&&e in this.display&&(e=this.options[this.display[e]].value),this.settings.strict&&!(e in this.values)&&(e=this.default),-1===(a=this.source.indexOf(e))){if(i=!0,-1===e||""===e?this.source=[]:this.settings.multi?this.source.push(e):this.source[0]=e,e in this.values){if(!this.settings.multi){const e=this.listbox.querySelector(".selected");e&&e.classList.remove("selected")}this.options[this.values[e]].classList.add("selected")}}else t&&(i=!0,this.source.splice(a,1),e in this.values&&this.options[this.values[e]].classList.remove("selected"));!this.settings.multi&&this.expanded&&(this.input_element.focus(),this.close(),this.filter_reset()),this.selection.innerText=this.source.length?this.settings.multi?this.source.length+" of "+this.options.length+" selected":this.source[0]in this.values?this.options[this.values[this.source[0]]].firstChild.textContent:this.settings.strict||-1===this.source[0]?"":this.source[0]:"",this.onchange&&this.onchange(),i&&pe(this.id)},adder:function(e,a,s,n){const r=t.createElement("div");return r.role="option",r.setAttribute("aria-selected",!1),r.tabindex="0",r.className="combobox-option combobox-component",r.value=e,r.innerText=a||i.data.format_label(e),n&&n.info&&(r.appendChild(t.createElement("p")),r.lastElementChild.className="combobox-option-description combobox-component",r.lastElementChild.innerText=n.info.description||n.info.short_description||""),s||this.listbox.appendChild(r),r}},plotly:{init:function(e){e.previous_span=1,e.id in i.plotly&&(e.x=e.e.getAttribute("x"),e.y=e.e.getAttribute("y"),e.color=e.e.getAttribute("color"),e.time=e.e.getAttribute("color-time"),e.click=e.e.getAttribute("click"),e.click in x&&(e.clickto=x[e.click]),e.parsed={},e.traces={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.tab&&t.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){e.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(W,155))}.bind(e)),e.show=function(t){e.revert();var a=F(this,t,0,0,"hover_line",b["border_highlight_"+i.settings.theme_dark]);a&&(a.line.width=4,a.marker.size=12,Plotly.addTraces(this.e,a,this.e.data.length))},e.revert=function(){this.e.data.length&&"hover_line"===this.e.data[this.e.data.length-1].name&&Plotly.deleteTraces(this.e,this.e.data.length-1)},e.options&&(i.plotly[e.id].u=e),i.plotly[e.id].data.forEach(((t,i)=>{Object.keys(t).forEach((e=>{if(s.period.test(e)){const a=e.split("."),s=a.length-1;var i=null;a.forEach(((a,n)=>{i=i?i[a]=n===s?t[e]:{}:t[a]={}}))}})),"textfont"in t||(t.textfont={}),"color"in t.textfont||(t.textfont.color=b.background_highlight),"line"in t||(t.line={}),"color"in t.line||(t.line.color=b.background_highlight),"marker"in t||(t.marker={}),t.marker.size=8,"color"in t.marker||(t.marker.color=b.background_highlight),"line"in t.marker||(t.marker.line={}),"color"in t.marker.line||(t.marker.line.color=b.background_highlight),"text"in t||(t.text=[]),"x"in t||(t.x=[]),"box"===t.type?t.hoverinfo="none":"y"in t||(t.y=[]),e.traces[t.type]=JSON.stringify(t),i||(e.base_trace=t.type,e.base_trace in x&&B(e.base_trace,{type:"update",id:e.id}))})),e.x&&!(e.x in i.data.variables)&&B(e.x,{type:"update",id:e.id}),e.y&&!(e.y in i.data.variables)&&B(e.y,{type:"update",id:e.id}),e.color&&!(e.color in i.data.variables)&&B(e.color,{type:"update",id:e.id}),e.time in x&&B(e.time,{type:"update",id:e.id}),e.view?(B(e.view,{type:"update",id:e.id}),B(e.view+"_filter",{type:"update",id:e.id}),x[e.view].time_agg in x&&B(x[e.view].time_agg,{type:"update",id:e.id})):e.view=b.dataview,ue.bind(e)())},mouseover:function(e){e.points&&1===e.points.length&&this.e.data[e.points[0].fullData.index]&&(Plotly.restyle(this.e,{"line.width":5},e.points[0].fullData.index),R(this.id,"show",i.data.entities[e.points[0].data.id]))},mouseout:function(e){e.points&&1===e.points.length&&this.e.data[e.points[0].fullData.index]&&(Plotly.restyle(this.e,{"line.width":2},e.points[0].fullData.index),R(this.id,"revert",i.data.entities[e.points[0].data.id]))},click:function(e){this.clickto&&this.clickto.set(e.points[0].data.id)},update:async function(e){if(clearTimeout(this.queue),e){if(this.e.layout){const e=x[this.view],t=e.selection&&e.selection.all,s=e.get.dataset(),n=x[this.time||e.time_agg],r=this.parsed;if(i.data.inited[s]&&t&&e.time_range.filtered.length){r.base_trace=ie(this.base_trace),r.x=ie(this.x),r.y=ie(this.y),r.color=ie(this.color||e.y||r.y);const o=await de(r.x,this.view),d=await de(r.y,this.view),c=await de(r.color,this.view);r.x_range=o.time_range[s],r.y_range=d.time_range[s],r.view=e,r.dataset=s,r.palette=ie(e.palette)||i.settings.palette,r.palette in a||(r.palette=b.palette),r.time=(n?n.value()-i.data.meta.times[s].range[0]:0)-c.time_range[s][0],r.summary=c[this.view].summaries[s];const h=r.summary.n[r.time]?r.time:0,p=d[this.view].summaries[s],m=r.summary.missing[h],u=r.summary.n[h],f=u!==e.n_selected.dataset,_=f?"subset_rank":"rank",v=f?c[this.view].order[s][h]:c.info[s].order[h],g=[];let y,E,x,C=r.summary.missing[h],w=v?v.length:0,k=i.settings.trace_limit||0,T=e.value()+e.get.time_filters()+s+r.x+r.y+r.time+r.palette+r.color+i.settings.summary_selection+i.settings.color_scale_center+i.settings.color_by_order+i.settings.trace_limit;for(k=x=k&&k<u?Math.ceil(Math.min(k/2,u/2)):0,Object.keys(this.reference_options).forEach((e=>this.options[e]=ie(this.reference_options[e])));C<w;C++)if(v[C][0]in t){y=v[C][0];const e=t[y];if(T+=y,g.push(F(this,e,e[this.view][_][r.color][r.time]-m,u)),k&&!--x)break}if(k&&C<w)for(x=C,C=w-1;C>x;C--)if(v[C][0]in t){y=v[C][0];const e=t[y];if(T+=y,g.push(F(this,e,e[this.view][_][r.color][r.time]-m,u)),!--k)break}if(T+=g.length&&g[0].type,i.settings.boxplots&&"box"in this.traces&&t[y]&&(T+="box"+i.settings.iqr_box,E=JSON.parse(this.traces.box),g.push(E),E.line.color=b.border,E.median=p.median,E.q3=p.q3,E.q1=p.q1,i.settings.iqr_box?(E.upperfence=[],E.lowerfence=[],E.q1.forEach(((e,t)=>{isNaN(E.median[t])&&(E.median[t]=0);const i=1.5*(E.q3[t]-e),a=E.median[t];E.q3[t]=isNaN(E.q3[t])?a:Math.max(a,E.q3[t]),E.upperfence[t]=E.q3[t]+i,E.q1[t]=isNaN(E.q1[t])?a:Math.min(a,e),E.lowerfence[t]=e-i}))):(E.upperfence=p.max,E.lowerfence=p.min),E.x=E.q1.map(((e,i)=>t[y].get_value(r.x,i+r.y_range[0])))),T!==this.state){"boolean"!=typeof this.e.layout.yaxis.title&&(this.e.layout.yaxis.title=i.data.format_label(r.y)+(i.settings.trace_limit<e.n_selected.all?" ("+i.settings.trace_limit+" extremes)":"")),"boolean"!=typeof this.e.layout.xaxis.title&&(this.e.layout.xaxis.title=i.data.format_label(r.x)),this.e.layout.yaxis.autorange=!1,this.e.layout.yaxis.range=[1/0,-1/0],E||(E={upperfence:p.max,lowerfence:p.min}),p.min.forEach(((e,t)=>{const i=Math.min(E.lowerfence[t],e),a=Math.max(E.upperfence[t],p.max[t]);this.e.layout.yaxis.range[0]>i&&(this.e.layout.yaxis.range[0]=i),this.e.layout.yaxis.range[1]<a&&(this.e.layout.yaxis.range[1]=a)}));const t=(this.e.layout.yaxis.range[1]-this.e.layout.yaxis.range[0])/10;this.e.layout.yaxis.range[0]-=t,this.e.layout.yaxis.range[1]+=t,i.data.variables[r.x].is_time&&(this.e.layout.xaxis.autorange?(this.e.layout.xaxis.autorange=!1,this.e.layout.xaxis.type="linear",this.e.layout.xaxis.dtick=1,this.e.layout.xaxis.range=[e.time_range.filtered[0]-.5,e.time_range.filtered[1]+.5]):(this.e.layout.xaxis.range[0]=e.time_range.filtered[0]-.5,this.e.layout.xaxis.range[1]=e.time_range.filtered[1]+.5)),E.lowerfence.length<this.previous_span?(Plotly.newPlot(this.e,g,this.e.layout,this.e.config),this.e.on("plotly_hover",l.plotly.mouseover.bind(this)).on("plotly_unhover",l.plotly.mouseout.bind(this)).on("plotly_click",l.plotly.click.bind(this))):Plotly.react(this.e,g,this.e.layout,this.e.config),setTimeout(W,300),this.previous_span=E.lowerfence.length,this.state=T}}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))}},map:{init:function(e){e.color=e.e.getAttribute("color"),e.time=e.e.getAttribute("color-time"),e.click=e.e.getAttribute("click"),e.click&&e.click in x&&(e.clickto=x[e.click]),e.parsed={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.show=function(t){if(t.layer&&t.layer[this.id])if(i.data.inited[this.parsed.dataset+e.id])t.layer[this.id].setStyle&&t.layer[this.id].setStyle({color:b["border_highlight_"+i.settings.theme_dark]});else{const e=i.map[this.id].match_time(i.data.meta.overall.value[i.data.variables[this.parsed.color].time_range[this.parsed.dataset][0]+this.parsed.time]);t.layer[this.id][e]&&t.layer[this.id][e].setStyle({color:b["border_highlight_"+i.settings.theme_dark]})}},e.revert=function(e){if(e.layer&&e.layer[this.id])if(i.data.inited[this.parsed.dataset+this.id])e.layer[this.id].setStyle({color:b.border});else{const t=i.map[this.id].match_time(i.data.meta.overall.value[i.data.variables[this.parsed.color].time_range[this.parsed.dataset][0]+this.parsed.time]);e.layer[this.id][t]&&e.layer[this.id][t].setStyle({color:b.border})}};const t={type:"update",id:e.id};if(e.view?(x[e.view].time_agg in x&&B(x[e.view].time_agg,t),x[e.view].y&&B(x[e.view].y,t)):e.view=b.dataview,B(e.view,t),e.color in x&&B(e.color,t),e.time&&B(e.time,t),e.e.style.height||(e.e.style.height=e.options.height?e.options.height:"400px"),e.options.overlays_from_measures&&i.data.variable_info){Array.isArray(i.map[e.id].overlays)||(i.map[e.id].overlays=[]);const t=i.map[e.id].overlays;Object.keys(i.data.variable_info).forEach((e=>{const a=i.data.variable_info[e];if(a.layer&&a.layer.source){if("string"==typeof a.layer.source&&s.time_ref.test(a.layer.source)){const t=a.layer.source;a.layer.source=[];for(let n,r=i.data.meta.ranges[e],l=r[0],o=r[1]+1;l<o;l++)n=i.data.meta.overall.value[l],a.layer.source.push({url:t.replace(s.time_ref,n),time:n})}s.time_ref.lastIndex=0;const n={variable:e,source:a.layer.source};a.layer.filter&&(Array.isArray(a.layer.filter)||a.layer.filter.feature)&&(n.filter=a.layer.filter),t.push(n)}}))}fe.bind(e)()},mouseover:function(e){e.target.setStyle({color:b["border_highlight_"+i.settings.theme_dark]}),R(this.id,"show",i.data.entities[e.target.feature.properties[e.target.source.id_property]])},mouseout:function(e){R(this.id,"revert",i.data.entities[e.target.feature.properties[e.target.source.id_property]]),e.target.setStyle({color:b.border})},click:function(e){this.clickto&&this.clickto.set(e.target.feature.properties[e.target.source.id_property])},update:async function(e,t,s){if(clearTimeout(this.queue),s){if(this.view&&this.displaying){const e=this.parsed,t=i.dataviews[this.view],s=t.get.dataset(),l=ie(t.time_agg),o=i.map[this.id].has_time?i.map[this.id].match_time(l):l,d=s+o+this.id in i.data.inited?s+o:s;if(i.map._queue&&d in i.map._queue&&!i.data.inited[d+this.id])return ne(this,i.map._queue[d],(()=>this.update(void 0,void 0,!0)));!t.valid&&i.data.inited[s]&&(t.state="",r.dataview(t,void 0,!0)),e.view=t,e.dataset=s;const c=t.value()+d+i.settings.background_shapes+i.data.inited[this.options.background_shapes],h=t.selection.all,p=t.selection[i.settings.background_shapes&&this.options.background_shapes?"ids":"all"],m=b.border,u=ie(this.color||t.y);if(i.settings.map_overlay&&u in i.map[this.id].triggers?re(this,i.map[this.id].triggers[u],i.data.meta.overall.value[t.parsed.time_agg]):(this.overlay_control.remove(),this.overlay.clearLayers()),i.data.inited[d+this.id]&&p&&t.valid){const r=this.time?x[this.time]:t.time_agg?t.time_agg in x?x[t.time_agg]:parseInt(t.time_agg):0;e.palette=ie(t.palette)||i.settings.palette,e.palette in a||(e.palette=b.palette);const l=await de(u,this.view),d=l[this.view].summaries[s],f=(r.parsed?r.value()-i.data.meta.times[s].range[0]:0)-l.time_range[s][0];e.summary=d,e.time=f,e.color=u;const _=d.n[r]===t.n_selected.dataset?"rank":"subset_rank";if(c!==this.vstate){this.map._zoomAnimated="none"!==i.settings.map_animations,Object.keys(this.reference_options).forEach((e=>{this.options[e]=ie(this.reference_options[e]),"zoomAnimation"===e&&(this.map._zoomAnimated=this.options[e])})),this.displaying.clearLayers(),this.fresh_shapes=!0,this.vstate=!1;var n=0;Object.keys(p).forEach((e=>{const t=p[e].layer;if(t&&t[this.id]){const a=e in h,s=t[this.id].has_time?t[this.id][o]:t[this.id];s&&(a||this.options.background_shapes===i.data.entities[e].group)&&(n++,s.options.interactive=a,s.addTo(this.displaying),a||(s.bringToBack(),s.setStyle({fillOpacity:0,color:m,weight:.3})),this.vstate||(this.vstate=c))}})),this.overlay.bringToFront(),n&&("fly"===i.settings.map_animations?setTimeout((()=>this.map.flyToBounds(this.displaying.getBounds())),400):this.map.fitBounds(this.displaying.getBounds()))}const v=u+this.vstate+e.palette+f+i.settings.polygon_outline+i.settings.color_by_order+i.settings.color_scale_center;if(v!==this.cstate)if(this.cstate=v,i.map[this.id]){const t=this.displaying._layers,a=d.n[f],n=d.missing[f];Object.keys(t).forEach((r=>{const l=t[r];if(s===l.entity.group){const t=h[l.entity.features.id],s=t&&t[this.view][_];l.setStyle({fillOpacity:.7,color:b.border,fillColor:t&&u in s?N(t.get_value(u,f),e.palette,d,f,s[u][f]-n,a):b.missing,weight:i.settings.polygon_outline})}}))}else"_waiting"in i.map||(i.map._waiting={}),s in i.map._waiting||(i.map._waiting[s]=[]),-1===i.map._waiting[s].indexOf(this.id)&&i.map._waiting[s].push(this.id),-1===i.map._waiting[s].indexOf(this.view)&&i.map._waiting[s].push(this.view)}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(void 0,void 0,!0)),50))}},info:{init:function(e){function a(e,a){const n={parent:e,text:a,parsed:{},ref:!0,selection:!1,get:function(t,a){if(this.ref){if(t){if("features"in this.parsed)return t.features[this.parsed.features];if("data"in this.parsed){if("value"===this.text?this.parsed.data=ie(e.options.variable||a.color||a.y||x[e.view].y):this.text in x&&(this.parsed.data=ie(this.text)),!(this.parsed.data in i.data.variables))return this.parsed.data;const n=i.data.variable_info[this.parsed.data],r=i.data.format_value(t.get_value(this.parsed.data,this.parent.time),!n||!n.type||s.int_types.test(n.type));return"unknown"!==r&&n.type in o?o[n.type](r):r}}return"data"in this.parsed?i.data.meta.times[this.parent.dataset].value[this.parent.time_agg]:"variables"in this.parsed&&(this.value_source||this.parent.v in i.data.variable_info)?i.data.variable_info[ie(this.value_source||this.parent.v)][this.parsed.variables]:this.text}return this.text}};if("value"===a)n.parsed.data=e.options.variable;else if("summary"===a){e.options.show_summary=!0,e.e.classList.add("info-summary-wrapper");const i=t.createElement("table");i.className="info-summary",n.parsed.summary=i,i.appendChild(t.createElement("tr")),i.appendChild(t.createElement("tr")),["NAs","Min","Q1","Mean","Median","Q3","Max"].forEach((e=>{i.firstElementChild.appendChild(t.createElement("th")),i.firstElementChild.lastElementChild.innerText=e,i.lastElementChild.appendChild(t.createElement("td")),i.lastElementChild.lastElementChild.innerText="NA"}))}else if("filter"===a){const e=t.createElement("table");e.className="info-filter",n.parsed.filter=e}return s.features.test(a)?n.parsed.features=a.replace(s.features,""):s.data.test(a)?n.parsed.data=a.replace(s.data,""):s.variables.test(a)?n.parsed.variables=a.replace(s.variables,""):n.ref=!1,n}if(e.depends={},e.has_default=e.options.default&&(e.options.default.title||e.options.default.body),I(e.view,e),e.options.floating&&(t.body.appendChild(e.e),e.e.classList.add("hidden"),t.addEventListener("mousemove",(function(t){if(e.showing){const i=u.content.getBoundingClientRect();e.e.style.top=(t.y>i.height/2?t.y-e.e.getBoundingClientRect().height-10:t.y+10)+"px",e.e.style.left=(t.x>i.width/2?t.x-e.e.getBoundingClientRect().width-10:t.x+10)+"px"}}))),e.show=function(e,t){this.update(e,t),this.showing=!0,this.options.floating&&this.e.classList.remove("hidden"),this.parts.title&&(this.selection?this.parts.title.base.classList.add("hidden"):this.parts.title.default.classList.add("hidden"),this.parts.title.temp.classList.remove("hidden")),this.parts.body&&(this.selection?this.parts.body.base.classList.add("hidden"):this.parts.body.default.classList.add("hidden"),this.parts.body.temp.classList.remove("hidden"))},e.revert=function(){this.showing=!1,this.options.floating?this.e.classList.add("hidden"):(this.parts.title&&(this.selection?this.parts.title.base.classList.remove("hidden"):this.has_default&&this.parts.title.default.classList.remove("hidden"),this.parts.title.temp.classList.add("hidden")),this.parts.body&&(this.selection?this.parts.body.base.classList.remove("hidden"):this.has_default&&this.parts.body.default.classList.remove("hidden"),this.parts.body.temp.classList.add("hidden")))},e.parts={},e.options.title&&(e.parts.title=a(e,e.options.title),"variables"in e.parts.title.parsed&&s.measure_name.test(e.parts.title.parsed.variables)?(e.parts.title.base=t.createElement("button"),e.parts.title.base.type="button",e.parts.title.base.setAttribute("data-bs-toggle","modal"),e.parts.title.base.setAttribute("data-bs-target","#variable_info_display"),e.parts.title.base.addEventListener("click",P.bind(e))):e.parts.title.base=t.createElement("p"),e.parts.title.base.appendChild(t.createElement("span")),e.parts.title.temp=t.createElement("p"),e.parts.title.default=t.createElement("p"),e.parts.title.temp.className=e.parts.title.base.className=e.parts.title.default.className="info-title hidden",e.has_default&&e.options.default.title&&(e.e.appendChild(e.parts.title.default),e.parts.title.default.innerText=e.options.default.title),e.parts.title.ref||(e.parts.title.base.firstElementChild.innerText=e.parts.title.get()),e.e.appendChild(e.parts.title.base),e.e.appendChild(e.parts.title.temp),e.parts.title.base.classList.add("hidden"),e.parts.title.temp.classList.add("hidden")),e.options.body){e.parts.body={base:t.createElement("div"),temp:t.createElement("div"),default:t.createElement("div"),rows:[]},e.parts.body.temp.className=e.parts.body.base.className=e.parts.body.default.className="info-body hidden",e.has_default&&e.options.default.body&&(e.parts.body.default.innerText=e.options.default.body);var n=0;e.options.body.forEach(((i,r)=>{const l={name:a(e,i.name),value:a(e,i.value)};e.parts.body.rows[r]=l,l.base=t.createElement("div"),e.parts.body.base.appendChild(l.base),l.temp=t.createElement("div"),e.parts.body.temp.appendChild(l.temp),l.temp.className=l.base.className="info-body-row-"+i.style,n+=24+("stack"===i.style?24:0),l.name&&(e.options.variable_info&&"variables"in l.name.parsed&&s.measure_name.test(l.name.parsed.variables)?(l.base.appendChild(t.createElement("button")),l.base.lastElementChild.type="button",l.base.lastElementChild.setAttribute("data-bs-toggle","modal"),l.base.lastElementChild.setAttribute("data-bs-target","#variable_info_display"),l.base.lastElementChild.addEventListener("click",P.bind(e))):l.base.appendChild(t.createElement("div")),l.temp.appendChild(t.createElement("div")),l.temp.lastElementChild.className=l.base.lastElementChild.className="info-body-row-name",l.temp.lastElementChild.innerText=l.base.lastElementChild.innerText=l.name.get()),l.value&&(l.base.appendChild(t.createElement("div")),l.temp.appendChild(t.createElement("div")),"summary"in l.value.parsed?l.base.lastElementChild.appendChild(l.value.parsed.summary):"filter"in l.value.parsed?l.base.lastElementChild.appendChild(l.value.parsed.filter):(l.temp.lastElementChild.className=l.base.lastElementChild.className="info-body-row-value"+("statement"===l.value.parsed.variables?" statement":""),l.value.ref||(l.temp.lastElementChild.innerText=l.base.lastElementChild.innerText=l.value.get())))})),e.e.style.minHeight=n+"px",e.e.appendChild(e.parts.body.base),e.e.appendChild(e.parts.body.default),e.e.appendChild(e.parts.body.temp)}e.update()},update:async function(e,a,s){const n=i.dataviews[this.view],r=x[n.time_agg];if(this.v=ie(this.options.variable||a&&(a.color||a.y)||n.y),this.dataset=n.get.dataset(),r&&!(this.dataset in i.data.meta.times))return;this.time_agg=r?r.value()-i.data.meta.times[this.dataset].range[0]:0;const l=this.v&&i.data.variables[this.v].time_range[this.dataset];this.time=l?this.time_agg-l[0]:0,this.options.show_summary&&(this.var=this.v&&await de(this.v,this.view),this.summary=this.var[this.view].summaries[this.dataset]),this.processed||(this.processed=!0,this.options.floating||(B(this.view,{type:"update",id:this.id}),n.y in x&&B(n.y,{type:"update",id:this.id}),r&&B(n.time_agg,{type:"update",id:this.id}),this.options.variable in x&&B(this.options.variable,{type:"update",id:this.id})),this.parts.body&&this.parts.body.rows.forEach((e=>{!e.value.ref&&e.value.text in x&&"variables"in e.name.parsed&&(e.name.value_source=e.value.value_source=e.value.text,e.value.ref=!0,e.value.parsed.data="")}))),e?(this.parts.title&&(this.parts.title.temp.innerText=this.parts.title.get(e,a)),this.parts.body&&this.parts.body.rows.forEach((t=>{t.name.ref&&(t.name.value_source&&(t.name.value_source=t.value.text),"object"!=typeof(V=t.name.get(e,a))&&(t.temp.firstElementChild.innerText=G(V,t.value.parsed.variables,this,e))),t.value.ref&&(t.value.value_source&&(t.value.value_source=t.value.text),"object"!=typeof(V=t.value.get(e,a))&&(t.temp.lastElementChild.innerText=G(V,t.value.parsed.variables,this,e)))}))):this.options.floating||(clearTimeout(this.queue),s?((e=i.data.entities[n.get.ids(!0)])?(this.selection=!0,this.parts.title&&(this.parts.title.value_source&&(p.title.value_source=p.value.text),this.parts.title.base.classList.remove("hidden"),this.parts.title.default.classList.add("hidden")),this.parts.body&&this.has_default&&this.parts.body.default.classList.add("hidden")):(this.selection=!1,this.parts.title&&(this.has_default?(this.parts.title.base.classList.add("hidden"),this.parts.title.default.classList.remove("hidden")):this.parts.title.ref&&"features"in this.parts.title.parsed||this.parts.title.base.classList.remove("hidden")),this.parts.body&&(this.parts.body.base.classList.add("hidden"),this.has_default&&this.parts.body.default.classList.remove("hidden"))),this.parts.title&&(this.parts.title.base.firstElementChild.innerText=this.parts.title.get(e,a)),this.parts.body&&(this.options.subto||this.parts.body.base.classList.remove("hidden"),this.parts.body.rows.forEach((s=>{if("summary"in s.value.parsed){const e=s.value.parsed.summary.lastElementChild.children;h.summary.forEach(((t,a)=>{e[a].innerText=i.data.format_value(this.summary[t][this.time],0===a)}))}else if("filter"in s.value.parsed){const e=s.value.parsed.filter;let a=0;if(e.innerHTML="",x._entity_filter.selected.length){a++;const s=t.createElement("tr");s.className="filter-display";let n=t.createElement("td");s.appendChild(n),n.appendChild(t.createElement("span")),n.lastElementChild.className="syntax-variable",n.lastElementChild.innerText="Select Entities",n=t.createElement("td"),s.appendChild(n),n.appendChild(t.createElement("span")),n.lastElementChild.className="syntax-operator",n.lastElementChild.innerText=":",n=t.createElement("td"),s.appendChild(n),n.setAttribute("colspan",2),n.appendChild(t.createElement("span")),n.lastElementChild.className="syntax-value";let r="";x._entity_filter.selected.forEach((e=>{const t=i.data.entities[e];r+=(r?", ":"")+(t&&t.features?t.features.name:e)})),n.lastElementChild.innerText=r,e.appendChild(s)}x._base_filter.c.forEach((s=>{const n=s.passed+s.failed;if(s.active&&n){const r=s.passed+"/"+n;s.e.children[1].lastElementChild.innerText=r,a++;const l=t.createElement("tr"),o=i.data.variable_info[s.variable];l.className="filter-display";let d=t.createElement("td");l.appendChild(d),d.appendChild(t.createElement("span")),d.lastElementChild.className="syntax-variable",d.lastElementChild.title=s.variable,d.lastElementChild.innerText=o.short_name,d.appendChild(t.createElement("span")),d.lastElementChild.innerText=" (",d.appendChild(t.createElement("span")),d.lastElementChild.className="syntax-component",d.lastElementChild.innerText=s.component,d.appendChild(t.createElement("span")),d.lastElementChild.innerText=")",d=t.createElement("td"),l.appendChild(d),d.appendChild(t.createElement("span")),d.lastElementChild.className="syntax-operator",d.lastElementChild.innerText=s.operator,d=t.createElement("td"),l.appendChild(d),d.appendChild(t.createElement("span")),d.lastElementChild.className="syntax-value",d.lastElementChild.innerText=s.value,d=t.createElement("td"),l.appendChild(d),d.appendChild(t.createElement("span")),d.lastElementChild.innerText="("+r+")",e.appendChild(l)}})),this.e.style.display=a?"":"none"}if(!("variables"in s.value.parsed)&&!("summary"in s.value.parsed)||n.y in this.depends?"filter"in s.value.parsed&&!("_base_filter"in this.depends)&&(this.depends._base_filter=!0,B("_base_filter",{type:"update",id:this.id})):(this.depends[n.y]=!0,B(n.y,{type:"update",id:this.id})),s.name.ref){s.name.value_source&&(s.name.value_source=s.value.text);const t=s.name.get(e,a);"object"!=typeof t&&(s.base.firstElementChild.innerText=t)}if(s.value.ref){const i=s.value.get(e,a);"object"==typeof i?Array.isArray(i)&&"sources"===s.value.parsed.variables&&(s.base.innerHTML="",s.base.appendChild(t.createElement("table")),s.base.lastElementChild.className="source-table",s.base.firstElementChild.appendChild(t.createElement("thead")),s.base.firstElementChild.firstElementChild.appendChild(t.createElement("tr")),s.base.firstElementChild.firstElementChild.firstElementChild.appendChild(t.createElement("th")),s.base.firstElementChild.firstElementChild.firstElementChild.appendChild(t.createElement("th")),s.base.firstElementChild.firstElementChild.firstElementChild.firstElementChild.innerText="Source",s.base.firstElementChild.firstElementChild.firstElementChild.lastElementChild.innerText="Accessed",s.base.firstElementChild.appendChild(t.createElement("tbody")),i.forEach((e=>{s.base.firstElementChild.lastElementChild.appendChild(z(e,!0))}))):s.base.lastElementChild.innerText=G(i,s.value.parsed.variables,this,e)}})))):this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(void 0,void 0,!0)),50))),this.revert()}},datatable:{init:function(e){e.e.appendChild(t.createElement("tHead")),e.e.appendChild(t.createElement("tBody")),e.click=e.e.getAttribute("click"),e.features=e.options.features,e.parsed={summary:{},order:[],time:0,color:"",dataset:x[e.view].get.dataset()},e.header=[],e.rows={},e.rowIds={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0;const a=i.data.meta.times[e.parsed.dataset];if(e.tab&&t.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){e.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(W,155))}.bind(e)),e.e.addEventListener("mouseover",l.datatable.mouseover.bind(e)),e.e.addEventListener("mouseout",l.datatable.mouseout.bind(e)),e.click&&(e.click in x&&(e.clickto=x[e.click]),e.e.addEventListener("click",l.datatable.click.bind(e))),e.show=function(e){if(e.features&&e.features.id in this.rows){const t=this.rows[e.features.id].node();if(t&&(t.style.backgroundColor=b.background_highlight,i.settings.table_autoscroll)){const e=this.e.parentElement.getBoundingClientRect().height,a=t.getBoundingClientRect().y-this.e.getBoundingClientRect().y;this.e.parentElement.scroll({top:e>this.e.scrollHeight-a?this.e.parentElement.scrollHeight:a,behavior:i.settings.table_scroll_behavior||"smooth"})}}},e.revert=function(e){if(e.features&&e.features.id in this.rows){const t=this.rows[e.features.id].node();t&&(t.style.backgroundColor="inherit")}},e.options.variable_source=e.options.variables,e.options.variables?"string"==typeof e.options.variables&&(e.options.variables in x?(B(e.options.variables,{type:"update",id:e.id}),e.options.variables=ie(e.options.variables),e.options.single_variable="string"==typeof e.options.variables):e.options.single_variable||(e.options.single_variable=[{name:e.options.single_variable}])):e.options.variables=Object.keys(i.data.variables),"string"!=typeof e.options.variables&&e.options.variables.length&&"string"===e.options.variables[0]&&(e.options.variables=e.options.variables.map((e=>{}))),e.options.single_variable){const t=e.options.variables,s=t.name||t;e.header.push({title:"Name",data:"entity.features.name"}),a&&a.is_single&&(e.variable_header=!0);const n=i.data.variables[s].time_range[e.parsed.dataset];if(n)for(let r=n[1]-n[0]+1;r--;)e.header[r+1]={title:e.variable_header?t.title||i.data.format_label(s):a.value[r+n[0]]+"",data:i.data.retrievers.vector,render:i.data.retrievers.row_time.bind({i:r,o:n[0],format_value:i.data.format_value.bind(i.data)})};e.options.order=[[e.header.length-1,"dsc"]]}else if(e.options.wide){e.features&&("string"==typeof e.features&&(e.features=[{name:e.features}]),e.features.forEach((t=>{e.header.push({title:t.title||t.name,data:"entity.features."+t.name.replace(s.all_periods,"\\.")})})));for(let t=e.options.variables.length;t--;){"string"==typeof e.options.variables[t]&&(e.options.variables[t]={name:e.options.variables[t]});const a=e.options.variables[t];a.source||(a.source=a.name in i.data.variables?"data":"features"),e.header.push("features"===a.source?{title:a.title||i.data.format_label(a.name),data:"entity.features."+a.name.toLowerCase().replace(s.all_periods,"\\.")}:{title:a.title||i.data.format_label(a.name),render:async function(e,t,a){if("data"===this.c.source){if(this.c.name in i.data.variables){const e=a.time-await de(this.c.name,this.view).time_range[this.o.parsed.dataset][0];return e<0?NaN:a.entity.get_value(this.c.name,e)}return NaN}return this.c.source in a.entity&&this.c.name in a.entity[this.c.source]?a.entity[this.c.source][this.c.name]:NaN}.bind({o:e,c:a})})}}else e.filters=e.options.filters,e.current_filter={},a.is_single||e.header.push({title:"Year",data:"entity.time.value",render:function(e,t,a){const s=a.time+a.offset;return e&&s>=0&&s<e.length?"number"==typeof e[s]?i.data.format_value(e[s],!0):e[s]:NaN}}),e.features&&("string"==typeof e.features&&(e.features=[{name:e.features}]),e.features.forEach((t=>{e.header.splice(0,0,{title:t.title||t.name,data:"entity.features."+t.name.replace(s.all_periods,"\\.")})}))),e.header.push({title:"Variable",data:function(e){return e.variable in e.entity.variables?e.entity.variables[e.variable].meta.short_name:e.variable}}),e.header.push({title:"Value",data:i.data.retrievers.vector,render:function(e,t,a){return e?"number"==typeof e[a.time]?i.data.format_value(e[a.time],a.int):e[a.time]:""}});e.view?(B(e.view,{type:"update",id:e.id}),B(e.view+"_filter",{type:"update",id:e.id})):e.view=b.dataview,be.bind(e)()},update:async function(e){if(clearTimeout(this.queue),e){if(this.table){var t=this.options.variable_source&&ie(this.options.variable_source).replace(s.all_periods,"\\.");const a=x[this.view],n=a.get.dataset(),r=n+a.value()+a.get.time_filters()+i.settings.digits+t;if(!i.data.inited[n])return;if(r!==this.state){this.rows={},this.rowIds={},this.table.clear();let l=!0;if(a.selection){if(this.state=r,Object.keys(this.reference_options).forEach((e=>this.options[e]=ie(this.reference_options[e]))),this.options.single_variable){const e=ie(a.time_agg),s=await de(t,this.view);if(this.parsed.dataset=n,this.parsed.color=t,this.parsed.time_range=s.time_range[n],this.parsed.time=("number"==typeof e?e-i.data.meta.times[n].range[0]:0)-this.parsed.time_range[0],this.parsed.summary=this.view in s&&s[this.view].summaries[n],this.parsed.order=this.view in s&&s[this.view].order[n][this.parsed.time],this.header.length<2||n!==this.header[1].dataset||t!==this.header[1].variable){if(this.table.destroy(),$(this.e).empty(),this.header=[{title:"Name",data:"entity.features.name"}],-1!==this.parsed.time_range[0])for(let e=this.parsed.time_range[2];e--;)this.header[e+1]={dataset:n,variable:t,title:this.variable_header?this.options.variables.title||i.data.format_label(t):i.data.meta.times[n].value[e+this.parsed.time_range[0]]+"",data:i.data.retrievers.vector,render:i.data.retrievers.row_time.bind({i:e,o:this.parsed.time_range[0],format_value:i.data.format_value.bind(i.data)})};else this.state="";this.options.order[0][0]=this.header.length-1,this.options.columns=this.header,this.table=$(this.e).DataTable(this.options)}const r=this.header.length;let l;for(let e=1;e<r;e++)this.table.column(e).visible(a.times[e-1+this.parsed.time_range[0]],!1),a.times[e-1+this.parsed.time_range[0]]&&(l=!1);l&&(this.state="")}if(this.options.wide)Object.keys(a.selection.all).forEach((e=>{if(t)t in a.selection.all[e][this.view].summary&&(this.rows[e]=this.table.row.add({dataset:n,variable:t,offset:this.parsed.time_range[0],entity:a.selection.all[e],int:s.int_types.test(i.data.variable_info[t].type)}),this.rowIds[this.rows[e].selector.rows]=e);else for(let t=i.data.meta.times[n].n;t--;)this.rows[e]=this.table.row.add({time:t,entity:a.selection.all[e]}),this.rowIds[this.rows[e].selector.rows]=e}));else{Object.keys(this.filters).forEach((e=>{this.current_filter[Q]=ie(e)}));const r=[];let l=""+this.parsed.dataset+a.get.ids(!0)+a.get.features()+i.settings.digits;for(let a=this.options.variables.length;a--;){if(t=this.options.variables[a].name||this.options.variables[a],e=!1,t in i.data.variables&&"meta"in variable)if(this.options.filters){for(const t in this.current_filter)if(t in variable.meta&&(e=variable.meta[t]===this.current_filter[t],!e))break}else e=!0;e&&(l+=t,r.push({variable:t,int:s.int_types.test(i.data.variable_info[t].type),time_range:variable.time_range[n],renderer:function(e,t){const i=t.features.id,a=this.time_range,s=a[1];for(let r=a[0];r<=s;r++)e.rows[i]=e.table.row.add({offset:this.time_range[0],time:r-this.time_range[0],dataset:n,variable:this.variable,entity:t,int:this.int}),e.rowIds[e.rows[i].selector.rows]=i}}))}if(l===this.varstate)return;this.varstate=l,Object.keys(a.selection.all).forEach((e=>{const l=a.selection.all[e];this.options.single_variable?t in l[a].summary&&variable.code in l.data&&(this.rows[e]=this.table.row.add({offset:this.parsed.time_range[0],dataset:n,variable:t,entity:l,int:s.int_types.test(i.data.variable_info[t].type)}),this.rowIds[this.rows[e].selector.rows]=e):r.forEach((e=>{i.data.variables[e.variable].code in l.data&&e.renderer(this,l)}))}))}}l?this.table.draw():this.table.columns.adjust().draw(!1)}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))},mouseover:function(e){if(e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row],a=this.rows[t].node();a&&(a.style.backgroundColor=b.background_highlight),t in i.data.entities&&R(this.id,"show",i.data.entities[t])}},mouseout:function(e){if(e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row],a=this.rows[t].node();a&&(a.style.backgroundColor="inherit"),t in i.data.entities&&R(this.id,"revert",i.data.entities[t])}},click:function(e){if(this.clickto&&e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row];t in i.data.entities&&this.clickto.set(t)}}},legend:{init:function(e){B(e.view,{type:"update",id:e.id});const a=x[e.view];if(a.time_agg in x&&B(a.time_agg,{type:"update",id:e.id}),e.palette||(a.palette?(e.palette=a.palette,a.palette in x&&B(a.palette,{type:"update",id:e.id})):e.palette="settings.palette"in x?"settings.palette":i.settings.palette),e.variable=e.e.getAttribute("variable"),e.variable?e.variable in x&&B(e.variable,{type:"update",id:e.id}):a.y in x&&B(a.y,{type:"update",id:e.id}),e.palette in x){const t=x[e.palette];t.e&&t.e.addEventListener("change",e.update)}e.parsed={summary:{},order:[],selection:{},time:0,color:"",rank:!1},e.state="",e.queue={lock:!1,cooldown:-1,trigger:function(){this.mouseover(this.queue.e)}.bind(e)},e.queue.reset=function(){this.lock=!1}.bind(e.queue),e.parts={ticks:e.e.querySelector(".legend-ticks"),scale:e.e.querySelector(".legend-scale"),summary:e.e.querySelector(".legend-summary")},e.parts.ticks.setAttribute("of",e.id),e.parts.scale.setAttribute("of",e.id),e.parts.summary.setAttribute("of",e.id),e.mouseover=l.legend.mouseover.bind(e),e.e.addEventListener("mousemove",e.mouseover),e.e.addEventListener("mouseout",l.legend.mouseout.bind(e)),e.e.addEventListener("click",l.legend.click.bind(e)),e.click=e.e.getAttribute("click"),e.click in x&&(e.clickto=x[e.click]),e.ticks={center:e.parts.summary.appendChild(t.createElement("div")),min:e.parts.summary.appendChild(t.createElement("div")),max:e.parts.summary.appendChild(t.createElement("div")),entity:e.parts.ticks.appendChild(t.createElement("div"))},Object.keys(e.ticks).forEach((i=>{e.ticks[i].setAttribute("of",e.id),e.ticks[i].className="legend-tick",e.ticks[i].appendChild(V=t.createElement("div")),V.setAttribute("of",e.id),V.appendChild(t.createElement("p")),V.lastElementChild.setAttribute("of",e.id),"m"!==i.substring(0,1)&&(V.appendChild(t.createElement("p")),V.lastElementChild.setAttribute("of",e.id),V.appendChild(t.createElement("p")),V.lastElementChild.setAttribute("of",e.id),"entity"===i?e.ticks[i].firstElementChild.lastElementChild.classList.add("entity"):e.ticks[i].firstElementChild.firstElementChild.classList.add("summary"))})),e.ticks.entity.firstElementChild.classList.add("hidden"),e.ticks.max.className="legend-tick-end max",e.ticks.min.className="legend-tick-end min",e.ticks.center.style.left="50%",e.show=function(e,t){if(e&&"parsed"in t&&e.features.name){const a=x[this.view],s=t.parsed.summary,n=s&&"levels"in s,r=s&&!n?s.min[t.parsed.time]:0,l=s?n?s.levels.length-r:s.range[t.parsed.time]:1,o=s.n[t.parsed.time],d=o===a.n_selected.dataset?"rank":"subset_rank",c=i.data.entities[e.features.id][this.view],h=e.get_value(t.parsed.color,t.parsed.time),p=100*((n?h in s.level_ids:"number"==typeof h)?i.settings.color_by_order?NaN:Math.max(0,Math.min(1,l?((n?s.level_ids[h]:h)-r)/l:.5)):NaN),m=this.ticks.entity,u=m.firstElementChild.children[1];if(isFinite(p))u.parentElement.classList.remove("hidden"),u.innerText=i.data.format_value(h,this.integer),m.style.left=p+"%",m.firstElementChild.firstElementChild.innerText=(p>96||p<4)&&e.features.name.length>13?e.features.name.substring(0,12)+"…":e.features.name;else if(i.settings.color_by_order&&t.parsed.color in c[d]){const i=c[d][t.parsed.color][t.parsed.time],a=o>1?i/(o-1)*100:0;m.firstElementChild.firstElementChild.innerText=i>-1&&(a>96||a<4)&&e.features.name.length>13?e.features.name.substring(0,12)+"…":e.features.name,i>-1&&(u.parentElement.classList.remove("hidden"),u.innerText="# "+(o-i),m.style.left=a+"%")}m.style.marginLeft=-m.getBoundingClientRect().width/2+"px"}},e.revert=function(){this.ticks.entity.firstElementChild.classList.add("hidden")},e.update()},update:async function(){const e=x[this.view],n=ie(this.variable||e.y),r=e.get.dataset(),l=await de(n,this.view),o=ie(e.time_agg);if(null!==o&&e.valid&&l&&this.view in l){const e=("number"==typeof o?o-i.data.meta.times[r].range[0]:0)-l.time_range[r][0],p=l[this.view].summaries[r],m=ie(this.palette).toLowerCase(),u=m in a?m:i.settings.palette in a?i.settings.palette:b.palette,f=a[u].colors,v=this.parts.scale,g=this.ticks;if(this.parsed.summary=p,this.parsed.order=l[this.view].order[r][e],this.parsed.time=e,this.parsed.color=n,p&&e<p.n.length){this.integer=!i.data.variable_info[n]||!i.data.variable_info[n].type||s.int_types.test(i.data.variable_info[n].type);const r=i.settings.color_by_order!==this.parsed.rank,o=f.length!==v.childElementCount;if(u+i.settings.color_scale_center!==this.current_palette||r)if(this.current_palette=u+i.settings.color_scale_center,this.parsed.rank=i.settings.color_by_order,o&&(v.innerHTML=""),"discrete"===a[u].type)if(i.settings.color_by_order)f.forEach(o?e=>{v.appendChild(t.createElement("span")),v.lastElementChild.setAttribute("of",this.id),v.lastElementChild.style.backgroundColor=e}:(e,t)=>{v.children[t].style.backgroundColor=e});else{var d,c=0,h=Math.ceil(f.length/2);if(o){for(v.appendChild(d=t.createElement("div")),d.setAttribute("of",this.id),d.style.left=0;c<h;c++)d.appendChild(t.createElement("span")),d.lastElementChild.setAttribute("of",this.id),d.lastElementChild.style.backgroundColor=f[c];for(v.appendChild(d=t.createElement("div")),d.setAttribute("of",this.id),d.style.right=0,c=Math.floor(f.length/2),h=f.length;c<h;c++)d.appendChild(t.createElement("span")),d.lastElementChild.setAttribute("of",this.id),d.lastElementChild.style.backgroundColor=f[c]}else{for(d=v.children;c<h;c++)d[c].style.backgroundColor=f[c];for(c=Math.floor(f.length/2),h=f.length;c<h;c++)d[c].style.backgroundColor=f[c]}}else o&&(v.appendChild(t.createElement("span")),v.appendChild(t.createElement("span"))),v.firstElementChild.style.background="linear-gradient(0.25turn, rgb("+f[2][0][0]+", "+f[2][0][1]+", "+f[2][0][2]+"), rgb("+f[1][0]+", "+f[1][1]+", "+f[1][2]+"))",v.lastElementChild.style.background="linear-gradient(0.25turn, rgb("+f[1][0]+", "+f[1][1]+", "+f[1][2]+"), rgb("+f[0][0][0]+", "+f[0][0][1]+", "+f[0][0][2]+"))";if(l.levels)g.center.classList.remove("hidden"),g.min.firstElementChild.firstElementChild.innerText=l.levels[0],g.max.firstElementChild.firstElementChild.innerText=l.levels[l.levels.length-1];else if(i.settings.color_by_order)g.center.classList.add("hidden"),g.min.firstElementChild.firstElementChild.innerText="# "+(p.n[e]?p.n[e]:0),g.max.firstElementChild.firstElementChild.innerText="# "+(p.n[e]?1:0);else{const t=""+p.n[e]+p.min[e]+p.max[e]+i.settings.digits+i.settings.color_scale_center+i.settings.summary_selection;(o||r||t!==this.state)&&(this.state=t,g.center.classList.remove("hidden"),g.min.firstElementChild.firstElementChild.innerText=p.n[e]&&isFinite(p.min[e])?i.data.format_value(p.min[e],this.integer):"unknown",g.max.firstElementChild.firstElementChild.innerText=p.n[e]&&isFinite(p.max[e])?i.data.format_value(p.max[e],this.integer):"unknown","none"!==i.settings.color_scale_center?(g.center.firstElementChild.lastElementChild.innerText=_[i.settings.summary_selection]+" "+i.settings.color_scale_center,g.center.firstElementChild.children[1].innerText=i.data.format_value(p[i.settings.color_scale_center][e]),g.center.style.left=100*p["norm_"+i.settings.color_scale_center][e]+"%"):(g.center.firstElementChild.lastElementChild.innerText=_[i.settings.summary_selection]+" median",g.center.firstElementChild.children[1].innerText=i.data.format_value(p.median[e]),g.center.style.left=100*p.norm_median[e]+"%"),2===v.childElementCount&&("none"===i.settings.color_scale_center?(v.firstElementChild.style.width="50%",v.lastElementChild.style.width="50%"):(v.firstElementChild.style.width=100*p["norm_"+i.settings.color_scale_center][e]+"%",v.lastElementChild.style.width=100-100*p["norm_"+i.settings.color_scale_center][e]+"%")),g.center.style.marginLeft=-g.center.getBoundingClientRect().width/2+"px")}}}},mouseover:function(e){if(this.queue.lock)clearTimeout(this.queue.cooldown),this.queue.e=e,this.queue.cooldown=setTimeout(this.queue.trigger,100);else{this.queue.lock=!0;const s=this.parts.scale.getBoundingClientRect(),n=(Math.max(s.x,Math.min(s.x+s.width,e.clientX))-s.x)/s.width;let r=!1;if(i.settings.color_by_order)this.parsed.order&&this.parsed.order.length&&(r=i.data.entities[this.parsed.order[Math.max(this.parsed.summary.missing[this.parsed.time],Math.min(this.parsed.order.length-1,Math.floor((this.parsed.order.length-1)*n)))][0]]);else if("min"in this.parsed.summary){const e=this.parsed.summary.min[this.parsed.time],s=e+n*(this.parsed.summary.max[this.parsed.time]-e);var t,a;if(this.parsed.order&&this.parsed.order.length&&(a=this.parsed.summary.missing[this.parsed.time])<this.parsed.order.length)if(1!==this.parsed.order.length&&n){for(t=this.parsed.order.length-2;t>=a&&!((this.parsed.order[t][1]+this.parsed.order[t+1][1])/2<=s);--t);t++,r=i.data.entities[this.parsed.order[t][0]]}else r=i.data.entities[this.parsed.order[a][0]]}r&&(this.show(r,this),this.entity&&r.features.id===this.entity.features.id||(this.entity?R(this.id,"revert",this.entity):this.entity=r,R(this.id,"show",r),this.entity=r)),setTimeout(this.queue.reset,200)}},mouseout:function(e){e.relatedTarget&&this.id!==e.relatedTarget.getAttribute("of")&&(clearTimeout(this.queue.cooldown),this.revert(),this.entity&&(R(this.id,"revert",this.entity),this.entity=!1))},click:function(){this.clickto&&this.entity&&(this.revert(),this.clickto.set(this.entity.features.id))}},credits:{init:function(e){const a=i.credit_output&&i.credit_output[e.id];e.exclude=a&&a.exclude||[],e.add=a&&a.add||{},e.e.appendChild(t.createElement("ul")),e.credits={...i.credits,...e.add},Object.keys(e.credits).forEach((i=>{if(-1===e.exclude.indexOf(i)){const s=e.credits[i];var a;e.e.lastElementChild.appendChild(a=t.createElement("li")),"url"in s&&(a.appendChild(a=t.createElement("a")),a.href=s.url,a.target="_blank",a.rel="noreferrer"),a.innerText=s.name,"version"in s&&(a.appendChild(t.createElement("span")),a.lastElementChild.className="version-tag",a.lastElementChild.innerText=s.version),"description"in s&&(a.parentElement.appendChild(t.createElement("p")),a.parentElement.lastElementChild.innerText=s.description)}}))}},init_input:function(e){const t={type:e.getAttribute("auto-type"),source:void 0,value:function(){const e=ie(this.source);return void 0===e?ie(this.default):e},default:e.getAttribute("default"),options_source:e.getAttribute("auto-options"),depends:e.getAttribute("depends"),variable:e.getAttribute("variable"),dataset:e.getAttribute("dataset"),view:e.getAttribute("data-view"),id:e.id||e.options_source||"ui"+u.elementCount++,note:e.getAttribute("aria-description")||"",current_index:-1,previous:"",e:e,values:[],display:[],data:[],input:!0};if(t.settings=t.type in i&&t.id in i[t.type]?i[t.type][t.id]:{},t.wrapper=t.e.parentElement.classList.contains("wrapper")?t.e.parentElement:t.e.parentElement.parentElement,t.wrapper&&(t.note&&t.wrapper.classList.add("has-note"),t.wrapper.setAttribute("of",t.id),["div","span","label","fieldset","legend","input","button"].forEach((e=>{const i=t.wrapper.querySelectorAll(e);i.length&&i.forEach((e=>e.setAttribute("of",t.id)))}))),t.note){t.wrapper.addEventListener("mouseover",ae.bind(t));const e="DIV"!==t.e.tagName?t.e:t.e.querySelector("input");e&&(e.addEventListener("focus",ae.bind(t)),e.addEventListener("blur",se))}if(s.number.test(t.default)&&(t.default=Number(t.default)),t.type in l){const e=l[t.type];e.setter&&(t.set=e.setter.bind(t),t.reset=function(){this.set(ie(this.default))}.bind(t)),e.retrieve&&(t.get=e.retrieve.bind(t)),e.adder&&(t.add=e.adder.bind(t)),e.listener&&(t.listen=e.listener.bind(t)),e.init&&e.init(t),t.options=t.e.querySelectorAll("select"===t.type?"option":"combobox"===t.type?".combobox-option":"input"),x[t.id]=t}},init_output:function(e,t){const a={type:e.getAttribute("auto-type"),view:e.getAttribute("data-view")||b.dataview,id:e.id||"out"+t,note:e.getAttribute("aria-description")||"",reference_options:{},e:e};a.note&&a.e.addEventListener("mouseover",ae.bind(a)),a.options=a.type in i?i[a.type][a.id]:void 0,a.options&&a.options.dataview&&(a.view=a.options.dataview),a.type in l&&"update"in l[a.type]&&(a.update=l[a.type].update.bind(a)),a.options&&("options"in a.options&&(a.options=a.options.options),Object.keys(a.options).forEach((e=>{a.options[e]in x&&(a.reference_options[e]=a.options[e])})),"subto"in a.options&&("string"==typeof a.options.subto&&(a.options.subto=[a.options.subto]),Array.isArray(a.options.subto)&&a.options.subto.forEach((e=>I(e,a))))),x[a.id]=a,a.type in l&&"init"in l[a.type]&&(!a.view||x[a.view].parsed.dataset in i.data.inited?l[a.type].init(a):(i.data.data_queue[x[a.view].parsed.dataset][a.id]=l[a.type].init.bind(null,a),i.data.loaded[x[a.view].parsed.dataset]&&i.data.load_id_maps()))}},o={percent:function(e){return e+"%"},"drive time":function(e){return e+" minutes"},minutes:function(e){return e+" minutes"},dollar:function(e){return"$"+e},"internet speed":function(e){return e+" MB/s"}},d={name:e.location.pathname||"default",perm:e.localStorage||{setItem:function(){},getItem:function(){},removeItem:function(){}},set:function(e,t){const i=JSON.parse(this.perm.getItem(this.name))||{};i[e]=t,this.perm.setItem(this.name,JSON.stringify(i))},get:function(e){const t=JSON.parse(this.perm.getItem(this.name));return t?e?t[e]:t:void 0}},c={Enter:"select",NumpadEnter:"select",ArrowUp:"move",Home:"move",ArrowDown:"move",End:"move",Escape:"close",Tab:"close"},h={Time:["first","selected","last"],summary:["missing","min","q1","mean","median","q3","max"]},m={number:function(e,t){return e.get_value(t.name,this-t.range[0])},first:function(e,t){return e.get_value(t.name,0)},selected:function(e,t,i){return e.get_value(t.name,i.time_agg-t.range[0])},last:function(e,t){return e.get_value(t.name,t.range[1]-t.range[0])}},u={load_screen:t.getElementById("load_screen"),wrap:t.getElementById("site_wrap"),navbar:t.querySelector(".navbar"),content:t.querySelector(".content"),overlay:t.createElement("div"),menus:t.getElementsByClassName("menu-wrapper"),panels:t.getElementsByClassName("panel"),elementCount:0},f={_timeout:0},b={time:"time",dataview:"default_view",palette:"vik",background_highlight:"#adadad",border:"#7e7e7e",border_highlight_true:"#ffffff",border_highlight_false:"#000000",missing:"#00000000"},_={dataset:"Overall",filtered:"Filtered",children:"Unfiltered selection",all:"Selection"},v={retain_state:!0},g={},y={},E={},x={_entity_filter:{id:"_entity_filter",registered:{},entities:new Map,selected:[],select_ids:{},value:function(e,t){return Object.keys(this.select_ids).join(",")}},_base_filter:{id:"_base_filter",c:new Map,value:function(e,t){const a=!e;return a&&(e=[]),x._base_filter.c.forEach((s=>{const n=Number(s.value),r="selected"===s.component?i.data.meta.overall.value[t]:s.time_component?i.data.meta.overall.value[s.component]:s.component;isNaN(n)||e.push(s.variable+"["+r+"]"+s.operator+n+(a?s.active:""))})),e.join("&")}}},C={},w={};if(u.overlay.className="content-overlay",t.body.appendChild(u.overlay),t.body.className=d.get("theme_dark")||i.settings.theme_dark?"dark-theme":"light-theme",u.content){for(var k=u.menus.length,T=u.navbar?u.navbar.getBoundingClientRect().height:0;k--;)if(u.menus[k].classList.contains("menu-top")){T=u.menus[k].getBoundingClientRect().height;break}u.content.style.top=T+"px"}function N(e,t,n,r,l,o){if(isNaN(e))return b.missing;const d="none"!==i.settings.color_scale_center&&!i.settings.color_by_order,c="discrete"===a[t].type,h=a[t].colors,p=a[t].odd,m="levels"in n,u=m?0:n.min[r],f=m?n.levels.length-u:n.range[r],_="none"===i.settings.color_scale_center||s.median.test(i.settings.color_scale_center)?"median":"mean",v=i.settings.color_by_order?d?n["break_"+_][r]/o:.5:isNaN(n["norm_"+_][r])?.5:n["norm_"+_][r],g=c?d&&!i.settings.color_by_order?Math.ceil(h.length/2):h.length:1,y=i.settings.color_by_order?l/o:f?((m?n.level_ids[e]:e)-u)/f:.5,E=y>(d?v:.5);var x=d?f?E?(y-v-n["upper_"+_+"_min"][r])/n["upper_"+_+"_range"][r]:(y+v-n["lower_"+_+"_min"][r])/n["lower_"+_+"_range"][r]:1:y;return c||(x=Math.max(0,Math.min(1,x)),E&&(x=1-x),d||(x*=2)),(m?e in n.level_ids:"number"==typeof e)?c?h[Math.max(0,Math.min(h.length-1,Math.floor(d&&E?g-p+g*x:g*x)))]:"rgb("+(E?h[0][0][0]+x*h[0][1][0]+", "+(h[0][0][1]+x*h[0][1][1])+", "+(h[0][0][2]+x*h[0][1][2]):h[2][0][0]+x*h[2][1][0]+", "+(h[2][0][1]+x*h[2][1][1])+", "+(h[2][0][2]+x*h[2][1][2]))+")":b.missing}function A(e,i){if("button"in i||(i.button={}),"string"==typeof i.text&&(i.text=[i.text]),i.parts=t.createElement("span"),i.text.forEach((a=>{if(a in i.button){const s=i.button[a];if(i.parts.appendChild(t.createElement("button")),i.parts.lastElementChild.type="button",s.trigger=ae.bind({id:e.id+s.text,note:s.target,wrapper:i.parts.lastElementChild}),"note"===s.type)i.parts.lastElementChild.setAttribute("aria-description",s.target),i.parts.lastElementChild.setAttribute("of",e.id+s.text),i.parts.lastElementChild.className="has-note",i.parts.lastElementChild.addEventListener("mouseover",s.trigger),i.parts.lastElementChild.addEventListener("focus",s.trigger),i.parts.lastElementChild.addEventListener("blur",se);else{i.parts.lastElementChild.className="btn btn-link";const e=x[s.target];e&&"function"==typeof e[s.type]&&(i.parts.lastElementChild.setAttribute("aria-label",s.text.join("")),i.parts.lastElementChild.addEventListener("click",e[s.type]))}}else i.parts.appendChild(t.createElement("span"));a in x&&e.depends.set(a,{id:a,u:x[a],parsed:""})})),"condition"in i)for(let t=i.condition.length;t--;){const a=i.condition[t];a.id&&("default"===a.id?a.check=function(){return!0}:(e.depends.set(a.id,a),a.check=function(){return"default"===this.id||DataHandler.prototype.checks[this.type](ie(this.id),ie(this.value))}.bind(a)))}}function O(e,a,n,r){if(!(a in i.data.sets))return i.data.data_queue[a][e.id]=function(){return O(e,a,n,r)},void(i.data.loaded[a]&&i.data.load_id_maps());n[a]={options:[],values:{},display:{}};const l=e.values,o=n[a].options,d=n[a].values,c=n[a].display,h="combobox"===e.type;var p=!e.sensitive&&!!e.current_set,m=0;e.settings.group&&(e.groups={e:[],by_name:{}},h&&e.settings.accordion&&(e.listbox.classList.add("accordion"),e.listbox.id=e.id+"-listbox")),Object.keys(i.data.entities).forEach((n=>{const r=i.data.entities[n];if(a===r.group)if(p&&!(n in l)&&(e.sensitive=!0,p=!1),e.groups){const i=r.features[e.settings.group]||"";if(!(i in e.groups.by_name)){const a=t.createElement(h?"div":"optgroup");if(h){const n=e.id+"_"+i.replace(s.seps,"-");let r;e.settings.accordion?(a.setAttribute("group",i),a.className="combobox-group accordion-item combobox-component",a.appendChild(r=t.createElement("div")),r.id=n+"-label",r.className="accordion-header combobox-component",r.appendChild(r=t.createElement("button")),r.innerText=i,r.type="button",r.className="accordion-button combobox-component collapsed",r.setAttribute("data-bs-toggle","collapse"),r.setAttribute("data-bs-target","#"+n),r.setAttribute("aria-expanded",!1),r.setAttribute("aria-controls",n),a.appendChild(r=t.createElement("div")),r.id=n,r.className="combobox-component accordion-collapse collapse",r.setAttribute("aria-labelledby",n+"-label"),r.setAttribute("data-bs-parent","#"+e.id+"-listbox"),r.appendChild(r=t.createElement("div")),r.className="accordion-body combobox-component"):(a.className="combobox-group combobox-component",a.role="group",a.setAttribute("aria-labelledby",n),a.appendChild(r=t.createElement("div")),r.appendChild(r=t.createElement("label")),r.innerText=i,r.id=n,r.className="combobox-group-label combobox-component")}else a.label=i;e.groups.by_name[i]=a,e.groups.e.push(a)}const a=e.add(n,r.features.name,!0);a.setAttribute("group",i),h&&e.settings.accordion?e.groups.by_name[i].lastElementChild.lastElementChild.appendChild(a):e.groups.by_name[i].appendChild(a)}else o.push(e.add(n,r.features.name)),d[n]=m,c[r.features.name]=m++})),e.settings.group&&(m=0,Object.keys(e.groups.by_name).forEach((t=>{e.groups.by_name[t].querySelectorAll(h?".combobox-option":"option").forEach((e=>{o.push(e),d[e.value]=m,c[e.innerText]=m++}))}))),r&&r()}function q(e,a,n){n[a]={options:[],values:{},display:{}};const r=e.values,l=n[a].options,o=n[a].values,d=n[a].display,c="combobox"===e.type;var h=!e.sensitive&&!!e.current_set,p=0;e.settings.group&&(e.groups={e:[],by_name:{}},c&&e.settings.accordion&&(e.listbox.classList.add("accordion"),e.listbox.id=e.id+"-listbox"));const m=i.url_options[e.id];let u=!1;m&&!(m in i.data.variables)&&(i.url_options[e.id]=m.replace(s.pre_colon,""),i.url_options[e.id]in i.data.variables||(u=!0)),i.metadata.info[a].schema.fields.forEach((a=>{const n=i.data.variables[a.name];if(n&&!n.is_time){const n=i.data.format_label(a.name);if(h&&!(J in r)&&(e.sensitive=!0,h=!1),e.groups){const i=a.info[e.settings.group]||"";if(!(i in e.groups.by_name)){const a=t.createElement(c?"div":"optgroup");if(c){const n=e.id+"_"+i.replace(s.seps,"-");let r;e.settings.accordion?(a.setAttribute("group",i),a.className="combobox-group accordion-item combobox-component",a.appendChild(r=t.createElement("div")),r.id=n+"-label",r.className="accordion-header combobox-component",r.appendChild(r=t.createElement("button")),r.innerText=i,r.type="button",r.className="accordion-button combobox-component collapsed",r.setAttribute("data-bs-toggle","collapse"),r.setAttribute("data-bs-target","#"+n),r.setAttribute("aria-expanded",!1),r.setAttribute("aria-controls",n),a.appendChild(r=t.createElement("div")),r.id=n,r.className="combobox-component accordion-collapse collapse",r.setAttribute("aria-labelledby",n+"-label"),r.setAttribute("data-bs-parent","#"+e.id+"-listbox"),r.appendChild(r=t.createElement("div")),r.className="accordion-body combobox-component"):(a.className="combobox-group combobox-component",a.role="group",a.setAttribute("aria-labelledby",n),a.appendChild(r=t.createElement("div")),r.appendChild(r=t.createElement("label")),r.innerText=i,r.id=n,r.className="combobox-group-label combobox-component")}else a.label=i;e.groups.by_name[i]=a,e.groups.e.push(a)}const r=e.add(a.name,n,!0,a);r.setAttribute("group",i),c&&e.settings.accordion?e.groups.by_name[i].lastElementChild.lastElementChild.appendChild(r):e.groups.by_name[i].appendChild(r)}else l.push(e.add(a.name,n,!0,a)),l[p].id=e.id+"-option"+p,o[a.name]=p,d[n]=p++;u&&m===a.name.replace(s.pre_colon,"")&&(i.url_options[e.id]=a.name,u=!1)}})),e.settings.group&&(p=0,Object.keys(e.groups.by_name).forEach((t=>{e.groups.by_name[t].querySelectorAll(c?".combobox-option":"option").forEach((t=>{l.push(t),l[p].id=e.id+"-option"+p,o[t.value]=p,d[t.firstChild&&t.firstChild.textContent||t.innerText]=p++}))}))),e.default in i.data.variables||(e.default=b.variable)}function j(e,t,a,s){const n=i.data.variables[a].info[t],r="string"===n.type?"levels":"ids",l=n[r];if(l){const i=t+a;s[i]={options:[],values:{},display:{}};const n=e.values,r=s[i].options,c=s[i].values,h=s[i].display;var o=!e.sensitive&&!!e.current_set,d=0;Object.keys(l).forEach((t=>{const i=l[t];o&&!(t in n)&&(e.sensitive=!0,o=!1),r.push(e.add(i.id,i.name,!0)),c[i.id]=d,h[i.name]=d++}))}else"ids"===r&&(i.data.data_queue[t][e.id]=function(){return j(e,t,a,s)},i.data.loaded[t]&&i.data.load_id_maps())}function S(e,t){t&&!e.e.classList.contains("locked")?(e.e.removeAttribute("disabled"),e.e.classList.remove("disabled"),e.input_element&&e.input_element.removeAttribute("disabled")):(e.e.setAttribute("disabled",!0),e.e.classList.add("disabled"),e.input_element&&e.input_element.setAttribute("disabled",!0))}function M(e,t){return e.id in w&&t.id in w?w[e.id]._n.children-w[t.id]._n.children:-1/0}function B(e,t){e in C||(C[e]=[]),t.uid||(t.uid=JSON.stringify(t));const i=C[e];for(let e=i.length;e--;)if(t.uid===i[e].uid)return;i.push(t),e in w||(w[e]={_n:{children:0,parents:0},children:{},parents:{}}),t.id in w||(w[t.id]={_n:{children:0,parents:0},children:{},parents:{}}),w[e].children[t.id]=w[t.id],w[e]._n.children++,w[t.id].parents[e]=w[e],w[t.id]._n.parents++,i.sort(M),pe(e)}function I(e,t){e in g||(g[e]=[]),g[e].push(t)}function R(e,t,i){if(e in g)for(var a=g[e].length;a--;)t in g[e][a]&&g[e][a][t](i,x[e])}function D(e){if(e.dark_theme!==i.settings.theme_dark){e.dark_theme=i.settings.theme_dark;const a=getComputedStyle(t.body);"style"in e||(e.style=e.options.layout,"font"in e.style||(e.style.font={}),"modebar"in e.style||(e.style.modebar={}),"font"in e.style.xaxis||(e.style.xaxis.font={}),"font"in e.style.yaxis||(e.style.yaxis.font={})),e.style.paper_bgcolor=a.backgroundColor,e.style.plot_bgcolor=a.backgroundColor,e.style.font.color=a.color,e.style.modebar.bgcolor=a.backgroundColor,e.style.modebar.color=a.color,e.e._fullLayout.xaxis.showgrid&&(e.style.xaxis.gridcolor=a.borderColor),e.e._fullLayout.yaxis.showgrid&&(e.style.yaxis.gridcolor=a.borderColor),e.style.xaxis.font.color=a.color,e.style.yaxis.font.color=a.color,Plotly.relayout(e.e,e.options.layout)}}function F(e,t,a,s,n,r){if(t.data&&e.parsed.x in i.data.variables){const l=i.data.retrievers.vector({variable:e.parsed.x,entity:t}),o=i.data.retrievers.vector({variable:e.parsed.y,entity:t}),d=JSON.parse(e.traces[e.base_trace]),c=i.data.variables[e.parsed.y].time_range[e.parsed.dataset],h=i.data.variables[e.parsed.x].time_range[e.parsed.dataset],p=Math.min(c[1],h[1])+1;for(let i=Math.max(c[0],h[0]);i<p;i++)d.text.push(t.features.name),d.x.push(e.parsed.x_range[0]<=i&&i<=e.parsed.x_range[1]?l[i-e.parsed.x_range[0]]:NaN),d.y.push(e.parsed.y_range[0]<=i&&i<=e.parsed.y_range[1]?o[i-e.parsed.y_range[0]]:NaN);return d.type=e.parsed.base_trace,d.color=d.line.color=d.marker.color=d.textfont.color=r||N(t.get_value(e.parsed.color,e.parsed.time),e.parsed.palette,e.parsed.summary,e.parsed.time,a,s)||b.border,"bar"===d.type&&(d.marker.line.width=0),d.name=n||t.features.name,d.id=t.features.id,d}}function H(e){Array.isArray(e.author)||(e.author=[e.author]);const i=t.createElement("li"),a=e.author.length;var n="",r=1===a?"":2===a?" & ":", & ";for(let t=a;t--;){const i=e.author[t];n=(t?r:"")+("string"==typeof i?i:i.family)+(i.given?", "+i.given.substring(0,1)+".":"")+n,r=", "}return i.innerHTML=n+" ("+e.year+"). "+e.title+"."+(e.journal?" <em>"+e.journal+(e.volume?", "+e.volume:"")+"</em>"+(e.page?", "+e.page:"")+".":"")+(e.version?" Version "+e.version+".":"")+(e.doi||e.url?(e.doi?" doi: ":" url: ")+(e.doi||e.url?'<a rel="noreferrer" target="_blank" href="'+(e.doi?"https://doi.org/"+e.doi:e.url)+'">'+(e.doi||e.url.replace(s.http,""))+"</a>":""):""),i}function z(e,i){const a=t.createElement(i?"tr":"div");let s;return i?(e.name&&(a.appendChild(s=t.createElement("td")),e.url?(s.appendChild(s=t.createElement("a")),s.target="_blank",s.rel="noreferrer",s.href=e.url):s.appendChild(t.createElement("span")),a.firstElementChild.firstElementChild.innerText=e.name),e.date_accessed&&(a.appendChild(s=t.createElement("td")),s.appendChild(t.createElement("span")),s.firstElementChild.innerText=e.date_accessed)):(a.className="card",e.name&&(a.appendChild(s=t.createElement("div")),s.className="card-header",e.url?(s.appendChild(s=t.createElement("a")),s.target="_blank",s.rel="noreferrer",s.href=e.url):s.appendChild(t.createElement("span")),a.firstElementChild.firstElementChild.innerText=e.name),a.appendChild(t.createElement("div")),a.lastElementChild.className="card-body",e.location&&(a.lastElementChild.appendChild(s=t.createElement("p")),s.appendChild(t.createElement("span")),s.lastElementChild.innerText="Location: ",s.appendChild(t.createElement("span")),e.location_url?(s.lastElementChild.appendChild(s=t.createElement("a")),s.target="_blank",s.rel="noreferrer",s.href=e.location_url,s.innerText=e.location):s.lastElementChild.innerText=e.location),e.date_accessed&&(a.lastElementChild.appendChild(s=t.createElement("p")),s.appendChild(t.createElement("span")),s.lastElementChild.innerText="Date Accessed: ",s.appendChild(t.createElement("span")),s.lastElementChild.innerText=e.date_accessed)),a}function P(){const e=x[this.view],t=ie(this.v||e.y),a=i.data.variable_info[t];if(u.modal.info.header.firstElementChild.innerText=a.short_name,u.modal.info.title.innerText=a.long_name,u.modal.info.description.innerText=a.long_description||a.description||a.short_description||"",u.modal.info.name.lastElementChild.innerText=t,u.modal.info.type.lastElementChild.innerText=a.type||"",a.sources&&a.sources.length?(u.modal.info.sources.lastElementChild.innerHTML="",u.modal.info.sources.classList.remove("hidden"),a.sources.forEach((e=>{u.modal.info.sources.lastElementChild.appendChild(z(e))}))):u.modal.info.sources.classList.add("hidden"),a.citations&&a.citations.length){if(u.modal.info.references.lastElementChild.innerHTML="",u.modal.info.references.classList.remove("hidden"),"string"==typeof a.citations&&(a.citations=[a.citations]),"references"in i.data&&(delete i.data.variable_info._references,delete i.data.references),!("_references"in i.data.variable_info)){const e={};i.data.variable_info._references=e,Object.keys(i.data.info).forEach((t=>{const a=i.data.info[t];"_references"in a&&Object.keys(a._references).forEach((t=>{t in e||(e[t]={reference:a._references[t],element:H(a._references[t])})}))}))}const e=i.data.variable_info._references;a.citations.forEach((t=>{t in e&&u.modal.info.references.lastElementChild.appendChild(e[t].element)}))}else u.modal.info.references.classList.add("hidden")}function G(e,t,a,n){if("statement"===t)for(var r,l;r=s.mustache.exec(e);)"value"===r[1]?(l=n?i.data.format_value(n.get_value(a.v,a.time),s.int_types.test(i.data.variable_info[a.v].type)):"unknown",e=e.replace(r[0],"unknown"!==l&&i.data.variable_info[a.v].type in o?o[i.data.variable_info[a.v].type](l):l),s.mustache.lastIndex=0):n&&("region_name"===r[1]?(e=e.replace(r[0],n.features.name),s.mustache.lastIndex=0):s.features.test(r[1])?(e=e.replace(r[0],n.features[r[1].replace(s.features,"")]),s.mustache.lastIndex=0):s.variables.test(r[1])?(e=e.replace(r[0],n.variables[a.v][r[1].replace(s.variables,"")]),s.mustache.lastIndex=0):s.data.test(r[1])&&(e=e.replace(r[0],n.get_value(r[1].replace(s.data,""),a.time)),s.mustache.lastIndex=0));return e}var J,V,U,Q;if(e.dataLayer||(e.dataLayer=[]),i.query=J=e.location.search.replace("?",""),i.url_options={},J)for(V=J.split("&"),k=V.length;k--;)(Q=V[k].split("=")).length<2&&Q.push("true"),Q[1]=s.bool.test(Q[1])?!!Q[1]||"true"===Q[1]:Q[1].replace(s.url_spaces," "),i.url_options[Q[0]]=Q[1],s.settings.test(Q[0])&&d.set(Q[0].replace(s.settings,""),Q[1]);if(("embedded"in i.url_options||"hide_navbar"in i.url_options)&&("hide_logo"in i.url_options||(i.url_options.hide_logo=!0),"hide_title"in i.url_options||(i.url_options.hide_title=!0),"hide_navcontent"in i.url_options||(i.url_options.hide_navcontent=!0),"hide_panels"in i.url_options||(i.url_options.hide_panels=!0),"embedded"in i.url_options&&!("close_menus"in i.url_options)&&(i.url_options.close_menus=!0)),(V=u.navbar)&&(V.querySelectorAll("button").forEach((e=>{const i=t.querySelector(e.getAttribute("data-bs-target"));i&&"false"===i.getAttribute("data-bs-backdrop")&&(i.addEventListener("show.bs.offcanvas",(function(){u.content_bounds.outer_right=i.getBoundingClientRect().width,K(void 0,!0),setTimeout(W,200)})),i.addEventListener("hide.bs.offcanvas",(function(){u.content_bounds.outer_right=0,K(void 0,!0),setTimeout(W,200)})))})),"navcolor"in i.url_options&&(""===i.url_options.navcolor&&(i.url_options.navcolor=e.location.hash),V.style.backgroundColor=i.url_options.navcolor.replace("%23","#")),i.url_options.hide_logo&&i.url_options.hide_title&&i.url_options.hide_navcontent?V.classList.add("hidden"):((V=t.querySelector(".navbar-brand"))&&(i.url_options.hide_logo&&"IMG"===V.firstElementChild.tagName&&V.firstElementChild.classList.add("hidden"),i.url_options.hide_title&&"IMG"!==V.lastElementChild.tagName&&V.lastElementChild.classList.add("hidden")),i.url_options.hide_navcontent&&(t.querySelector(".navbar-toggler").classList.add("hidden"),(V=t.querySelector(".navbar-nav"))&&V.classList.add("hidden"))),i.url_options.hide_panels&&u.panels.length))for(k=u.panels.length;k--;)u.panels[k].classList.add("hidden");if(d.copy=d.get(),d.copy)for(const e in i.settings)if(e in d.copy){let t=d.copy[e];s.bool.test(t)?t=!!t||"true"===t:s.number.test(t)&&(t=parseFloat(t)),i.settings[e]=t}function X(e,t,i){const a=i.length;for(var s=i[0][e]+t*i[1][e],n=2;n<a;n++)s+=Math.pow(t,n)*i[n][e];return Math.max(0,Math.min(255,s))}function Y(){i.data.inited&&clearTimeout(i.data.inited.load_screen),u.wrap.style.visibility="visible",u.load_screen.style.display="none"}function K(e,t){const i=u[t?"wrap":"content"];t||(i.style.top=(u.top_menu&&"open"===u.top_menu.state?u.top_menu.getBoundingClientRect().height:u.content_bounds.top+(!u.top_menu&&!u.left_menu&&!u.right_menu||u.right_menu&&"open"===u.right_menu.state||u.left_menu&&"open"===u.left_menu.state?0:40))+"px",i.style.bottom=u.content_bounds.bottom+(u.bottom_menu&&"closed"!==u.bottom_menu.state?u.bottom_menu.getBoundingClientRect().height:0)+"px",i.style.left=u.content_bounds.left+(u.left_menu&&"closed"!==u.left_menu.state?u.left_menu.getBoundingClientRect().width:0)+"px"),i.style.right=u.content_bounds[t?"outer_right":"right"]+(u.right_menu&&"closed"!==u.right_menu.state?u.right_menu.getBoundingClientRect().width:0)+"px"}function W(){"undefined"==typeof module&&e.dispatchEvent(new Event("resize"))}function Z(){var t="";return E._u.forEach((e=>{const i=x[e];if(i.input&&!s.settings.test(e)&&(!i.range||i.range[0]!==i.range[1])){let a=i.value();a!==i.default&&(Array.isArray(a)&&(a=a.join(",")),""!==a&&null!=a&&"-1"!=a&&(t+=(t?"&":"?")+e+"="+a))}})),i.data&&x._base_filter.c.size&&(t+="&"+x._base_filter.value([])),e.location.protocol+"//"+e.location.host+e.location.pathname+t}function ee(){function e(e,a){if("A"===e.target.tagName){a=a||{};const n=t.createElement("tr"),r={e:n,index:x._base_filter.c.size,variable:e.target.value,component:a.component||"last",operator:a.operator||">=",value:a.value||"",active:!0,id:"vf"+x._base_filter.c.size,passed:0,failed:0},o=i.data.variables[e.target.value].time_range[x[b.dataview].get.dataset()],d=i.data.meta.overall.value;var s;n.setAttribute("index",x._base_filter.c.size),x._base_filter.c.set(x._base_filter.c.size,r),a.time_component&&(r.component=String(d[r.component])),n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("p")),s.className="cell-text",s.innerText=e.target.innerText+" ("+d[o[0]]+"-"+d[o[1]]+")",n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("p")),s.className="cell-text",s.innerText="0/0",n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("label")),s.innerText="Active",s.className="filter-label",s.id=r.id+"_switch",n.lastElementChild.appendChild(s=t.createElement("div")),s.className="form-check form-switch filter-form-input",s.appendChild(s=t.createElement("input")),s.className="form-check-input",s.type="checkbox",s.role="switch",s.setAttribute("aria-labelledby",r.id+"_switch"),s.checked=!0,s.addEventListener("change",function(){r.active=!r.active,pe("_base_filter")}.bind(r)),n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("label")),s.innerText="Component",s.className="filter-label",s.id=r.id+"_component";const c=l.combobox.create("component",h.Time);c.default=r.component,c.set(r.component),n.lastElementChild.appendChild(c.e.parentElement),c.e.parentElement.removeChild(c.e.parentElement.lastElementChild),c.e.parentElement.classList.add("filter-form-input"),c.e.setAttribute("aria-labelledby",r.id+"_component"),c.onchange=function(){r.component=this.value(),pe("_base_filter")}.bind(c),n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("label")),s.innerText="Operator",s.className="filter-label",s.id=r.id+"_operator",n.lastElementChild.appendChild(s=t.createElement("select")),s.className="form-select filter-form-input",s.setAttribute("aria-labelledby",r.id+"_value"),s.addEventListener("change",(e=>{r.operator=e.target.selectedOptions[0].value,pe("_base_filter")})),[">=","=","!=","<="].forEach((e=>{s.appendChild(t.createElement("option")),s.lastElementChild.value=s.lastElementChild.innerText=e,e===r.operator&&(s.lastElementChild.selected=!0)})),n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("label")),s.innerText="Value",s.className="filter-label",s.id=r.id+"_value",n.lastElementChild.appendChild(s=t.createElement("input")),s.className="form-control filter-form-input",s.type="number",s.value=r.value,s.addEventListener("change",(e=>{r.value=e.target.value,pe("_base_filter")})),n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("label")),s.innerText="Remove",s.className="filter-label",s.id=r.id+"_remove",n.lastElementChild.appendChild(s=t.createElement("button")),s.className="btn-close filter-form-input",s.type="button",s.setAttribute("aria-labelledby",r.id+"_remove"),s.addEventListener("mouseup",function(e){1===e.which&&(this.e.parentElement.removeChild(this.e),x._base_filter.c.delete(this.index),pe("_base_filter"))}.bind(r)),pe("_base_filter"),u.modal.filter.variable_filters.lastElementChild.lastElementChild.appendChild(n)}}i.data.variables&&(b.variable=Object.keys(i.data.variables),b.variable=b.variable[b.variable.length-1]),i.map||(i.map={}),i.map._overlay_property_selectors||(i.map._overlay_property_selectors=[]),E._u.forEach((async e=>{if(x[e].type in l){const t=x[e],n="combobox"===t.type;if(t.options_source)if(s.palette.test(t.options_source))t.options=[],Object.keys(a).forEach((e=>t.options.push(t.add(e,a[e].name)))),-1===t.default&&(t.default=b.palette);else if(s.datasets.test(t.options_source))t.options=[],i.metadata.datasets.forEach((e=>t.options.push(t.add(e))));else{t.sensitive=!1,t.option_sets={},s.properties.test(t.options_source)&&i.map._overlay_property_selectors.push(t),t.depends&&B(t.depends,{type:"options",id:t.id}),t.dataset in x&&B(t.dataset,{type:"options",id:t.id}),t.view&&B(t.view,{type:"options",id:t.id});const e=ie(t.dataset)||b.dataset;t.dataset||(t.dataset=e),e in i.metadata.info&&r.options(t)}if(n||"select"===t.type){if(Array.isArray(t.values)){t.values={},t.display={};let e=!0;t.options.forEach((t=>{e&&(e=t.value===t.innerText)})),t.options.forEach(((a,s)=>{t.values[a.value]=s,e&&(a.innerText=i.data.format_label(a.value)),t.display[a.innerText]=s})),t.default in t.values||t.default in x||(t.default=Number(t.default),isNaN(t.default)&&(t.default=-1)),t.source="",t.id in i.url_options?t.set(i.url_options[t.id]):t.reset()}t.subset=t.e.getAttribute("subset")||"all",t.selection_subset=t.e.getAttribute("selection-subset")||t.subset,t.type in i&&t.id in i[t.type]&&(t.settings=i[t.type][t.id],t.settings.filters&&(t.filters=t.settings.filters,t.current_filter={},Object.keys(t.filters).forEach((e=>{B(t.filters[e],{type:"filter",id:t.id})})),t.filter=function(){var e;Object.keys(this.filters).forEach((e=>{this.current_filter[e]=ie(this.filters[e])})),Object.keys(this.values).forEach(((t,a)=>{var s=!1;if(t in i.data.variables&&"meta"in i.data.variables[t])for(const e in this.current_filter)if(e in i.data.variables[t].meta&&(s=i.data.variables[t].meta[e]===this.current_filter[e],!s))break;s&&!e&&(e=t),this.options[a].classList[s?"remove":"add"]("hidden")})),this.current_index=this.values[this.value()],e&&(-1===this.current_index||this.options[this.current_index].classList.contains("hidden"))&&this.set(e)}.bind(t)))}else if("number"===t.type){if(t.min=t.e.getAttribute("min"),t.min_ref=parseFloat(t.min),t.min_indicator=t.e.parentElement.parentElement.querySelector(".indicator-min"),t.max=t.e.getAttribute("max"),t.max_ref=parseFloat(t.max),t.max_indicator=t.e.parentElement.parentElement.querySelector(".indicator-max"),t.ref=isNaN(t.min_ref)||isNaN(t.max_ref),t.range=[t.min_ref,t.max_ref],t.step=parseFloat(t.e.step)||1,t.parsed={min:void 0,max:void 0},t.depends={},t.update=async function(){const e=x[this.view],a=ie(t.variable||e.y);e.time_range||(e.time_range={time:[]});var n=e.get?e.get.dataset():ie(this.dataset),r=ie(this.min)||e.time,l=ie(this.max)||e.time;s.minmax.test(r)&&(r=x[this.min][r]),s.minmax.test(l)&&(l=x[this.max][l]),this.parsed.min=isNaN(this.min_ref)?void 0===r?e.time_range.time[0]:"number"==typeof r?r:r in i.data.variables?i.data.variables[r].info[n||i.data.variables[r].datasets[0]].min:parseFloat(r):this.min_ref,this.parsed.max=isNaN(this.max_ref)?void 0===l?e.time_range.time[1]:"number"==typeof l?l:l in i.data.variables?i.data.variables[l].info[n||i.data.variables[l].datasets[0]].max:parseFloat(l):this.min_ref,this.ref&&a in i.data.variables?(this.range[0]=this.e.min=isNaN(this.min_ref)?Math.max(e.time_range.time[0],this.parsed.min):this.min_ref,this.range[1]=this.e.max=isNaN(this.max_ref)?Math.min(e.time_range.time[1],this.parsed.max):this.max_ref,this.depends[e.y]||(this.depends[e.y]=!0,B(e.y,{type:"update",id:this.id})),a!==this.variable&&this.reset(),this.variable=await de(a,this.view)):(this.e.min=this.parsed.min,(this.parsed.min>this.source||!this.source&&"min"===this.default)&&this.set(this.parsed.min),this.e.max=this.parsed.max,(this.parsed.max<this.source||!this.source&&"max"===this.default)&&this.set(this.parsed.max))}.bind(t),t.view&&B(t.view,{type:"update",id:t.id}),t.max in i.data.variables?t.view&&B(t.view+"_time",{type:"max",id:t.id}):t.max in x?B(t.max,{type:"max",id:t.id}):t.e.max=parseFloat(t.max),t.min in i.data.variables?t.view&&B(t.view+"_time",{type:"min",id:t.id}):t.min in x?B(t.min,{type:"min",id:t.id}):t.e.min=parseFloat(t.min),void 0!==t.default&&(s.number.test(t.default)?t.default=Number(t.default):t.reset="max"===t.default||"last"===t.default?function(){this.range&&this.set(ie(this.range[1]))}.bind(t):"min"===t.default||"first"===t.default?function(){this.range&&this.set(ie(this.range[0]))}.bind(t):this.default in x?function(){this.set(ie(this.default))}.bind(t):function(){}),t.variable){const e=-1===i.metadata.datasets.indexOf(t.dataset)?b.dataset:t.dataset;t.variable in x?B(t.variable,{type:"update",id:t.id}):t.variable in i.data.variables&&(t.e.min=t.min=t.parsed.min=t.range[0]=i.data.variables[t.variable].info[e].min,t.e.max=t.max=t.parsed.max=t.range[1]=i.data.variables[t.variable].info[e].max)}}else"checkbox"===t.type&&(t.source=[],t.current_index=[],t.default=t.default.split(","));Array.isArray(t.values)&&(t.values.length||(t.values=[],t.options.length&&t.options.forEach((e=>t.values.push(e.value)))),t.values.length&&!(t.default in x)&&-1===t.values.indexOf(t.default)&&(t.default=parseInt(t.default),t.default=t.values.length>t.default?t.values[t.default]:"")),n||"select"===t.type||"number"===t.type||"intext"===t.type?(t.e.addEventListener("change",t.listen),t.e.parentElement.lastElementChild&&t.e.parentElement.lastElementChild.classList.contains("select-reset")&&t.e.parentElement.lastElementChild.addEventListener("click",t.reset)):"switch"===t.type?("boolean"!=typeof t.default&&(t.default=t.e.checked),t.e.addEventListener("change",t.listen)):t.listen&&t.options.forEach((e=>e.addEventListener("click",t.listen))),s.settings.test(t.id)&&(t.setting=t.id.replace(s.settings,""),null==t.default&&t.setting in i.settings&&(t.default=i.settings[t.setting]),B(t.id,{type:"setting",id:t.id})),t.view||(t.view=b.dataview);const l=i.url_options[t.id]||d.get(t.id.replace(s.settings,""));l?t.set(s.bool.test(l)?!!l||"true"===l:l):t.reset&&t.reset()}})),Object.keys(i.dataviews).forEach((e=>{const t=i.dataviews[e];x[e]=t,t.id=e,t.value=function(){if(this.get)return this.reparse(),""+this.parsed.dataset+x._entity_filter.entities.size+i.data.inited[this.parsed.dataset]+this.parsed.id_source+Object.keys(this.parsed.ids)+this.parsed.features+this.parsed.variables+i.settings.summary_selection}.bind(t),"string"==typeof t.palette&&t.palette in x&&B(t.palette,{type:"dataview",id:e}),"string"==typeof t.dataset&&t.dataset in x&&B(t.dataset,{type:"dataview",id:e}),"string"==typeof t.ids&&t.ids in x&&B(t.ids,{type:"dataview",id:e}),t.time_range={dataset:"",variable:"",index:[],time:[],filtered:[]},B(e,{type:"time_range",id:e}),B("_base_filter",{type:"dataview",id:e}),B("_entity_filter",{type:"dataview",id:e}),t.x in x&&B(t.x,{type:"time_range",id:e}),t.y in x&&B(t.y,{type:"time_range",id:e}),t.features&&Object.keys(t.features).forEach((i=>{"string"==typeof t.features[i]&&t.features[i]in x&&B(t.features[i],{type:"dataview",id:e})})),t.variables&&t.variables.forEach((i=>{"variable"in i?i.variable in x&&B(i.variable,{type:"dataview",id:e}):t.variables.splice(k,1),"type"in i?i.type in x&&B(i.type,{type:"dataview",id:e}):i.type="=","value"in i?i.value in x&&B(i.value,{type:"dataview",id:e}):i.value=0})),function(e){e.times=[],e.time_filters&&(e.time_filters=[{variable:b.time,type:">=",value:"filter.time_min"},{variable:b.time,type:"<=",value:"filter.time_max"}],B(e.id+"_time",{type:"min",id:"filter.time_min"}),B(e.id+"_time",{type:"max",id:"filter.time_max"}),e.time_filters.forEach((t=>{t.value in x&&B(t.value,{type:"time_filters",id:e.id})})));e.selection={ids:{},features:{},variables:[],dataset:{},filtered:{},full_filter:{},all:{}},e.n_selected={ids:0,features:0,variables:0,dataset:0,filtered:0,full_filter:0,all:0},e.get={dataset:function(){return ie("string"==typeof e.dataset&&e.dataset in x?x[e.dataset].value():e.dataset)||b.dataset},ids:function(t){const a=ie("string"==typeof e.ids&&e.ids in x?x[e.ids].value():e.ids);if(""!==a&&-1!=a){if(t)return a;const e={},s=i.data.entities[a];return e[a]=!0,s&&s.relations&&Object.keys(s.relations.children).forEach((t=>e[t]=!0)),e}return!(t||!x._entity_filter.selected.length)&&x._entity_filter.select_ids},features:function(){var t="";return e.features&&Object.keys(e.features).forEach((i=>{t+=i+ie(e.features[i])})),t},variables:function(){if(e.variables||x._base_filter.c.size){e.parsed.variable_values.length||e.reparse();var t="";return e.parsed.variable_values.forEach((e=>{t+=e.name+e.operator+e.component+e.value+e.active})),t}return""},time_filters:function(){var t="";return e.time_filters&&e.time_filters.forEach((e=>{t+=e.value in x?ie(e.value):e.value})),t}},e.ids_check=function(e,t){return!e||t in e},e.parsed={dataset:"",ids:"",features:"",variables:"",time_filters:"",time_agg:0,id_source:"",variable_values:[],feature_values:{}},e.reparse=function(){if(this.parsed.dataset=this.get.dataset(),this.parsed.ids=this.get.ids(),this.parsed.time_filters=this.get.time_filters(),this.parsed.time_agg=this.parsed.dataset in i.data.meta.times?ie(this.time_agg)-i.data.meta.times[this.parsed.dataset].range[0]:0,"string"==typeof this.ids&&this.ids in x&&("virtual"===x[this.ids].type&&x[this.ids].source in x||"depends"in x[this.ids]&&x[this.ids].depends in x)&&(this.parsed.id_source="virtual"===x[this.ids].type?ie(x[x[this.ids].source].dataset):x[x[this.ids].depends].value()),this.features){for(var e in this.parsed.feature_values={},this.features)e in this.features&&(this.parsed.feature_values[e]={value:ie(this.features[e])},this.parsed.feature_values[e].operator="string"==typeof this.parsed.feature_values[e].value?"equals":"includes");this.parsed.features=this.get.features()}else this.parsed.features="";if(this.parsed.variable_values=[],x._base_filter.c.size&&x._base_filter.c.forEach((e=>{this.parsed.variable_values.push({filter:e,name:e.variable,range:i.data.variables[e.variable].info[this.parsed.dataset].time_range,operator:e.operator,value:e.value?Number(e.value):NaN,value_type:"number",component:e.component,active:e.active,comp_fun:le(e.component)})})),this.variables||this.parsed.variable_values.length){if(this.variables)for(var t,a=this.variables.length;a--;)t=ie(this.variables[a].value),this.parsed.variable_values.push({name:ie(this.variables[a].variable),operator:ie(this.variables[a].type),value:t,value_type:typeof t});this.parsed.variables=this.get.variables()}else this.parsed.variables=""}.bind(e),e.checks={dataset:function(e){return this.parsed.dataset===e.group}.bind(e),ids:function(e){return e.features&&this.ids_check(this.parsed.ids,e.features.id)}.bind(e),features:function(e){if(e.features){var t,i,a=!0;for(t in this.parsed.feature_values)if(t in this.parsed.feature_values&&(i=this.parsed.feature_values[t],!(a=DataHandler.prototype.checks[i.operator](i.value,ie(e.features[t])))))break;return a}return!0}.bind(e),variables:function(e){if(e.data){let t=!0;for(let i=this.parsed.variable_values.length;i--;){const a=this.parsed.variable_values[i];if(a.active&&!isNaN(a.value)){const i=a.comp_fun(e,a,this.parsed),s=!isNaN(i)&&DataHandler.prototype.checks[a.operator](i,a.value);a.filter[s?"passed":"failed"]++,t&&!s&&(t=!1)}else a.filter.failed++}return t}return!0}.bind(e)},e.check=function(e){return{ids:!this.ids||this.checks.ids(e),features:!this.features||this.checks.features(e),variables:!this.variables&&!x._base_filter.c.size||this.checks.variables(e),dataset:!this.dataset||this.checks.dataset(e)}}.bind(e)}(t),r.dataview(t),t.reparse()})),t.querySelectorAll(".auto-output").forEach(l.init_output),(V=u.modal.filter).body.className="filter-dialog",V.body.appendChild(V.entity_filters=t.createElement("div")),V.entity_filters.appendChild(t.createElement("p")),V.entity_filters.lastElementChild.className="h6 text-muted",V.entity_filters.lastElementChild.innerText="Select Entities",V.entity_filters.appendChild(t.createElement("div")),V.entity_filters.lastElementChild.className="row",V.entity_inputs={},Object.keys(i.data.data_queue).reverse().forEach((e=>{const a=l.combobox.create(e,void 0,{search:!0,multi:!0,clearable:!0},"filter."+e);V.entity_inputs[e]=a,V.entity_filters.lastElementChild.appendChild(t.createElement("div")),V.entity_filters.lastElementChild.lastElementChild.className="col-sm",V.entity_filters.lastElementChild.lastElementChild.appendChild(a.e.parentElement),a.e.parentElement.classList.add("form-floating"),a.listbox.classList.add("multi"),a.option_sets={},a.dataset=e,a.onchange=function(){r.id_filter(),pe("_entity_filter")}.bind(a),O(a,e,a.option_sets,function(){this.values=this.option_sets[this.dataset].values,this.display=this.option_sets[this.dataset].display,this.options=this.option_sets[this.dataset].options,S(a,!!a.options.length),Object.keys(this.values).forEach((e=>{x._entity_filter.entities.set(e,i.data.entities[e])})),x._entity_filter.registered[e]=!0,this.set(a.id in i.url_options?i.url_options[a.id].split(","):-1)}.bind(a)),S(a,!!a.options.length)})),V.body.appendChild(V.variable_filters=t.createElement("div")),V.variable_filters.appendChild(t.createElement("p")),V.variable_filters.lastElementChild.className="h6 text-muted",V.variable_filters.lastElementChild.innerText="Variable Conditions",V.variable_filters.appendChild(U=t.createElement("div")),U.className="row",U.appendChild(t.createElement("div")),U.lastElementChild.className="col",U.lastElementChild.appendChild(Q=t.createElement("div")),Q.className="dropdown",Q.appendChild(t.createElement("button")),Q.lastElementChild.type="button",Q.lastElementChild.id="filter_variable_dropdown",Q.lastElementChild.className="btn dropdown-toggle",Q.lastElementChild.setAttribute("data-bs-toggle","dropdown"),Q.lastElementChild.setAttribute("aria-expanded",!1),Q.lastElementChild.innerText="Add Variable Condition",Q.appendChild(t.createElement("ul")),Q.lastElementChild.addEventListener("click",e.bind(V)),Q.lastElementChild.className="dropdown-menu",Q.lastElementChild.setAttribute("aria-labelledby","filter_variable_dropdown"),Object.keys(i.data.variables).forEach((e=>{if(!i.data.variables[e].is_time){const a=t.createElement("li");a.appendChild(t.createElement("a")),a.lastElementChild.className="dropdown-item",a.lastElementChild.href="#",a.lastElementChild.value=e,a.lastElementChild.innerText=i.data.variable_info[e]&&i.data.variable_info[e].short_name||e,Q.lastElementChild.appendChild(a)}})),V.variable_filters.appendChild(U=t.createElement("table")),U.className="table",U.appendChild(U=t.createElement("thead")),U.className="filter-header",V.variable_filters.lastElementChild.appendChild(t.createElement("tbody")),V.variable_filters.lastElementChild.lastElementChild.className="filter-body",U=U.appendChild(U=t.createElement("tr")),["Variable","Result","Active","Component","Operator","Value","Remove"].forEach((e=>{if(U.appendChild(t.createElement("th")),"Component"===e||"Result"===e){const i="Component"===e?{wrapper:t.createElement("label"),id:"filter_component_header",note:"Component refers to which single value to filter on for each entity; select a dynamic time reference, or enter a time."}:{wrapper:t.createElement("label"),id:"filter_result_header",note:"Passing / total entities across loaded datasets."};U.lastElementChild.appendChild(i.wrapper),U.lastElementChild.className="has-note",i.wrapper.innerText=e,i.wrapper.id=i.id,i.wrapper.setAttribute("of",i.id),i.wrapper.setAttribute("aria-description",i.note),U.lastElementChild.addEventListener("mouseover",ae.bind(i))}else U.lastElementChild.innerText=e})),E._u=Object.keys(x),i.query&&(i.parsed_query=i.data.parse_query(i.query),i.parsed_query.variables.conditions.length&&i.parsed_query.variables.conditions.forEach((t=>{const a=i.data.variable_info[t.name];a&&e({target:{tagName:"A",value:t.name,innerText:a.short_name}},t)})))}function te(){i.settings.tracking&&e.dataLayer.push(arguments)}function ie(e){return e in x&&(e=x[e]),e&&e.value&&(e=ie(e.value())),e}function ae(){if(i.settings.hide_tooltips||this.id===u.tooltip.showing)return;u.tooltip.showing=this.id,u.tooltip.e.firstElementChild.innerText=this.note,u.tooltip.e.classList.remove("hidden");const e=this.wrapper.getBoundingClientRect(),t=u.tooltip.e.getBoundingClientRect();u.tooltip.e.style.left=Math.max(0,Math.min(e.x,e.x+e.width/2-t.width/2))+"px",u.tooltip.e.style.top=e.y+(e.y<t.height?e.height+5:-t.height-5)+"px"}function se(e){!u.tooltip.showing||"blur"!==e.type&&u.tooltip.showing===(e.target.getAttribute("of")||e.target.id)||(u.tooltip.showing="",u.tooltip.e.classList.add("hidden"))}async function ne(t,a,n){if(a.url in i.map._raw)!function(e,t){var a,n;const r="time"in e,o=e.name+(r?e.time:"");if(i.map[t.id]._layers[o]=L.geoJSON(JSON.parse(i.map._raw[e.url]),{onEachFeature:(o,d)=>{d.on({mouseover:l.map.mouseover.bind(t),mouseout:l.map.mouseout.bind(t),click:l.map.click.bind(t)}),d.setStyle({weight:0,fillOpacity:0}),d.source=e,a=d.feature.properties,!((n=a[e.id_property])in i.data.entities)&&s.leading_zeros.test(n)&&(n=a[e.id_property]=n.replace(s.leading_zeros,"")),n in i.data.entities?"layer"in i.data.entities[n]||(i.data.entities[n].layer={}):i.data.entities[n]={layer:{},features:{id:n}},r?(t.id in i.data.entities[n].layer||(i.data.entities[n].layer[t.id]={has_time:!0}),i.data.entities[n].layer[t.id][e.time]=d):i.data.entities[n].layer[t.id]=d,d.entity=i.data.entities[n],i.data.entities[n].features&&Object.keys(a).forEach((e=>{e in i.data.entities[n].features||("name"!==e.toLowerCase()||"name"in i.data.entities[n].features&&i.data.entities[n].features.id!==i.data.entities[n].features.name?i.data.entities[n].features[e]=a[e]:i.data.entities[n].features[e.toLowerCase()]=a[e])}))}}),i.data.inited[o+t.id]=!0,i.map._waiting&&i.map._waiting[e.name])for(let t=i.map._waiting[e.name].length;t--;)pe(i.map._waiting[e.name][t])}(a,t),i.map._queue[a.name+(a.time?a.time:"")].retrieved=!0,n&&n();else{const t=new e.XMLHttpRequest;t.onreadystatechange=()=>{4===t.readyState&&200===t.status&&(i.map._raw[a.url]=t.responseText,a.name&&(i.map._queue[a.name+(a.time||"")].retrieved=!0),n&&n())},t.open("GET",a.url,!0),t.send()}}function re(e,a,s){var n=0,l="string"==typeof a.source?a.source:"";if(!l&&a.source)for(n=a.source.length;n--;)if(!a.source[n].time||s===a.source[n].time){a.source[n].name&&delete a.source[n].name,l=a.source[n].url;break}if(l){if(!(l in i.map._raw))return ne(e,a.source[n],re.bind(null,e,a,s));{if(!(l in i.map[e.id]._layers)){const a={};i.map._queue[l].processed||(i.map._queue[l].property_summaries=a),i.map[e.id]._layers[l]=L.geoJSON(JSON.parse(i.map._raw[l]),{pointToLayer:(e,t)=>L.circleMarker(t)}).on("mouseover",(e=>{const i=e.layer;if(i&&!i._tooltip){const e=i.feature&&i.feature.properties;if(e){const s=t.createElement("table");Object.keys(e).forEach((i=>{const n=e[i];"number"==typeof n&&(i in a||(a[i]=[1/0,-1/0]),n<a[i][0]&&(a[i][0]=n),n>a[i][1]&&(a[i][1]=n));const r=t.createElement("tr");r.appendChild(t.createElement("td")),r.appendChild(t.createElement("td")),r.firstElementChild.innerText=i,r.lastElementChild.innerText=n,s.appendChild(r)})),i.bindTooltip(s),i.openTooltip()}}})),Object.keys(a).forEach((e=>{a[e].push(a[e][1]-a[e][0]),a[e][2]||delete a[e]})),i.map._overlay_property_selectors.forEach((e=>{l in e.option_sets||(!function(e,t,a){a[t]={options:[],values:{},display:{}};const s=e.values,n=a[t].options,r=a[t].values,l=a[t].display;e.type;var o=!e.sensitive&&!!e.current_set,d=0;e.settings.group&&(e.groups={e:[],by_name:{}}),Object.keys(i.map._queue[t].property_summaries).forEach((t=>{const a=i.data.format_label(t);o&&!(J in s)&&(e.sensitive=!0,o=!1),n.push(e.add(t,a)),n[d].id=e.id+"-option"+d,r[t]=d,l[a]=d++}))}(e,l,e.option_sets),e.dataset=l,e.variable="")}))}i.map._overlay_property_selectors.forEach((e=>r.options(e))),e.overlay.clearLayers();var o=0;const s=i.settings.circle_property&&i.map._queue[l].property_summaries,n=s&&s[i.settings.circle_property];i.map[e.id]._layers[l].eachLayer((t=>{if(a.filter)for(let e=a.filter.length;e--;)if(!a.filter[e].check(t.feature.properties[a.filter[e].feature],a.filter[e].value))return;o++,t.setRadius(n?((t.feature.properties[i.settings.circle_property]-n[0])/n[2]+.5)*i.settings.circle_radius:i.settings.circle_radius).setStyle({weight:i.settings.polygon_outline,color:"white",opacity:.5,fillOpacity:.5,fillColor:"black"}),t.addTo(e.overlay)})),o&&e.overlay_control.addTo(e.map)}}}function le(e){return"string"==typeof e&&s.number.test(e)&&-1===(e=i.data.meta.overall.value.indexOf(Number(e)))?function(){return NaN}:"number"==typeof e?m.number.bind(e):e in m?m[e]:function(){return NaN}}function oe(){e.localStorage&&d.perm.removeItem(d.name),e.location.reload()}async function de(e,t){return e in i.data.variables&&await i.data.calculate_summary(e,t,!0),i.data.variables[e]}function ce(){v.retain_state=!1,E._u.forEach(pe)}function he(){v.retain_state=!1,E._u.forEach((e=>{!x[e].setting&&x[e].reset&&(x[e].reset(),pe(e))}))}function pe(e){f[e]=!0,clearTimeout(f._timeout),f._timeout=setTimeout(me,20),v.lock_after=e}function me(){clearTimeout(f._timeout),E._u.forEach((e=>{if(f[e]){const t=function(e){if(e in C){const t=x[e],a=C[e],s=[],n=t&&t.value()+"",l=t&&t.dataset&&ie(t.dataset)||n;if(t&&(!v.retain_state||t.state!==n)){if(l in i.metadata.info&&!i.data.loaded[l])return i.data.retrieve(l,i.metadata.info[l].site_file),l;t.state=n,a.forEach((e=>{"rule"===e.type?-1===s.indexOf(e.rule)&&s.push(e.rule):"function"==typeof x[e.id][e.type]?x[e.id][e.type]():r[e.type](x[e.id],t)})),s.forEach((e=>{var t=!1;const a=i.rules[e],s=a.condition.length;for(let e=0;e<s;e++){const i=a.condition[e];if(t=i.check(),i.any?t:!t)break}Object.keys(a.effects).forEach((e=>{const i=a.effects[e];t?"display"===e?i.e.classList.remove("hidden"):"lock"===e?i.forEach((e=>{e.e.disabled=!1,e.e.classList.remove("disabled","locked")})):e in x&&x[e].set(ie(i)):"display"===e?i.e.classList.contains("hidden")||(i.e.classList.add("hidden"),i.u&&i.u.reset(),i.e.querySelectorAll(".auto-input").forEach((e=>{e.id in x&&x[e.id].reset()}))):"lock"===e?i.forEach((e=>{e.e.disabled=!0,e.e.classList.add("disabled","locked")})):"default"in a&&e in x&&x[e].set(ie(a.default))}))})),e===v.lock_after&&(v.retain_state=!0)}}}(e);if(t)return i.data.data_queue[t][e]=me,i.data.loaded[t]&&i.data.load_id_maps(),!1;f[e]=!1}}));let t=Z();i.data.inited.first&&t!==i.state&&(i.state=t,Object.keys(i.url_options).forEach((e=>{s.embed_setting.test(e)&&(t+="&"+e+"="+("navcolor"===e?i.url_options[e].replace(s.hashes,"%23"):i.url_options[e]))})),i.settings.hide_url_parameters||e.history.replaceState(Date.now(),"",t),setTimeout(K,50))}function ue(){const t=this.deferred||!this.tab||this.tab.classList.contains("show");t&&e.Plotly?(Plotly.newPlot(this.e,this.options),this.e.on("plotly_hover",l.plotly.mouseover.bind(this)).on("plotly_unhover",l.plotly.mouseout.bind(this)).on("plotly_click",l.plotly.click.bind(this)),D(this),this.update()):(this.deferred=!0,setTimeout(ue.bind(this),t?0:2e3))}function fe(){const t=i.settings.theme_dark?"dark":"light",a=this.deferred||!this.tab||this.tab.classList.contains("show");if(a&&e.L){if(this.map=L.map(this.e,this.options),this.options=this.map.options,this.overlay=L.featureGroup().addTo(this.map),this.displaying=L.featureGroup().addTo(this.map),this.overlay_control=L.control.layers().setPosition("topleft").addOverlay(this.overlay,"Overlay").addTo(this.map),this.tiles={},this.id in i.map){const e=i.map[this.id].tiles;i.map[this.id].u=this,e&&(e.url?(this.tiles[t]=L.tileLayer(e.url,e.options),this.tiles[t].addTo(this.map)):Object.keys(e).forEach((i=>{this.tiles[i]=L.tileLayer(e[i].url,e[i].options),t===i&&this.tiles[i].addTo(this.map)}))),"_raw"in i.map||(i.map._raw={}),"_queue"in i.map||(i.map._queue={}),"_layers"in i.map[this.id]||(i.map[this.id]._layers={}),i.map[this.id].shapes.forEach(((e,t)=>{const a="time"in e;!i.map[this.id].has_time&&a&&(i.map[this.id].has_time=!0,B(this.view,{type:"update",id:this.id}),i.map[this.id].match_time="exact"===e.resolution?e=>e+"":e=>Number(e)>2019?"2020":"2010");var s=e.name;s||(e.name=s=i.metadata.datasets[t<i.metadata.datasets.length?t:0]);const n=s+(a?e.time:"");i.map._queue[n]=e,i.data.inited[n+this.id]=!1,!i.data.loaded[s]||s!==n&&e.time!=i.map[this.id].match_time(i.data.meta.overall.value[x[this.view].parsed.time_agg])||ne(this,e)})),i.map[this.id].triggers={},i.map[this.id].overlay_summaries={},Array.isArray(i.map[this.id].overlays)&&i.map[this.id].overlays.forEach((e=>{"string"==typeof e.source&&(e.source=[{url:e.source}]);const t=e.source;t.forEach((e=>{e.retrieved=e.url in i.map._raw,e.processed=!1,e.property_summaries={},i.map._queue[e.url]=e})),i.map[this.id].triggers[e.variable]={source:t};const a=e.filter;if(a){const t=Array.isArray(a)?a:[a];i.map[this.id].triggers[e.variable].filter=t,t.forEach((e=>{e.check=i.data.checks[e.operator]}))}}))}}else this.deferred=!0,setTimeout(fe.bind(this),a?0:2e3)}function be(){const t=this.deferred||!this.tab||this.tab.classList.contains("show");t&&e.jQuery&&e.DataTable&&"get"in i.dataviews[this.view]?(this.options.columns=this.header,this.table=$(this.e).DataTable(this.options),this.update()):(this.deferred=!0,setTimeout(be.bind(this),t?0:2e3))}Object.keys(a).forEach((e=>{const t=a[e];if("continuous-polynomial"===t.type){const e=t.colors;t.type="discrete",t.colors=[];for(let i=0;i<255;i++){const a=i/255;t.colors.push("rgb("+X(0,a,e)+", "+X(1,a,e)+", "+X(2,a,e)+")")}}t.odd=t.colors.length%2})),e.onload=function(){if(u.navbar=t.querySelector(".navbar"),u.navbar=u.navbar?u.navbar.getBoundingClientRect():{height:0},u.content=t.querySelector(".content"),u.menus=t.querySelectorAll(".menu-wrapper"),u.panels=t.querySelectorAll(".panel"),u.content_bounds={top:u.navbar.height,right:0,bottom:0,left:0,outer_right:0},u.script_style=t.head.appendChild(t.createElement("style")),i.settings.hide_tooltips&&u.script_style.sheet.insertRule(n,0),u.menu_toggler={hide:function(){this.classList.add("hidden"),K()},toggle:function(e){if(clearTimeout(u.menu_toggler.timeout),"closed"===this.parentElement.state)this.parentElement.state="open",this.parentElement.firstElementChild.classList.remove("hidden"),this.parentElement.style[e]="0px",u.content.style[e]=this.parentElement.getBoundingClientRect()["left"===e||"right"===e?"width":"height"]+"px","top"!==e&&"bottom"!==e||(this.style[e]=u.content_bounds[e]+"px"),setTimeout(W,300);else{if(this.parentElement.state="closed","left"===e||"right"===e)this.parentElement.style[e]=-this.parentElement.getBoundingClientRect().width+"px",u.content.style[e]=u.content_bounds[e]+"px";else{const t=this.parentElement.getBoundingClientRect();u.content.style[e]=u.content_bounds[e]+("top"===e?40:0)+"px",this.parentElement.style[e]=-t.height+("top"===e?u.content_bounds.top:0)+"px","top"!==e&&"bottom"!==e||(this.style[e]=t.height+"px")}u.menu_toggler.timeout=setTimeout(u.menu_toggler.hide.bind(this.parentElement.firstElementChild),300)}},timeout:-1},u.modal={info:{init:!1,e:t.createElement("div")},filter:{init:!1,e:t.createElement("div")}},u.load_screen=t.getElementById("load_screen"),i.settings.tracking&&i.tag_id&&(te("js",new Date),te("config",i.tag_id)),V=u.modal.info.e,t.body.appendChild(V),u.modal.info.init=!0,V.id="variable_info_display",V.className="modal fade",V.setAttribute("tabindex","-1"),V.setAttribute("aria-labelledby","variable_info_title"),V.ariaHidden="true",V.appendChild(t.createElement("div")),V.firstElementChild.className="modal-dialog modal-dialog-scrollable",V.firstElementChild.appendChild(t.createElement("div")),V.firstElementChild.firstElementChild.className="modal-content",V.firstElementChild.firstElementChild.appendChild(u.modal.info.header=t.createElement("div")),(V=u.modal.info).header.className="modal-header",V.header.appendChild(t.createElement("p")),V.header.firstElementChild.className="h5 modal-title",V.header.firstElementChild.id="variable_info_title",V.header.appendChild(t.createElement("button")),V.header.lastElementChild.type="button",V.header.lastElementChild.className="btn-close",V.header.lastElementChild.setAttribute("data-bs-dismiss","modal"),V.header.lastElementChild.title="close",V.header.insertAdjacentElement("afterEnd",V.body=t.createElement("div")),V.body.className="modal-body",V.body.appendChild(V.title=t.createElement("p")),V.title.className="h4",V.body.appendChild(V.description=t.createElement("p")),V.body.appendChild(t.createElement("table")),V.body.lastElementChild.className="info-feature-table",V.body.lastElementChild.appendChild(V.name=t.createElement("tr")),V.name.appendChild(t.createElement("th")),V.name.firstElementChild.innerText="Name",V.name.appendChild(t.createElement("td")),V.body.lastElementChild.appendChild(V.type=t.createElement("tr")),V.type.appendChild(t.createElement("th")),V.type.firstElementChild.innerText="Type",V.type.appendChild(t.createElement("td")),V.body.appendChild(V.sources=t.createElement("div")),V.sources.appendChild(t.createElement("p")),V.sources.lastElementChild.innerText="Sources",V.sources.lastElementChild.className="h3",V.sources.appendChild(t.createElement("div")),V.sources.lastElementChild.className="sources-cards",(V=u.modal.info).body.appendChild(V.references=t.createElement("div")),V.references.appendChild(t.createElement("p")),V.references.firstElementChild.className="h3",V.references.firstElementChild.innerText="References",V.references.appendChild(V=t.createElement("ul")),V.className="reference-list",t.body.appendChild(V=u.modal.filter.e),u.modal.filter.init=!0,V.id="filter_display",V.className="modal fade",V.setAttribute("tabindex","-1"),V.setAttribute("aria-labelledby","filter_title"),V.ariaHidden="true",V.appendChild(t.createElement("div")),V.firstElementChild.className="modal-dialog",V.firstElementChild.appendChild(t.createElement("div")),V.firstElementChild.firstElementChild.className="modal-content",V.firstElementChild.firstElementChild.appendChild(u.modal.filter.header=t.createElement("div")),(V=u.modal.filter).header.className="modal-header",V.header.appendChild(t.createElement("p")),V.header.firstElementChild.className="h5 modal-title",V.header.firstElementChild.id="filter_title",V.header.firstElementChild.innerText="Filter",V.header.appendChild(t.createElement("button")),V.header.lastElementChild.type="button",V.header.lastElementChild.className="btn-close",V.header.lastElementChild.setAttribute("data-bs-dismiss","modal"),V.header.lastElementChild.title="close",V.header.insertAdjacentElement("afterEnd",V.body=t.createElement("div")),V.body.className="modal-body",V.body.appendChild(t.createElement("p")),V.body.lastElementChild.className="h6 text-muted",V.body.lastElementChild.innerText="Time Range",V.body.appendChild(V.time_range=t.createElement("div")),V.time_range.className="row",V.time_range.appendChild(t.createElement("div")),V.time_range.lastElementChild.className="col",V.time_range.lastElementChild.appendChild(U=t.createElement("div")),U.className="form-floating text-wrapper wrapper",U.appendChild(t.createElement("input")),U.lastElementChild.className="form-control auto-input",U.lastElementChild.setAttribute("auto-type","number"),U.lastElementChild.setAttribute("default","min"),U.lastElementChild.max="filter.time_max",U.lastElementChild.type="number",U.lastElementChild.autoType="number",U.lastElementChild.id="filter.time_min",U.appendChild(t.createElement("label")),U.lastElementChild.innerText="First Time",U.lastElementChild.setAttribute("for","filter.time_min"),V.time_range.appendChild(t.createElement("div")),V.time_range.lastElementChild.className="col",V.time_range.lastElementChild.appendChild(U=t.createElement("div")),U.className="form-floating text-wrapper wrapper",U.appendChild(t.createElement("input")),U.lastElementChild.className="form-control auto-input",U.lastElementChild.setAttribute("auto-type","number"),U.lastElementChild.setAttribute("default","max"),U.lastElementChild.min="filter.time_min",U.lastElementChild.type="number",U.lastElementChild.autoType="number",U.lastElementChild.id="filter.time_max",U.appendChild(t.createElement("label")),U.lastElementChild.innerText="Last Time",U.lastElementChild.setAttribute("for","filter.time_max"),u.panels.length&&u.panels.forEach((e=>{const t=e.classList.contains("panel-left")?"left":"right";u.content_bounds[t]=e.getBoundingClientRect().width,e.style.marginTop=u.content_bounds.top+"px",e.lastElementChild.addEventListener("click",function(){const i=e.getBoundingClientRect().width,a=e.lastElementChild.getBoundingClientRect().width;"true"===e.lastElementChild.getAttribute("aria-expanded")?(u.content_bounds[t]=a,u.top_menu&&(u.top_menu.style[t]=a+"px"),u.bottom_menu&&(u.bottom_menu.style[t]=a+"px"),e.style[t]=-i+a+"px",e.lastElementChild.setAttribute("aria-expanded","false")):(u.content_bounds[t]=i,u.top_menu&&(u.top_menu.style[t]=i+"px"),u.bottom_menu&&(u.bottom_menu.style[t]=i+"px"),e.style[t]="0px",e.lastElementChild.setAttribute("aria-expanded","true")),K(),setTimeout(W,200)}.bind(e))})),u.menus.length&&u.menus.forEach((e=>{const t="BUTTON"===e.lastElementChild.tagName;e.state=e.getAttribute("state"),e.classList.contains("menu-top")?(u.top_menu=e,u.top_menu.style.left=u.content_bounds.left+"px",u.top_menu.style.right=u.content_bounds.right+"px",t&&(e.lastElementChild.addEventListener("click",u.menu_toggler.toggle.bind(e.lastElementChild,"top")),e.lastElementChild.style.top=u.content_bounds.top+"px")):e.classList.contains("menu-right")?(u.right_menu=e,u.right_menu.style.right=u.content_bounds.right+"px",t&&(e.lastElementChild.addEventListener("click",u.menu_toggler.toggle.bind(e.lastElementChild,"right")),e.lastElementChild.style.top=u.content_bounds.top+"px")):e.classList.contains("menu-bottom")?(u.bottom_menu=e,u.content_bounds.bottom=40,u.bottom_menu.style.left=u.content_bounds.left+"px",u.bottom_menu.style.right=u.content_bounds.right+"px",t&&e.lastElementChild.addEventListener("click",u.menu_toggler.toggle.bind(e.lastElementChild,"bottom"))):e.classList.contains("menu-left")&&(u.left_menu=e,u.left_menu.style.left=u.content_bounds.left+"px",t&&(e.lastElementChild.addEventListener("click",u.menu_toggler.toggle.bind(e.lastElementChild,"left")),e.lastElementChild.style.top=u.content_bounds.top+"px")),i.url_options.close_menus&&"open"===e.state&&e.lastElementChild.click()})),u.tooltip={e:t.createElement("div"),showing:""},u.tooltip.e.className="tooltip hidden",u.tooltip.e.appendChild(t.createElement("p")),t.body.appendChild(u.tooltip.e),t.body.addEventListener("mouseover",se),i.dataviews){for(const e in i.dataviews)if(e in i.dataviews){b.dataview=e;break}}else i.dataviews={},i.dataviews[b.dataview]={};if(t.querySelectorAll(".auto-input").forEach(l.init_input),i.variables&&i.variables.length&&i.variables.forEach((e=>{const t=e.id,i={id:t,type:"virtual",source:e.default,previous:void 0,default:e.default,display:e.display,current_index:-1,values:[],states:e.states,update:function(){this.source=void 0;for(var e,t=this.states.length;t--;){e=!0;for(let i=this.states[t].condition.length;i--;){const a=this.states[t].condition[i];if(DataHandler.prototype.checks[a.type](ie(a.id),ie(a.value))){if(a.any){e=!0;break}}else e=!1}if(e){this.source=this.states[t].value;break}}if(this.source||(this.source=this.default),this.source!==this.previous)this.previous=this.source,pe(this.id);else if(this.source in x){const e=x[this.source].value();e!==this.previous&&(this.previous=e,pe(this.id))}},value:function(){return ie(this.source)},set:function(e){if(-1!==this.values.indexOf(e))this.previous=this.source,this.source=e;else if(this.source){const t=x[this.source];("select"===t.type||"combobox"===t.type?e in t.values||e in t.display:-1!==t.values.indexOf(e))&&t.set(e)}pe(this.id)}};x[t]=i,i.source&&i.values.push(i.source);const a={};i.states.forEach((e=>{i.values.push(e.value),e.condition.forEach((e=>{a[e.id]={type:"update",id:t},B(e.id,{type:"update",id:t})}))})),i.values.forEach((e=>{e in x&&B(e,{type:"update",id:t})}))})),i.rules&&i.rules.length&&i.rules.forEach(((e,i)=>{if("display"in e.effects&&(e.effects.display={e:t.getElementById(e.effects.display)},(V=e.effects.display.e.querySelector(".auto-input"))&&(e.effects.display.u=x[V.id])),"lock"in e.effects){const i=new Map;t.querySelectorAll("#"+e.effects.lock+" .auto-input").forEach((e=>i.set(e.id,x[e.id]))),e.effects.lock=i}e.condition.forEach((t=>{t.type in DataHandler.prototype.checks&&(t.check=function(){return DataHandler.prototype.checks[this.type](ie(this.id),ie(this.value))}.bind(t),t.id in x&&(B(t.id,{type:"rule",id:t.id,condition:t,rule:i}),t.id in y||(y[t.id]={}),y[t.id][i]=e),t.check()?Object.keys(e.effects).forEach((t=>{t in x&&x[t].set(ie(e.effects[t]))})):t.default&&Object.keys(e.effects).forEach((e=>{e in x&&x[e].set(ie(t.default))})))}))})),E._u=Object.keys(x),e.addEventListener("resize",K),i.metadata.datasets||Y(),!i.dataviews[b.dataview].dataset){if(1===i.metadata.datasets.length)b.dataset=i.metadata.datasets[0];else{const e=i.metadata.info;for(let t=E._u.length;t--;){const i=x[E._u[t]];if(i.dataset in e){b.dataset=i.dataset;break}if(i.default in e){b.dataset=i.default;break}if("select"===i.type&&i.options[i.default]&&i.options[i.default].value in e){b.dataset=i.options[i.default].value;break}if(Array.isArray(i.values)&&i.values[i.default]&&i.values[i.default]in e){b.dataset=i.values[i.default];break}}b.dataset||(b.dataset=i.metadata.datasets[i.metadata.datasets.length-1])}E._u.forEach((e=>{const t=x[e];t.dataset||(t.dataset=b.dataset)})),i.dataviews[b.dataview].dataset=b.dataset}"undefined"!=typeof DataHandler&&(b.dataset=ie(i.dataviews[b.dataview].dataset),"number"==typeof b.dataset&&(b.dataset=i.metadata.datasets[b.dataset]),i.data=new DataHandler(i,b,i.data,{init:ee,onload:function(){i.data.inited&&clearTimeout(i.data.inited.load_screen),setTimeout(Y,600),delete this.onload},data_load:function(){Object.keys(C).forEach(pe)}}),i.data.retrievers.vector=i.data.retrievers.vector.bind(i.data)),u.load_screen&&i.data.inited?i.data.inited.load_screen=setTimeout(Y,3e3):u.wrap.style.visibility="visible"}};"undefined"==typeof module?e(window,document,site):module.exports=e}();