!function(){const e=function(e,t,i){"use strict";const a={rdylbu7:{name:"Red-Yellow-Blue (7)",type:"discrete",colors:["#d73027","#fc8d59","#fee090","#adadad","#e0f3f8","#91bfdb","#4575b4"]},orrd7:{name:"Orange-Red (7)",type:"discrete",colors:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"]},gnbu7:{name:"Green-Blue (7)",type:"discrete",colors:["#a8ddb5","#ccebc5","#f0f9e8","#adadad","#4eb3d3","#2b8cbe","#08589e"]},brbg7:{name:"Brown-Teal (7)",type:"discrete",colors:["#8c510a","#d8b365","#f6e8c3","#adadad","#c7eae5","#5ab4ac","#01665e"]},puor7:{name:"Purple-Orange (7)",type:"discrete",colors:["#b35806","#f1a340","#fee0b6","#adadad","#d8daeb","#998ec3","#542788"]},prgn6:{name:"Purple-Green (6)",type:"discrete",colors:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"]},reds5:{name:"Red (5)",type:"discrete",colors:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"]},greens5:{name:"Green (5)",type:"discrete",colors:["#ffffcc","#c2e699","#78c679","#31a354","#006837"]},paired4:{name:"Blue-Green (4)",type:"discrete",colors:["#1f78b4","#a6cee3","#b2df8a","#33a02c"]},greys4:{name:"Grey (4)",type:"discrete",colors:["#f7f7f7","#cccccc","#969696","#525252"]},grey:{name:"Grey",type:"continuous",colors:[[[70,70,70],[80,80,80]],[150,150,150],[[230,230,230],[-80,-80,-80]]]},brown:{name:"Brown",type:"continuous",colors:[[[131,30,0],[62,85,95]],[193,115,95],[[255,200,190],[-62,-85,-95]]]},purple:{name:"Purple",type:"continuous",colors:[[[90,14,213],[52.5,89,16]],[142.5,103,229],[[195,192,245],[-52.5,-89,-16]]]},prgn:{name:"Purple-Green",type:"continuous-divergent",colors:[[[27,120,55],[207,107,168.5]],[234,227,223.5],[[118,42,131],[116,185,92.5]]]},puor:{name:"Purple-Orange",type:"continuous-divergent",colors:[[[179,88,6],[56,133,202.5]],[235,221,208.5],[[84,39,136],[151,182,72.5]]]},rdbu:{name:"Red-Blue",type:"continuous-divergent",colors:[[[69,117,180],[170,116.5,16]],[239,233.5,196],[[215,48,39],[24,185.5,157]]]},vik:{name:"vik",type:"continuous-polynomial",colors:[[97.031,18.4251,.4149],[461.7602,637.5326,244.4647],[-2434.798,-2838.5427,-5893.4695],[9665.3469,14405.823,44072.722],[-2575.9109,-25871.106,-109792.1319],[-42510.0569,8528.3288,120953.8594],[63342.3061,14006.291,-59644.4457],[-26045.0391,-8868.9621,10155.5667]]},lajolla:{name:"lajolla",type:"continuous-polynomial",colors:[[256.0016,255.9138,204.945],[-187.6735,-46.2889,-768.5655],[1022.785,-1057.5602,1782.0325],[-2032.382,1490.8271,-1785.9056],[966.8373,-617.1949,567.7715]]}},s={seps:/[\s,/._-]+/g,period:/\./,all_periods:/\./g,word_start:/\b(\w)/g,settings:/^settings\./,features:/^features\./,filter:/^filter\./,data:/^data\./,variables:/^variables\./,palette:/^pal/,datasets:/^dat/,variable:/^var/,levels:/^lev/,ids:/^ids/,minmax:/^m[inax]{2}$/,int_types:/^(?:year|integer)$/,end_punct:/[.?!]$/,mustache:/\{(.*?)\}/g,measure_name:/(?:^measure|_name)$/,http:/^https?:\/\//,bool:/^(?:true|false)$/,number:/^[\d-][\d.,]*$/,leading_zeros:/^0+/,url_spaces:/%20/g,hashes:/#/g,embed_setting:/^(?:hide_|navcolor|close_menus)/,median:/^med/i,location_string:/^[^?]*/,time_ref:/\{time\}/g},r="button.has-note::after,.button-wrapper.has-note button::before,.has-note legend::before,.has-note label::before,.wrapper.has-note > div > label::before{display:none}",l={setting:function(a){const s=a.value(),n=s?"dark":"light";s!==i.settings[a.setting]&&(i.settings[a.setting]=s,"theme_dark"===a.setting?(s?t.body.classList.replace("light-theme","dark-theme"):t.body.classList.replace("dark-theme","light-theme"),i.plotly&&Object.keys(i.plotly).forEach((e=>I(i.plotly[e].u))),i.map&&Object.keys(i.map).forEach((e=>{const t=i.map[e].u;t&&n in t.tiles&&(Object.keys(t.tiles).forEach((e=>{n!==e&&t.tiles[e].removeFrom(t.map)})),t.tiles[n].addTo(t.map))}))):"hide_url_parameters"===a.setting?e.history.replaceState(Date.now(),"",i.settings.hide_url_parameters?e.location.protocol+"//"+e.location.host+e.location.pathname:Y()):"hide_tooltips"===a.setting?s?m.script_style.sheet.insertRule(r,0):m.script_style.sheet.removeRule(0):"map_overlay"===a.setting?Object.keys(i.map).forEach((e=>{"_"!==e[0]&&(s?i.map[e].u.update():(i.map[e].u.overlay.clearLayers(),i.map[e].u.overlay_control.remove()))})):re(),h.set(a.setting,i.settings[a.setting]))},options:function(e){const t=!e.view||!i.dataviews[e.view].selection,a=Z(e.dataset),n=Z(e.variable),r=a+(n||""),l="combobox"===e.type;if(r in e.option_sets||(s.variable.test(e.options_source)?O(e,a,e.option_sets):s.levels.test(e.options_source)?q(e,a,n,e.option_sets):s.ids.test(e.options_source)&&A(e,a,e.option_sets)),r in e.option_sets){const a=r!==e.current_set&&(e.sensitive||!e.current_set),s=e[l?"listbox":"e"];a&&(s.innerHTML="",e.values=e.option_sets[r].values,e.display=e.option_sets[r].display,e.options=e.option_sets[r].options);var d=0;if("ID"===e.variable||"ids"===e.options_source){const n=t?{}:i.dataviews[e.view].selection[-1===e.value()?e.subset:e.selection_subset];e.options.forEach((i=>{a&&!e.groups&&s.appendChild(i),t||i.value in n?(i.classList.remove("hidden"),d++):i.classList.add("hidden")}))}else a?e.options.forEach((t=>{t.classList.remove("hidden"),e.groups||s.appendChild(t),d++})):d++;a&&e.groups&&e.groups.e.forEach((e=>s.appendChild(e))),e.e[d?"removeAttribute":"setAttribute"]("disabled",!0),e.current_set=r,a&&(l?e.source=[]:(e.e.selectedIndex=-1,e.source="")),a?e.id in i.url_options?e.set(i.url_options[e.id]):e.reset():e.set(e.value()),e.filter&&e.filter()}},min:async function(e,t){var a=t.value(),n=e.value(),r=E[e.view||t.view];s.minmax.test(a)&&(a=t.parsed.min),r&&r.y&&(Z(r.y)in i.data.variables&&(r.time_range.time.length||await l.time_range(r,e,!0),a=Math.max(r.time_range.time[0],parseFloat(a))),e.update()),e.e.min=void 0===e.parsed.min?parseFloat(a):Math.max(e.parsed.min,parseFloat(a)),e.e.value?"number"==typeof n&&isFinite(n)&&n<a&&e.set(a):e.reset()},max:async function(e,t){var a=t.value(),n=e.value(),r=E[e.view||t.view];s.minmax.test(a)&&(a=t.parsed.max),r&&r.y&&(Z(r.y)in i.data.variables&&(r.time_range.time.length||await l.time_range(r,e,!0),a=Math.min(r.time_range.time[1],parseFloat(a))),e.update()),e.e.max=void 0===e.parsed.max?parseFloat(a):Math.min(e.parsed.max,parseFloat(a)),e.e.value?"number"==typeof n&&isFinite(n)&&n>a&&e.set(a):e.reset()},dataview:function(e){(e=e||E[f.dataview]).value()!==e.state&&(i.data.inited[e.parsed.dataset]?(e.valid=!0,e.n_selected.ids=0,e.n_selected.children=0,e.n_selected.features=0,e.n_selected.variables=0,e.n_selected.dataset=0,e.n_selected.filtered=0,e.n_selected.full_filter=0,e.n_selected.all=0,e.selection.ids={},e.selection.children={},e.selection.features={},e.selection.variables={},e.selection.dataset={},e.selection.filtered={},e.selection.full_filter={},e.selection.all={},Object.keys(i.data.entities).forEach((t=>{const a=e.check(i.data.entities[t]);a.all=0,a.ids&&(e.selection.ids[t]=i.data.entities[t],e.n_selected.ids++,a.all++),a.features&&(e.selection.features[t]=i.data.entities[t],e.n_selected.features++,a.all++),a.variables&&(e.selection.variables[t]=i.data.entities[t],e.n_selected.variables++,a.all++),a.dataset&&(e.selection.dataset[t]=i.data.entities[t],e.n_selected.dataset++,a.all++),a.features&&a.variables&&(e.selection.full_filter[t]=i.data.entities[t],e.n_selected.full_filter++),a.dataset&&a.ids&&(e.selection.children[t]=i.data.entities[t],e.n_selected.children++),a.variables&&a.features&&a.dataset&&(e.selection.filtered[t]=i.data.entities[t],e.n_selected.filtered++),4===a.all&&(e.selection.all[t]=i.data.entities[t],e.n_selected.all++)})),de(e.id)):(e.valid=!1,i.data.data_queue[e.parsed.dataset][e.id]=function(){return l.dataview(e)},i.data.loaded[e.parsed.dataset]&&i.data.load_id_maps()))},time_filters:function(e){e.time_range.filtered[0]=1/0,e.time_range.filtered[1]=-1/0;const t=e.get.dataset(),a=i.data.meta.times[t],s=x[e.id+"_filter"];if(i.data.inited[t]){for(let t=a.n;t--;){let i=!1;if(t>=e.time_range.index[0]&&t<=e.time_range.index[1])for(let s=e.time_filters.length;s--;){const n={},r=e.time_filters[s];if(r.value in n||(n[r.value]=Z(r.value)),i=DataHandler.prototype.checks[r.type](a.value[t],n[r.value]),!i)break}e.times[t]=i,i&&(e.time_range.filtered[0]>a.value[t]&&(e.time_range.filtered[0]=a.value[t]),e.time_range.filtered[1]<a.value[t]&&(e.time_range.filtered[1]=a.value[t]))}e.time_range.filtered_index=[e.time_range.index[0]+e.time_range.filtered[0]-e.time_range.time[0],e.time_range.index[1]+e.time_range.filtered[1]-e.time_range.time[1]],s&&s.forEach((t=>{"update"===t.type?E[t.id].update():t.type in l&&l[t.type](E[t.id],e)}))}},time_range:async function(e,t,a){const s=t&&t.value(),n=e.get.dataset(),r=e.time?Z(e.time):f.time,d=r in i.data.variables?i.data.variables[r].info[n].min:1,o=x[e.id+"_time"],h=s in i.data.variables?s:Z(e.y);if(i.data.inited[n]){var c=h&&await ne(h,e.id);if(c){const t=n+h!=e.time_range.dataset+e.time_range.variable;-1!==(c=c.time_range[n])[0]&&(e.time_range.dataset=n,e.time_range.variable=h,e.time_range.index[0]=c[0],e.time_range.time[0]=e.time_range.filtered[0]=d+c[0],e.time_range.index[1]=c[1],e.time_range.time[1]=e.time_range.filtered[1]=d+c[1]),!a&&o&&(o.forEach((i=>{const a=E[i.id],s=a.value();"min"===i.type?(t||isFinite(e.time_range.time[0])&&parseFloat(a.e.min)!==e.time_range.time[0])&&(a.e.min=e.time_range.time[0],(t||!b.retain_state||e.time_range.time[0]>s)&&a.set(e.time_range.time[0])):"max"===i.type&&(t||isFinite(e.time_range.time[1])&&parseFloat(a.e.max)!==e.time_range.time[1])&&(a.e.max=e.time_range.time[1],(t||!b.retain_state||e.time_range.time[1]<s||s<e.time_range.time[0])&&a.set(e.time_range.time[1]))})),l.time_filters(e))}else e.time_range.dataset=n,e.time_range.index[0]=0,e.time_range.time[0]=e.time_range.filtered[0]=1,e.time_range.index[1]=0,e.time_range.time[1]=e.time_range.filtered[1]=1}}},d={button:{init:function(t){t.target=t.e.getAttribute("target"),"copy"===t.target&&(t.settings.endpoint=i.endpoint),"filter"===t.target?(t.e.setAttribute("data-bs-toggle","modal"),t.e.setAttribute("data-bs-target","#filter_display")):t.e.addEventListener("click",t.settings.effects?"export"===t.target||"copy"===t.target?function(){const a={},s=this.settings,n=E[s.dataview],r=n&&n.parsed.dataset;if(Object.keys(s.query).forEach((e=>a[e]=Z(s.query[e]))),n&&(!("include"in a)&&n.y&&(a.include=Z(n.y)),!("id"in a)&&n.ids&&(a.id=Z(n.ids))),"copy"===this.target||this.api){var l=[];"include"in a&&l.push("include="+a.include),"dataset"in a&&l.push("dataset="+a.dataset),"id"in a&&l.push("id="+a.id),n&&(a.time_range||l.push("time_range="+i.data.meta.times[r].value[n.time_range.filtered_index[0]]+","+i.data.meta.times[r].value[n.time_range.filtered_index[1]]),n.features&&Object.keys(n.features).forEach((e=>{e in a||(a[e]=Z(n.features[e]),Array.isArray(a[e])&&(a[e]=a[e].join(",")),l.push(e+"="+a[e]))})),i.data.filter&&i.data.filter.forEach((e=>{const t=Number(e.value);isNaN(t)||l.push(e.variable+"["+i.data.meta.overall.value[n.parsed.time_agg]+"]"+e.operator+t)})));const d=s.endpoint+(l.length?"?"+l.join("&"):"");this.api?e.location.href=d:navigator.clipboard.writeText(d).then((()=>{"Copied!"!==t.e.innerText&&(t.text=t.e.innerText,t.e.innerText="Copied!",setTimeout((function(){t.e.innerText=t.text}),500))}),(e=>{e!==t.e.innerText&&(t.text=t.e.innerText,t.e.innerText=e,setTimeout((function(){t.e.innerText=t.text}),1500))}))}else n&&"selection"in n?(a.time_range||(a.time_range=i.data.meta.times[r].value[n.time_range.filtered_index[0]]+","+i.data.meta.times[r].value[n.time_range.filtered_index[1]]),i.data.export(a,n.selection.all,!0)):i.data.export(a,i.data.entities,!0)}.bind(t):function(){Object.keys(this.settings.effects).forEach((e=>{""===this.settings.effects[e]||-1==this.settings.effects[e]?E[e].reset():E[e].set(this.settings.effects[e])}))}.bind(t):"refresh"===t.target?re:"reset_selection"===t.target?le:"reset_storage"===t.target?se:function(){this.target in E&&E[this.target].reset()}.bind(t))}},buttongroup:{retrieve:function(){for(let e=this.options.length;e--;)if(this.options[e].checked){this.set(e);break}},setter:function(e){this.previous=this.value(),this.current_index="string"==typeof e?this.values.indexOf(e):e,-1!==this.current_index?(this.source=this.values[this.current_index]in E?E[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,de(this.id)},listener:function(e){this.set(e.target.value)},adder:function(e,a,s,n){var r=[t.createElement("input"),t.createElement("label")];return r[0].className="btn-check",r[0].type="radio",r[0].name=this.e.id+"_options",r[0].autocomplete="off",r[0].value=a,r[0].id=this.e.id+"_option"+e,r[1].className="btn btn-primary",r[1].innerText=s||i.data.format_label(a),r[1].setAttribute("for",r[0].id),n||(this.e.appendChild(r[0]),this.e.appendChild(r[1])),r[0]}},radio:{retrieve:function(){for(let e=this.options.length;e--;)if(this.options[e].checked){this.set(e);break}},setter:function(e){this.current_index="string"==typeof e?this.values.indexOf(e):e,-1!==this.current_index?(this.source=this.values[this.current_index]in E?E[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,de(this.id)},listener:function(e){this.set(e.target.value)},adder:function(e,a,s){const n=t.createElement("div"),r="TRUE"===this.e.getAttribute("switch");return n.className="form-check"+(r?" form-switch":""),n.appendChild(t.createElement("input")),n.appendChild(t.createElement("label")),n.firstElementChild.autocomplete="off",n.firstElementChild.className="form-check-input",r&&(n.firstElementChild.role="switch"),n.firstElementChild.type="radio",n.firstElementChild.name=this.e.id+"_options",n.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,n.firstElementChild.value=e,n.lastElementChild.innerText=a||i.data.format_label(e),n.lastElementChild.className="form-check-label",n.lastElementChild.setAttribute("for",n.firstElementChild.id),s||this.e.appendChild(n),n.firstElementChild}},checkbox:{retrieve:function(){this.source=[],this.current_index=[],this.options.forEach((e=>{e.checked&&(this.source.push(this.values[w]),this.current_index.push(w))})),de(this.id)},setter:function(e){if("object"==typeof e)this.source=[],this.current_index=[],this.values.forEach(((e,t)=>{-1!==e.indexOf(e)?(this.source.push(e),this.current_index.push(t),this.options[t].checked=!0):this.options[t].checked=!1}));else{if("string"==typeof e)return this.set(e.split(","));-1!==e&&(this.options[e].checked=!0)}de(this.id)},listener:function(e){if(e.target.checked)this.source.push(e.target.value),this.current_index.push(this.values.indexOf(e.target.value));else{var t=this.source.indexOf(e.target.value);-1!==t&&(this.source.splice(t,1),this.current_index.splice(t,1))}de(this.id)},adder:function(e,a,s){var n=t.createElement("div"),r="TRUE"===this.e.getAttribute("switch");return n.className="form-check"+(r?" form-switch":""),n.appendChild(t.createElement("input")),n.appendChild(t.createElement("label")),n.firstElementChild.autocomplete="off",n.firstElementChild.className="form-check-input",r&&(n.firstElementChild.role="switch"),n.firstElementChild.type="checkbox",n.firstElementChild.name=this.e.id+"_options",n.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,n.firstElementChild.value=e,n.lastElementChild.innerText=a||i.data.format_label(e),n.lastElementChild.className="form-check-label",n.lastElementChild.setAttribute("for",n.firstElementChild.id),s||this.e.appendChild(n),n.firstElementChild}},switch:{retrieve:function(){this.set(this.e.checked)},setter:function(e){"string"==typeof e&&(e="on"===e),e!==this.source&&(this.previous=this.e.checked,this.e.checked=this.source=e,de(this.id))},listener:function(e){this.set(e.target.checked)}},number:{init:function(e){const t=e.e.parentElement.parentElement;t&&t.firstElementChild.classList.contains("number-down")&&(t.firstElementChild.addEventListener("click",function(){this.set(Math.max(this.parsed.min,this.value()-1))}.bind(e)),t.lastElementChild.addEventListener("click",function(){this.set(Math.min(this.parsed.max,this.value()+1))}.bind(e)))},retrieve:function(){this.set(this.e.value)},setter:function(e){e||(e=null),"string"==typeof e&&(e=parseFloat(e)),isFinite(e)&&e!==this.source&&(this.previous=parseFloat(this.e.value),!isFinite(this.parsed.min)&&e<this.parsed.min?e=this.parsed.min:!isFinite(this.parsed.max)&&e>this.parsed.max&&(e=this.parsed.max),this.e.value=this.source=e,this.current_index=e-this.parsed.min,"range"===this.e.type&&(this.e.nextElementSibling.firstElementChild.innerText=this.e.value),de(this.id))},listener:function(e){this.set(e.target.value)}},text:{init:function(e){i.text&&e.id in i.text&&(e.text=i.text[e.id].text,e.condition=i.text[e.id].condition||[],e.depends={},e.text.forEach((i=>{"text"in i?(N(e,i),e.e.appendChild(i.parts)):(e.e.appendChild(t.createElement("span")),i.forEach((t=>N(e,t))))})),e.condition.forEach((t=>{t.id in E&&S(t.id,{type:"display",id:e.id})})),Object.keys(e.depends).forEach((t=>S(t,{type:"update",id:e.id}))),e.update=d.text.update.bind(e)),e.update()},update:function(){Object.keys(this.reference_options).forEach((e=>this.options[e]=Z(this.reference_options[e]))),Object.keys(this.depends).forEach((e=>{this.depends[e]=Z(e),this.depends[e]in i.data.entities&&(this.depends[e]=i.data.entities[this.depends[e]].features.name)})),this.text.forEach(((e,t)=>{var i=!0;if(e.length){for(let t=e.length;t--;)if("condition"in e[t]){for(let a=e[t].condition.length;a--&&(i=e[t].condition[a].check(),i););if(i){e=e[t];break}}}else if("condition"in e)for(let t=e.condition.length;t--&&(i=e.condition[t].check()););i?(e.text.forEach(((t,i)=>{if(Array.isArray(t)&&t.forEach((e=>{("default"===e.id||DataHandler.prototype.checks[e.type](Z(e.id),Z(e.value)))&&(t=e.text)})),t in this.depends)e.parts.children[i].innerText=this.depends[t];else if(t in e.button){var a="";e.button[t].text.forEach((e=>{a=(e in this.depends?this.depends[e]:e)+a})),e.parts.children[i].innerText=a}else e.parts.children[i].innerText=t})),this.text[t].length?(this.e.children[t].innerHTML="",this.e.children[t].appendChild(e.parts)):e.parts.classList.remove("hidden")):e.parts.classList.add("hidden")}))}},select:{retrieve:function(){this.set(this.e.selectedIndex)},setter:function(e){"string"==typeof e&&!(e in this.values)&&s.number.test(e)&&(e=Number(e)),"number"==typeof e&&(e=this.options[e]?this.options[e].value:e),!(e in this.values)&&e in this.display&&(e=this.options[this.display[e]].value),e!==this.source&&(this.e.selectedIndex=e in this.values?this.values[e]:-1,this.source=e,de(this.id))},listener:function(e){this.set(e.target.selectedIndex)},adder:function(e,a,s,n){const r=t.createElement("option");return r.value=e,r.innerText=a||i.data.format_label(e),s&&s.info&&(r.title=s.info.description||s.info.short_description),n||this.e.appendChild(r),r}},combobox:{init:function(a){a.hover_index=-1,a.cleared_selection="",a.expanded=!1,a.listbox=a.e.parentElement.children[1],a.container=t.createElement("div"),a.container.className="combobox-options-container combobox-component",a.container.style.display="none",m.overlay.appendChild(a.container),a.container.appendChild(a.listbox),a.selection=a.e.firstElementChild.firstElementChild,a.input=a.e.firstElementChild.lastElementChild,2===a.e.childElementCount&&a.e.lastElementChild.addEventListener("click",function(){this.cleared_selection="",this.set(-1),this.input.focus()}.bind(a)),a.value=function(){return this.source?this.settings.multi?this.source:this.source.length?this.source[0]:"":Z(this.default)}.bind(a),a.input.addEventListener("focus",function(){this.e.classList.add("focused")}.bind(a)),a.input.addEventListener("blur",function(){this.e.classList.remove("focused")}.bind(a)),a.listbox.addEventListener("click",a.set),a.close=function(t){!this.expanded||t&&t.target.classList&&t.target.classList.contains("combobox-component")||(""===this.selection.innerText&&(this.selection.innerText=this.cleared_selection),this.e.setAttribute("aria-expanded",!1),this.expanded=!1,this.container.style.display="none",e.removeEventListener("click",a.close))}.bind(a),a.resize=function(){const e=this.e.getBoundingClientRect();this.container.style.top=e.y+e.height+"px",this.container.style.left=e.x+"px",this.container.style.width=e.width+"px"}.bind(a),e.addEventListener("resize",a.resize),a.toggle=function(t){t.button||"BUTTON"===t.target.tagName||(this.expanded?t.target!==this.input&&this.close():(Object.keys(i.combobox).forEach((e=>{e!==this.id&&E[e].close()})),this.container.style.display="",this.settings.multi||(""!==this.selection.innerText&&(this.cleared_selection=this.selection.innerText),this.cleared_selection in this.display&&this.highlight({target:this.options[this.display[this.cleared_selection]]}),this.selection.innerText=""),e.addEventListener("click",this.close),this.e.setAttribute("aria-expanded",!0),t&&t.target===this.input||setTimeout((()=>this.input.focus()),0),this.resize(),this.expanded=!0))}.bind(a),a.e.addEventListener("mousedown",a.toggle),a.highlight=function(e){if(!(e&&e.target&&!(e.target.value in this.values)||(e&&e.target&&e.target.value?this.hover_index=this.values[e.target.value]:-1===this.hover_index&&(this.hover_index=this.values[this.source[0]]),-1===this.hover_index||this.options[this.hover_index].classList.contains("highlighted")))){const e=this.listbox.querySelector(".highlighted");e&&e.classList.remove("highlighted"),this.options[this.hover_index].classList.add("highlighted"),this.e.setAttribute("aria-activedescendant",this.options[this.hover_index].id);const t=this.container.getBoundingClientRect(),i=this.options[this.hover_index].getBoundingClientRect();t.top>i.top?this.container.scrollTo(0,this.container.scrollTop+i.top-t.top):t.bottom<i.bottom&&this.container.scrollTo(0,this.container.scrollTop+i.bottom-t.bottom)}}.bind(a),a.listbox.addEventListener("mouseover",a.highlight),a.filter_reset=function(){this.filter_index=[],this.listbox.querySelectorAll(".filter-hidden").forEach((e=>e.classList.remove("filter-hidden")))}.bind(a),a.settings.search&&a.input.addEventListener("keyup",function(e){const t=this.input.value;""===t?this.filter_reset():(this.filter_index=[],this.options.forEach(((e,i)=>{e.innerText.toLowerCase().includes(t)?(e.classList.remove("filter-hidden"),this.filter_index.push(i)):e.classList.add("filter-hidden")})))}.bind(a)),a.input.addEventListener("keydown",function(e){const t=c[e.code];if(t)if("close"===t)this.close();else if("select"===t){if(!this.expanded)return this.toggle({target:this.input});this.set(e)}else"move"===t&&(e.preventDefault(),"ArrowUp"===e.code?this.filter_index.length?(this.hover_index=this.filter_index.indexOf(this.hover_index)-1,this.hover_index=this.filter_index[0>this.hover_index?0:this.hover_index]):this.hover_index=Math.max(0,this.hover_index-1):"ArrowDown"===e.code?this.filter_index.length?(this.hover_index=this.filter_index.indexOf(this.hover_index)+1,this.hover_index=this.filter_index[this.filter_index.length-1<this.hover_index?this.filter_index.length-1:this.hover_index]):this.hover_index=Math.min(this.options.length-1,this.hover_index+1):"Home"===e.code?this.hover_index=0:"End"===e.code&&(this.hover_index=this.options.length-1),this.expanded?this.highlight():this.set(this.hover_index));else this.expanded||this.toggle({target:this.input})}.bind(a))},retrieve:function(){this.source=[],this.listbox.querySelectorAll(".selected").forEach((e=>this.source.push(e.value))),de(this.id)},setter:function(e,t){let i=!1;var a=-1;if(e.target&&(-1!==(a=this.hover_index)&&(this.options[a].classList.contains("hidden")||this.options[a].classList.contains("filter-hidden"))&&(a=-1),e=-1===a?e.target.innerText:a,t=this.settings.multi),"object"==typeof e){if(this.options.multi)return this.listbox.querySelectorAll(".selected").forEach((e=>e.classList.remove("selected"))),this.source=e,de(this.id);e=e[0]}if(this.settings.strict&&"string"==typeof e&&!(e in this.values)&&s.number.test(e)&&(e=Number(e)),"number"==typeof e&&e>-1&&e<this.options.length&&(e=this.options[e].value),"string"===e&&e in this.display&&(e=this.options[this.display[e]].value),Array.isArray(this.source)||(this.source=[]),this.settings.strict&&!(e in this.values)&&(e=this.default),-1===(a=this.source.indexOf(e))){if(i=!0,this.settings.multi?this.source.push(e):this.source[0]=e,e in this.values){if(!this.settings.multi){const e=this.listbox.querySelector(".selected");e&&e.classList.remove("selected")}this.options[this.values[e]].classList.add("selected")}}else t&&(i=!0,this.source.splice(a,1),e in this.values&&this.options[this.values[e]].classList.remove("selected"));!this.settings.multi&&this.expanded&&(this.input.focus(),this.close(),this.input.value="",this.filter_reset()),this.selection.innerText=this.source.length?this.settings.multi?this.source.length+" of "+this.options.length+" selected":this.source[0]in this.values?this.options[this.values[this.source[0]]].firstChild.textContent:this.settings.strict||-1===this.source[0]?"":this.source[0]:"",i&&de(this.id)},adder:function(e,a,s,n){const r=t.createElement("div");return r.role="option",r.setAttribute("aria-selected",!1),r.tabindex="0",r.className="combobox-option combobox-component",r.value=e,r.innerText=a||i.data.format_label(e),s&&s.info&&(r.appendChild(t.createElement("p")),r.lastElementChild.className="combobox-option-description combobox-component",r.lastElementChild.innerText=s.info.description||s.info.short_description||""),n||this.e.appendChild(r),r}},plotly:{init:function(e){e.id in i.plotly&&(e.x=e.e.getAttribute("x"),e.y=e.e.getAttribute("y"),e.color=e.e.getAttribute("color"),e.time=e.e.getAttribute("color-time"),e.click=e.e.getAttribute("click"),e.click in E&&(e.clickto=E[e.click]),e.parsed={},e.traces={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.tab&&t.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){e.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(X,155))}.bind(e)),e.show=function(e){var t=R(this,e,0,0,"hover_line",f["border_highlight_"+i.settings.theme_dark]);t&&(t.line.width=4,t.marker.size=12,Plotly.addTraces(this.e,t,this.e.data.length))},e.revert=function(){this.e.data.length&&"hover_line"===this.e.data[this.e.data.length-1].name&&Plotly.deleteTraces(this.e,this.e.data.length-1)},e.options&&(i.plotly[e.id].u=e),i.plotly[e.id].data.forEach(((t,i)=>{Object.keys(t).forEach((e=>{if(s.period.test(e)){const a=e.split("."),s=a.length-1;var i=null;a.forEach(((a,n)=>{i=i?i[a]=n===s?t[e]:{}:t[a]={}}))}})),"textfont"in t||(t.textfont={}),"color"in t.textfont||(t.textfont.color=f.background_highlight),"line"in t||(t.line={}),"color"in t.line||(t.line.color=f.background_highlight),"marker"in t||(t.marker={}),t.marker.size=8,"color"in t.marker||(t.marker.color=f.background_highlight),"line"in t.marker||(t.marker.line={}),"color"in t.marker.line||(t.marker.line.color=f.background_highlight),"text"in t||(t.text=[]),"x"in t||(t.x=[]),"box"===t.type?t.hoverinfo="none":"y"in t||(t.y=[]),e.traces[t.type]=JSON.stringify(t),i||(e.base_trace=t.type,e.base_trace in E&&S(e.base_trace,{type:"update",id:e.id}))})),e.x in i.data.variables||S(e.x,{type:"update",id:e.id}),e.y in i.data.variables||S(e.y,{type:"update",id:e.id}),e.time in E&&S(e.time,{type:"update",id:e.id}),e.view?(x[e.view].push({type:"update",id:e.id}),x[e.view+"_filter"].push({type:"update",id:e.id}),E[e.view].time_agg in E&&S(E[e.view].time_agg,{type:"update",id:e.id})):e.view=f.dataview,he.bind(e)())},mouseover:function(e){e.points&&1===e.points.length&&this.e.data[e.points[0].fullData.index]&&(this.e.data[e.points[0].fullData.index].line.width=4,Plotly.react(this.e,this.e.data,this.e.layout),M(this.id,"show",i.data.entities[e.points[0].data.id]))},mouseout:function(e){e.points&&1===e.points.length&&this.e.data[e.points[0].fullData.index]&&(this.e.data[e.points[0].fullData.index].line.width=2,Plotly.react(this.e,this.e.data,this.e.layout),M(this.id,"revert",i.data.entities[e.points[0].data.id]))},click:function(e){this.clickto&&this.clickto.set(e.points[0].data.id)},update:async function(e){if(clearTimeout(this.queue),e){if(this.e.layout){const e=E[this.view],h=e.selection&&e.selection.all,c=e.get.dataset(),p=E[this.time||e.time_agg];if(i.data.inited[c]&&h&&e.time_range.filtered.length){this.parsed.base_trace=Z(this.base_trace),this.parsed.x=Z(this.x),this.parsed.y=Z(this.y),this.parsed.color=Z(this.color||e.y||this.parsed.y);const m=await ne(this.parsed.x,this.view),u=await ne(this.parsed.y,this.view),v=await ne(this.parsed.color,this.view);this.parsed.x_range=m.time_range[c],this.parsed.y_range=u.time_range[c],this.parsed.view=e,this.parsed.dataset=c,this.parsed.palette=Z(e.palette)||i.settings.palette,this.parsed.palette in a||(this.parsed.palette=f.palette),this.parsed.time=(p?p.value()-i.data.meta.times[c].range[0]:0)-v.time_range[c][0],this.parsed.summary=v[this.view].summaries[c];const b=u[this.view].summaries[c],g=this.parsed.summary.missing[this.parsed.time],_=this.parsed.summary.n[this.parsed.time],y=_!==e.n_selected.dataset,E=y?"subset_rank":"rank",x=y?v[this.view].order[c][this.parsed.time]:v.info[c].order[this.parsed.time],C=[];var t,s,n,r=this.parsed.summary.missing[this.parsed.time],l=x?x.length:0,d=i.settings.trace_limit||0,o=e.value()+e.get.time_filters()+c+this.parsed.x+this.parsed.y+this.parsed.palette+this.parsed.color+i.settings.summary_selection+i.settings.color_scale_center+i.settings.color_by_order+i.settings.trace_limit;for(d=n=d&&d<_?Math.ceil(Math.min(d/2,_/2)):0,Object.keys(this.reference_options).forEach((e=>this.options[e]=Z(this.reference_options[e])));r<l;r++)if(x[r][0]in h){t=x[r][0];const e=h[t];if(o+=t,C.push(R(this,e,e[this.view][E][this.parsed.color][this.parsed.time]-g,_)),d&&!--n)break}if(d&&r<l)for(n=r,r=l-1;r>n;r--)if(x[r][0]in h){t=x[r][0];const e=h[t];if(o+=t,C.push(R(this,e,e[this.view][E][this.parsed.color][this.parsed.time]-g,_)),!--d)break}if(o+=C.length&&C[0].type,i.settings.boxplots&&"box"in this.traces&&h[t]&&(o+="box"+i.settings.iqr_box,s=JSON.parse(this.traces.box),C.push(s),s.line.color=f.border,s.median=b.median,s.q3=b.q3,s.q1=b.q1,i.settings.iqr_box?(s.upperfence=[],s.lowerfence=[],s.q1.forEach(((e,t)=>{isNaN(s.median[t])&&(s.median[t]=0);const i=1.5*(s.q3[t]-e),a=s.median[t];s.q3[t]=isNaN(s.q3[t])?a:Math.max(a,s.q3[t]),s.upperfence[t]=s.q3[t]+i,s.q1[t]=isNaN(s.q1[t])?a:Math.min(a,e),s.lowerfence[t]=e-i}))):(s.upperfence=b.max,s.lowerfence=b.min),s.x=s.q1.map(((e,i)=>h[t].get_value(this.parsed.x,i+this.parsed.y_range[0])))),o!==this.state){"boolean"!=typeof this.e.layout.yaxis.title&&(this.e.layout.yaxis.title=i.data.format_label(this.parsed.y)+(i.settings.trace_limit<e.n_selected.all?" ("+i.settings.trace_limit+" extremes)":"")),"boolean"!=typeof this.e.layout.xaxis.title&&(this.e.layout.xaxis.title=i.data.format_label(this.parsed.x)),this.e.layout.yaxis.autorange=!1,this.e.layout.yaxis.range=[1/0,-1/0],s||(s={upperfence:b.max,lowerfence:b.min}),b.min.forEach(((e,t)=>{const i=Math.min(s.lowerfence[t],e),a=Math.max(s.upperfence[t],b.max[t]);this.e.layout.yaxis.range[0]>i&&(this.e.layout.yaxis.range[0]=i),this.e.layout.yaxis.range[1]<a&&(this.e.layout.yaxis.range[1]=a)}));const t=(this.e.layout.yaxis.range[1]-this.e.layout.yaxis.range[0])/10;this.e.layout.yaxis.range[0]-=t,this.e.layout.yaxis.range[1]+=t,i.data.variables[this.parsed.x].is_time&&(this.e.layout.xaxis.autorange?(this.e.layout.xaxis.autorange=!1,this.e.layout.xaxis.type="linear",this.e.layout.xaxis.dtick=1,this.e.layout.xaxis.range=[e.time_range.filtered[0]-.5,e.time_range.filtered[1]+.5]):(this.e.layout.xaxis.range[0]=e.time_range.filtered[0]-.5,this.e.layout.xaxis.range[1]=e.time_range.filtered[1]+.5)),Plotly.react(this.e,C,this.e.layout),setTimeout(X,300),this.state=o}}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))}},map:{init:function(e){if(e.color=e.e.getAttribute("color"),e.time=e.e.getAttribute("color-time"),e.click=e.e.getAttribute("click"),e.click&&e.click in E&&(e.clickto=E[e.click]),e.parsed={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.show=function(t){if(t.layer&&t.layer[this.id])if(i.data.inited[this.parsed.dataset+e.id])t.layer[this.id].setStyle({color:f["border_highlight_"+i.settings.theme_dark]});else{const e=i.map[this.id].match_time(i.data.meta.overall.value[i.data.variables[this.parsed.color].time_range[this.parsed.dataset][0]+this.parsed.time]);t.layer[this.id][e]&&t.layer[this.id][e].setStyle({color:f["border_highlight_"+i.settings.theme_dark]})}},e.revert=function(e){if(e.layer&&e.layer[this.id])if(i.data.inited[this.parsed.dataset+this.id])e.layer[this.id].setStyle({color:f.border});else{const t=i.map[this.id].match_time(i.data.meta.overall.value[i.data.variables[this.parsed.color].time_range[this.parsed.dataset][0]+this.parsed.time]);e.layer[this.id][t]&&e.layer[this.id][t].setStyle({color:f.border})}},e.view?(S(e.view,{type:"update",id:e.id}),E[e.view].time_agg in E&&S(E[e.view].time_agg,{type:"update",id:e.id}),E[e.view].y&&S(E[e.view].y,{type:"update",id:e.id})):e.view=f.dataview,x[e.view].push({type:"update",id:e.id}),e.color in E&&S(e.color,{type:"update",id:e.id}),e.time&&S(e.time,{type:"update",id:e.id}),e.e.style.height||(e.e.style.height=e.options.height?e.options.height:"400px"),e.options.overlays_from_measures&&i.data.variable_info){i.map[e.id].overlays||(i.map[e.id].overlays=[]);const t=i.map[e.id].overlays;Object.keys(i.data.variable_info).forEach((e=>{const a=i.data.variable_info[e];if(a.layer&&a.layer.source){if("string"==typeof a.layer.source&&s.time_ref.test(a.layer.source)){const t=a.layer.source;a.layer.source=[];for(let n,r=i.data.meta.ranges[e],l=r[0],d=r[1];l<d;l++)n=i.data.meta.overall.value[l],a.layer.source.push({url:t.replace(s.time_ref,n),time:n})}s.time_ref.lastIndex=0;const n={variable:e,source:a.layer.source};a.layer.filter&&(n.filter=a.layer.filter),t.push(n)}}))}ce.bind(e)()},mouseover:function(e){e.target.setStyle({color:f["border_highlight_"+i.settings.theme_dark]}),M(this.id,"show",i.data.entities[e.target.feature.properties[e.target.source.id_property]])},mouseout:function(e){M(this.id,"revert",i.data.entities[e.target.feature.properties[e.target.source.id_property]]),e.target.setStyle({color:f.border})},click:function(e){this.clickto&&this.clickto.set(e.target.feature.properties[e.target.source.id_property])},update:async function(e,t,s){if(clearTimeout(this.queue),s){if(this.view&&this.displaying){const e=i.dataviews[this.view],t=e.get.dataset(),s=Z(e.time_agg),r=i.map[this.id].has_time?i.map[this.id].match_time(s):s,d=t+r+this.id in i.data.inited?t+r:t;if(i.map._queue&&d in i.map._queue&&!i.data.inited[d+this.id])return ie(this,i.map._queue[d],(()=>this.update(void 0,void 0,!0)));!e.valid&&i.data.inited[t]&&(e.state="",l.dataview(e,void 0,!0)),this.parsed.view=e,this.parsed.dataset=t;const o=e.value()+d+i.settings.background_shapes+i.data.inited[this.options.background_shapes],h=e.selection.all,c=e.selection[i.settings.background_shapes&&this.options.background_shapes?"ids":"all"],p=f.border,m=Z(this.color||e.y);if(i.settings.map_overlay&&m in i.map[this.id].triggers?ae(this,i.map[this.id].triggers[m],i.data.meta.overall.value[e.parsed.time_agg]):(this.overlay_control.remove(),this.overlay.clearLayers()),i.data.inited[d+this.id]&&c&&e.valid){const s=this.time?E[this.time]:e.time_agg?e.time_agg in E?E[e.time_agg]:parseInt(e.time_agg):0;this.parsed.palette=Z(e.palette)||i.settings.palette,this.parsed.palette in a||(this.parsed.palette=f.palette);const l=await ne(m,this.view);this.parsed.time=(s.parsed?s.value()-i.data.meta.times[t].range[0]:0)-l.time_range[t][0],this.parsed.color=m,this.parsed.summary=l[this.view].summaries[t];const d=this.parsed.summary.n[s]===e.n_selected.dataset?"rank":"subset_rank";if(o!==this.vstate){this.map._zoomAnimated="none"!==i.settings.map_animations,Object.keys(this.reference_options).forEach((e=>{this.options[e]=Z(this.reference_options[e]),"zoomAnimation"===e&&(this.map._zoomAnimated=this.options[e])})),this.displaying.clearLayers(),this.fresh_shapes=!0,this.vstate=!1;var n=0;Object.keys(c).forEach((e=>{const t=c[e].layer;if(t&&t[this.id]){const a=e in h,s=t[this.id].has_time?t[this.id][r]:t[this.id];s&&(a||this.options.background_shapes===i.data.entities[e].group)&&(n++,s.options.interactive=a,s.addTo(this.displaying),a||(s.bringToBack(),s.setStyle({fillOpacity:0,color:p,weight:.3})),this.vstate||(this.vstate=o))}})),this.overlay.bringToFront(),n&&("fly"===i.settings.map_animations?setTimeout((()=>this.map.flyToBounds(this.displaying.getBounds())),400):this.map.fitBounds(this.displaying.getBounds()))}const u=m+this.vstate+this.parsed.palette+this.parsed.time+i.settings.polygon_outline+i.settings.color_by_order+i.settings.color_scale_center;if(u!==this.cstate)if(this.cstate=u,i.map[this.id]){const e=this.displaying._layers,a=this.parsed.summary.n[this.parsed.time],s=this.parsed.summary.missing[this.parsed.time];Object.keys(e).forEach((n=>{const r=e[n];if(t===r.entity.group){const e=h[r.entity.features.id];r.setStyle({fillOpacity:.7,color:f.border,fillColor:e&&m in e[this.view][d]?T(e.get_value(m,this.parsed.time),this.parsed.palette,this.parsed.summary,this.parsed.time,e[this.view][d][m][this.parsed.time]-s,a):f.missing,weight:i.settings.polygon_outline})}}))}else"_waiting"in i.map||(i.map._waiting={}),t in i.map._waiting||(i.map._waiting[t]=[]),-1===i.map._waiting[t].indexOf(this.id)&&i.map._waiting[t].push(this.id),-1===i.map._waiting[t].indexOf(this.view)&&i.map._waiting[t].push(this.view)}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(void 0,void 0,!0)),50))}},info:{init:function(e){function a(e,a){const n={parent:e,text:a,parsed:{},ref:!0,selection:!1,get:function(t,a){if(this.ref){if(t){if("features"in this.parsed)return t.features[this.parsed.features];if("data"in this.parsed){if("value"===this.text?this.parsed.data=Z(e.options.variable||a.color||a.y||E[e.view].y):this.text in E&&(this.parsed.data=Z(this.text)),!(this.parsed.data in i.data.variables))return this.parsed.data;const n=i.data.variable_info[this.parsed.data],r=i.data.format_value(t.get_value(this.parsed.data,this.parent.time),!n||!n.type||s.int_types.test(n.type));return"unknown"!==r&&n.type in o?o[n.type](r):r}}return"data"in this.parsed?i.data.meta.times[this.parent.dataset].value[this.parent.time_agg]:"variables"in this.parsed&&(this.value_source||this.parent.v in i.data.variable_info)?i.data.variable_info[Z(this.value_source||this.parent.v)][this.parsed.variables]:this.text}return this.text}};if("value"===a)n.parsed.data=e.options.variable;else if("summary"===a){e.options.show_summary=!0;const i=t.createElement("table");i.className="info-summary",n.parsed.summary=i,i.appendChild(t.createElement("tr")),i.appendChild(t.createElement("tr")),["NAs","Min","Q1","Mean","Median","Q3","Max"].forEach((e=>{i.firstElementChild.appendChild(t.createElement("th")),i.firstElementChild.lastElementChild.innerText=e,i.lastElementChild.appendChild(t.createElement("td")),i.lastElementChild.lastElementChild.innerText="NA"}))}return s.features.test(a)?n.parsed.features=a.replace(s.features,""):s.data.test(a)?n.parsed.data=a.replace(s.data,""):s.variables.test(a)?n.parsed.variables=a.replace(s.variables,""):n.ref=!1,n}if(e.depends={},e.has_default=e.options.default&&(e.options.default.title||e.options.default.body),B(e.view,e),e.options.floating&&(t.body.appendChild(e.e),e.e.classList.add("hidden"),t.addEventListener("mousemove",(function(t){if(e.showing){const i=m.content.getBoundingClientRect();e.e.style.top=(t.y>i.height/2?t.y-e.e.getBoundingClientRect().height-10:t.y+10)+"px",e.e.style.left=(t.x>i.width/2?t.x-e.e.getBoundingClientRect().width-10:t.x+10)+"px"}}))),e.summary_components=["missing","min","q1","mean","median","q3","max"],e.show=function(e,t){this.update(e,t),this.showing=!0,this.options.floating&&this.e.classList.remove("hidden"),this.parts.title&&(this.selection?this.parts.title.base.classList.add("hidden"):this.parts.title.default.classList.add("hidden"),this.parts.title.temp.classList.remove("hidden")),this.parts.body&&(this.selection?this.parts.body.base.classList.add("hidden"):this.parts.body.default.classList.add("hidden"),this.parts.body.temp.classList.remove("hidden"))},e.revert=function(){this.showing=!1,this.options.floating?this.e.classList.add("hidden"):(this.parts.title&&(this.selection?this.parts.title.base.classList.remove("hidden"):this.has_default&&this.parts.title.default.classList.remove("hidden"),this.parts.title.temp.classList.add("hidden")),this.parts.body&&(this.selection?this.parts.body.base.classList.remove("hidden"):this.has_default&&this.parts.body.default.classList.remove("hidden"),this.parts.body.temp.classList.add("hidden")))},e.parts={},e.options.title&&(e.parts.title=a(e,e.options.title),"variables"in e.parts.title.parsed&&s.measure_name.test(e.parts.title.parsed.variables)?(e.parts.title.base=t.createElement("button"),e.parts.title.base.type="button",e.parts.title.base.setAttribute("data-bs-toggle","modal"),e.parts.title.base.setAttribute("data-bs-target","#variable_info_display"),e.parts.title.base.addEventListener("click",H.bind(e))):e.parts.title.base=t.createElement("p"),e.parts.title.temp=t.createElement("p"),e.parts.title.default=t.createElement("p"),e.parts.title.temp.className=e.parts.title.base.className=e.parts.title.default.className="info-title hidden",e.has_default&&e.options.default.title&&(e.e.appendChild(e.parts.title.default),e.parts.title.default.innerText=e.options.default.title),e.parts.title.ref||(e.parts.title.base.innerText=e.parts.title.get()),e.e.appendChild(e.parts.title.base),e.e.appendChild(e.parts.title.temp),e.parts.title.base.classList.add("hidden"),e.parts.title.temp.classList.add("hidden")),e.options.body){e.parts.body={base:t.createElement("div"),temp:t.createElement("div"),default:t.createElement("div"),rows:[]},e.parts.body.temp.className=e.parts.body.base.className=e.parts.body.default.className="info-body hidden",e.has_default&&e.options.default.body&&(e.parts.body.default.innerText=e.options.default.body);var n=0;e.options.body.forEach(((i,r)=>{const l={name:a(e,i.name),value:a(e,i.value)};e.parts.body.rows[r]=l,l.base=t.createElement("div"),e.parts.body.base.appendChild(l.base),l.temp=t.createElement("div"),e.parts.body.temp.appendChild(l.temp),l.temp.className=l.base.className="info-body-row-"+i.style,n+=24+("stack"===i.style?24:0),l.name&&(e.options.variable_info&&"variables"in l.name.parsed&&s.measure_name.test(l.name.parsed.variables)?(l.base.appendChild(t.createElement("button")),l.base.lastElementChild.type="button",l.base.lastElementChild.setAttribute("data-bs-toggle","modal"),l.base.lastElementChild.setAttribute("data-bs-target","#variable_info_display"),l.base.lastElementChild.addEventListener("click",H.bind(e))):l.base.appendChild(t.createElement("div")),l.temp.appendChild(t.createElement("div")),l.temp.lastElementChild.className=l.base.lastElementChild.className="info-body-row-name",l.temp.lastElementChild.innerText=l.base.lastElementChild.innerText=l.name.get()),l.value&&(l.base.appendChild(t.createElement("div")),l.temp.appendChild(t.createElement("div")),"summary"in l.value.parsed?l.base.lastElementChild.appendChild(l.value.parsed.summary):(l.temp.lastElementChild.className=l.base.lastElementChild.className="info-body-row-value"+("statement"===l.value.parsed.variables?" statement":""),l.value.ref||(l.temp.lastElementChild.innerText=l.base.lastElementChild.innerText=l.value.get())))})),e.e.style.minHeight=n+"px",e.e.appendChild(e.parts.body.base),e.e.appendChild(e.parts.body.default),e.e.appendChild(e.parts.body.temp)}e.update()},update:async function(e,a,s){const n=i.dataviews[this.view],r=E[n.time_agg];if(this.v=Z(this.options.variable||a&&(a.color||a.y)||n.y),this.dataset=n.get.dataset(),r&&!(this.dataset in i.data.meta.times))return;this.time_agg=r?r.value()-i.data.meta.times[this.dataset].range[0]:0;const l=this.v&&i.data.variables[this.v].time_range[this.dataset];this.time=l?this.time_agg-l[0]:0,this.options.show_summary&&(this.var=this.v&&await ne(this.v,this.view),this.summary=this.var[this.view].summaries[this.dataset]),this.processed||(this.processed=!0,this.options.floating||(S(this.view,{type:"update",id:this.id}),n.y in E&&S(n.y,{type:"update",id:this.id}),r&&S(n.time_agg,{type:"update",id:this.id}),this.options.variable in E&&S(this.options.variable,{type:"update",id:this.id})),this.parts.body&&this.parts.body.rows.forEach((e=>{!e.value.ref&&e.value.text in E&&"variables"in e.name.parsed&&(e.name.value_source=e.value.value_source=e.value.text,e.value.ref=!0,e.value.parsed.data="")}))),e?(this.parts.title&&(this.parts.title.temp.innerText=this.parts.title.get(e,a)),this.parts.body&&this.parts.body.rows.forEach((t=>{t.name.ref&&(t.name.value_source&&(t.name.value_source=t.value.text),"object"!=typeof(G=t.name.get(e,a))&&(t.temp.firstElementChild.innerText=z(G,t.value.parsed.variables,this,e))),t.value.ref&&(t.value.value_source&&(t.value.value_source=t.value.text),"object"!=typeof(G=t.value.get(e,a))&&(t.temp.lastElementChild.innerText=z(G,t.value.parsed.variables,this,e)))}))):this.options.floating||(clearTimeout(this.queue),s?((e=i.data.entities[n.get.ids()])?(this.selection=!0,this.parts.title&&(this.parts.title.value_source&&(p.title.value_source=p.value.text),this.parts.title.base.classList.remove("hidden"),this.parts.title.default.classList.add("hidden")),this.parts.body&&this.has_default&&this.parts.body.default.classList.add("hidden")):(this.selection=!1,this.parts.title&&(this.has_default?(this.parts.title.base.classList.add("hidden"),this.parts.title.default.classList.remove("hidden")):this.parts.title.base.classList.remove("hidden")),this.parts.body&&(this.parts.body.base.classList.add("hidden"),this.has_default&&this.parts.body.default.classList.remove("hidden"))),this.parts.title&&(this.parts.title.base.innerText=this.parts.title.get(e,a)),this.parts.body&&(this.options.subto||this.parts.body.base.classList.remove("hidden"),this.parts.body.rows.forEach((s=>{if("summary"in s.value.parsed){const e=s.value.parsed.summary.lastElementChild.children;this.summary_components.forEach(((t,a)=>{e[a].innerText=i.data.format_value(this.summary[t][this.time],0===a)}))}if(!("variables"in s.value.parsed)&&!("summary"in s.value.parsed)||n.y in this.depends||(this.depends[n.y]=!0,S(n.y,{type:"update",id:this.id})),s.name.ref){s.name.value_source&&(s.name.value_source=s.value.text);const t=s.name.get(e,a);"object"!=typeof t&&(s.base.firstElementChild.innerText=t)}if(s.value.ref){const i=s.value.get(e,a);"object"==typeof i?Array.isArray(i)&&"sources"===s.value.parsed.variables&&(s.base.innerHTML="",s.base.appendChild(t.createElement("table")),s.base.lastElementChild.className="source-table",s.base.firstElementChild.appendChild(t.createElement("thead")),s.base.firstElementChild.firstElementChild.appendChild(t.createElement("tr")),s.base.firstElementChild.firstElementChild.firstElementChild.appendChild(t.createElement("th")),s.base.firstElementChild.firstElementChild.firstElementChild.appendChild(t.createElement("th")),s.base.firstElementChild.firstElementChild.firstElementChild.firstElementChild.innerText="Source",s.base.firstElementChild.firstElementChild.firstElementChild.lastElementChild.innerText="Accessed",s.base.firstElementChild.appendChild(t.createElement("tbody")),i.forEach((e=>{s.base.firstElementChild.lastElementChild.appendChild(D(e))}))):s.base.lastElementChild.innerText=z(i,s.value.parsed.variables,this,e)}})))):this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(void 0,void 0,!0)),50))),this.revert()}},datatable:{init:function(e){e.e.appendChild(t.createElement("tHead")),e.e.appendChild(t.createElement("tBody")),e.click=e.e.getAttribute("click"),e.features=e.options.features,e.parsed={summary:{},order:[],time:0,color:"",dataset:E[e.view].get.dataset()},e.header=[],e.rows={},e.rowIds={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0;const a=i.data.meta.times[e.parsed.dataset];if(e.tab&&t.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){e.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(X,155))}.bind(e)),e.e.addEventListener("mouseover",d.datatable.mouseover.bind(e)),e.e.addEventListener("mouseout",d.datatable.mouseout.bind(e)),e.click&&(e.click in E&&(e.clickto=E[e.click]),e.e.addEventListener("click",d.datatable.click.bind(e))),e.show=function(e){if(e.features&&e.features.id in this.rows){const t=this.rows[e.features.id].node();if(t&&(t.style.backgroundColor=f.background_highlight,i.settings.table_autoscroll)){const e=this.e.parentElement.getBoundingClientRect().height,a=t.getBoundingClientRect().y-this.e.getBoundingClientRect().y;this.e.parentElement.scroll({top:e>this.e.scrollHeight-a?this.e.parentElement.scrollHeight:a,behavior:i.settings.table_scroll_behavior||"smooth"})}}},e.revert=function(e){if(e.features&&e.features.id in this.rows){const t=this.rows[e.features.id].node();t&&(t.style.backgroundColor="inherit")}},e.options.variable_source=e.options.variables,e.options.variables?"string"==typeof e.options.variables&&(e.options.variables in E?(S(e.options.variables,{type:"update",id:e.id}),e.options.variables=Z(e.options.variables),e.options.single_variable="string"==typeof e.options.variables):e.options.single_variable||(e.options.single_variable=[{name:e.options.single_variable}])):e.options.variables=Object.keys(i.data.variables),"string"!=typeof e.options.variables&&e.options.variables.length&&"string"===e.options.variables[0]&&(e.options.variables=e.options.variables.map((e=>{}))),e.options.single_variable){const t=e.options.variables,s=t.name||t;e.header.push({title:"Name",data:"entity.features.name"}),a.is_single&&(e.variable_header=!0);const n=i.data.variables[s].time_range[e.parsed.dataset];if(n)for(let r=n[1]-n[0]+1;r--;)e.header[r+1]={title:e.variable_header?t.title||i.data.format_label(s):a.value[r+n[0]]+"",data:i.data.retrievers.vector,render:i.data.retrievers.row_time.bind({i:r,o:n[0],format_value:i.data.format_value.bind(i.data)})};e.options.order=[[e.header.length-1,"dsc"]]}else if(e.options.wide){e.features&&("string"==typeof e.features&&(e.features=[{name:e.features}]),e.features.forEach((t=>{e.header.push({title:t.title||t.name,data:"entity.features."+t.name.replace(s.all_periods,"\\.")})})));for(let t=e.options.variables.length;t--;){"string"==typeof e.options.variables[t]&&(e.options.variables[t]={name:e.options.variables[t]});const a=e.options.variables[t];a.source||(a.source=a.name in i.data.variables?"data":"features"),e.header.push("features"===a.source?{title:a.title||i.data.format_label(a.name),data:"entity.features."+a.name.toLowerCase().replace(s.all_periods,"\\.")}:{title:a.title||i.data.format_label(a.name),render:async function(e,t,a){if("data"===this.c.source){if(this.c.name in i.data.variables){const e=a.time-await ne(this.c.name,this.view).time_range[this.o.parsed.dataset][0];return e<0?NaN:a.entity.get_value(this.c.name,e)}return NaN}return this.c.source in a.entity&&this.c.name in a.entity[this.c.source]?a.entity[this.c.source][this.c.name]:NaN}.bind({o:e,c:a})})}}else e.filters=e.options.filters,e.current_filter={},a.is_single||e.header.push({title:"Year",data:"entity.time.value",render:function(e,t,a){const s=a.time+a.offset;return e&&s>=0&&s<e.length?"number"==typeof e[s]?i.data.format_value(e[s],!0):e[s]:NaN}}),e.features&&("string"==typeof e.features&&(e.features=[{name:e.features}]),e.features.forEach((t=>{e.header.splice(0,0,{title:t.title||t.name,data:"entity.features."+t.name.replace(s.all_periods,"\\.")})}))),e.header.push({title:"Variable",data:function(e){return e.variable in e.entity.variables?e.entity.variables[e.variable].meta.short_name:e.variable}}),e.header.push({title:"Value",data:i.data.retrievers.vector,render:function(e,t,a){return e?"number"==typeof e[a.time]?i.data.format_value(e[a.time],a.int):e[a.time]:""}});e.view?(x[e.view].push({type:"update",id:e.id}),x[e.view+"_filter"].push({type:"update",id:e.id})):e.view=f.dataview,pe.bind(e)()},update:async function(e){if(clearTimeout(this.queue),e){if(this.table){var t=this.options.variable_source&&Z(this.options.variable_source).replace(s.all_periods,"\\.");const a=E[this.view],n=a.get.dataset(),r=n+a.value()+a.get.time_filters()+i.settings.digits+t;if(!i.data.inited[n])return;if(r!==this.state){this.rows={},this.rowIds={},this.table.clear();let l=!0;if(a.selection){if(this.state=r,Object.keys(this.reference_options).forEach((e=>this.options[e]=Z(this.reference_options[e]))),this.options.single_variable){const e=Z(a.time_agg),s=await ne(t,this.view);if(this.parsed.dataset=n,this.parsed.color=t,this.parsed.time_range=s.time_range[n],this.parsed.time=("number"==typeof e?e-i.data.meta.times[n].range[0]:0)-this.parsed.time_range[0],this.parsed.summary=this.view in s&&s[this.view].summaries[n],this.parsed.order=this.view in s&&s[this.view].order[n][this.parsed.time],this.header.length<2||n!==this.header[1].dataset||t!==this.header[1].variable){if(this.table.destroy(),$(this.e).empty(),this.header=[{title:"Name",data:"entity.features.name"}],-1!==this.parsed.time_range[0])for(let e=this.parsed.time_range[2];e--;)this.header[e+1]={dataset:n,variable:t,title:this.variable_header?this.options.variables.title||i.data.format_label(t):i.data.meta.times[n].value[e+this.parsed.time_range[0]]+"",data:i.data.retrievers.vector,render:i.data.retrievers.row_time.bind({i:e,o:this.parsed.time_range[0],format_value:i.data.format_value.bind(i.data)})};else this.state="";this.options.order[0][0]=this.header.length-1,this.options.columns=this.header,this.table=$(this.e).DataTable(this.options)}const r=this.header.length;let l;for(let e=1;e<r;e++)this.table.column(e).visible(a.times[e-1+this.parsed.time_range[0]],!1),a.times[e-1+this.parsed.time_range[0]]&&(l=!1);l&&(this.state="")}if(this.options.wide)Object.keys(a.selection.all).forEach((e=>{if(t)t in a.selection.all[e][this.view].summary&&(this.rows[e]=this.table.row.add({dataset:n,variable:t,offset:this.parsed.time_range[0],entity:a.selection.all[e],int:s.int_types.test(i.data.variable_info[t].type)}),this.rowIds[this.rows[e].selector.rows]=e);else for(let t=i.data.meta.times[n].n;t--;)this.rows[e]=this.table.row.add({time:t,entity:a.selection.all[e]}),this.rowIds[this.rows[e].selector.rows]=e}));else{Object.keys(this.filters).forEach((e=>{this.current_filter[U]=Z(e)}));const r=[];let l=""+this.parsed.dataset+a.get.ids()+a.get.features()+i.settings.digits;for(let a=this.options.variables.length;a--;){if(t=this.options.variables[a].name||this.options.variables[a],e=!1,t in i.data.variables&&"meta"in variable)if(this.options.filters){for(const t in this.current_filter)if(t in variable.meta&&(e=variable.meta[t]===this.current_filter[t],!e))break}else e=!0;e&&(l+=t,r.push({variable:t,int:s.int_types.test(i.data.variable_info[t].type),time_range:variable.time_range[n],renderer:function(e,t){const i=t.features.id,a=this.time_range,s=a[1];for(let r=a[0];r<=s;r++)e.rows[i]=e.table.row.add({offset:this.time_range[0],time:r-this.time_range[0],dataset:n,variable:this.variable,entity:t,int:this.int}),e.rowIds[e.rows[i].selector.rows]=i}}))}if(l===this.varstate)return;this.varstate=l,Object.keys(a.selection.all).forEach((e=>{const l=a.selection.all[e];this.options.single_variable?t in l[a].summary&&variable.code in l.data&&(this.rows[e]=this.table.row.add({offset:this.parsed.time_range[0],dataset:n,variable:t,entity:l,int:s.int_types.test(i.data.variable_info[t].type)}),this.rowIds[this.rows[e].selector.rows]=e):r.forEach((e=>{i.data.variables[e.variable].code in l.data&&e.renderer(this,l)}))}))}}l?this.table.draw():this.table.columns.adjust().draw(!1)}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))},mouseover:function(e){if(e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row],a=this.rows[t].node();a&&(a.style.backgroundColor=f.background_highlight),t in i.data.entities&&M(this.id,"show",i.data.entities[t])}},mouseout:function(e){if(e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row],a=this.rows[t].node();a&&(a.style.backgroundColor="inherit"),t in i.data.entities&&M(this.id,"revert",i.data.entities[t])}},click:function(e){if(this.clickto&&e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row];t in i.data.entities&&this.clickto.set(t)}}},legend:{init:function(e){S(e.view,{type:"update",id:e.id});const a=E[e.view];if(a.time_agg in E&&S(a.time_agg,{type:"update",id:e.id}),e.palette||(a.palette?(e.palette=a.palette,a.palette in E&&S(a.palette,{type:"update",id:e.id})):e.palette="settings.palette"in E?"settings.palette":i.settings.palette),e.variable=e.e.getAttribute("variable"),e.variable?e.variable in E&&S(e.variable,{type:"update",id:e.id}):a.y in E&&S(a.y,{type:"update",id:e.id}),e.palette in E){const t=E[e.palette];t.e&&t.e.addEventListener("change",e.update)}e.parsed={summary:{},order:[],selection:{},time:0,color:""},e.parts={ticks:e.e.querySelector(".legend-ticks"),scale:e.e.querySelector(".legend-scale"),summary:e.e.querySelector(".legend-summary")},e.parts.ticks.setAttribute("of",e.id),e.parts.scale.setAttribute("of",e.id),e.parts.summary.setAttribute("of",e.id),e.e.addEventListener("mousemove",d.legend.mouseover.bind(e)),e.e.addEventListener("mouseout",d.legend.mouseout.bind(e)),e.e.addEventListener("click",d.legend.click.bind(e)),e.click=e.e.getAttribute("click"),e.click in E&&(e.clickto=E[e.click]),e.ticks={center:e.parts.summary.appendChild(t.createElement("div")),min:e.parts.summary.appendChild(t.createElement("div")),max:e.parts.summary.appendChild(t.createElement("div")),entity:e.parts.ticks.appendChild(t.createElement("div"))},Object.keys(e.ticks).forEach((i=>{e.ticks[i].setAttribute("of",e.id),e.ticks[i].className="legend-tick",e.ticks[i].appendChild(G=t.createElement("div")),G.setAttribute("of",e.id),G.appendChild(t.createElement("p")),G.lastElementChild.setAttribute("of",e.id),"m"!==i.substring(0,1)&&(G.appendChild(t.createElement("p")),G.lastElementChild.setAttribute("of",e.id),G.appendChild(t.createElement("p")),G.lastElementChild.setAttribute("of",e.id),"entity"===i?e.ticks[i].firstElementChild.lastElementChild.classList.add("entity"):e.ticks[i].firstElementChild.firstElementChild.classList.add("summary"))})),e.ticks.entity.firstElementChild.classList.add("hidden"),e.ticks.max.className="legend-tick-end max",e.ticks.min.className="legend-tick-end min",e.ticks.center.style.left="50%",e.show=function(e,t){if(e&&"parsed"in t&&e.features.name){const a=E[this.view],s=t.parsed.summary,n=s&&"levels"in s,r=s&&!n?s.min[t.parsed.time]:0,l=s?n?s.levels.length-r:s.range[t.parsed.time]:1,d=s.n[t.parsed.time],o=d===a.n_selected.dataset?"rank":"subset_rank",h=i.data.entities[e.features.id][this.view],c=e.get_value(t.parsed.color,t.parsed.time),p=100*((n?c in s.level_ids:"number"==typeof c)?i.settings.color_by_order?NaN:Math.max(0,Math.min(1,l?((n?s.level_ids[c]:c)-r)/l:0)):NaN),m=this.ticks.entity.firstElementChild.children[1];if(isFinite(p))m.parentElement.classList.remove("hidden"),m.innerText=i.data.format_value(c,this.integer),this.ticks.entity.style.left=p+"%",this.ticks.entity.firstElementChild.firstElementChild.innerText=(p>96||p<4)&&e.features.name.length>13?e.features.name.substring(0,12)+"…":e.features.name;else if(i.settings.color_by_order&&t.parsed.color in h[o]){const i=h[o][t.parsed.color][t.parsed.time],a=i/(d-1)*100;this.ticks.entity.firstElementChild.firstElementChild.innerText=i>-1&&(a>96||a<4)&&e.features.name.length>13?e.features.name.substring(0,12)+"…":e.features.name,i>-1&&(m.parentElement.classList.remove("hidden"),m.innerText="# "+(d-i),this.ticks.entity.style.left=a+"%")}this.ticks.entity.style.marginLeft=-this.ticks.entity.getBoundingClientRect().width/2+"px"}},e.revert=function(){this.ticks.entity.firstElementChild.classList.add("hidden")},e.update()},update:async function(){const e=E[this.view],n=Z(this.variable||e.y),r=e.get.dataset(),l=await ne(n,this.view);if(e.valid&&l&&this.view in l){const c=Z(e.time_agg),p=("number"==typeof c?c-i.data.meta.times[r].range[0]:0)-l.time_range[r][0],m=l[this.view].summaries[r],u=Z(this.palette).toLowerCase(),b=u in a?u:i.settings.palette in a?i.settings.palette:f.palette,g=a[b].colors;if(this.parsed.summary=m,this.parsed.order=l[this.view].order[r][p],this.parsed.time=p,this.parsed.color=n,m&&p<m.n.length){if(this.integer=!i.data.variable_info[n]||!i.data.variable_info[n].type||s.int_types.test(i.data.variable_info[n].type),b+i.settings.color_scale_center!==this.current_palette)if(this.current_palette=b+i.settings.color_scale_center,this.parts.scale.innerHTML="","discrete"===a[b].type)if(i.settings.color_by_order||"none"===i.settings.color_scale_center)g.forEach((e=>{this.parts.scale.appendChild(t.createElement("span")),this.parts.scale.lastElementChild.setAttribute("of",this.id),this.parts.scale.lastElementChild.style.backgroundColor=e}));else{var d,o=0,h=Math.ceil(g.length/2);for(this.parts.scale.appendChild(d=t.createElement("div")),d.setAttribute("of",this.id),d.style.left=0;o<h;o++)d.appendChild(t.createElement("span")),d.lastElementChild.setAttribute("of",this.id),d.lastElementChild.style.backgroundColor=g[o];for(this.parts.scale.appendChild(d=t.createElement("div")),d.setAttribute("of",this.id),d.style.right=0,o=Math.floor(g.length/2),h=g.length;o<h;o++)d.appendChild(t.createElement("span")),d.lastElementChild.setAttribute("of",this.id),d.lastElementChild.style.backgroundColor=g[o]}else this.parts.scale.appendChild(t.createElement("span")),this.parts.scale.appendChild(t.createElement("span")),this.parts.scale.firstElementChild.style.background="linear-gradient(0.25turn, rgb("+g[2][0][0]+", "+g[2][0][1]+", "+g[2][0][2]+"), rgb("+g[1][0]+", "+g[1][1]+", "+g[1][2]+"))",this.parts.scale.lastElementChild.style.background="linear-gradient(0.25turn, rgb("+g[1][0]+", "+g[1][1]+", "+g[1][2]+"), rgb("+g[0][0][0]+", "+g[0][0][1]+", "+g[0][0][2]+"))";l.levels?(this.ticks.center.classList.remove("hidden"),this.ticks.min.firstElementChild.firstElementChild.innerText=l.levels[0],this.ticks.max.firstElementChild.firstElementChild.innerText=l.levels[l.levels.length-1]):i.settings.color_by_order?(this.ticks.center.classList.add("hidden"),this.ticks.min.firstElementChild.firstElementChild.innerText="# "+(m.n[p]?m.n[p]:0),this.ticks.max.firstElementChild.firstElementChild.innerText="# "+(m.n[p]?1:0)):(this.ticks.center.classList.remove("hidden"),this.ticks.min.firstElementChild.firstElementChild.innerText=m.n[p]&&isFinite(m.min[p])?i.data.format_value(m.min[p],this.integer):"unknown",this.ticks.max.firstElementChild.firstElementChild.innerText=m.n[p]&&isFinite(m.max[p])?i.data.format_value(m.max[p],this.integer):"unknown","none"!==i.settings.color_scale_center?(this.ticks.center.firstElementChild.lastElementChild.innerText=v[i.settings.summary_selection]+" "+i.settings.color_scale_center,this.ticks.center.firstElementChild.children[1].innerText=i.data.format_value(m[i.settings.color_scale_center][p]),this.ticks.center.style.left=100*m["norm_"+i.settings.color_scale_center][p]+"%"):(this.ticks.center.firstElementChild.lastElementChild.innerText=v[i.settings.summary_selection]+" median",this.ticks.center.firstElementChild.children[1].innerText=i.data.format_value(m.median[p]),this.ticks.center.style.left=100*m.norm_median[p]+"%"),2===this.parts.scale.childElementCount&&("none"===i.settings.color_scale_center?(this.parts.scale.firstElementChild.style.width="50%",this.parts.scale.lastElementChild.style.width="50%"):(this.parts.scale.firstElementChild.style.width=100*m["norm_"+i.settings.color_scale_center][p]+"%",this.parts.scale.lastElementChild.style.width=100-100*m["norm_"+i.settings.color_scale_center][p]+"%")),this.ticks.center.style.marginLeft=-this.ticks.center.getBoundingClientRect().width/2+"px")}}},mouseover:function(e){const t=this.parts.scale.getBoundingClientRect(),a=(Math.max(t.x,Math.min(t.x+t.width,e.clientX))-t.x)/t.width;var s=!1;if(i.settings.color_by_order)this.parsed.order&&this.parsed.order.length&&(s=i.data.entities[this.parsed.order[Math.max(this.parsed.summary.missing[this.parsed.time],Math.min(this.parsed.order.length-1,Math.floor((this.parsed.order.length-1)*a)))][0]]);else{const e=this.parsed.summary.min[this.parsed.time],t=e+a*(this.parsed.summary.max[this.parsed.time]-e);var n,r;if(this.parsed.order&&this.parsed.order.length&&(r=this.parsed.summary.missing[this.parsed.time])<this.parsed.order.length)if(1!==this.parsed.order.length&&a){for(n=this.parsed.order.length-2;n>=r&&!((this.parsed.order[n][1]+this.parsed.order[n+1][1])/2<=t);--n);n++,s=i.data.entities[this.parsed.order[n][0]]}else s=i.data.entities[this.parsed.order[r][0]]}s&&(this.show(s,this),this.entity&&s.features.id===this.entity.features.id||(this.entity?M(this.id,"revert",this.entity):this.entity=s,M(this.id,"show",s),this.entity=s))},mouseout:function(e){e.relatedTarget&&this.id!==e.relatedTarget.getAttribute("of")&&(this.revert(),this.entity&&(M(this.id,"revert",this.entity),this.entity=!1))},click:function(){this.clickto&&this.entity&&(this.revert(),this.clickto.set(this.entity.features.id))}},credits:{init:function(e){const a=i.credit_output&&i.credit_output[e.id];e.exclude=[],e.add={},e.exclude=a&&a.exclude||[],e.add=a&&a.add||{},e.e.appendChild(t.createElement("ul")),Object.keys(i.credits).forEach((a=>{if(-1===e.exclude.indexOf(a)){const n=i.credits[a];var s;e.e.lastElementChild.appendChild(s=t.createElement("li")),"url"in n&&(s.appendChild(s=t.createElement("a")),s.href=n.url,s.target="_blank",s.rel="noreferrer"),s.innerText=n.name,"version"in n&&(s.appendChild(t.createElement("span")),s.lastElementChild.className="version-tag",s.lastElementChild.innerText=n.version),"description"in n&&(s.parentElement.appendChild(t.createElement("p")),s.parentElement.lastElementChild.innerText=n.description)}}))}}},o={percent:function(e){return e+"%"},"drive time":function(e){return e+" minutes"},minutes:function(e){return e+" minutes"},dollar:function(e){return"$"+e},"internet speed":function(e){return e+" MB/s"}},h={name:e.location.pathname||"default",perm:e.localStorage||{setItem:function(){},getItem:function(){},removeItem:function(){}},set:function(e,t){const i=JSON.parse(this.perm.getItem(this.name))||{};i[e]=t,this.perm.setItem(this.name,JSON.stringify(i))},get:function(e){const t=JSON.parse(this.perm.getItem(this.name));return t?e?t[e]:t:void 0}},c={Enter:"select",NumpadEnter:"select",ArrowUp:"move",Home:"move",ArrowDown:"move",End:"move",Escape:"close",Tab:"close"},m={load_screen:t.getElementById("load_screen"),wrap:t.getElementById("site_wrap"),navbar:t.querySelector(".navbar"),content:t.querySelector(".content"),overlay:t.createElement("div"),menus:t.getElementsByClassName("menu-wrapper"),panels:t.getElementsByClassName("panel")},u={_timeout:0},f={time:"time",dataview:"default_view",palette:"vik",background_highlight:"#adadad",border:"#7e7e7e",border_highlight_true:"#ffffff",border_highlight_false:"#000000",missing:"#00000000"},v={dataset:"Overall",filtered:"Filtered",children:"Unfiltered selection",all:"Selection"},b={retain_state:!0},g={},_={},y={},E={},x={},C={};if(m.overlay.className="content-overlay",t.body.appendChild(m.overlay),t.body.className=h.get("theme_dark")||i.settings.theme_dark?"dark-theme":"light-theme",m.content){for(var w=m.menus.length,k=m.navbar?m.navbar.getBoundingClientRect().height:0;w--;)if(m.menus[w].classList.contains("menu-top")){k=m.menus[w].getBoundingClientRect().height;break}m.content.style.top=k+"px"}function T(e,t,n,r,l,d){if(isNaN(e))return f.missing;const o="none"!==i.settings.color_scale_center&&!i.settings.color_by_order,h="discrete"===a[t].type,c=a[t].colors,p="levels"in n,m=p?0:n.min[r],u=p?n.levels.length-m:n.range[r],v="none"===i.settings.color_scale_center||s.median.test(i.settings.color_scale_center)?"median":"mean",b=i.settings.color_by_order?o?n["break_"+v][r]/d:.5:isNaN(n["norm_"+v][r])?0:n["norm_"+v][r],g=h?o&&!i.settings.color_by_order?Math.ceil(c.length/2):c.length:1,_=i.settings.color_by_order?l/d:u?((p?n.level_ids[e]:e)-m)/u:0,y=_>(o?b:.5);var E=o?u?y?(_-b-n["upper_"+v+"_min"][r])/n["upper_"+v+"_range"][r]:(_+b-n["lower_"+v+"_min"][r])/n["lower_"+v+"_range"][r]:0:_;return h||(E=Math.max(0,Math.min(1,E)),y&&(E=1-E),o||(E*=2)),(p?e in n.level_ids:"number"==typeof e)?h?c[Math.max(0,Math.min(c.length-1,Math.floor(o&&y?g-c.length%2+g*E:g*E)))]:"rgb("+(y?c[0][0][0]+E*c[0][1][0]+", "+(c[0][0][1]+E*c[0][1][1])+", "+(c[0][0][2]+E*c[0][1][2]):c[2][0][0]+E*c[2][1][0]+", "+(c[2][0][1]+E*c[2][1][1])+", "+(c[2][0][2]+E*c[2][1][2]))+")":f.missing}function N(e,i){if("button"in i||(i.button={}),"string"==typeof i.text&&(i.text=[i.text]),i.parts=t.createElement("span"),i.text.forEach((a=>{if(a in i.button){const s=i.button[a];if(i.parts.appendChild(t.createElement("button")),i.parts.lastElementChild.type="button",s.trigger=ee.bind({id:e.id+s.text,note:s.target,wrapper:i.parts.lastElementChild}),"note"===s.type)i.parts.lastElementChild.setAttribute("aria-description",s.target),i.parts.lastElementChild.setAttribute("of",e.id+s.text),i.parts.lastElementChild.className="has-note",i.parts.lastElementChild.addEventListener("mouseover",s.trigger),i.parts.lastElementChild.addEventListener("focus",s.trigger),i.parts.lastElementChild.addEventListener("blur",te);else{i.parts.lastElementChild.className="btn btn-link";const e=E[s.target];e&&"function"==typeof e[s.type]&&(i.parts.lastElementChild.setAttribute("aria-label",s.text.join("")),i.parts.lastElementChild.addEventListener("click",e[s.type]))}}else i.parts.appendChild(t.createElement("span"))})),"condition"in i)for(let t=i.condition.length;t--;){const a=i.condition[t];a.id&&("default"===a.id?a.check=function(){return!0}:(e.depends[a.id]="",a.check=function(){return"default"===this.id||DataHandler.prototype.checks[this.type](Z(this.id),Z(this.value))}.bind(a)))}}function A(e,a,n){if(!(a in i.data.sets))return i.data.data_queue[a][e.id]=function(){return A(e,a,n)},void(i.data.loaded[a]&&i.data.load_id_maps());n[a]={options:[],values:{},display:{}};const r=e.values,l=n[a].options,d=n[a].values,o=n[a].display,h="combobox"===e.type;var c=!e.sensitive&&!!e.current_set,p=0;e.settings.group&&(e.groups={e:[],by_name:{}}),Object.keys(i.data.entities).forEach((n=>{const m=i.data.entities[n];if(a===m.group)if(c&&!(n in r)&&(e.sensitive=!0,c=!1),e.groups){const i=m.features[e.settings.group]||"";if(!(i in e.groups.by_name)){if(h){const a=t.createElement("div"),n=e.id+"_"+i.replace(s.seps,"-");a.className="combobox-group combobox-component",a.role="group",a.setAttribute("aria-labelledby",n),a.appendChild(t.createElement("label")),a.firstElementChild.innerText=i,a.firstElementChild.id=n,a.firstElementChild.className="combobox-group-label combobox-component"}else{t.createElement("optgroup").label=i}e.groups.by_name[i]=m,e.groups.e.push(m)}e.groups.by_name[i].appendChild(e.add(n,m.features.name,!0))}else l.push(e.add(n,m.features.name,!0)),d[n]=p,o[m.features.name]=p++})),e.settings.group&&(p=0,Object.keys(e.groups.by_name).forEach((t=>{e.groups.by_name[t].querySelectorAll("option").forEach((e=>{l.push(e),d[e.value]=p,o[e.innerText]=p++}))})))}function O(e,a,n){n[a]={options:[],values:{},display:{}};const r=e.values,l=n[a].options,d=n[a].values,o=n[a].display,h="combobox"===e.type;var c=!e.sensitive&&!!e.current_set,p=0;e.settings.group&&(e.groups={e:[],by_name:{}}),i.metadata.info[a].schema.fields.forEach((a=>{const n=i.data.variables[a.name];if(n&&!n.is_time){const n=i.data.format_label(a.name);if(c&&!(P in r)&&(e.sensitive=!0,c=!1),e.groups){const i=a.info[e.settings.group]||"";if(!(i in e.groups.by_name)){const a=t.createElement(h?"div":"optgroup");if(h){const n=e.id+"_"+i.replace(s.seps,"-");a.className="combobox-group combobox-component",a.role="group",a.setAttribute("aria-labelledby",n),a.appendChild(t.createElement("label")),a.firstElementChild.innerText=i,a.firstElementChild.id=n,a.firstElementChild.className="combobox-group-label combobox-component"}else a.label=i;e.groups.by_name[i]=a,e.groups.e.push(a)}e.groups.by_name[i].appendChild(e.add(a.name,n,a,!0))}else l.push(e.add(a.name,n,a,!0)),l[p].id=e.id+"-option"+p,d[a.name]=p,o[n]=p++}})),e.settings.group&&(p=0,Object.keys(e.groups.by_name).forEach((t=>{e.groups.by_name[t].querySelectorAll(h?".combobox-option":"option").forEach((t=>{l.push(t),l[p].id=e.id+"-option"+p,d[t.value]=p,o[t.firstChild&&t.firstChild.textContent||t.innerText]=p++}))})))}function q(e,t,a,s){const n=i.data.variables[a].info[t],r="string"===n.type?"levels":"ids",l=n[r];if(l){const i=t+a;s[i]={options:[],values:{},display:{}};const n=e.values,r=s[i].options,h=s[i].values,c=s[i].display;var d=!e.sensitive&&!!e.current_set,o=0;Object.keys(l).forEach((t=>{const i=l[t];d&&!(t in n)&&(e.sensitive=!0,d=!1),r.push(e.add(i.id,i.name,!0)),h[i.id]=o,c[i.name]=o++}))}else"ids"===r&&(i.data.data_queue[t][e.id]=function(){return q(e,t,a,s)},i.data.loaded[t]&&i.data.load_id_maps())}function j(e,t){return e.id in C&&t.id in C?C[e.id]._n.children-C[t.id]._n.children:-1/0}function S(e,t){e in x||(x[e]=[]),x[e].push(t),e in C||(C[e]={_n:{children:0,parents:0},children:{},parents:{}}),t.id in C||(C[t.id]={_n:{children:0,parents:0},children:{},parents:{}}),C[e].children[t.id]=C[t.id],C[e]._n.children++,C[t.id].parents[e]=C[e],C[t.id]._n.parents++,x[e].sort(j),de(e)}function B(e,t){e in g||(g[e]=[]),g[e].push(t)}function M(e,t,i){if(e in g)for(var a=g[e].length;a--;)t in g[e][a]&&g[e][a][t](i,E[e])}function I(e){if(e.dark_theme!==i.settings.theme_dark){e.dark_theme=i.settings.theme_dark;const a=getComputedStyle(t.body);"style"in e||(e.style=e.options.layout,"font"in e.style||(e.style.font={}),"modebar"in e.style||(e.style.modebar={}),"font"in e.style.xaxis||(e.style.xaxis.font={}),"font"in e.style.yaxis||(e.style.yaxis.font={})),e.style.paper_bgcolor=a.backgroundColor,e.style.plot_bgcolor=a.backgroundColor,e.style.font.color=a.color,e.style.modebar.bgcolor=a.backgroundColor,e.style.modebar.color=a.color,e.e._fullLayout.xaxis.showgrid&&(e.style.xaxis.gridcolor=a.borderColor),e.e._fullLayout.yaxis.showgrid&&(e.style.yaxis.gridcolor=a.borderColor),e.style.xaxis.font.color=a.color,e.style.yaxis.font.color=a.color,Plotly.relayout(e.e,e.options.layout)}}function R(e,t,a,s,n,r){if(t.data&&e.parsed.x in i.data.variables){const l=i.data.retrievers.vector({variable:e.parsed.x,entity:t}),d=i.data.retrievers.vector({variable:e.parsed.y,entity:t}),o=JSON.parse(e.traces[e.base_trace]);for(let a=i.data.variables[e.parsed.x].time_range[e.parsed.dataset][2];a--;)o.text[a]=t.features.name,o.x[a]=e.parsed.x_range[0]<=a&&a<=e.parsed.x_range[1]?l[a-e.parsed.x_range[0]]:NaN,o.y[a]=e.parsed.y_range[0]<=a&&a<=e.parsed.y_range[1]?d[a-e.parsed.y_range[0]]:NaN;return o.type=e.parsed.base_trace,o.color=o.line.color=o.marker.color=o.textfont.color=r||T(t.get_value(e.parsed.color,e.parsed.time),e.parsed.palette,e.parsed.summary,e.parsed.time,a,s)||f.border,"bar"===o.type&&(o.marker.line.width=0),o.name=n||t.features.name,o.id=t.features.id,o}}function F(e){const i=t.createElement("li"),a=e.author.length;var n="",r=1===a?"":2===a?" & ":", & ";for(let t=a;t--;){const i=e.author[t];n=(t?r:"")+i.family+(i.given?", "+i.given.substring(0,1)+".":"")+n,r=", "}return i.innerHTML=n+" ("+e.year+"). "+e.title+"."+(e.journal?" <em>"+e.journal+(e.volume?", "+e.volume:"")+"</em>"+(e.page?", "+e.page:"")+".":"")+(e.version?" Version "+e.version+".":"")+(e.doi||e.url?(e.doi?" doi: ":" url: ")+(e.doi||e.url?'<a rel="noreferrer" target="_blank" href="'+(e.doi?"https://doi.org/"+e.doi:e.url)+'">'+(e.doi||e.url.replace(s.http,""))+"</a>":""):""),i}function D(e){var i=t.createElement("tr");return e.name&&(i.appendChild(t.createElement("td")),e.url?(i.firstElementChild.appendChild(t.createElement("a")),i.firstElementChild.firstElementChild.target="_blank",i.firstElementChild.firstElementChild.rel="noreferrer",i.firstElementChild.firstElementChild.href=e.url):i.firstElementChild.appendChild(t.createElement("span")),i.firstElementChild.firstElementChild.innerText=e.name),e.date_accessed&&(i.appendChild(t.createElement("td")),i.lastElementChild.appendChild(t.createElement("span")),i.lastElementChild.firstElementChild.innerText=e.date_accessed),i}function H(){const e=E[this.view],t=i.data.variable_info[Z(this.v||e.y)];if(m.modal.info.header.firstElementChild.innerText=t.short_name,m.modal.info.title.innerText=t.long_name,m.modal.info.description.innerText=t.long_description||t.description||t.short_description||"",m.modal.info.name.lastElementChild.innerText=t.measure||"",m.modal.info.type.lastElementChild.innerText=t.type||"",t.sources&&t.sources.length?(m.modal.info.sources.lastElementChild.lastElementChild.innerHTML="",m.modal.info.sources.classList.remove("hidden"),t.sources.forEach((e=>{m.modal.info.sources.lastElementChild.lastElementChild.appendChild(D(e))}))):m.modal.info.sources.classList.add("hidden"),t.citations&&t.citations.length){if(m.modal.info.references.lastElementChild.innerHTML="",m.modal.info.references.classList.remove("hidden"),"string"==typeof t.citations&&(t.citations=[t.citations]),"references"in i.data&&(delete i.data.variable_info._references,delete i.data.references),!("_references"in i.data.variable_info)){const e={};i.data.variable_info._references=e,Object.keys(i.data.info).forEach((t=>{const a=i.data.info[t];"_references"in a&&Object.keys(a._references).forEach((t=>{t in e||(e[t]={reference:a._references[t],element:F(a._references[t])})}))}))}const e=i.data.variable_info._references;t.citations.forEach((t=>{t in e&&m.modal.info.references.lastElementChild.appendChild(e[t].element)}))}else m.modal.info.references.classList.add("hidden")}function z(e,t,a,n){if("statement"===t)for(var r,l;r=s.mustache.exec(e);)"value"===r[1]?(l=n?i.data.format_value(n.get_value(a.v,a.time),s.int_types.test(i.data.variable_info[a.v].type)):"unknown",e=e.replace(r[0],"unknown"!==l&&i.data.variable_info[a.v].type in o?o[i.data.variable_info[a.v].type](l):l),s.mustache.lastIndex=0):n&&("region_name"===r[1]?(e=e.replace(r[0],n.features.name),s.mustache.lastIndex=0):s.features.test(r[1])?(e=e.replace(r[0],n.features[r[1].replace(s.features,"")]),s.mustache.lastIndex=0):s.variables.test(r[1])?(e=e.replace(r[0],n.variables[a.v][r[1].replace(s.variables,"")]),s.mustache.lastIndex=0):s.data.test(r[1])&&(e=e.replace(r[0],n.get_value(r[1].replace(s.data,""),a.time)),s.mustache.lastIndex=0));return e}var P,G,J,U;if(i.query=P=e.location.search.replace("?",""),i.url_options={},P)for(G=P.split("&"),w=G.length;w--;)(U=G[w].split("=")).length<2&&U.push("true"),U[1]=s.bool.test(U[1])?!!U[1]||"true"===U[1]:U[1].replace(s.url_spaces," "),i.url_options[U[0]]=U[1],s.settings.test(U[0])&&h.set(U[0].replace(s.settings,""),U[1]);if(("embedded"in i.url_options||"hide_navbar"in i.url_options)&&("hide_logo"in i.url_options||(i.url_options.hide_logo=!0),"hide_title"in i.url_options||(i.url_options.hide_title=!0),"hide_navcontent"in i.url_options||(i.url_options.hide_navcontent=!0),"hide_panels"in i.url_options||(i.url_options.hide_panels=!0),"embedded"in i.url_options&&!("close_menus"in i.url_options)&&(i.url_options.close_menus=!0)),(G=t.querySelector(".navbar"))&&("navcolor"in i.url_options&&(""===i.url_options.navcolor&&(i.url_options.navcolor=e.location.hash),G.style.backgroundColor=i.url_options.navcolor.replace("%23","#")),i.url_options.hide_logo&&i.url_options.hide_title&&i.url_options.hide_navcontent?G.classList.add("hidden"):((G=t.querySelector(".navbar-brand"))&&(i.url_options.hide_logo&&"IMG"===G.firstElementChild.tagName&&G.firstElementChild.classList.add("hidden"),i.url_options.hide_title&&"IMG"!==G.lastElementChild.tagName&&G.lastElementChild.classList.add("hidden")),i.url_options.hide_navcontent&&(t.querySelector(".navbar-toggler").classList.add("hidden"),(G=t.querySelector(".navbar-nav"))&&G.classList.add("hidden"))),i.url_options.hide_panels&&m.panels.length))for(w=m.panels.length;w--;)m.panels[w].classList.add("hidden");if(h.copy=h.get(),h.copy)for(const e in i.settings)if(e in h.copy){let t=h.copy[e];s.bool.test(t)?t=!!t||"true"===t:s.number.test(t)&&(t=parseFloat(t)),i.settings[e]=t}function V(e,t,i){const a=i.length;for(var s=i[0][e]+t*i[1][e],n=2;n<a;n++)s+=Math.pow(t,n)*i[n][e];return Math.max(0,Math.min(255,s))}function Q(){i.data.inited&&clearTimeout(i.data.inited.load_screen),m.wrap.style.visibility="visible",m.load_screen.style.display="none"}function W(){m.content.style.top=(m.top_menu&&"open"===m.top_menu.state?m.top_menu.getBoundingClientRect().height:m.content_bounds.top+(!m.top_menu&&!m.left_menu&&!m.right_menu||m.right_menu&&"open"===m.right_menu.state||m.left_menu&&"open"===m.left_menu.state?0:40))+"px",m.content.style.right=m.content_bounds.right+(m.right_menu&&"closed"!==m.right_menu.state?m.right_menu.getBoundingClientRect().width:0)+"px",m.content.style.bottom=m.content_bounds.bottom+(m.bottom_menu&&"closed"!==m.bottom_menu.state?m.bottom_menu.getBoundingClientRect().height:0)+"px",m.content.style.left=m.content_bounds.left+(m.left_menu&&"closed"!==m.left_menu.state?m.left_menu.getBoundingClientRect().width:0)+"px"}function X(){"undefined"==typeof module&&e.dispatchEvent(new Event("resize"))}function Y(){var t="";return y._u.forEach((e=>{if(E[e].input&&!s.settings.test(e)){const i=E[e].value();""!==i&&null!=i&&"-1"!=i&&(t+=(t?"&":"?")+e+"="+i)}})),e.location.protocol+"//"+e.location.host+e.location.pathname+t}function K(){y._u.forEach((async e=>{if(E[e].type in d){const t=E[e],n="combobox"===t.type;if(t.options_source)if(s.palette.test(t.options_source))t.options=[],Object.keys(a).forEach((e=>t.options.push(t.add(e,a[e].name)))),-1===t.default&&(t.default=f.palette);else if(s.datasets.test(t.options_source))t.options=[],i.metadata.datasets.forEach((e=>t.options.push(t.add(e))));else{t.sensitive=!1,t.option_sets={values:{},displays:{},options:[]},t.depends&&S(t.depends,{type:"options",id:t.id}),t.dataset in E&&S(t.dataset,{type:"options",id:t.id}),t.view&&S(t.view,{type:"options",id:t.id});const e=Z(t.dataset)||f.dataset;t.dataset||(t.dataset=e),e in i.metadata.info&&l.options(t)}if(n||"select"===t.type)Array.isArray(t.values)&&(t.values={},t.display={},t.options.forEach(((e,i)=>{t.values[e.value]=i,t.display[e.value]=i})),t.default in t.values||t.default in E||(t.default=Number(t.default),isNaN(t.default)&&(t.default=-1)),t.source="",t.id in i.url_options?t.set(i.url_options[t.id]):t.reset()),t.subset=t.e.getAttribute("subset")||"all",t.selection_subset=t.e.getAttribute("selection-subset")||t.subset,t.type in i&&t.id in i[t.type]&&(t.settings=i[t.type][t.id],t.settings.filters&&(t.filters=t.settings.filters,t.current_filter={},Object.keys(t.filters).forEach((e=>{S(t.filters[e],{type:"filter",id:t.id})})),t.filter=function(){var e;Object.keys(this.filters).forEach((e=>{this.current_filter[e]=Z(this.filters[e])})),Object.keys(this.values).forEach(((t,a)=>{var s=!1;if(t in i.data.variables&&"meta"in i.data.variables[t])for(const e in this.current_filter)if(e in i.data.variables[t].meta&&(s=i.data.variables[t].meta[e]===this.current_filter[e],!s))break;s&&!e&&(e=t),this.options[a].classList[s?"remove":"add"]("hidden")})),this.current_index=this.values[this.value()],e&&(-1===this.current_index||this.options[this.current_index].classList.contains("hidden"))&&this.set(e)}.bind(t)));else if("number"===t.type){if(t.min=t.e.getAttribute("min"),t.min_ref=parseFloat(t.min),t.max=t.e.getAttribute("max"),t.max_ref=parseFloat(t.max),t.ref=isNaN(t.min_ref)||isNaN(t.max_ref),t.range=[t.min_ref,t.max_ref],t.step=parseFloat(t.e.step)||1,t.parsed={min:void 0,max:void 0},t.depends={},t.update=async function(){const e=E[this.view],a=Z(t.variable||e.y);e.time_range||(e.time_range={time:[]});var n=e.get?e.get.dataset():Z(this.dataset),r=Z(this.min)||e.time,l=Z(this.max)||e.time;s.minmax.test(r)&&(r=E[this.min][r]),s.minmax.test(l)&&(l=E[this.max][l]),this.parsed.min=isNaN(this.min_ref)?void 0===r?e.time_range.time[0]:"number"==typeof r?r:r in i.data.variables?i.data.variables[r].info[n||i.data.variables[r].datasets[0]].min:parseFloat(r):this.min_ref,this.parsed.max=isNaN(this.max_ref)?void 0===l?e.time_range.time[1]:"number"==typeof l?l:l in i.data.variables?i.data.variables[l].info[n||i.data.variables[l].datasets[0]].max:parseFloat(l):this.min_ref,this.ref&&a in i.data.variables?(this.range[0]=this.e.min=isNaN(this.min_ref)?Math.max(e.time_range.time[0],this.parsed.min):this.min_ref,this.range[1]=this.e.max=isNaN(this.max_ref)?Math.min(e.time_range.time[1],this.parsed.max):this.max_ref,this.depends[e.y]||(this.depends[e.y]=!0,S(e.y,{type:"update",id:this.id})),a!==this.variable&&this.reset(),this.variable=await ne(a,this.view)):(this.e.min=this.parsed.min,(this.parsed.min>this.source||!this.source&&"min"===this.default)&&this.set(this.parsed.min),this.e.max=this.parsed.max,(this.parsed.max<this.source||!this.source&&"max"===this.default)&&this.set(this.parsed.max))}.bind(t),t.view&&S(t.view,{type:"update",id:t.id}),t.max in i.data.variables?t.view&&S(t.view+"_time",{type:"max",id:t.id}):t.max in E?S(t.max,{type:"max",id:t.id}):t.e.max=parseFloat(t.max),t.min in i.data.variables?t.view&&S(t.view+"_time",{type:"min",id:t.id}):t.min in E?S(t.min,{type:"min",id:t.id}):t.e.min=parseFloat(t.min),void 0!==t.default&&(s.number.test(t.default)?t.default=Number(t.default):t.reset="max"===t.default||"last"===t.default?function(){this.range&&this.set(Z(this.range[1]))}.bind(t):"min"===t.default||"first"===t.default?function(){this.range&&this.set(Z(this.range[0]))}.bind(t):this.default in E?function(){this.set(Z(this.default))}.bind(t):function(){}),t.variable){const e=-1===i.metadata.datasets.indexOf(t.dataset)?f.dataset:t.dataset;t.variable in E?S(t.variable,{type:"update",id:t.id}):t.variable in i.data.variables&&(t.e.min=t.min=t.parsed.min=t.range[0]=i.data.variables[t.variable].info[e].min,t.e.max=t.max=t.parsed.max=t.range[1]=i.data.variables[t.variable].info[e].max)}}else"checkbox"===t.type&&(t.source=[],t.current_index=[],t.default=t.default.split(","));Array.isArray(t.values)&&(t.values.length||(t.values=[],t.options.length&&t.options.forEach((e=>t.values.push(e.value)))),t.values.length&&!(t.default in E)&&-1===t.values.indexOf(t.default)&&(t.default=parseInt(t.default),t.default=t.values.length>t.default?t.values[t.default]:"")),n||"select"===t.type||"number"===t.type?(t.e.addEventListener("change",t.listen),t.e.parentElement.lastElementChild&&t.e.parentElement.lastElementChild.classList.contains("select-reset")&&t.e.parentElement.lastElementChild.addEventListener("click",t.reset)):"switch"===t.type?("boolean"!=typeof t.default&&(t.default=t.e.checked),t.e.addEventListener("change",t.listen)):t.listen&&t.options.forEach((e=>e.addEventListener("click",t.listen))),s.settings.test(t.id)&&(t.setting=t.id.replace(s.settings,""),null==t.default&&t.setting in i.settings&&(t.default=i.settings[t.setting]),S(t.id,{type:"setting",id:t.id})),t.view||(t.view=f.dataview);const r=i.url_options[t.id]||h.get(t.id.replace(s.settings,""));r?t.set(s.bool.test(r)?!!r||"true"===r:r):t.reset&&t.reset()}})),Object.keys(i.dataviews).forEach((e=>{const t=i.dataviews[e];E[e]=t,t.id=e,t.value=function(){if(this.get)return this.reparse(),""+this.parsed.dataset+i.data.inited[this.parsed.dataset]+this.parsed.ids+this.parsed.features+this.parsed.variables+i.settings.summary_selection}.bind(t),"string"==typeof t.palette&&t.palette in E&&S(t.palette,{type:"dataview",id:e}),"string"==typeof t.dataset&&t.dataset in E&&S(t.dataset,{type:"dataview",id:e}),"string"==typeof t.ids&&t.ids in E&&S(t.ids,{type:"dataview",id:e}),t.time_range={dataset:"",variable:"",index:[],time:[],filtered:[]},S(e,{type:"time_range",id:e}),t.x in E&&S(t.x,{type:"time_range",id:e}),t.y in E&&S(t.y,{type:"time_range",id:e}),t.features&&Object.keys(t.features).forEach((i=>{"string"==typeof t.features[i]&&t.features[i]in E&&S(t.features[i],{type:"dataview",id:e})})),t.variables&&t.variables.forEach((i=>{"variable"in i?i.variable in E&&S(i.variable,{type:"dataview",id:e}):t.variables.splice(w,1),"type"in i?i.type in E&&S(i.type,{type:"dataview",id:e}):i.type="=","value"in i?i.value in E&&S(i.value,{type:"dataview",id:e}):i.value=0})),function(e){e.times=[],e.time_filters&&(e.time_filters=[{variable:f.time,type:">=",value:"filter.time_min"},{variable:f.time,type:"<=",value:"filter.time_max"}],S(e.id+"_time",{type:"min",id:"filter.time_min"}),S(e.id+"_time",{type:"max",id:"filter.time_max"}),e.time_filters.forEach((t=>{t.value in E&&S(t.value,{type:"time_filters",id:e.id})})));e.selection={ids:{},features:{},variables:[],dataset:{},filtered:{},all:{}},e.n_selected={ids:0,features:0,variables:0,dataset:0,filtered:0,all:0},e.get={dataset:function(){return Z("string"==typeof e.dataset&&e.dataset in E?E[e.dataset].value():e.dataset)||f.dataset},ids:function(){return Z("string"==typeof e.ids&&e.ids in E?E[e.ids].value():e.ids)},features:function(){var t="";return e.features&&Object.keys(e.features).forEach((i=>{t+=i+Z(e.features[i])})),t},variables:function(){if(e.variables||i.data.filter&&i.data.filter.size){e.parsed.variable_values.length||e.reparse();var t="";return e.parsed.variable_values.forEach((e=>{t+=e.name+e.operator+e.value})),t}return""},time_filters:function(){var t="";return e.time_filters&&e.time_filters.forEach((e=>{t+=e.value in E?Z(e.value):e.value})),t}},e.ids_check="object"==typeof e.get.ids()?DataHandler.prototype.checks.includes:function(e,t){return!e||-1==e||e===t||t&&e.length>2&&e===String(t).substring(0,e.length)},e.parsed={dataset:"",ids:"",features:"",variables:"",time_filters:"",time_agg:0,id_source:"",variable_values:[],feature_values:{}},e.reparse=function(){if(this.parsed.dataset=this.get.dataset(),this.parsed.ids=this.get.ids(),this.parsed.time_filters=this.get.time_filters(),this.parsed.time_agg=this.parsed.dataset in i.data.meta.times?Z(this.time_agg)-i.data.meta.times[this.parsed.dataset].range[0]:0,"string"==typeof this.ids&&this.ids in E&&("virtual"===E[this.ids].type&&E[this.ids].source in E||"depends"in E[this.ids]&&E[this.ids].depends in E)&&(this.parsed.id_source="virtual"===E[this.ids].type?Z(E[E[this.ids].source].dataset):E[E[this.ids].depends].value()),this.features){for(var e in this.parsed.feature_values={},this.features)e in this.features&&(this.parsed.feature_values[e]={value:Z(this.features[e])},this.parsed.feature_values[e].operator="string"==typeof this.parsed.feature_values[e].value?"equals":"includes");this.parsed.features=this.get.features()}else this.parsed.features="";if(this.parsed.variable_values=[],i.data.filter&&i.data.filter.size&&i.data.filter.forEach((e=>{const t=Number(e.value);isNaN(t)||this.parsed.variable_values.push({name:e.variable,operator:e.operator,value:t,value_type:"number"})})),this.variables||this.parsed.variable_values.length){if(this.variables)for(var t,a=this.variables.length;a--;)t=Z(this.variables[a].value),this.parsed.variable_values.push({name:Z(this.variables[a].variable),operator:Z(this.variables[a].type),value:t,value_type:typeof t});this.parsed.variables=this.get.variables()}else this.parsed.variables=""}.bind(e),e.checks={dataset:function(e){return this.parsed.dataset===e.group}.bind(e),ids:("string"==typeof e.ids&&e.ids in E&&("virtual"===E[e.ids].type&&E[e.ids].source in E||"depends"in E[e.ids]&&E[e.ids].depends in E)?"virtual"===E[e.ids].type?function(e){return e.features&&this.ids_check(this.parsed.ids,e.features[this.parsed.id_source&&e.group!==this.parsed.id_source&&this.parsed.id_source in e.features?this.parsed.id_source:"id"])}:function(e){return e.features&&this.ids_check(this.parsed.ids,this.parsed.id_source in e.features?Z(e.features[this.parsed.id_source]):e.features.id)}:function(e){return e.features&&this.ids_check(this.parsed.ids,e.features.id)}).bind(e),features:function(e){if(e.features){var t,i,a=!0;for(t in this.parsed.feature_values)if(t in this.parsed.feature_values&&(i=this.parsed.feature_values[t],!(a=DataHandler.prototype.checks[i.operator](i.value,Z(e.features[t])))))break;return a}return!0}.bind(e),variables:function(e){if(e.data){var t;for(let a=this.parsed.variable_values.length;a--;){const s=this.parsed.variable_values[a],n=e.get_value(s.name,this.parsed.time_agg-i.data.variables[s.name].info[this.parsed.dataset].time_range[0]);if(t=isNaN(n)||DataHandler.prototype.checks[s.operator](n,s.value),!t)break}return t}return!0}.bind(e)},e.check=function(e){return{ids:!this.ids||this.checks.ids(e),features:!this.features||this.checks.features(e),variables:!this.variables&&(!i.data.filter||!i.data.filter.size)||this.checks.variables(e),dataset:!this.dataset||this.checks.dataset(e)}}.bind(e)}(t),l.dataview(t),t.reparse()})),t.querySelectorAll(".auto-output").forEach(((e,t)=>{const a={type:e.getAttribute("auto-type"),view:e.getAttribute("data-view")||f.dataview,id:e.id||"out"+t,note:e.getAttribute("aria-description")||"",reference_options:{},e:e};a.note&&a.e.addEventListener("mouseover",ee.bind(a)),a.options=a.type in i?i[a.type][a.id]:void 0,a.options&&a.options.dataview&&(a.view=a.options.dataview),a.type in d&&"update"in d[a.type]&&(a.update=d[a.type].update.bind(a)),a.options&&("options"in a.options&&(a.options=a.options.options),Object.keys(a.options).forEach((e=>{a.options[e]in E&&(a.reference_options[e]=a.options[e])})),"subto"in a.options&&("string"==typeof a.options.subto&&(a.options.subto=[a.options.subto]),Array.isArray(a.options.subto)&&a.options.subto.forEach((e=>B(e,a))))),E[a.id]=a,a.view&&(a.view in x||(x[a.view]=[]),a.view+"_filter"in x||(x[a.view+"_filter"]=[])),a.type in d&&"init"in d[a.type]&&(!a.view||E[a.view].parsed.dataset in i.data.inited?d[a.type].init(a):(i.data.data_queue[E[a.view].parsed.dataset][a.id]=d[a.type].init.bind(null,a),i.data.loaded[E[a.view].parsed.dataset]&&i.data.load_id_maps()))})),(G=m.modal.filter).body.appendChild(G.variable_filters=t.createElement("div")),G.variable_filters.appendChild(t.createElement("p")),G.variable_filters.lastElementChild.className="h6 text-muted",G.variable_filters.lastElementChild.innerText="Variable Conditions",G.variable_filters.appendChild(J=t.createElement("div")),J.className="row",J.appendChild(t.createElement("div")),J.lastElementChild.className="col",J.lastElementChild.appendChild(U=t.createElement("div")),U.className="dropdown",U.appendChild(t.createElement("button")),U.lastElementChild.type="button",U.lastElementChild.id="filter_variable_dropdown",U.lastElementChild.className="btn dropdown-toggle",U.lastElementChild.setAttribute("data-bs-toggle","dropdown"),U.lastElementChild.setAttribute("aria-expanded",!1),U.lastElementChild.innerText="Add Variable Condition",U.appendChild(t.createElement("ul")),U.lastElementChild.addEventListener("click",function(e){if("A"===e.target.tagName){i.data.filter||(i.data.filter=new Map);const s=t.createElement("div"),n={e:s,index:i.data.filter.size,variable:e.target.value,component:"selected",operator:">=",value:""};var a;s.setAttribute("index",i.data.filter.size),i.data.filter.set(i.data.filter.size,n),s.className="row",s.appendChild(t.createElement("div")),s.lastElementChild.className="col",s.lastElementChild.appendChild(a=t.createElement("p")),a.className="cell-text",a.innerText=e.target.innerText,s.appendChild(t.createElement("div")),s.lastElementChild.style.maxWidth="140px",s.lastElementChild.className="col",s.lastElementChild.appendChild(a=t.createElement("select")),a.className="form-select",a.default="0",a.addEventListener("change",(e=>{n.component=e.target.selectedOptions[0].value,l.dataview()})),["selected"].forEach((e=>{a.appendChild(t.createElement("option")),a.lastElementChild.component=a.lastElementChild.innerText=e,l.dataview()})),s.appendChild(t.createElement("div")),s.lastElementChild.style.maxWidth="95px",s.lastElementChild.className="col",s.lastElementChild.appendChild(a=t.createElement("select")),a.className="form-select",a.default="0",a.addEventListener("change",(e=>{n.operator=e.target.selectedOptions[0].value,l.dataview()})),[">=","<="].forEach((e=>{a.appendChild(t.createElement("option")),a.lastElementChild.value=a.lastElementChild.innerText=e,l.dataview()})),s.appendChild(t.createElement("div")),s.lastElementChild.className="col-2",s.lastElementChild.appendChild(a=t.createElement("input")),a.className="form-control",a.type="number",a.addEventListener("change",(e=>{n.value=e.target.value,l.dataview()})),s.appendChild(t.createElement("div")),s.lastElementChild.style.maxWidth="36px",s.lastElementChild.className="col",s.lastElementChild.appendChild(a=t.createElement("button")),a.className="btn btn-close",a.type="button",a.addEventListener("mouseup",function(){this.e.parentElement.removeChild(this.e),i.data.filter.delete(this.index),l.dataview()}.bind(n)),m.modal.filter.variable_filters.lastElementChild.appendChild(s)}}.bind(G)),U.lastElementChild.className="dropdown-menu",U.lastElementChild.setAttribute("aria-labelledby","filter_variable_dropdown"),Object.keys(i.data.variables).forEach((e=>{if("time"!==e){const a=t.createElement("li");a.appendChild(t.createElement("a")),a.lastElementChild.className="dropdown-item",a.lastElementChild.href="#",a.lastElementChild.value=e,a.lastElementChild.innerText=i.data.variable_info[e]&&i.data.variable_info[e].short_name||e,U.lastElementChild.appendChild(a)}})),G.variable_filters.appendChild(t.createElement("div")),G.variable_filters.lastElementChild.className="row",y._u=Object.keys(E)}function Z(e){return e in E&&(e=E[e]),e&&e.value&&(e=Z(e.value())),e}function ee(){if(i.settings.hide_tooltips||this.id===m.tooltip.showing)return;m.tooltip.showing=this.id,m.tooltip.e.firstElementChild.innerText=this.note,m.tooltip.e.classList.remove("hidden");const e=m.wrap.getBoundingClientRect(),t=this.wrapper.getBoundingClientRect(),a=m.tooltip.e.getBoundingClientRect();m.tooltip.e.style.left=Math.max(0,Math.min(t.x,t.x+t.width/2-a.width/2))+"px",m.tooltip.e.style.top=t.y+(t.y<e.height/2?t.height+5:-a.height-5)+"px"}function te(e){!m.tooltip.showing||"blur"!==e.type&&m.tooltip.showing===(e.target.getAttribute("of")||e.target.id)||(m.tooltip.showing="",m.tooltip.e.classList.add("hidden"))}async function ie(t,a,n){if(a.url in i.map._raw)!function(e,t){var a,n;const r="time"in e,l=e.name+(r?e.time:"");if(i.map[t.id]._layers[l]=L.geoJSON(JSON.parse(i.map._raw[e.url]),{onEachFeature:(l,o)=>{o.on({mouseover:d.map.mouseover.bind(t),mouseout:d.map.mouseout.bind(t),click:d.map.click.bind(t)}),o.setStyle({weight:0,fillOpacity:0}),o.source=e,a=o.feature.properties,!((n=a[e.id_property])in i.data.entities)&&s.leading_zeros.test(n)&&(n=a[e.id_property]=n.replace(s.leading_zeros,"")),n in i.data.entities?"layer"in i.data.entities[n]||(i.data.entities[n].layer={}):i.data.entities[n]={layer:{},features:{id:n}},r?(t.id in i.data.entities[n].layer||(i.data.entities[n].layer[t.id]={has_time:!0}),i.data.entities[n].layer[t.id][e.time]=o):i.data.entities[n].layer[t.id]=o,o.entity=i.data.entities[n],i.data.entities[n].features&&Object.keys(a).forEach((e=>{e in i.data.entities[n].features||("name"!==e.toLowerCase()||"name"in i.data.entities[n].features&&i.data.entities[n].features.id!==i.data.entities[n].features.name?i.data.entities[n].features[e]=a[e]:i.data.entities[n].features[e.toLowerCase()]=a[e])}))}}),i.data.inited[l+t.id]=!0,i.map._waiting&&i.map._waiting[e.name])for(let t=i.map._waiting[e.name].length;t--;)de(i.map._waiting[e.name][t])}(a,t),i.map._queue[a.name+(a.time?a.time:"")].retrieved=!0,n&&n();else{const t=new e.XMLHttpRequest;t.onreadystatechange=()=>{4===t.readyState&&200===t.status&&(i.map._raw[a.url]=t.responseText,a.name&&(i.map._queue[a.name+(a.time||"")].retrieved=!0),n&&n())},t.open("GET",a.url,!0),t.send()}}function ae(e,a,s){var n=0,r="string"==typeof a.source?a.source:"";if(!r&&a.source)for(n=a.source.length;n--;)if(!a.source[n].time||s===a.source[n].time){a.source[n].name&&delete a.source[n].name,r=a.source[n].url;break}if(r){if(!(r in i.map._raw))return ie(e,a.source[n],ae.bind(null,e,a,s));r in i.map[e.id]._layers||(i.map[e.id]._layers[r]=L.geoJSON(JSON.parse(i.map._raw[r]),{pointToLayer:(e,t)=>L.circleMarker(t),onEachFeature:(e,i)=>{const a=t.createElement("table");Object.keys(e.properties).forEach((i=>{const s=t.createElement("tr");s.appendChild(t.createElement("td")),s.appendChild(t.createElement("td")),s.firstElementChild.innerText=i,s.lastElementChild.innerText=e.properties[i],a.appendChild(s)})),i.bindTooltip(a)}})),e.overlay.clearLayers();var l=0;i.map[e.id]._layers[r].eachLayer((t=>{if(a.filter)for(let e=a.filter.length;e--;)if(!a.filter[e].check(t.feature.properties[a.filter[e].feature],a.filter[e].value))return;l++,t.setRadius(i.settings.circle_radius).setStyle({weight:i.settings.polygon_outline,color:"white",opacity:.5,fillOpacity:.5,fillColor:"black"}),t.addTo(e.overlay)})),l&&e.overlay_control.addTo(e.map)}}function se(){e.localStorage&&h.perm.removeItem(h.name),e.location.reload()}async function ne(e,t){return e in i.data.variables&&await i.data.calculate_summary(e,t,!0),i.data.variables[e]}function re(){b.retain_state=!1,y._u.forEach(de)}function le(){b.retain_state=!1,y._u.forEach((e=>{!E[e].setting&&E[e].reset&&(E[e].reset(),de(e))}))}function de(e){u[e]=!0,clearTimeout(u._timeout),u._timeout=setTimeout(oe,20),b.lock_after=e}function oe(){clearTimeout(u._timeout),y._u.forEach((e=>{if(u[e]){const t=function(e){if(e in x){const t=E[e],a=x[e],s=[],n=t&&t.value()+"",r=t&&t.dataset&&Z(t.dataset)||n;if(t&&(!b.retain_state||t.state!==n)){if(r in i.metadata.info&&!i.data.loaded[r])return i.data.retrieve(r,i.metadata.info[r].site_file),r;t.state=n,a.forEach((e=>{"rule"===e.type?-1===s.indexOf(e.rule)&&s.push(i.rules[e.rule]):"function"==typeof E[e.id][e.type]?E[e.id][e.type]():l[e.type](E[e.id],t)})),s.forEach((e=>{var t=!1;const i=e.condition.length;for(let a=0;a<i;a++){const i=e.condition[a];if(t=i.check(),i.any?t:!t)break}Object.keys(e.effects).forEach((i=>{const a=e.effects[i];t?"display"===i?a.e.classList.remove("hidden"):i in E&&E[i].set(Z(a)):"display"===i?(a.e.classList.add("hidden"),a.u&&a.u.reset(),a.e.querySelectorAll(".auto-input").forEach((e=>{e.id in E&&E[e.id].reset()}))):"default"in e&&i in E&&E[i].set(Z(e.default))}))})),e===b.lock_after&&(b.retain_state=!0)}}}(e);if(t)return i.data.data_queue[t][e]=oe,i.data.loaded[t]&&i.data.load_id_maps(),!1;u[e]=!1}}));const t=Y();i.data.inited.first&&t!==i.state&&(i.state=t,Object.keys(i.url_options).forEach((e=>{s.embed_setting.test(e)&&(t+="&"+e+"="+("navcolor"===e?i.url_options[e].replace(s.hashes,"%23"):i.url_options[e]))})),i.settings.hide_url_parameters||e.history.replaceState(Date.now(),"",t),setTimeout(W,50))}function he(){const t=this.deferred||!this.tab||this.tab.classList.contains("show");t&&e.Plotly?(Plotly.newPlot(this.e,this.options),this.e.on("plotly_hover",d.plotly.mouseover.bind(this)).on("plotly_unhover",d.plotly.mouseout.bind(this)).on("plotly_click",d.plotly.click.bind(this)),I(this),this.update()):(this.deferred=!0,setTimeout(he.bind(this),t?0:2e3))}function ce(){const t=i.settings.theme_dark?"dark":"light",a=this.deferred||!this.tab||this.tab.classList.contains("show");if(a&&e.L){if(this.map=L.map(this.e,this.options),this.options=this.map.options,this.overlay=L.featureGroup().addTo(this.map),this.displaying=L.featureGroup().addTo(this.map),this.overlay_control=L.control.layers().setPosition("topleft").addOverlay(this.overlay,"Overlay").addTo(this.map),this.tiles={},this.id in i.map){const e=i.map[this.id].tiles;i.map[this.id].u=this,e&&(e.url?(this.tiles[t]=L.tileLayer(e.url,e.options),this.tiles[t].addTo(this.map)):Object.keys(e).forEach((i=>{this.tiles[i]=L.tileLayer(e[i].url,e[i].options),t===i&&this.tiles[i].addTo(this.map)}))),"_raw"in i.map||(i.map._raw={}),"_queue"in i.map||(i.map._queue={}),"_layers"in i.map[this.id]||(i.map[this.id]._layers={}),i.map[this.id].shapes.forEach(((e,t)=>{const a="time"in e;!i.map[this.id].has_time&&a&&(i.map[this.id].has_time=!0,S(this.view,{type:"update",id:this.id}),i.map[this.id].match_time="exact"===e.resolution?e=>e+"":e=>Number(e)>2019?"2020":"2010");var s=e.name;s||(e.name=s=i.metadata.datasets[t<i.metadata.datasets.length?t:0]);const n=s+(a?e.time:"");i.map._queue[n]=e,i.data.inited[n+this.id]=!1,!i.data.loaded[s]||s!==n&&e.time!=i.map[this.id].match_time(i.data.meta.overall.value[E[this.view].parsed.time_agg])||ie(this,e)})),i.map[this.id].triggers={},Array.isArray(i.map[this.id].overlays)&&i.map[this.id].overlays.forEach((e=>{"string"==typeof e.source&&(e.source=[{url:e.source}]);const t=e.source;t.forEach((e=>{e.retrieved=e.url in i.map._raw,i.map._queue[e.url]=e})),i.map[this.id].triggers[e.variable]={source:t};const a=e.filter;if(a){const t=Array.isArray(a)?a:[a];i.map[this.id].triggers[e.variable].filter=t,t.forEach((e=>{e.check=i.data.checks[e.operator]}))}}))}}else this.deferred=!0,setTimeout(ce.bind(this),a?0:2e3)}function pe(){const t=this.deferred||!this.tab||this.tab.classList.contains("show");t&&e.jQuery&&e.DataTable&&"get"in i.dataviews[this.view]?(this.options.columns=this.header,this.table=$(this.e).DataTable(this.options),this.update()):(this.deferred=!0,setTimeout(pe.bind(this),t?0:2e3))}Object.keys(a).forEach((e=>{const t=a[e];if("continuous-polynomial"===t.type){const e=t.colors;t.type="discrete",t.colors=[];for(let i=0;i<255;i++){const a=i/255;t.colors.push("rgb("+V(0,a,e)+", "+V(1,a,e)+", "+V(2,a,e)+")")}}})),e.onload=function(){if(m.navbar=t.querySelector(".navbar"),m.navbar=m.navbar?m.navbar.getBoundingClientRect():{height:0},m.content=t.querySelector(".content"),m.menus=t.querySelectorAll(".menu-wrapper"),m.panels=t.querySelectorAll(".panel"),m.content_bounds={top:m.navbar.height,right:0,bottom:0,left:0},m.script_style=t.head.appendChild(t.createElement("style")),i.settings.hide_tooltips&&m.script_style.sheet.insertRule(r,0),m.menu_toggler={hide:function(){this.classList.add("hidden"),X()},toggle:function(e){clearTimeout(m.menu_toggler.timeout),"closed"===this.parentElement.state?(this.parentElement.state="open",this.parentElement.firstElementChild.classList.remove("hidden"),this.parentElement.style[e]="0px",m.content.style[e]=this.parentElement.getBoundingClientRect()["left"===e||"right"===e?"width":"height"]+"px",setTimeout(X,300)):(this.parentElement.state="closed","left"===e||"right"===e?(this.parentElement.style[e]=-this.parentElement.getBoundingClientRect().width+"px",m.content.style[e]=m.content_bounds[e]+"px"):(m.content.style[e]=m.content_bounds[e]+("top"===e?m.content_bounds.top:0)+"px",this.parentElement.style[e]=-this.parentElement.getBoundingClientRect().height+("top"===e?m.content_bounds.top:0)+"px"),m.menu_toggler.timeout=setTimeout(m.menu_toggler.hide.bind(this.parentElement.firstElementChild),300))},timeout:-1},m.modal={info:{init:!1,e:t.createElement("div")},filter:{init:!1,e:t.createElement("div")}},m.load_screen=t.getElementById("load_screen"),G=m.modal.info.e,t.body.appendChild(G),m.modal.info.init=!0,G.id="variable_info_display",G.className="modal fade",G.setAttribute("tabindex","-1"),G.setAttribute("aria-labelledby","variable_info_title"),G.ariaHidden="true",G.appendChild(t.createElement("div")),G.firstElementChild.className="modal-dialog modal-dialog-scrollable",G.firstElementChild.appendChild(t.createElement("div")),G.firstElementChild.firstElementChild.className="modal-content",G.firstElementChild.firstElementChild.appendChild(m.modal.info.header=t.createElement("div")),(G=m.modal.info).header.className="modal-header",G.header.appendChild(t.createElement("p")),G.header.firstElementChild.className="h5 modal-title",G.header.firstElementChild.id="variable_info_title",G.header.appendChild(t.createElement("button")),G.header.lastElementChild.type="button",G.header.lastElementChild.className="btn-close",G.header.lastElementChild.setAttribute("data-bs-dismiss","modal"),G.header.lastElementChild.title="close",G.header.insertAdjacentElement("afterEnd",G.body=t.createElement("div")),G.body.className="modal-body",G.body.appendChild(G.title=t.createElement("p")),G.title.className="h4",G.body.appendChild(G.description=t.createElement("p")),G.body.appendChild(t.createElement("table")),G.body.lastElementChild.className="info-feature-table",G.body.lastElementChild.appendChild(G.name=t.createElement("tr")),G.name.appendChild(t.createElement("th")),G.name.firstElementChild.innerText="Name",G.name.appendChild(t.createElement("td")),G.body.lastElementChild.appendChild(G.type=t.createElement("tr")),G.type.appendChild(t.createElement("th")),G.type.firstElementChild.innerText="Type",G.type.appendChild(t.createElement("td")),G.body.appendChild(G.sources=t.createElement("div")),G.sources.appendChild(G=t.createElement("table")),G.className="source-table",G.appendChild(t.createElement("thead")),G.firstElementChild.appendChild(t.createElement("tr")),G.firstElementChild.firstElementChild.appendChild(t.createElement("th")),G.firstElementChild.firstElementChild.appendChild(t.createElement("th")),G.firstElementChild.firstElementChild.firstElementChild.innerText="Source",G.firstElementChild.firstElementChild.lastElementChild.innerText="Accessed",G.appendChild(t.createElement("tbody")),(G=m.modal.info).body.appendChild(G.references=t.createElement("div")),G.references.appendChild(t.createElement("p")),G.references.firstElementChild.className="h3",G.references.firstElementChild.innerText="References",G.references.appendChild(G=t.createElement("ul")),G.className="reference-list",t.body.appendChild(G=m.modal.filter.e),m.modal.filter.init=!0,G.id="filter_display",G.className="modal fade",G.setAttribute("tabindex","-1"),G.setAttribute("aria-labelledby","filter_title"),G.ariaHidden="true",G.appendChild(t.createElement("div")),G.firstElementChild.className="modal-dialog",G.firstElementChild.appendChild(t.createElement("div")),G.firstElementChild.firstElementChild.className="modal-content",G.firstElementChild.firstElementChild.appendChild(m.modal.filter.header=t.createElement("div")),(G=m.modal.filter).header.className="modal-header",G.header.appendChild(t.createElement("p")),G.header.firstElementChild.className="h5 modal-title",G.header.firstElementChild.id="filter_title",G.header.firstElementChild.innerText="Filter",G.header.appendChild(t.createElement("button")),G.header.lastElementChild.type="button",G.header.lastElementChild.className="btn-close",G.header.lastElementChild.setAttribute("data-bs-dismiss","modal"),G.header.lastElementChild.title="close",G.header.insertAdjacentElement("afterEnd",G.body=t.createElement("div")),G.body.className="modal-body",G.body.appendChild(t.createElement("p")),G.body.lastElementChild.className="h6 text-muted",G.body.lastElementChild.innerText="Time Range",G.body.appendChild(G.time_range=t.createElement("div")),G.time_range.className="row",G.time_range.appendChild(t.createElement("div")),G.time_range.lastElementChild.className="col",G.time_range.lastElementChild.appendChild(J=t.createElement("div")),J.className="form-floating text-wrapper wrapper",J.appendChild(t.createElement("input")),J.lastElementChild.className="form-control auto-input",J.lastElementChild.setAttribute("auto-type","number"),J.lastElementChild.setAttribute("default","min"),J.lastElementChild.max="filter.time_max",J.lastElementChild.type="number",J.lastElementChild.autoType="number",J.lastElementChild.id="filter.time_min",J.appendChild(t.createElement("label")),J.lastElementChild.innerText="First Time",J.lastElementChild.setAttribute("for","filter.time_min"),G.time_range.appendChild(t.createElement("div")),G.time_range.lastElementChild.className="col",G.time_range.lastElementChild.appendChild(J=t.createElement("div")),J.className="form-floating text-wrapper wrapper",J.appendChild(t.createElement("input")),J.lastElementChild.className="form-control auto-input",J.lastElementChild.setAttribute("auto-type","number"),J.lastElementChild.setAttribute("default","max"),J.lastElementChild.min="filter.time_min",J.lastElementChild.type="number",J.lastElementChild.autoType="number",J.lastElementChild.id="filter.time_max",J.appendChild(t.createElement("label")),J.lastElementChild.innerText="Last Time",J.lastElementChild.setAttribute("for","filter.time_max"),m.panels.length&&m.panels.forEach((e=>{m.content_bounds[e.classList.contains("panel-left")?"left":"right"]=e.getBoundingClientRect().width,e.style.marginTop=m.content_bounds.top+"px",e.lastElementChild.addEventListener("click",function(){const t=e.classList.contains("panel-left")?"left":"right",i=e.getBoundingClientRect().width,a=e.lastElementChild.getBoundingClientRect().width;"true"===e.lastElementChild.getAttribute("aria-expanded")?(m.content_bounds[t]=a,m.top_menu&&(m.top_menu.style[t]=a+"px"),m.bottom_menu&&(m.bottom_menu.style[t]=a+"px"),e.style[t]=-i+a+"px",e.lastElementChild.setAttribute("aria-expanded","false")):(m.content_bounds[t]=i,m.top_menu&&(m.top_menu.style[t]=i+"px"),m.bottom_menu&&(m.bottom_menu.style[t]=i+"px"),e.style[t]="0px",e.lastElementChild.setAttribute("aria-expanded","true")),X()}.bind(e))})),m.menus.length&&m.menus.forEach((e=>{e.state=e.getAttribute("state"),e.classList.contains("menu-top")?(m.top_menu=e,m.top_menu.style.left=m.content_bounds.left+"px",m.top_menu.style.right=m.content_bounds.right+"px","BUTTON"===e.lastElementChild.tagName&&(e.lastElementChild.addEventListener("click",m.menu_toggler.toggle.bind(e.lastElementChild,"top")),e.lastElementChild.style.top=m.content_bounds.top+"px")):e.classList.contains("menu-right")?(m.right_menu=e,m.right_menu.style.right=m.content_bounds.right+"px","BUTTON"===e.lastElementChild.tagName&&(e.lastElementChild.addEventListener("click",m.menu_toggler.toggle.bind(e.lastElementChild,"right")),e.lastElementChild.style.top=m.content_bounds.top+"px")):e.classList.contains("menu-bottom")?(m.bottom_menu=e,m.content_bounds.bottom=40,m.bottom_menu.style.left=m.content_bounds.left+"px",m.bottom_menu.style.right=m.content_bounds.right+"px","BUTTON"===e.lastElementChild.tagName&&e.lastElementChild.addEventListener("click",m.menu_toggler.toggle.bind(e.lastElementChild,"bottom"))):e.classList.contains("menu-left")&&(m.left_menu=e,m.left_menu.style.left=m.content_bounds.left+"px","BUTTON"===e.lastElementChild.tagName&&(e.lastElementChild.addEventListener("click",m.menu_toggler.toggle.bind(e.lastElementChild,"left")),e.lastElementChild.style.top=m.content_bounds.top+"px")),i.url_options.close_menus&&"open"===e.state&&e.lastElementChild.click()})),m.tooltip={e:t.createElement("div"),showing:""},m.tooltip.e.className="tooltip hidden",m.tooltip.e.appendChild(t.createElement("p")),m.wrap.appendChild(m.tooltip.e),m.wrap.addEventListener("mouseover",te),i.dataviews){for(const e in i.dataviews)if(e in i.dataviews){f.dataview=e;break}}else i.dataviews={},i.dataviews[f.dataview]={};if(t.querySelectorAll(".auto-input").forEach((e=>{const t={type:e.getAttribute("auto-type"),source:void 0,value:function(){const e=Z(this.source);return void 0===e?Z(this.default):e},default:e.getAttribute("default"),options_source:e.getAttribute("auto-options"),depends:e.getAttribute("depends"),variable:e.getAttribute("variable"),dataset:e.getAttribute("dataset"),view:e.getAttribute("data-view"),id:e.id||e.options_source||"ui"+n++,note:e.getAttribute("aria-description")||"",current_index:-1,previous:"",e:e,values:[],display:[],data:[],input:!0};if(t.settings=t.type in i&&t.id in i[t.type]?i[t.type][t.id]:{},t.wrapper=t.e.parentElement.classList.contains("wrapper")?t.e.parentElement:t.e.parentElement.parentElement,t.wrapper&&(t.note&&t.wrapper.classList.add("has-note"),t.wrapper.setAttribute("of",t.id),["div","span","label","fieldset","legend","input","button"].forEach((e=>{const i=t.wrapper.querySelectorAll(e);i.length&&i.forEach((e=>e.setAttribute("of",t.id)))}))),t.note){t.wrapper.addEventListener("mouseover",ee.bind(t));const e="DIV"!==t.e.tagName?t.e:t.e.querySelector("input");e&&(e.addEventListener("focus",ee.bind(t)),e.addEventListener("blur",te))}if(s.number.test(t.default)&&(t.default=Number(t.default)),t.type in d){const e=d[t.type];e.setter&&(t.set=e.setter.bind(t),t.reset=function(){this.set(Z(this.default))}.bind(t)),e.retrieve&&(t.get=e.retrieve.bind(t)),e.adder&&(t.add=e.adder.bind(t)),e.listener&&(t.listen=e.listener.bind(t)),e.init&&e.init(t),t.options=t.e.querySelectorAll("select"===t.type?"option":"combobox"===t.type?".combobox-option":"input"),E[t.id]=t}})),i.variables&&i.variables.length&&i.variables.forEach((e=>{const t=e.id;E[t]={id:t,type:"virtual",source:e.default,previous:void 0,default:e.default,current_index:-1,values:[],states:e.states,update:function(){this.source=void 0;for(var e,t=this.states.length;t--;){e=!0;for(let i=this.states[t].condition.length;i--;){const a=this.states[t].condition[i];if(DataHandler.prototype.checks[a.type](Z(a.id),Z(a.value))){if(a.any){e=!0;break}}else e=!1}if(e){this.source=this.states[t].value;break}}if(this.source||(this.source=this.default),this.source!==this.previous)this.previous=this.source,de(this.id);else if(this.source in E){const e=E[this.source].value();e!==this.previous&&(this.previous=e,de(this.id))}},value:function(){return Z(this.source)},set:function(e){if(-1!==this.values.indexOf(e))this.previous=this.source,this.source=e;else if(this.source){const t=E[this.source];("select"===t.type||"combobox"===t.type?e in t.values||e in t.display:-1!==t.values.indexOf(e))&&t.set(e)}de(this.id)}},E[t].source&&E[t].values.push(E[t].source);const i={};E[t].states.forEach((e=>{E[t].values.push(e.value),e.condition.forEach((e=>{e.id in i||(i[e.id]={type:"update",id:t})}))})),Object.keys(i).forEach((e=>S(e,i[e])))})),i.rules&&i.rules.length&&i.rules.forEach(((e,i)=>{"display"in e.effects&&(e.effects.display={e:t.getElementById(e.effects.display)},(G=e.effects.display.e.getElementsByClassName("auto-input")).length&&(e.effects.display.u=E[G[0].id])),e.condition.forEach((t=>{t.type in DataHandler.prototype.checks&&(t.check=function(){return DataHandler.prototype.checks[this.type](Z(this.id),Z(this.value))}.bind(t),t.id in E&&(S(t.id,{type:"rule",id:t.id,condition:t,rule:i}),t.id in _||(_[t.id]={}),_[t.id][i]=e),t.check()?Object.keys(e.effects).forEach((t=>{t in E&&E[t].set(Z(e.effects[t]))})):t.default&&Object.keys(e.effects).forEach((e=>{e in E&&E[e].set(Z(t.default))})))}))})),y._u=Object.keys(E),e.addEventListener("resize",W),i.metadata.datasets||Q(),!i.dataviews[f.dataview].dataset){if(1===i.metadata.datasets.length)f.dataset=i.metadata.datasets[0];else{const e=i.metadata.info;for(let t=y._u.length;t--;){const i=E[y._u[t]];if(i.dataset in e){f.dataset=i.dataset;break}if(i.default in e){f.dataset=i.default;break}if("select"===i.type&&i.options[i.default]&&i.options[i.default].value in e){f.dataset=i.options[i.default].value;break}if(Array.isArray(i.values)&&i.values[i.default]&&i.values[i.default]in e){f.dataset=i.values[i.default];break}}f.dataset||(f.dataset=i.metadata.datasets[i.metadata.datasets.length-1])}y._u.forEach((e=>{const t=E[e];t.dataset||(t.dataset=f.dataset)})),i.dataviews[f.dataview].dataset=f.dataset}"undefined"!=typeof DataHandler&&(f.dataset=Z(i.dataviews[f.dataview].dataset),"number"==typeof f.dataset&&(f.dataset=i.metadata.datasets[f.dataset]),i.data=new DataHandler(i,f,i.data,{init:K,onload:function(){setTimeout(Q,150),delete this.onload},data_load:function(){Object.keys(x).forEach(de)}}),i.data.retrievers.vector=i.data.retrievers.vector.bind(i.data),i.query&&(i.parsed_query=i.data.parse_query(i.query))),m.load_screen&&i.data.inited?i.data.inited.load_screen=setTimeout(Q,3e3):m.wrap.style.visibility="visible"}};"undefined"==typeof module?e(window,document,site):module.exports=e}();