!function(){const e=function(e,t,i){"use strict";const a={rdylbu7:{name:"Red-Yellow-Blue (7)",type:"discrete",colors:["#d73027","#fc8d59","#fee090","#adadad","#e0f3f8","#91bfdb","#4575b4"]},orrd7:{name:"Orange-Red (7)",type:"discrete",colors:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"]},gnbu7:{name:"Green-Blue (7)",type:"discrete",colors:["#a8ddb5","#ccebc5","#f0f9e8","#adadad","#4eb3d3","#2b8cbe","#08589e"]},brbg7:{name:"Brown-Teal (7)",type:"discrete",colors:["#8c510a","#d8b365","#f6e8c3","#adadad","#c7eae5","#5ab4ac","#01665e"]},puor7:{name:"Purple-Orange (7)",type:"discrete",colors:["#b35806","#f1a340","#fee0b6","#adadad","#d8daeb","#998ec3","#542788"]},prgn6:{name:"Purple-Green (6)",type:"discrete",colors:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"]},reds5:{name:"Red (5)",type:"discrete",colors:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"]},greens5:{name:"Green (5)",type:"discrete",colors:["#ffffcc","#c2e699","#78c679","#31a354","#006837"]},paired4:{name:"Blue-Green (4)",type:"discrete",colors:["#1f78b4","#a6cee3","#b2df8a","#33a02c"]},greys4:{name:"Grey (4)",type:"discrete",colors:["#f7f7f7","#cccccc","#969696","#525252"]},grey:{name:"Grey",type:"continuous",colors:[[[70,70,70],[80,80,80]],[150,150,150],[[230,230,230],[-80,-80,-80]]]},brown:{name:"Brown",type:"continuous",colors:[[[131,30,0],[62,85,95]],[193,115,95],[[255,200,190],[-62,-85,-95]]]},purple:{name:"Purple",type:"continuous",colors:[[[90,14,213],[52.5,89,16]],[142.5,103,229],[[195,192,245],[-52.5,-89,-16]]]},prgn:{name:"Purple-Green",type:"continuous-divergent",colors:[[[27,120,55],[207,107,168.5]],[234,227,223.5],[[118,42,131],[116,185,92.5]]]},puor:{name:"Purple-Orange",type:"continuous-divergent",colors:[[[179,88,6],[56,133,202.5]],[235,221,208.5],[[84,39,136],[151,182,72.5]]]},rdbu:{name:"Red-Blue",type:"continuous-divergent",colors:[[[69,117,180],[170,116.5,16]],[239,233.5,196],[[215,48,39],[24,185.5,157]]]},vik:{name:"vik",type:"continuous-polynomial",colors:[[97.031,18.4251,.4149],[461.7602,637.5326,244.4647],[-2434.798,-2838.5427,-5893.4695],[9665.3469,14405.823,44072.722],[-2575.9109,-25871.106,-109792.1319],[-42510.0569,8528.3288,120953.8594],[63342.3061,14006.291,-59644.4457],[-26045.0391,-8868.9621,10155.5667]]},lajolla:{name:"lajolla",type:"continuous-polynomial",colors:[[256.0016,255.9138,204.945],[-187.6735,-46.2889,-768.5655],[1022.785,-1057.5602,1782.0325],[-2032.382,1490.8271,-1785.9056],[966.8373,-617.1949,567.7715]]}},s={seps:/[\s,/._-]+/g,period:/\./,all_periods:/\./g,word_start:/\b(\w)/g,settings:/^settings\./,features:/^features\./,filter:/^filter\./,data:/^data\./,variables:/^variables\./,palette:/^pal/,datasets:/^dat/,variable:/^var/,levels:/^lev/,ids:/^ids/,minmax:/^m[inax]{2}$/,int_types:/^(?:year|integer)$/,end_punct:/[.?!]$/,mustache:/\{(.*?)\}/g,measure_name:/(?:^measure|_name)$/,http:/^https?:\/\//,bool:/^(?:true|false)$/,number:/^[\d-][\d.,]*$/,leading_zeros:/^0+/,url_spaces:/%20/g,hashes:/#/g,embed_setting:/^(?:hide_|navcolor|close_menus)/,median:/^med/i,location_string:/^[^?]*/,time_ref:/\{time\}/g},n="button.has-note::after,.button-wrapper.has-note button::before,.has-note legend::before,.has-note label::before,.wrapper.has-note > div > label::before{display:none}",r={setting:function(a){const s=a.value(),r=s?"dark":"light";s!==i.settings[a.setting]&&(i.settings[a.setting]=s,"theme_dark"===a.setting?(s?t.body.classList.replace("light-theme","dark-theme"):t.body.classList.replace("dark-theme","light-theme"),i.plotly&&Object.keys(i.plotly).forEach((e=>R(i.plotly[e].u))),i.map&&Object.keys(i.map).forEach((e=>{const t=i.map[e].u;t&&r in t.tiles&&(Object.keys(t.tiles).forEach((e=>{r!==e&&t.tiles[e].removeFrom(t.map)})),t.tiles[r].addTo(t.map))}))):"hide_url_parameters"===a.setting?e.history.replaceState(Date.now(),"",i.settings.hide_url_parameters?e.location.protocol+"//"+e.location.host+e.location.pathname:W()):"hide_tooltips"===a.setting?s?u.script_style.sheet.insertRule(n,0):u.script_style.sheet.removeRule(0):"map_overlay"===a.setting?Object.keys(i.map).forEach((e=>{"_"!==e[0]&&(s?i.map[e].u.update():(i.map[e].u.overlay.clearLayers(),i.map[e].u.overlay_control.remove()))})):de(),o.set(a.setting,i.settings[a.setting]))},options:function(e){const t=!e.view||!i.dataviews[e.view].selection,a=ee(e.dataset),n=ee(e.variable),r=a+(n||""),l="combobox"===e.type;if(r in e.option_sets||(s.variable.test(e.options_source)?q(e,a,e.option_sets):s.levels.test(e.options_source)?j(e,a,n,e.option_sets):s.ids.test(e.options_source)&&O(e,a,e.option_sets)),r in e.option_sets){const a=r!==e.current_set&&(e.sensitive||!e.current_set),s=e[l?"listbox":"e"];a&&(s.innerHTML="",e.values=e.option_sets[r].values,e.display=e.option_sets[r].display,e.options=e.option_sets[r].options);var d=0;if("ID"===e.variable||"ids"===e.options_source){const n=t?{}:i.dataviews[e.view].selection[-1===e.value()?e.subset:e.selection_subset];e.options.forEach((i=>{a&&!e.groups&&s.appendChild(i),t||i.value in n?(i.classList.remove("hidden"),d++):i.classList.add("hidden")}))}else a?e.options.forEach((t=>{t.classList.remove("hidden"),e.groups||s.appendChild(t),d++})):d++;a&&e.groups&&e.groups.e.forEach((e=>s.appendChild(e))),e.e[d?"removeAttribute":"setAttribute"]("disabled",!0),e.current_set=r,a&&(l?e.source=[]:(e.e.selectedIndex=-1,e.source="")),a?e.id in i.url_options?e.set(i.url_options[e.id]):e.reset():e.set(e.value()),e.filter&&e.filter()}},min:async function(e,t){var a=t.value(),n=e.value(),l=x[e.view||t.view];s.minmax.test(a)&&(a=t.parsed.min),l&&l.y&&(ee(l.y)in i.data.variables&&(l.time_range.time.length||await r.time_range(l,e,!0),a=Math.max(l.time_range.time[0],parseFloat(a))),e.update()),e.e.min=void 0===e.parsed.min?parseFloat(a):Math.max(e.parsed.min,parseFloat(a)),e.e.value?"number"==typeof n&&isFinite(n)&&n<a&&e.set(a):e.reset()},max:async function(e,t){var a=t.value(),n=e.value(),l=x[e.view||t.view];s.minmax.test(a)&&(a=t.parsed.max),l&&l.y&&(ee(l.y)in i.data.variables&&(l.time_range.time.length||await r.time_range(l,e,!0),a=Math.min(l.time_range.time[1],parseFloat(a))),e.update()),e.e.max=void 0===e.parsed.max?parseFloat(a):Math.min(e.parsed.max,parseFloat(a)),e.e.value?"number"==typeof n&&isFinite(n)&&n>a&&e.set(a):e.reset()},dataview:function(e){(e=e||x[b.dataview]).value()!==e.state&&(i.data.inited[e.parsed.dataset]?(e.valid=!0,e.n_selected.ids=0,e.n_selected.children=0,e.n_selected.features=0,e.n_selected.variables=0,e.n_selected.dataset=0,e.n_selected.filtered=0,e.n_selected.full_filter=0,e.n_selected.all=0,e.selection.ids={},e.selection.children={},e.selection.features={},e.selection.variables={},e.selection.dataset={},e.selection.filtered={},e.selection.full_filter={},e.selection.all={},x._base_filter.c.forEach((e=>{e.passed=0,e.failed=0})),Object.keys(i.data.entities).forEach((t=>{const a=e.check(i.data.entities[t]);a.all=0,a.ids&&(e.selection.ids[t]=i.data.entities[t],e.n_selected.ids++,a.all++),a.features&&(e.selection.features[t]=i.data.entities[t],e.n_selected.features++,a.all++),a.variables&&(e.selection.variables[t]=i.data.entities[t],e.n_selected.variables++,a.all++),a.dataset&&(e.selection.dataset[t]=i.data.entities[t],e.n_selected.dataset++,a.all++),a.features&&a.variables&&(e.selection.full_filter[t]=i.data.entities[t],e.n_selected.full_filter++),a.dataset&&a.ids&&(e.selection.children[t]=i.data.entities[t],e.n_selected.children++),a.variables&&a.features&&a.dataset&&(e.selection.filtered[t]=i.data.entities[t],e.n_selected.filtered++),4===a.all&&(e.selection.all[t]=i.data.entities[t],e.n_selected.all++)})),he(e.id)):(e.valid=!1,i.data.data_queue[e.parsed.dataset][e.id]=function(){return r.dataview(e)},i.data.loaded[e.parsed.dataset]&&i.data.load_id_maps()))},time_filters:function(e){e.time_range.filtered[0]=1/0,e.time_range.filtered[1]=-1/0;const t=e.get.dataset(),a=i.data.meta.times[t],s=C[e.id+"_filter"];if(i.data.inited[t]){for(let t=a.n;t--;){let i=!1;if(t>=e.time_range.index[0]&&t<=e.time_range.index[1])for(let s=e.time_filters.length;s--;){const n={},r=e.time_filters[s];if(r.value in n||(n[r.value]=ee(r.value)),i=DataHandler.prototype.checks[r.type](a.value[t],n[r.value]),!i)break}e.times[t]=i,i&&(e.time_range.filtered[0]>a.value[t]&&(e.time_range.filtered[0]=a.value[t]),e.time_range.filtered[1]<a.value[t]&&(e.time_range.filtered[1]=a.value[t]))}e.time_range.filtered_index=[e.time_range.index[0]+e.time_range.filtered[0]-e.time_range.time[0],e.time_range.index[1]+e.time_range.filtered[1]-e.time_range.time[1]],s&&s.forEach((t=>{"update"===t.type?x[t.id].update():t.type in r&&r[t.type](x[t.id],e)}))}},time_range:async function(e,t,a){const s=t&&t.value(),n=e.get.dataset(),l=e.time?ee(e.time):b.time,d=l in i.data.variables?i.data.variables[l].info[n].min:1,o=C[e.id+"_time"],h=s in i.data.variables?s:ee(e.y);if(i.data.inited[n]){var c=h&&await le(h,e.id);if(c){const t=n+h!=e.time_range.dataset+e.time_range.variable;-1!==(c=c.time_range[n])[0]&&(e.time_range.dataset=n,e.time_range.variable=h,e.time_range.index[0]=c[0],e.time_range.time[0]=e.time_range.filtered[0]=d+c[0],e.time_range.index[1]=c[1],e.time_range.time[1]=e.time_range.filtered[1]=d+c[1]),!a&&o&&(o.forEach((i=>{const a=x[i.id],s=a.value();"min"===i.type?(t||isFinite(e.time_range.time[0])&&parseFloat(a.e.min)!==e.time_range.time[0])&&(a.e.min=e.time_range.time[0],(t||!g.retain_state||e.time_range.time[0]>s)&&a.set(e.time_range.time[0])):"max"===i.type&&(t||isFinite(e.time_range.time[1])&&parseFloat(a.e.max)!==e.time_range.time[1])&&(a.e.max=e.time_range.time[1],(t||!g.retain_state||e.time_range.time[1]<s||s<e.time_range.time[0])&&a.set(e.time_range.time[1]))})),r.time_filters(e))}else e.time_range.dataset=n,e.time_range.index[0]=0,e.time_range.time[0]=e.time_range.filtered[0]=1,e.time_range.index[1]=0,e.time_range.time[1]=e.time_range.filtered[1]=1}}},l={button:{init:function(a){a.target=a.e.getAttribute("target"),"copy"===a.target&&(a.settings.endpoint=i.endpoint),"filter"===a.target?(a.e.setAttribute("data-bs-toggle","modal"),a.e.setAttribute("data-bs-target","#filter_display"),a.notification=t.createElement("span"),a.notification.className="filter-notification hidden",a.e.parentElement.appendChild(a.notification),M("_base_filter",{type:"update",id:a.id}),a.update=l.button.update.bind(a),i.data&&a.update()):a.e.addEventListener("click",a.settings.effects?"export"===a.target||"copy"===a.target?function(){const t={},s=this.settings,n=x[s.dataview],r=n&&n.parsed.dataset;if(Object.keys(s.query).forEach((e=>t[e]=ee(s.query[e]))),n&&(!("include"in t)&&n.y&&(t.include=ee(n.y)),!("id"in t)&&n.ids&&(t.id=ee(n.ids))),"copy"===this.target||this.api){var l=[];"include"in t&&l.push("include="+t.include),"dataset"in t&&l.push("dataset="+t.dataset),"id"in t&&-1!=t.id&&l.push("id="+t.id),n&&(t.time_range||l.push("time_range="+i.data.meta.times[r].value[n.time_range.filtered_index[0]]+","+i.data.meta.times[r].value[n.time_range.filtered_index[1]]),n.features&&Object.keys(n.features).forEach((e=>{e in t||(t[e]=ee(n.features[e]),Array.isArray(t[e])&&(t[e]=t[e].join(",")),l.push(e+"="+t[e]))})),x._base_filter.c.size&&x._base_filter.value(l,n.parsed.time_agg));const d=s.endpoint+(l.length?"?"+l.join("&"):"");this.api?e.location.href=d:navigator.clipboard.writeText(d).then((()=>{"Copied!"!==a.e.innerText&&(a.text=a.e.innerText,a.e.innerText="Copied!",setTimeout((function(){a.e.innerText=a.text}),500))}),(e=>{e!==a.e.innerText&&(a.text=a.e.innerText,a.e.innerText=e,setTimeout((function(){a.e.innerText=a.text}),1500))}))}else n&&"selection"in n?(t.time_range||(t.time_range=i.data.meta.times[r].value[n.time_range.filtered_index[0]]+","+i.data.meta.times[r].value[n.time_range.filtered_index[1]]),i.data.export(t,n.selection.all,!0)):i.data.export(t,i.data.entities,!0,!0)}.bind(a):function(){Object.keys(this.settings.effects).forEach((e=>{""===this.settings.effects[e]||-1==this.settings.effects[e]?x[e].reset():x[e].set(this.settings.effects[e])}))}.bind(a):"refresh"===a.target?de:"reset_selection"===a.target?oe:"reset_storage"===a.target?re:function(){this.target in x&&x[this.target].reset()}.bind(a))},update:function(){let e=0;x._base_filter.c.forEach((t=>e+=t.active)),e?(this.notification.innerText=e,this.notification.classList.remove("hidden")):this.notification.classList.add("hidden")}},buttongroup:{retrieve:function(){for(let e=this.options.length;e--;)if(this.options[e].checked){this.set(e);break}},setter:function(e){this.previous=this.value(),this.current_index="string"==typeof e?this.values.indexOf(e):e,-1!==this.current_index?(this.source=this.values[this.current_index]in x?x[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,he(this.id)},listener:function(e){this.set(e.target.value)},adder:function(e,a,s,n){var r=[t.createElement("input"),t.createElement("label")];return r[0].className="btn-check",r[0].type="radio",r[0].name=this.e.id+"_options",r[0].autocomplete="off",r[0].value=a,r[0].id=this.e.id+"_option"+e,r[1].className="btn btn-primary",r[1].innerText=s||i.data.format_label(a),r[1].setAttribute("for",r[0].id),n||(this.e.appendChild(r[0]),this.e.appendChild(r[1])),r[0]}},radio:{retrieve:function(){for(let e=this.options.length;e--;)if(this.options[e].checked){this.set(e);break}},setter:function(e){this.current_index="string"==typeof e?this.values.indexOf(e):e,-1!==this.current_index?(this.source=this.values[this.current_index]in x?x[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,he(this.id)},listener:function(e){this.set(e.target.value)},adder:function(e,a,s){const n=t.createElement("div"),r="TRUE"===this.e.getAttribute("switch");return n.className="form-check"+(r?" form-switch":""),n.appendChild(t.createElement("input")),n.appendChild(t.createElement("label")),n.firstElementChild.autocomplete="off",n.firstElementChild.className="form-check-input",r&&(n.firstElementChild.role="switch"),n.firstElementChild.type="radio",n.firstElementChild.name=this.e.id+"_options",n.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,n.firstElementChild.value=e,n.lastElementChild.innerText=a||i.data.format_label(e),n.lastElementChild.className="form-check-label",n.lastElementChild.setAttribute("for",n.firstElementChild.id),s||this.e.appendChild(n),n.firstElementChild}},checkbox:{retrieve:function(){this.source=[],this.current_index=[],this.options.forEach((e=>{e.checked&&(this.source.push(this.values[k]),this.current_index.push(k))})),he(this.id)},setter:function(e){if("object"==typeof e)this.source=[],this.current_index=[],this.values.forEach(((e,t)=>{-1!==e.indexOf(e)?(this.source.push(e),this.current_index.push(t),this.options[t].checked=!0):this.options[t].checked=!1}));else{if("string"==typeof e)return this.set(e.split(","));-1!==e&&(this.options[e].checked=!0)}he(this.id)},listener:function(e){if(e.target.checked)this.source.push(e.target.value),this.current_index.push(this.values.indexOf(e.target.value));else{var t=this.source.indexOf(e.target.value);-1!==t&&(this.source.splice(t,1),this.current_index.splice(t,1))}he(this.id)},adder:function(e,a,s){var n=t.createElement("div"),r="TRUE"===this.e.getAttribute("switch");return n.className="form-check"+(r?" form-switch":""),n.appendChild(t.createElement("input")),n.appendChild(t.createElement("label")),n.firstElementChild.autocomplete="off",n.firstElementChild.className="form-check-input",r&&(n.firstElementChild.role="switch"),n.firstElementChild.type="checkbox",n.firstElementChild.name=this.e.id+"_options",n.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,n.firstElementChild.value=e,n.lastElementChild.innerText=a||i.data.format_label(e),n.lastElementChild.className="form-check-label",n.lastElementChild.setAttribute("for",n.firstElementChild.id),s||this.e.appendChild(n),n.firstElementChild}},switch:{retrieve:function(){this.set(this.e.checked)},setter:function(e){"string"==typeof e&&(e="on"===e),e!==this.source&&(this.previous=this.e.checked,this.e.checked=this.source=e,he(this.id))},listener:function(e){this.set(e.target.checked)}},number:{init:function(e){const t=e.e.parentElement.parentElement;t&&t.firstElementChild.classList.contains("number-down")&&(t.firstElementChild.addEventListener("click",function(){this.set(Math.max(this.parsed.min,this.value()-1))}.bind(e)),t.lastElementChild.addEventListener("click",function(){this.set(Math.min(this.parsed.max,this.value()+1))}.bind(e)))},retrieve:function(){this.set(this.e.value)},setter:function(e){e||(e=null),"string"==typeof e&&(e=parseFloat(e)),isFinite(e)&&e!==this.source&&(this.previous=parseFloat(this.e.value),!isFinite(this.parsed.min)&&e<this.parsed.min?e=this.parsed.min:!isFinite(this.parsed.max)&&e>this.parsed.max&&(e=this.parsed.max),this.e.value=this.source=e,this.current_index=e-this.parsed.min,"range"===this.e.type&&(this.e.nextElementSibling.firstElementChild.innerText=this.e.value),he(this.id))},listener:function(e){this.set(e.target.value)}},text:{init:function(e){i.text&&e.id in i.text&&(e.text=i.text[e.id].text,e.condition=i.text[e.id].condition||[],e.depends={},e.text.forEach((i=>{"text"in i?(A(e,i),e.e.appendChild(i.parts)):(e.e.appendChild(t.createElement("span")),i.forEach((t=>A(e,t))))})),e.condition.forEach((t=>{t.id in x&&M(t.id,{type:"display",id:e.id})})),Object.keys(e.depends).forEach((t=>M(t,{type:"update",id:e.id}))),e.update=l.text.update.bind(e)),e.update()},update:function(){Object.keys(this.reference_options).forEach((e=>this.options[e]=ee(this.reference_options[e]))),Object.keys(this.depends).forEach((e=>{this.depends[e]=ee(e),this.depends[e]in i.data.entities&&(this.depends[e]=i.data.entities[this.depends[e]].features.name)})),this.text.forEach(((e,t)=>{var i=!0;if(e.length){for(let t=e.length;t--;)if("condition"in e[t]){for(let a=e[t].condition.length;a--&&(i=e[t].condition[a].check(),i););if(i){e=e[t];break}}}else if("condition"in e)for(let t=e.condition.length;t--&&(i=e.condition[t].check()););i?(e.text.forEach(((t,i)=>{if(Array.isArray(t)&&t.forEach((e=>{("default"===e.id||DataHandler.prototype.checks[e.type](ee(e.id),ee(e.value)))&&(t=e.text)})),t in this.depends)e.parts.children[i].innerText=this.depends[t];else if(t in e.button){var a="";e.button[t].text.forEach((e=>{a=(e in this.depends?this.depends[e]:e)+a})),e.parts.children[i].innerText=a}else e.parts.children[i].innerText=t})),this.text[t].length?(this.e.children[t].innerHTML="",this.e.children[t].appendChild(e.parts)):e.parts.classList.remove("hidden")):e.parts.classList.add("hidden")}))}},select:{retrieve:function(){this.set(this.e.selectedIndex)},setter:function(e){"string"==typeof e&&!(e in this.values)&&s.number.test(e)&&(e=Number(e)),"number"==typeof e&&(e=this.options[e]?this.options[e].value:e),!(e in this.values)&&e in this.display&&(e=this.options[this.display[e]].value),e!==this.source&&(this.e.selectedIndex=e in this.values?this.values[e]:-1,this.source=e,he(this.id))},listener:function(e){this.set(e.target.selectedIndex)},adder:function(e,a,s,n){const r=t.createElement("option");return r.value=e,r.innerText=a||i.data.format_label(e),s&&s.info&&(r.title=s.info.description||s.info.short_description),n||this.e.appendChild(r),r}},combobox:{create:function(e,a){const n="created_combobox_"+ ++u.elementCount,r=t.createElement("div");let d=t.createElement("div");r.className="wrapper combobox-wrapper",r.appendChild(d),d.id=n,d.setAttribute("auto-type","combobox"),d.className="auto-input form-select combobox combobox-component",d.role="combobox",d.setAttribute("aria-haspopup","listbox"),d.setAttribute("aria-expanded","false"),d.setAttribute("aria-labelledby",n+"-label"),d.setAttribute("aria-controls",n+"-listbox"),d.appendChild(d=t.createElement("div")),d.className="combobox-selection combobox-component",d.appendChild(t.createElement("span")),d.lastElementChild.className="combobox-component",d.appendChild(d=t.createElement("input")),d.className="combobox-input combobox-component",d.type="text",d.setAttribute("aria-labelledby",n+"-label"),d.id=n+"-input",d.autocomplete="false",r.appendChild(d=t.createElement("div")),d.className="combobox-options combobox-component",d.role="listbox",d.tabindex="-1",d.id=n+"-listbox",r.appendChild(d=t.createElement("label")),d.id=n+"-label",d.innerText=e,l.init_input(r.firstElementChild);const o=x[n];var h=0;return o.options=[],Array.isArray(a)?a.forEach((e=>{const t=i.data.format_label(e);o.display[t]=h,o.values[e]=h++,o.options.push(o.add(e,t))})):(o.groups={e:[],by_name:{}},Object.keys(a).forEach((e=>{const i=a[e],n=t.createElement("div"),r=o.id+"_group_"+e.replace(s.seps,"-");n.className="combobox-group combobox-component",n.role="group",n.setAttribute("aria-labelledby",r),n.appendChild(t.createElement("label")),n.firstElementChild.innerText=e,n.firstElementChild.id=r,n.firstElementChild.className="combobox-group-label combobox-component",o.groups.by_name[e]=n,o.groups.e.push(n),i.forEach((t=>o.groups.by_name[e].appendChild(o.add(t,t,!0)))),o.listbox.appendChild(n)})),Object.keys(o.groups.by_name).forEach((e=>{o.groups.by_name[e].querySelectorAll(".combobox-option").forEach((e=>{o.options.push(e),o.values[e.value]=h,o.display[e.innerText]=h++}))}))),o},init:function(a){a.hover_index=-1,a.cleared_selection="",a.expanded=!1,a.listbox=a.e.parentElement.children[1],a.container=t.createElement("div"),a.container.className="combobox-options-container combobox-component",a.container.style.display="none",u.overlay.appendChild(a.container),a.container.appendChild(a.listbox),a.selection=a.e.firstElementChild.firstElementChild,a.input=a.e.firstElementChild.lastElementChild,2===a.e.childElementCount&&a.e.lastElementChild.addEventListener("click",function(){this.cleared_selection="",this.set(-1),this.input.focus()}.bind(a)),a.value=function(){return this.source?this.settings.multi?this.source:this.source.length?this.source[0]:"":ee(this.default)}.bind(a),a.input.addEventListener("focus",function(){this.e.classList.add("focused")}.bind(a)),a.input.addEventListener("blur",function(){this.e.classList.remove("focused")}.bind(a)),a.listbox.addEventListener("click",a.set),a.close=function(t){!this.expanded||t&&t.target.classList&&t.target.classList.contains("combobox-component")||(""===this.selection.innerText&&(this.selection.innerText=this.cleared_selection),""!==this.input.value&&setTimeout(this.set,0),this.e.setAttribute("aria-expanded",!1),this.expanded=!1,this.container.style.display="none",e.removeEventListener("click",a.close))}.bind(a),a.resize=function(){const e=this.e.getBoundingClientRect();this.container.style.top=e.y+e.height+"px",this.container.style.left=e.x+"px",this.container.style.width=e.width+"px"}.bind(a),e.addEventListener("resize",a.resize),a.toggle=function(t){t.button||"BUTTON"===t.target.tagName||(this.expanded?t.target!==this.input&&this.close():(i.combobox&&Object.keys(i.combobox).forEach((e=>{e!==this.id&&x[e].close()})),this.container.style.display="",this.settings.multi||(""!==this.selection.innerText&&(this.cleared_selection=this.selection.innerText),this.cleared_selection in this.display&&this.highlight({target:this.options[this.display[this.cleared_selection]]}),this.selection.innerText=""),e.addEventListener("click",this.close),this.e.setAttribute("aria-expanded",!0),t&&t.target===this.input||setTimeout((()=>this.input.focus()),0),this.resize(),this.expanded=!0))}.bind(a),a.e.addEventListener("mousedown",a.toggle),a.highlight=function(e){if(!(e&&e.target&&!(e.target.value in this.values)||(e&&e.target&&e.target.value?this.hover_index=this.values[e.target.value]:-1===this.hover_index&&this.source&&(this.hover_index=this.values[this.source[0]]),void 0===this.hover_index&&(this.hover_index=-1),-1===this.hover_index||this.options[this.hover_index].classList.contains("highlighted")))){const e=this.listbox.querySelector(".highlighted");e&&e.classList.remove("highlighted"),this.options[this.hover_index].classList.add("highlighted"),this.e.setAttribute("aria-activedescendant",this.options[this.hover_index].id);const t=this.container.getBoundingClientRect(),i=this.options[this.hover_index].getBoundingClientRect();t.top>i.top?this.container.scrollTo(0,this.container.scrollTop+i.top-t.top):t.bottom<i.bottom&&this.container.scrollTo(0,this.container.scrollTop+i.bottom-t.bottom)}}.bind(a),a.listbox.addEventListener("mouseover",a.highlight),a.clear_highlight=function(){-1!==this.hover_index&&(this.options[this.hover_index].classList.remove("highlighted"),this.hover_index=-1)}.bind(a),a.filter_reset=function(){this.input.value="",this.filter_index=[],this.listbox.querySelectorAll(".filter-hidden").forEach((e=>e.classList.remove("filter-hidden")))}.bind(a),a.settings.search&&a.input.addEventListener("keyup",function(e){const t=this.input.value.toLowerCase();""===t?this.filter_reset():(this.filter_index=[],this.options.forEach(((e,i)=>{e.innerText.toLowerCase().includes(t)?(e.classList.remove("filter-hidden"),this.filter_index.push(i)):e.classList.add("filter-hidden")})))}.bind(a)),a.input.addEventListener("keydown",function(e){const t=h[e.code];if(t)if("close"===t)this.close();else if("select"===t){if(!this.expanded)return this.toggle({target:this.input});this.set(e)}else"move"===t&&(e.preventDefault(),"ArrowUp"===e.code?this.filter_index&&this.filter_index.length?(this.hover_index=this.filter_index.indexOf(this.hover_index)-1,this.hover_index=this.filter_index[0>this.hover_index?0:this.hover_index]):this.hover_index=Math.max(0,this.hover_index-1):"ArrowDown"===e.code?this.filter_index&&this.filter_index.length?(this.hover_index=this.filter_index.indexOf(this.hover_index)+1,this.hover_index=this.filter_index[this.filter_index.length-1<this.hover_index?this.filter_index.length-1:this.hover_index]):this.hover_index=Math.min(this.options.length-1,this.hover_index+1):"Home"===e.code?this.hover_index=0:"End"===e.code&&(this.hover_index=this.options.length-1),this.expanded?this.highlight():this.set(this.hover_index));else this.expanded?this.clear_highlight():this.toggle({target:this.input})}.bind(a))},retrieve:function(){this.source=[],this.listbox.querySelectorAll(".selected").forEach((e=>this.source.push(e.value))),he(this.id)},setter:function(e,t){if(e||(e=this.input.value),e.target&&"LABEL"===e.target.tagName)return;let i=!1;var a=-1;if(e.target&&(-1!==(a=this.hover_index)&&(this.options[a].classList.contains("hidden")||this.options[a].classList.contains("filter-hidden"))&&(a=-1),e=-1===a?e.target.innerText||e.target.value:a,t=this.settings.multi),this.filter_reset(),"object"==typeof e){if(this.options.multi)return this.listbox.querySelectorAll(".selected").forEach((e=>e.classList.remove("selected"))),this.source=e,he(this.id);e=e[0]}if(this.settings.strict&&"string"==typeof e&&!(e in this.values)&&s.number.test(e)&&(e=Number(e)),"number"==typeof e&&e>-1&&e<this.options.length&&(e=this.options[e].value),"string"===e&&e in this.display&&(e=this.options[this.display[e]].value),Array.isArray(this.source)||(this.source=[]),this.settings.strict&&!(e in this.values)&&(e=this.default),-1===(a=this.source.indexOf(e))){if(i=!0,this.settings.multi?this.source.push(e):this.source[0]=e,e in this.values){if(!this.settings.multi){const e=this.listbox.querySelector(".selected");e&&e.classList.remove("selected")}this.options[this.values[e]].classList.add("selected")}}else t&&(i=!0,this.source.splice(a,1),e in this.values&&this.options[this.values[e]].classList.remove("selected"));!this.settings.multi&&this.expanded&&(this.input.focus(),this.close(),this.filter_reset()),this.selection.innerText=this.source.length?this.settings.multi?this.source.length+" of "+this.options.length+" selected":this.source[0]in this.values?this.options[this.values[this.source[0]]].firstChild.textContent:this.settings.strict||-1===this.source[0]?"":this.source[0]:"",this.onchange&&this.onchange(),i&&he(this.id)},adder:function(e,a,s,n){const r=t.createElement("div");return r.role="option",r.setAttribute("aria-selected",!1),r.tabindex="0",r.className="combobox-option combobox-component",r.value=e,r.innerText=a||i.data.format_label(e),n&&n.info&&(r.appendChild(t.createElement("p")),r.lastElementChild.className="combobox-option-description combobox-component",r.lastElementChild.innerText=n.info.description||n.info.short_description||""),s||this.listbox.appendChild(r),r}},plotly:{init:function(e){e.id in i.plotly&&(e.x=e.e.getAttribute("x"),e.y=e.e.getAttribute("y"),e.color=e.e.getAttribute("color"),e.time=e.e.getAttribute("color-time"),e.click=e.e.getAttribute("click"),e.click in x&&(e.clickto=x[e.click]),e.parsed={},e.traces={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.tab&&t.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){e.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(K,155))}.bind(e)),e.show=function(e){var t=D(this,e,0,0,"hover_line",b["border_highlight_"+i.settings.theme_dark]);t&&(t.line.width=4,t.marker.size=12,Plotly.addTraces(this.e,t,this.e.data.length))},e.revert=function(){this.e.data.length&&"hover_line"===this.e.data[this.e.data.length-1].name&&Plotly.deleteTraces(this.e,this.e.data.length-1)},e.options&&(i.plotly[e.id].u=e),i.plotly[e.id].data.forEach(((t,i)=>{Object.keys(t).forEach((e=>{if(s.period.test(e)){const a=e.split("."),s=a.length-1;var i=null;a.forEach(((a,n)=>{i=i?i[a]=n===s?t[e]:{}:t[a]={}}))}})),"textfont"in t||(t.textfont={}),"color"in t.textfont||(t.textfont.color=b.background_highlight),"line"in t||(t.line={}),"color"in t.line||(t.line.color=b.background_highlight),"marker"in t||(t.marker={}),t.marker.size=8,"color"in t.marker||(t.marker.color=b.background_highlight),"line"in t.marker||(t.marker.line={}),"color"in t.marker.line||(t.marker.line.color=b.background_highlight),"text"in t||(t.text=[]),"x"in t||(t.x=[]),"box"===t.type?t.hoverinfo="none":"y"in t||(t.y=[]),e.traces[t.type]=JSON.stringify(t),i||(e.base_trace=t.type,e.base_trace in x&&M(e.base_trace,{type:"update",id:e.id}))})),e.x in i.data.variables||M(e.x,{type:"update",id:e.id}),e.y in i.data.variables||M(e.y,{type:"update",id:e.id}),e.time in x&&M(e.time,{type:"update",id:e.id}),e.view?(M(e.view,{type:"update",id:e.id}),M(e.view+"_filter",{type:"update",id:e.id}),x[e.view].time_agg in x&&M(x[e.view].time_agg,{type:"update",id:e.id})):e.view=b.dataview,pe.bind(e)())},mouseover:function(e){e.points&&1===e.points.length&&this.e.data[e.points[0].fullData.index]&&(this.e.data[e.points[0].fullData.index].line.width=4,Plotly.react(this.e,this.e.data,this.e.layout),I(this.id,"show",i.data.entities[e.points[0].data.id]))},mouseout:function(e){e.points&&1===e.points.length&&this.e.data[e.points[0].fullData.index]&&(this.e.data[e.points[0].fullData.index].line.width=2,Plotly.react(this.e,this.e.data,this.e.layout),I(this.id,"revert",i.data.entities[e.points[0].data.id]))},click:function(e){this.clickto&&this.clickto.set(e.points[0].data.id)},update:async function(e){if(clearTimeout(this.queue),e){if(this.e.layout){const e=x[this.view],h=e.selection&&e.selection.all,c=e.get.dataset(),p=x[this.time||e.time_agg];if(i.data.inited[c]&&h&&e.time_range.filtered.length){this.parsed.base_trace=ee(this.base_trace),this.parsed.x=ee(this.x),this.parsed.y=ee(this.y),this.parsed.color=ee(this.color||e.y||this.parsed.y);const m=await le(this.parsed.x,this.view),u=await le(this.parsed.y,this.view),f=await le(this.parsed.color,this.view);this.parsed.x_range=m.time_range[c],this.parsed.y_range=u.time_range[c],this.parsed.view=e,this.parsed.dataset=c,this.parsed.palette=ee(e.palette)||i.settings.palette,this.parsed.palette in a||(this.parsed.palette=b.palette),this.parsed.time=(p?p.value()-i.data.meta.times[c].range[0]:0)-f.time_range[c][0],this.parsed.summary=f[this.view].summaries[c];const v=u[this.view].summaries[c],g=this.parsed.summary.missing[this.parsed.time],_=this.parsed.summary.n[this.parsed.time],y=_!==e.n_selected.dataset,E=y?"subset_rank":"rank",x=y?f[this.view].order[c][this.parsed.time]:f.info[c].order[this.parsed.time],C=[];var t,s,n,r=this.parsed.summary.missing[this.parsed.time],l=x?x.length:0,d=i.settings.trace_limit||0,o=e.value()+e.get.time_filters()+c+this.parsed.x+this.parsed.y+this.parsed.palette+this.parsed.color+i.settings.summary_selection+i.settings.color_scale_center+i.settings.color_by_order+i.settings.trace_limit;for(d=n=d&&d<_?Math.ceil(Math.min(d/2,_/2)):0,Object.keys(this.reference_options).forEach((e=>this.options[e]=ee(this.reference_options[e])));r<l;r++)if(x[r][0]in h){t=x[r][0];const e=h[t];if(o+=t,C.push(D(this,e,e[this.view][E][this.parsed.color][this.parsed.time]-g,_)),d&&!--n)break}if(d&&r<l)for(n=r,r=l-1;r>n;r--)if(x[r][0]in h){t=x[r][0];const e=h[t];if(o+=t,C.push(D(this,e,e[this.view][E][this.parsed.color][this.parsed.time]-g,_)),!--d)break}if(o+=C.length&&C[0].type,i.settings.boxplots&&"box"in this.traces&&h[t]&&(o+="box"+i.settings.iqr_box,s=JSON.parse(this.traces.box),C.push(s),s.line.color=b.border,s.median=v.median,s.q3=v.q3,s.q1=v.q1,i.settings.iqr_box?(s.upperfence=[],s.lowerfence=[],s.q1.forEach(((e,t)=>{isNaN(s.median[t])&&(s.median[t]=0);const i=1.5*(s.q3[t]-e),a=s.median[t];s.q3[t]=isNaN(s.q3[t])?a:Math.max(a,s.q3[t]),s.upperfence[t]=s.q3[t]+i,s.q1[t]=isNaN(s.q1[t])?a:Math.min(a,e),s.lowerfence[t]=e-i}))):(s.upperfence=v.max,s.lowerfence=v.min),s.x=s.q1.map(((e,i)=>h[t].get_value(this.parsed.x,i+this.parsed.y_range[0])))),o!==this.state){"boolean"!=typeof this.e.layout.yaxis.title&&(this.e.layout.yaxis.title=i.data.format_label(this.parsed.y)+(i.settings.trace_limit<e.n_selected.all?" ("+i.settings.trace_limit+" extremes)":"")),"boolean"!=typeof this.e.layout.xaxis.title&&(this.e.layout.xaxis.title=i.data.format_label(this.parsed.x)),this.e.layout.yaxis.autorange=!1,this.e.layout.yaxis.range=[1/0,-1/0],s||(s={upperfence:v.max,lowerfence:v.min}),v.min.forEach(((e,t)=>{const i=Math.min(s.lowerfence[t],e),a=Math.max(s.upperfence[t],v.max[t]);this.e.layout.yaxis.range[0]>i&&(this.e.layout.yaxis.range[0]=i),this.e.layout.yaxis.range[1]<a&&(this.e.layout.yaxis.range[1]=a)}));const t=(this.e.layout.yaxis.range[1]-this.e.layout.yaxis.range[0])/10;this.e.layout.yaxis.range[0]-=t,this.e.layout.yaxis.range[1]+=t,i.data.variables[this.parsed.x].is_time&&(this.e.layout.xaxis.autorange?(this.e.layout.xaxis.autorange=!1,this.e.layout.xaxis.type="linear",this.e.layout.xaxis.dtick=1,this.e.layout.xaxis.range=[e.time_range.filtered[0]-.5,e.time_range.filtered[1]+.5]):(this.e.layout.xaxis.range[0]=e.time_range.filtered[0]-.5,this.e.layout.xaxis.range[1]=e.time_range.filtered[1]+.5)),Plotly.react(this.e,C,this.e.layout),setTimeout(K,300),this.state=o}}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))}},map:{init:function(e){e.color=e.e.getAttribute("color"),e.time=e.e.getAttribute("color-time"),e.click=e.e.getAttribute("click"),e.click&&e.click in x&&(e.clickto=x[e.click]),e.parsed={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.show=function(t){if(t.layer&&t.layer[this.id])if(i.data.inited[this.parsed.dataset+e.id])t.layer[this.id].setStyle({color:b["border_highlight_"+i.settings.theme_dark]});else{const e=i.map[this.id].match_time(i.data.meta.overall.value[i.data.variables[this.parsed.color].time_range[this.parsed.dataset][0]+this.parsed.time]);t.layer[this.id][e]&&t.layer[this.id][e].setStyle({color:b["border_highlight_"+i.settings.theme_dark]})}},e.revert=function(e){if(e.layer&&e.layer[this.id])if(i.data.inited[this.parsed.dataset+this.id])e.layer[this.id].setStyle({color:b.border});else{const t=i.map[this.id].match_time(i.data.meta.overall.value[i.data.variables[this.parsed.color].time_range[this.parsed.dataset][0]+this.parsed.time]);e.layer[this.id][t]&&e.layer[this.id][t].setStyle({color:b.border})}};const t={type:"update",id:e.id};if(e.view?(x[e.view].time_agg in x&&M(x[e.view].time_agg,t),x[e.view].y&&M(x[e.view].y,t)):e.view=b.dataview,M(e.view,t),e.color in x&&M(e.color,t),e.time&&M(e.time,t),e.e.style.height||(e.e.style.height=e.options.height?e.options.height:"400px"),e.options.overlays_from_measures&&i.data.variable_info){i.map[e.id].overlays||(i.map[e.id].overlays=[]);const t=i.map[e.id].overlays;Object.keys(i.data.variable_info).forEach((e=>{const a=i.data.variable_info[e];if(a.layer&&a.layer.source){if("string"==typeof a.layer.source&&s.time_ref.test(a.layer.source)){const t=a.layer.source;a.layer.source=[];for(let n,r=i.data.meta.ranges[e],l=r[0],d=r[1];l<d;l++)n=i.data.meta.overall.value[l],a.layer.source.push({url:t.replace(s.time_ref,n),time:n})}s.time_ref.lastIndex=0;const n={variable:e,source:a.layer.source};a.layer.filter&&(n.filter=a.layer.filter),t.push(n)}}))}me.bind(e)()},mouseover:function(e){e.target.setStyle({color:b["border_highlight_"+i.settings.theme_dark]}),I(this.id,"show",i.data.entities[e.target.feature.properties[e.target.source.id_property]])},mouseout:function(e){I(this.id,"revert",i.data.entities[e.target.feature.properties[e.target.source.id_property]]),e.target.setStyle({color:b.border})},click:function(e){this.clickto&&this.clickto.set(e.target.feature.properties[e.target.source.id_property])},update:async function(e,t,s){if(clearTimeout(this.queue),s){if(this.view&&this.displaying){const e=i.dataviews[this.view],t=e.get.dataset(),s=ee(e.time_agg),l=i.map[this.id].has_time?i.map[this.id].match_time(s):s,d=t+l+this.id in i.data.inited?t+l:t;if(i.map._queue&&d in i.map._queue&&!i.data.inited[d+this.id])return ae(this,i.map._queue[d],(()=>this.update(void 0,void 0,!0)));!e.valid&&i.data.inited[t]&&(e.state="",r.dataview(e,void 0,!0)),this.parsed.view=e,this.parsed.dataset=t;const o=e.value()+d+i.settings.background_shapes+i.data.inited[this.options.background_shapes],h=e.selection.all,c=e.selection[i.settings.background_shapes&&this.options.background_shapes?"ids":"all"],p=b.border,m=ee(this.color||e.y);if(i.settings.map_overlay&&m in i.map[this.id].triggers?se(this,i.map[this.id].triggers[m],i.data.meta.overall.value[e.parsed.time_agg]):(this.overlay_control.remove(),this.overlay.clearLayers()),i.data.inited[d+this.id]&&c&&e.valid){const s=this.time?x[this.time]:e.time_agg?e.time_agg in x?x[e.time_agg]:parseInt(e.time_agg):0;this.parsed.palette=ee(e.palette)||i.settings.palette,this.parsed.palette in a||(this.parsed.palette=b.palette);const r=await le(m,this.view);this.parsed.time=(s.parsed?s.value()-i.data.meta.times[t].range[0]:0)-r.time_range[t][0],this.parsed.color=m,this.parsed.summary=r[this.view].summaries[t];const d=this.parsed.summary.n[s]===e.n_selected.dataset?"rank":"subset_rank";if(o!==this.vstate){this.map._zoomAnimated="none"!==i.settings.map_animations,Object.keys(this.reference_options).forEach((e=>{this.options[e]=ee(this.reference_options[e]),"zoomAnimation"===e&&(this.map._zoomAnimated=this.options[e])})),this.displaying.clearLayers(),this.fresh_shapes=!0,this.vstate=!1;var n=0;Object.keys(c).forEach((e=>{const t=c[e].layer;if(t&&t[this.id]){const a=e in h,s=t[this.id].has_time?t[this.id][l]:t[this.id];s&&(a||this.options.background_shapes===i.data.entities[e].group)&&(n++,s.options.interactive=a,s.addTo(this.displaying),a||(s.bringToBack(),s.setStyle({fillOpacity:0,color:p,weight:.3})),this.vstate||(this.vstate=o))}})),this.overlay.bringToFront(),n&&("fly"===i.settings.map_animations?setTimeout((()=>this.map.flyToBounds(this.displaying.getBounds())),400):this.map.fitBounds(this.displaying.getBounds()))}const u=m+this.vstate+this.parsed.palette+this.parsed.time+i.settings.polygon_outline+i.settings.color_by_order+i.settings.color_scale_center;if(u!==this.cstate)if(this.cstate=u,i.map[this.id]){const e=this.displaying._layers,a=this.parsed.summary.n[this.parsed.time],s=this.parsed.summary.missing[this.parsed.time];Object.keys(e).forEach((n=>{const r=e[n];if(t===r.entity.group){const e=h[r.entity.features.id];r.setStyle({fillOpacity:.7,color:b.border,fillColor:e&&m in e[this.view][d]?N(e.get_value(m,this.parsed.time),this.parsed.palette,this.parsed.summary,this.parsed.time,e[this.view][d][m][this.parsed.time]-s,a):b.missing,weight:i.settings.polygon_outline})}}))}else"_waiting"in i.map||(i.map._waiting={}),t in i.map._waiting||(i.map._waiting[t]=[]),-1===i.map._waiting[t].indexOf(this.id)&&i.map._waiting[t].push(this.id),-1===i.map._waiting[t].indexOf(this.view)&&i.map._waiting[t].push(this.view)}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(void 0,void 0,!0)),50))}},info:{init:function(e){function a(e,a){const n={parent:e,text:a,parsed:{},ref:!0,selection:!1,get:function(t,a){if(this.ref){if(t){if("features"in this.parsed)return t.features[this.parsed.features];if("data"in this.parsed){if("value"===this.text?this.parsed.data=ee(e.options.variable||a.color||a.y||x[e.view].y):this.text in x&&(this.parsed.data=ee(this.text)),!(this.parsed.data in i.data.variables))return this.parsed.data;const n=i.data.variable_info[this.parsed.data],r=i.data.format_value(t.get_value(this.parsed.data,this.parent.time),!n||!n.type||s.int_types.test(n.type));return"unknown"!==r&&n.type in d?d[n.type](r):r}}return"data"in this.parsed?i.data.meta.times[this.parent.dataset].value[this.parent.time_agg]:"variables"in this.parsed&&(this.value_source||this.parent.v in i.data.variable_info)?i.data.variable_info[ee(this.value_source||this.parent.v)][this.parsed.variables]:this.text}return this.text}};if("value"===a)n.parsed.data=e.options.variable;else if("summary"===a){e.options.show_summary=!0,e.e.classList.add("info-summary-wrapper");const i=t.createElement("table");i.className="info-summary",n.parsed.summary=i,i.appendChild(t.createElement("tr")),i.appendChild(t.createElement("tr")),["NAs","Min","Q1","Mean","Median","Q3","Max"].forEach((e=>{i.firstElementChild.appendChild(t.createElement("th")),i.firstElementChild.lastElementChild.innerText=e,i.lastElementChild.appendChild(t.createElement("td")),i.lastElementChild.lastElementChild.innerText="NA"}))}else if("filter"===a){const e=t.createElement("table");e.className="info-filter",n.parsed.filter=e}return s.features.test(a)?n.parsed.features=a.replace(s.features,""):s.data.test(a)?n.parsed.data=a.replace(s.data,""):s.variables.test(a)?n.parsed.variables=a.replace(s.variables,""):n.ref=!1,n}if(e.depends={},e.has_default=e.options.default&&(e.options.default.title||e.options.default.body),B(e.view,e),e.options.floating&&(t.body.appendChild(e.e),e.e.classList.add("hidden"),t.addEventListener("mousemove",(function(t){if(e.showing){const i=u.content.getBoundingClientRect();e.e.style.top=(t.y>i.height/2?t.y-e.e.getBoundingClientRect().height-10:t.y+10)+"px",e.e.style.left=(t.x>i.width/2?t.x-e.e.getBoundingClientRect().width-10:t.x+10)+"px"}}))),e.show=function(e,t){this.update(e,t),this.showing=!0,this.options.floating&&this.e.classList.remove("hidden"),this.parts.title&&(this.selection?this.parts.title.base.classList.add("hidden"):this.parts.title.default.classList.add("hidden"),this.parts.title.temp.classList.remove("hidden")),this.parts.body&&(this.selection?this.parts.body.base.classList.add("hidden"):this.parts.body.default.classList.add("hidden"),this.parts.body.temp.classList.remove("hidden"))},e.revert=function(){this.showing=!1,this.options.floating?this.e.classList.add("hidden"):(this.parts.title&&(this.selection?this.parts.title.base.classList.remove("hidden"):this.has_default&&this.parts.title.default.classList.remove("hidden"),this.parts.title.temp.classList.add("hidden")),this.parts.body&&(this.selection?this.parts.body.base.classList.remove("hidden"):this.has_default&&this.parts.body.default.classList.remove("hidden"),this.parts.body.temp.classList.add("hidden")))},e.parts={},e.options.title&&(e.parts.title=a(e,e.options.title),"variables"in e.parts.title.parsed&&s.measure_name.test(e.parts.title.parsed.variables)?(e.parts.title.base=t.createElement("button"),e.parts.title.base.type="button",e.parts.title.base.setAttribute("data-bs-toggle","modal"),e.parts.title.base.setAttribute("data-bs-target","#variable_info_display"),e.parts.title.base.addEventListener("click",z.bind(e))):e.parts.title.base=t.createElement("p"),e.parts.title.base.appendChild(t.createElement("span")),e.parts.title.temp=t.createElement("p"),e.parts.title.default=t.createElement("p"),e.parts.title.temp.className=e.parts.title.base.className=e.parts.title.default.className="info-title hidden",e.has_default&&e.options.default.title&&(e.e.appendChild(e.parts.title.default),e.parts.title.default.innerText=e.options.default.title),e.parts.title.ref||(e.parts.title.base.firstElementChild.innerText=e.parts.title.get()),e.e.appendChild(e.parts.title.base),e.e.appendChild(e.parts.title.temp),e.parts.title.base.classList.add("hidden"),e.parts.title.temp.classList.add("hidden")),e.options.body){e.parts.body={base:t.createElement("div"),temp:t.createElement("div"),default:t.createElement("div"),rows:[]},e.parts.body.temp.className=e.parts.body.base.className=e.parts.body.default.className="info-body hidden",e.has_default&&e.options.default.body&&(e.parts.body.default.innerText=e.options.default.body);var n=0;e.options.body.forEach(((i,r)=>{const l={name:a(e,i.name),value:a(e,i.value)};e.parts.body.rows[r]=l,l.base=t.createElement("div"),e.parts.body.base.appendChild(l.base),l.temp=t.createElement("div"),e.parts.body.temp.appendChild(l.temp),l.temp.className=l.base.className="info-body-row-"+i.style,n+=24+("stack"===i.style?24:0),l.name&&(e.options.variable_info&&"variables"in l.name.parsed&&s.measure_name.test(l.name.parsed.variables)?(l.base.appendChild(t.createElement("button")),l.base.lastElementChild.type="button",l.base.lastElementChild.setAttribute("data-bs-toggle","modal"),l.base.lastElementChild.setAttribute("data-bs-target","#variable_info_display"),l.base.lastElementChild.addEventListener("click",z.bind(e))):l.base.appendChild(t.createElement("div")),l.temp.appendChild(t.createElement("div")),l.temp.lastElementChild.className=l.base.lastElementChild.className="info-body-row-name",l.temp.lastElementChild.innerText=l.base.lastElementChild.innerText=l.name.get()),l.value&&(l.base.appendChild(t.createElement("div")),l.temp.appendChild(t.createElement("div")),"summary"in l.value.parsed?l.base.lastElementChild.appendChild(l.value.parsed.summary):"filter"in l.value.parsed?l.base.lastElementChild.appendChild(l.value.parsed.filter):(l.temp.lastElementChild.className=l.base.lastElementChild.className="info-body-row-value"+("statement"===l.value.parsed.variables?" statement":""),l.value.ref||(l.temp.lastElementChild.innerText=l.base.lastElementChild.innerText=l.value.get())))})),e.e.style.minHeight=n+"px",e.e.appendChild(e.parts.body.base),e.e.appendChild(e.parts.body.default),e.e.appendChild(e.parts.body.temp)}e.update()},update:async function(e,a,s){const n=i.dataviews[this.view],r=x[n.time_agg];if(this.v=ee(this.options.variable||a&&(a.color||a.y)||n.y),this.dataset=n.get.dataset(),r&&!(this.dataset in i.data.meta.times))return;this.time_agg=r?r.value()-i.data.meta.times[this.dataset].range[0]:0;const l=this.v&&i.data.variables[this.v].time_range[this.dataset];this.time=l?this.time_agg-l[0]:0,this.options.show_summary&&(this.var=this.v&&await le(this.v,this.view),this.summary=this.var[this.view].summaries[this.dataset]),this.processed||(this.processed=!0,this.options.floating||(M(this.view,{type:"update",id:this.id}),n.y in x&&M(n.y,{type:"update",id:this.id}),r&&M(n.time_agg,{type:"update",id:this.id}),this.options.variable in x&&M(this.options.variable,{type:"update",id:this.id})),this.parts.body&&this.parts.body.rows.forEach((e=>{!e.value.ref&&e.value.text in x&&"variables"in e.name.parsed&&(e.name.value_source=e.value.value_source=e.value.text,e.value.ref=!0,e.value.parsed.data="")}))),e?(this.parts.title&&(this.parts.title.temp.innerText=this.parts.title.get(e,a)),this.parts.body&&this.parts.body.rows.forEach((t=>{t.name.ref&&(t.name.value_source&&(t.name.value_source=t.value.text),"object"!=typeof(J=t.name.get(e,a))&&(t.temp.firstElementChild.innerText=P(J,t.value.parsed.variables,this,e))),t.value.ref&&(t.value.value_source&&(t.value.value_source=t.value.text),"object"!=typeof(J=t.value.get(e,a))&&(t.temp.lastElementChild.innerText=P(J,t.value.parsed.variables,this,e)))}))):this.options.floating||(clearTimeout(this.queue),s?((e=i.data.entities[n.get.ids()])?(this.selection=!0,this.parts.title&&(this.parts.title.value_source&&(p.title.value_source=p.value.text),this.parts.title.base.classList.remove("hidden"),this.parts.title.default.classList.add("hidden")),this.parts.body&&this.has_default&&this.parts.body.default.classList.add("hidden")):(this.selection=!1,this.parts.title&&(this.has_default?(this.parts.title.base.classList.add("hidden"),this.parts.title.default.classList.remove("hidden")):this.parts.title.base.classList.remove("hidden")),this.parts.body&&(this.parts.body.base.classList.add("hidden"),this.has_default&&this.parts.body.default.classList.remove("hidden"))),this.parts.title&&(this.parts.title.base.firstElementChild.innerText=this.parts.title.get(e,a)),this.parts.body&&(this.options.subto||this.parts.body.base.classList.remove("hidden"),this.parts.body.rows.forEach((s=>{if("summary"in s.value.parsed){const e=s.value.parsed.summary.lastElementChild.children;c.summary.forEach(((t,a)=>{e[a].innerText=i.data.format_value(this.summary[t][this.time],0===a)}))}else if("filter"in s.value.parsed){const e=s.value.parsed.filter;let a=0;e.innerHTML="",x._base_filter.c.forEach((s=>{const n=s.passed+s.failed;if(s.active&&n){const r=s.passed+"/"+n;s.e.children[1].lastElementChild.innerText=r,a++;const l=t.createElement("tr"),d=i.data.variable_info[s.variable];l.className="filter-display";let o=t.createElement("td");l.appendChild(o),o.appendChild(t.createElement("span")),o.lastElementChild.className="syntax-variable",o.lastElementChild.title=s.variable,o.lastElementChild.innerText=d.short_name,o.appendChild(t.createElement("span")),o.lastElementChild.innerText=" (",o.appendChild(t.createElement("span")),o.lastElementChild.className="syntax-component",o.lastElementChild.innerText=s.component,o.appendChild(t.createElement("span")),o.lastElementChild.innerText=")",o=t.createElement("td"),l.appendChild(o),o.appendChild(t.createElement("span")),o.lastElementChild.className="syntax-operator",o.lastElementChild.innerText=s.operator,o=t.createElement("td"),l.appendChild(o),o.appendChild(t.createElement("span")),o.lastElementChild.className="syntax-value",o.lastElementChild.innerText=s.value,o=t.createElement("td"),l.appendChild(o),o.appendChild(t.createElement("span")),o.lastElementChild.innerText="("+r+")",e.appendChild(l)}})),this.e.style.display=a?"":"none"}if(!("variables"in s.value.parsed)&&!("summary"in s.value.parsed)||n.y in this.depends?"filter"in s.value.parsed&&!("_base_filter"in this.depends)&&(this.depends._base_filter=!0,M("_base_filter",{type:"update",id:this.id})):(this.depends[n.y]=!0,M(n.y,{type:"update",id:this.id})),s.name.ref){s.name.value_source&&(s.name.value_source=s.value.text);const t=s.name.get(e,a);"object"!=typeof t&&(s.base.firstElementChild.innerText=t)}if(s.value.ref){const i=s.value.get(e,a);"object"==typeof i?Array.isArray(i)&&"sources"===s.value.parsed.variables&&(s.base.innerHTML="",s.base.appendChild(t.createElement("table")),s.base.lastElementChild.className="source-table",s.base.firstElementChild.appendChild(t.createElement("thead")),s.base.firstElementChild.firstElementChild.appendChild(t.createElement("tr")),s.base.firstElementChild.firstElementChild.firstElementChild.appendChild(t.createElement("th")),s.base.firstElementChild.firstElementChild.firstElementChild.appendChild(t.createElement("th")),s.base.firstElementChild.firstElementChild.firstElementChild.firstElementChild.innerText="Source",s.base.firstElementChild.firstElementChild.firstElementChild.lastElementChild.innerText="Accessed",s.base.firstElementChild.appendChild(t.createElement("tbody")),i.forEach((e=>{s.base.firstElementChild.lastElementChild.appendChild(H(e,!0))}))):s.base.lastElementChild.innerText=P(i,s.value.parsed.variables,this,e)}})))):this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(void 0,void 0,!0)),50))),this.revert()}},datatable:{init:function(e){e.e.appendChild(t.createElement("tHead")),e.e.appendChild(t.createElement("tBody")),e.click=e.e.getAttribute("click"),e.features=e.options.features,e.parsed={summary:{},order:[],time:0,color:"",dataset:x[e.view].get.dataset()},e.header=[],e.rows={},e.rowIds={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0;const a=i.data.meta.times[e.parsed.dataset];if(e.tab&&t.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){e.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(K,155))}.bind(e)),e.e.addEventListener("mouseover",l.datatable.mouseover.bind(e)),e.e.addEventListener("mouseout",l.datatable.mouseout.bind(e)),e.click&&(e.click in x&&(e.clickto=x[e.click]),e.e.addEventListener("click",l.datatable.click.bind(e))),e.show=function(e){if(e.features&&e.features.id in this.rows){const t=this.rows[e.features.id].node();if(t&&(t.style.backgroundColor=b.background_highlight,i.settings.table_autoscroll)){const e=this.e.parentElement.getBoundingClientRect().height,a=t.getBoundingClientRect().y-this.e.getBoundingClientRect().y;this.e.parentElement.scroll({top:e>this.e.scrollHeight-a?this.e.parentElement.scrollHeight:a,behavior:i.settings.table_scroll_behavior||"smooth"})}}},e.revert=function(e){if(e.features&&e.features.id in this.rows){const t=this.rows[e.features.id].node();t&&(t.style.backgroundColor="inherit")}},e.options.variable_source=e.options.variables,e.options.variables?"string"==typeof e.options.variables&&(e.options.variables in x?(M(e.options.variables,{type:"update",id:e.id}),e.options.variables=ee(e.options.variables),e.options.single_variable="string"==typeof e.options.variables):e.options.single_variable||(e.options.single_variable=[{name:e.options.single_variable}])):e.options.variables=Object.keys(i.data.variables),"string"!=typeof e.options.variables&&e.options.variables.length&&"string"===e.options.variables[0]&&(e.options.variables=e.options.variables.map((e=>{}))),e.options.single_variable){const t=e.options.variables,s=t.name||t;e.header.push({title:"Name",data:"entity.features.name"}),a.is_single&&(e.variable_header=!0);const n=i.data.variables[s].time_range[e.parsed.dataset];if(n)for(let r=n[1]-n[0]+1;r--;)e.header[r+1]={title:e.variable_header?t.title||i.data.format_label(s):a.value[r+n[0]]+"",data:i.data.retrievers.vector,render:i.data.retrievers.row_time.bind({i:r,o:n[0],format_value:i.data.format_value.bind(i.data)})};e.options.order=[[e.header.length-1,"dsc"]]}else if(e.options.wide){e.features&&("string"==typeof e.features&&(e.features=[{name:e.features}]),e.features.forEach((t=>{e.header.push({title:t.title||t.name,data:"entity.features."+t.name.replace(s.all_periods,"\\.")})})));for(let t=e.options.variables.length;t--;){"string"==typeof e.options.variables[t]&&(e.options.variables[t]={name:e.options.variables[t]});const a=e.options.variables[t];a.source||(a.source=a.name in i.data.variables?"data":"features"),e.header.push("features"===a.source?{title:a.title||i.data.format_label(a.name),data:"entity.features."+a.name.toLowerCase().replace(s.all_periods,"\\.")}:{title:a.title||i.data.format_label(a.name),render:async function(e,t,a){if("data"===this.c.source){if(this.c.name in i.data.variables){const e=a.time-await le(this.c.name,this.view).time_range[this.o.parsed.dataset][0];return e<0?NaN:a.entity.get_value(this.c.name,e)}return NaN}return this.c.source in a.entity&&this.c.name in a.entity[this.c.source]?a.entity[this.c.source][this.c.name]:NaN}.bind({o:e,c:a})})}}else e.filters=e.options.filters,e.current_filter={},a.is_single||e.header.push({title:"Year",data:"entity.time.value",render:function(e,t,a){const s=a.time+a.offset;return e&&s>=0&&s<e.length?"number"==typeof e[s]?i.data.format_value(e[s],!0):e[s]:NaN}}),e.features&&("string"==typeof e.features&&(e.features=[{name:e.features}]),e.features.forEach((t=>{e.header.splice(0,0,{title:t.title||t.name,data:"entity.features."+t.name.replace(s.all_periods,"\\.")})}))),e.header.push({title:"Variable",data:function(e){return e.variable in e.entity.variables?e.entity.variables[e.variable].meta.short_name:e.variable}}),e.header.push({title:"Value",data:i.data.retrievers.vector,render:function(e,t,a){return e?"number"==typeof e[a.time]?i.data.format_value(e[a.time],a.int):e[a.time]:""}});e.view?(M(e.view,{type:"update",id:e.id}),M(e.view+"_filter",{type:"update",id:e.id})):e.view=b.dataview,ue.bind(e)()},update:async function(e){if(clearTimeout(this.queue),e){if(this.table){var t=this.options.variable_source&&ee(this.options.variable_source).replace(s.all_periods,"\\.");const a=x[this.view],n=a.get.dataset(),r=n+a.value()+a.get.time_filters()+i.settings.digits+t;if(!i.data.inited[n])return;if(r!==this.state){this.rows={},this.rowIds={},this.table.clear();let l=!0;if(a.selection){if(this.state=r,Object.keys(this.reference_options).forEach((e=>this.options[e]=ee(this.reference_options[e]))),this.options.single_variable){const e=ee(a.time_agg),s=await le(t,this.view);if(this.parsed.dataset=n,this.parsed.color=t,this.parsed.time_range=s.time_range[n],this.parsed.time=("number"==typeof e?e-i.data.meta.times[n].range[0]:0)-this.parsed.time_range[0],this.parsed.summary=this.view in s&&s[this.view].summaries[n],this.parsed.order=this.view in s&&s[this.view].order[n][this.parsed.time],this.header.length<2||n!==this.header[1].dataset||t!==this.header[1].variable){if(this.table.destroy(),$(this.e).empty(),this.header=[{title:"Name",data:"entity.features.name"}],-1!==this.parsed.time_range[0])for(let e=this.parsed.time_range[2];e--;)this.header[e+1]={dataset:n,variable:t,title:this.variable_header?this.options.variables.title||i.data.format_label(t):i.data.meta.times[n].value[e+this.parsed.time_range[0]]+"",data:i.data.retrievers.vector,render:i.data.retrievers.row_time.bind({i:e,o:this.parsed.time_range[0],format_value:i.data.format_value.bind(i.data)})};else this.state="";this.options.order[0][0]=this.header.length-1,this.options.columns=this.header,this.table=$(this.e).DataTable(this.options)}const r=this.header.length;let l;for(let e=1;e<r;e++)this.table.column(e).visible(a.times[e-1+this.parsed.time_range[0]],!1),a.times[e-1+this.parsed.time_range[0]]&&(l=!1);l&&(this.state="")}if(this.options.wide)Object.keys(a.selection.all).forEach((e=>{if(t)t in a.selection.all[e][this.view].summary&&(this.rows[e]=this.table.row.add({dataset:n,variable:t,offset:this.parsed.time_range[0],entity:a.selection.all[e],int:s.int_types.test(i.data.variable_info[t].type)}),this.rowIds[this.rows[e].selector.rows]=e);else for(let t=i.data.meta.times[n].n;t--;)this.rows[e]=this.table.row.add({time:t,entity:a.selection.all[e]}),this.rowIds[this.rows[e].selector.rows]=e}));else{Object.keys(this.filters).forEach((e=>{this.current_filter[U]=ee(e)}));const r=[];let l=""+this.parsed.dataset+a.get.ids()+a.get.features()+i.settings.digits;for(let a=this.options.variables.length;a--;){if(t=this.options.variables[a].name||this.options.variables[a],e=!1,t in i.data.variables&&"meta"in variable)if(this.options.filters){for(const t in this.current_filter)if(t in variable.meta&&(e=variable.meta[t]===this.current_filter[t],!e))break}else e=!0;e&&(l+=t,r.push({variable:t,int:s.int_types.test(i.data.variable_info[t].type),time_range:variable.time_range[n],renderer:function(e,t){const i=t.features.id,a=this.time_range,s=a[1];for(let r=a[0];r<=s;r++)e.rows[i]=e.table.row.add({offset:this.time_range[0],time:r-this.time_range[0],dataset:n,variable:this.variable,entity:t,int:this.int}),e.rowIds[e.rows[i].selector.rows]=i}}))}if(l===this.varstate)return;this.varstate=l,Object.keys(a.selection.all).forEach((e=>{const l=a.selection.all[e];this.options.single_variable?t in l[a].summary&&variable.code in l.data&&(this.rows[e]=this.table.row.add({offset:this.parsed.time_range[0],dataset:n,variable:t,entity:l,int:s.int_types.test(i.data.variable_info[t].type)}),this.rowIds[this.rows[e].selector.rows]=e):r.forEach((e=>{i.data.variables[e.variable].code in l.data&&e.renderer(this,l)}))}))}}l?this.table.draw():this.table.columns.adjust().draw(!1)}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))},mouseover:function(e){if(e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row],a=this.rows[t].node();a&&(a.style.backgroundColor=b.background_highlight),t in i.data.entities&&I(this.id,"show",i.data.entities[t])}},mouseout:function(e){if(e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row],a=this.rows[t].node();a&&(a.style.backgroundColor="inherit"),t in i.data.entities&&I(this.id,"revert",i.data.entities[t])}},click:function(e){if(this.clickto&&e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row];t in i.data.entities&&this.clickto.set(t)}}},legend:{init:function(e){M(e.view,{type:"update",id:e.id});const a=x[e.view];if(a.time_agg in x&&M(a.time_agg,{type:"update",id:e.id}),e.palette||(a.palette?(e.palette=a.palette,a.palette in x&&M(a.palette,{type:"update",id:e.id})):e.palette="settings.palette"in x?"settings.palette":i.settings.palette),e.variable=e.e.getAttribute("variable"),e.variable?e.variable in x&&M(e.variable,{type:"update",id:e.id}):a.y in x&&M(a.y,{type:"update",id:e.id}),e.palette in x){const t=x[e.palette];t.e&&t.e.addEventListener("change",e.update)}e.parsed={summary:{},order:[],selection:{},time:0,color:""},e.parts={ticks:e.e.querySelector(".legend-ticks"),scale:e.e.querySelector(".legend-scale"),summary:e.e.querySelector(".legend-summary")},e.parts.ticks.setAttribute("of",e.id),e.parts.scale.setAttribute("of",e.id),e.parts.summary.setAttribute("of",e.id),e.e.addEventListener("mousemove",l.legend.mouseover.bind(e)),e.e.addEventListener("mouseout",l.legend.mouseout.bind(e)),e.e.addEventListener("click",l.legend.click.bind(e)),e.click=e.e.getAttribute("click"),e.click in x&&(e.clickto=x[e.click]),e.ticks={center:e.parts.summary.appendChild(t.createElement("div")),min:e.parts.summary.appendChild(t.createElement("div")),max:e.parts.summary.appendChild(t.createElement("div")),entity:e.parts.ticks.appendChild(t.createElement("div"))},Object.keys(e.ticks).forEach((i=>{e.ticks[i].setAttribute("of",e.id),e.ticks[i].className="legend-tick",e.ticks[i].appendChild(J=t.createElement("div")),J.setAttribute("of",e.id),J.appendChild(t.createElement("p")),J.lastElementChild.setAttribute("of",e.id),"m"!==i.substring(0,1)&&(J.appendChild(t.createElement("p")),J.lastElementChild.setAttribute("of",e.id),J.appendChild(t.createElement("p")),J.lastElementChild.setAttribute("of",e.id),"entity"===i?e.ticks[i].firstElementChild.lastElementChild.classList.add("entity"):e.ticks[i].firstElementChild.firstElementChild.classList.add("summary"))})),e.ticks.entity.firstElementChild.classList.add("hidden"),e.ticks.max.className="legend-tick-end max",e.ticks.min.className="legend-tick-end min",e.ticks.center.style.left="50%",e.show=function(e,t){if(e&&"parsed"in t&&e.features.name){const a=x[this.view],s=t.parsed.summary,n=s&&"levels"in s,r=s&&!n?s.min[t.parsed.time]:0,l=s?n?s.levels.length-r:s.range[t.parsed.time]:1,d=s.n[t.parsed.time],o=d===a.n_selected.dataset?"rank":"subset_rank",h=i.data.entities[e.features.id][this.view],c=e.get_value(t.parsed.color,t.parsed.time),p=100*((n?c in s.level_ids:"number"==typeof c)?i.settings.color_by_order?NaN:Math.max(0,Math.min(1,l?((n?s.level_ids[c]:c)-r)/l:0)):NaN),m=this.ticks.entity.firstElementChild.children[1];if(isFinite(p))m.parentElement.classList.remove("hidden"),m.innerText=i.data.format_value(c,this.integer),this.ticks.entity.style.left=p+"%",this.ticks.entity.firstElementChild.firstElementChild.innerText=(p>96||p<4)&&e.features.name.length>13?e.features.name.substring(0,12)+"…":e.features.name;else if(i.settings.color_by_order&&t.parsed.color in h[o]){const i=h[o][t.parsed.color][t.parsed.time],a=i/(d-1)*100;this.ticks.entity.firstElementChild.firstElementChild.innerText=i>-1&&(a>96||a<4)&&e.features.name.length>13?e.features.name.substring(0,12)+"…":e.features.name,i>-1&&(m.parentElement.classList.remove("hidden"),m.innerText="# "+(d-i),this.ticks.entity.style.left=a+"%")}this.ticks.entity.style.marginLeft=-this.ticks.entity.getBoundingClientRect().width/2+"px"}},e.revert=function(){this.ticks.entity.firstElementChild.classList.add("hidden")},e.update()},update:async function(){const e=x[this.view],n=ee(this.variable||e.y),r=e.get.dataset(),l=await le(n,this.view);if(e.valid&&l&&this.view in l){const c=ee(e.time_agg),p=("number"==typeof c?c-i.data.meta.times[r].range[0]:0)-l.time_range[r][0],m=l[this.view].summaries[r],u=ee(this.palette).toLowerCase(),f=u in a?u:i.settings.palette in a?i.settings.palette:b.palette,g=a[f].colors;if(this.parsed.summary=m,this.parsed.order=l[this.view].order[r][p],this.parsed.time=p,this.parsed.color=n,m&&p<m.n.length){if(this.integer=!i.data.variable_info[n]||!i.data.variable_info[n].type||s.int_types.test(i.data.variable_info[n].type),f+i.settings.color_scale_center!==this.current_palette)if(this.current_palette=f+i.settings.color_scale_center,this.parts.scale.innerHTML="","discrete"===a[f].type)if(i.settings.color_by_order||"none"===i.settings.color_scale_center)g.forEach((e=>{this.parts.scale.appendChild(t.createElement("span")),this.parts.scale.lastElementChild.setAttribute("of",this.id),this.parts.scale.lastElementChild.style.backgroundColor=e}));else{var d,o=0,h=Math.ceil(g.length/2);for(this.parts.scale.appendChild(d=t.createElement("div")),d.setAttribute("of",this.id),d.style.left=0;o<h;o++)d.appendChild(t.createElement("span")),d.lastElementChild.setAttribute("of",this.id),d.lastElementChild.style.backgroundColor=g[o];for(this.parts.scale.appendChild(d=t.createElement("div")),d.setAttribute("of",this.id),d.style.right=0,o=Math.floor(g.length/2),h=g.length;o<h;o++)d.appendChild(t.createElement("span")),d.lastElementChild.setAttribute("of",this.id),d.lastElementChild.style.backgroundColor=g[o]}else this.parts.scale.appendChild(t.createElement("span")),this.parts.scale.appendChild(t.createElement("span")),this.parts.scale.firstElementChild.style.background="linear-gradient(0.25turn, rgb("+g[2][0][0]+", "+g[2][0][1]+", "+g[2][0][2]+"), rgb("+g[1][0]+", "+g[1][1]+", "+g[1][2]+"))",this.parts.scale.lastElementChild.style.background="linear-gradient(0.25turn, rgb("+g[1][0]+", "+g[1][1]+", "+g[1][2]+"), rgb("+g[0][0][0]+", "+g[0][0][1]+", "+g[0][0][2]+"))";l.levels?(this.ticks.center.classList.remove("hidden"),this.ticks.min.firstElementChild.firstElementChild.innerText=l.levels[0],this.ticks.max.firstElementChild.firstElementChild.innerText=l.levels[l.levels.length-1]):i.settings.color_by_order?(this.ticks.center.classList.add("hidden"),this.ticks.min.firstElementChild.firstElementChild.innerText="# "+(m.n[p]?m.n[p]:0),this.ticks.max.firstElementChild.firstElementChild.innerText="# "+(m.n[p]?1:0)):(this.ticks.center.classList.remove("hidden"),this.ticks.min.firstElementChild.firstElementChild.innerText=m.n[p]&&isFinite(m.min[p])?i.data.format_value(m.min[p],this.integer):"unknown",this.ticks.max.firstElementChild.firstElementChild.innerText=m.n[p]&&isFinite(m.max[p])?i.data.format_value(m.max[p],this.integer):"unknown","none"!==i.settings.color_scale_center?(this.ticks.center.firstElementChild.lastElementChild.innerText=v[i.settings.summary_selection]+" "+i.settings.color_scale_center,this.ticks.center.firstElementChild.children[1].innerText=i.data.format_value(m[i.settings.color_scale_center][p]),this.ticks.center.style.left=100*m["norm_"+i.settings.color_scale_center][p]+"%"):(this.ticks.center.firstElementChild.lastElementChild.innerText=v[i.settings.summary_selection]+" median",this.ticks.center.firstElementChild.children[1].innerText=i.data.format_value(m.median[p]),this.ticks.center.style.left=100*m.norm_median[p]+"%"),2===this.parts.scale.childElementCount&&("none"===i.settings.color_scale_center?(this.parts.scale.firstElementChild.style.width="50%",this.parts.scale.lastElementChild.style.width="50%"):(this.parts.scale.firstElementChild.style.width=100*m["norm_"+i.settings.color_scale_center][p]+"%",this.parts.scale.lastElementChild.style.width=100-100*m["norm_"+i.settings.color_scale_center][p]+"%")),this.ticks.center.style.marginLeft=-this.ticks.center.getBoundingClientRect().width/2+"px")}}},mouseover:function(e){const t=this.parts.scale.getBoundingClientRect(),a=(Math.max(t.x,Math.min(t.x+t.width,e.clientX))-t.x)/t.width;var s=!1;if(i.settings.color_by_order)this.parsed.order&&this.parsed.order.length&&(s=i.data.entities[this.parsed.order[Math.max(this.parsed.summary.missing[this.parsed.time],Math.min(this.parsed.order.length-1,Math.floor((this.parsed.order.length-1)*a)))][0]]);else{const e=this.parsed.summary.min[this.parsed.time],t=e+a*(this.parsed.summary.max[this.parsed.time]-e);var n,r;if(this.parsed.order&&this.parsed.order.length&&(r=this.parsed.summary.missing[this.parsed.time])<this.parsed.order.length)if(1!==this.parsed.order.length&&a){for(n=this.parsed.order.length-2;n>=r&&!((this.parsed.order[n][1]+this.parsed.order[n+1][1])/2<=t);--n);n++,s=i.data.entities[this.parsed.order[n][0]]}else s=i.data.entities[this.parsed.order[r][0]]}s&&(this.show(s,this),this.entity&&s.features.id===this.entity.features.id||(this.entity?I(this.id,"revert",this.entity):this.entity=s,I(this.id,"show",s),this.entity=s))},mouseout:function(e){e.relatedTarget&&this.id!==e.relatedTarget.getAttribute("of")&&(this.revert(),this.entity&&(I(this.id,"revert",this.entity),this.entity=!1))},click:function(){this.clickto&&this.entity&&(this.revert(),this.clickto.set(this.entity.features.id))}},credits:{init:function(e){const a=i.credit_output&&i.credit_output[e.id];e.exclude=[],e.add={},e.exclude=a&&a.exclude||[],e.add=a&&a.add||{},e.e.appendChild(t.createElement("ul")),Object.keys(i.credits).forEach((a=>{if(-1===e.exclude.indexOf(a)){const n=i.credits[a];var s;e.e.lastElementChild.appendChild(s=t.createElement("li")),"url"in n&&(s.appendChild(s=t.createElement("a")),s.href=n.url,s.target="_blank",s.rel="noreferrer"),s.innerText=n.name,"version"in n&&(s.appendChild(t.createElement("span")),s.lastElementChild.className="version-tag",s.lastElementChild.innerText=n.version),"description"in n&&(s.parentElement.appendChild(t.createElement("p")),s.parentElement.lastElementChild.innerText=n.description)}}))}},init_input:function(e){const t={type:e.getAttribute("auto-type"),source:void 0,value:function(){const e=ee(this.source);return void 0===e?ee(this.default):e},default:e.getAttribute("default"),options_source:e.getAttribute("auto-options"),depends:e.getAttribute("depends"),variable:e.getAttribute("variable"),dataset:e.getAttribute("dataset"),view:e.getAttribute("data-view"),id:e.id||e.options_source||"ui"+u.elementCount++,note:e.getAttribute("aria-description")||"",current_index:-1,previous:"",e:e,values:[],display:[],data:[],input:!0};if(t.settings=t.type in i&&t.id in i[t.type]?i[t.type][t.id]:{},t.wrapper=t.e.parentElement.classList.contains("wrapper")?t.e.parentElement:t.e.parentElement.parentElement,t.wrapper&&(t.note&&t.wrapper.classList.add("has-note"),t.wrapper.setAttribute("of",t.id),["div","span","label","fieldset","legend","input","button"].forEach((e=>{const i=t.wrapper.querySelectorAll(e);i.length&&i.forEach((e=>e.setAttribute("of",t.id)))}))),t.note){t.wrapper.addEventListener("mouseover",te.bind(t));const e="DIV"!==t.e.tagName?t.e:t.e.querySelector("input");e&&(e.addEventListener("focus",te.bind(t)),e.addEventListener("blur",ie))}if(s.number.test(t.default)&&(t.default=Number(t.default)),t.type in l){const e=l[t.type];e.setter&&(t.set=e.setter.bind(t),t.reset=function(){this.set(ee(this.default))}.bind(t)),e.retrieve&&(t.get=e.retrieve.bind(t)),e.adder&&(t.add=e.adder.bind(t)),e.listener&&(t.listen=e.listener.bind(t)),e.init&&e.init(t),t.options=t.e.querySelectorAll("select"===t.type?"option":"combobox"===t.type?".combobox-option":"input"),x[t.id]=t}},init_output:function(e,t){const a={type:e.getAttribute("auto-type"),view:e.getAttribute("data-view")||b.dataview,id:e.id||"out"+t,note:e.getAttribute("aria-description")||"",reference_options:{},e:e};a.note&&a.e.addEventListener("mouseover",te.bind(a)),a.options=a.type in i?i[a.type][a.id]:void 0,a.options&&a.options.dataview&&(a.view=a.options.dataview),a.type in l&&"update"in l[a.type]&&(a.update=l[a.type].update.bind(a)),a.options&&("options"in a.options&&(a.options=a.options.options),Object.keys(a.options).forEach((e=>{a.options[e]in x&&(a.reference_options[e]=a.options[e])})),"subto"in a.options&&("string"==typeof a.options.subto&&(a.options.subto=[a.options.subto]),Array.isArray(a.options.subto)&&a.options.subto.forEach((e=>B(e,a))))),x[a.id]=a,a.type in l&&"init"in l[a.type]&&(!a.view||x[a.view].parsed.dataset in i.data.inited?l[a.type].init(a):(i.data.data_queue[x[a.view].parsed.dataset][a.id]=l[a.type].init.bind(null,a),i.data.loaded[x[a.view].parsed.dataset]&&i.data.load_id_maps()))}},d={percent:function(e){return e+"%"},"drive time":function(e){return e+" minutes"},minutes:function(e){return e+" minutes"},dollar:function(e){return"$"+e},"internet speed":function(e){return e+" MB/s"}},o={name:e.location.pathname||"default",perm:e.localStorage||{setItem:function(){},getItem:function(){},removeItem:function(){}},set:function(e,t){const i=JSON.parse(this.perm.getItem(this.name))||{};i[e]=t,this.perm.setItem(this.name,JSON.stringify(i))},get:function(e){const t=JSON.parse(this.perm.getItem(this.name));return t?e?t[e]:t:void 0}},h={Enter:"select",NumpadEnter:"select",ArrowUp:"move",Home:"move",ArrowDown:"move",End:"move",Escape:"close",Tab:"close"},c={Time:["first","selected","last"],summary:["missing","min","q1","mean","median","q3","max"]},m={number:function(e,t){return e.get_value(t.name,this-t.range[0])},first:function(e,t){return e.get_value(t.name,0)},selected:function(e,t,i){return e.get_value(t.name,i.time_agg-t.range[0])},last:function(e,t){return e.get_value(t.name,t.range[1]-t.range[0])}},u={load_screen:t.getElementById("load_screen"),wrap:t.getElementById("site_wrap"),navbar:t.querySelector(".navbar"),content:t.querySelector(".content"),overlay:t.createElement("div"),menus:t.getElementsByClassName("menu-wrapper"),panels:t.getElementsByClassName("panel"),elementCount:0},f={_timeout:0},b={time:"time",dataview:"default_view",palette:"vik",background_highlight:"#adadad",border:"#7e7e7e",border_highlight_true:"#ffffff",border_highlight_false:"#000000",missing:"#00000000"},v={dataset:"Overall",filtered:"Filtered",children:"Unfiltered selection",all:"Selection"},g={retain_state:!0},_={},y={},E={},x={_base_filter:{id:"_base_filter",c:new Map,value:function(e,t){const a=!e;return a&&(e=[]),x._base_filter.c.forEach((s=>{const n=Number(s.value),r="selected"===s.component?i.data.meta.overall.value[t]:s.time_component?i.data.meta.overall.value[s.component]:s.component;isNaN(n)||e.push(s.variable+"["+r+"]"+s.operator+n+(a?s.active:""))})),e.join("&")}}},C={},w={};if(u.overlay.className="content-overlay",t.body.appendChild(u.overlay),t.body.className=o.get("theme_dark")||i.settings.theme_dark?"dark-theme":"light-theme",u.content){for(var k=u.menus.length,T=u.navbar?u.navbar.getBoundingClientRect().height:0;k--;)if(u.menus[k].classList.contains("menu-top")){T=u.menus[k].getBoundingClientRect().height;break}u.content.style.top=T+"px"}function N(e,t,n,r,l,d){if(isNaN(e))return b.missing;const o="none"!==i.settings.color_scale_center&&!i.settings.color_by_order,h="discrete"===a[t].type,c=a[t].colors,p="levels"in n,m=p?0:n.min[r],u=p?n.levels.length-m:n.range[r],f="none"===i.settings.color_scale_center||s.median.test(i.settings.color_scale_center)?"median":"mean",v=i.settings.color_by_order?o?n["break_"+f][r]/d:.5:isNaN(n["norm_"+f][r])?0:n["norm_"+f][r],g=h?o&&!i.settings.color_by_order?Math.ceil(c.length/2):c.length:1,_=i.settings.color_by_order?l/d:u?((p?n.level_ids[e]:e)-m)/u:0,y=_>(o?v:.5);var E=o?u?y?(_-v-n["upper_"+f+"_min"][r])/n["upper_"+f+"_range"][r]:(_+v-n["lower_"+f+"_min"][r])/n["lower_"+f+"_range"][r]:0:_;return h||(E=Math.max(0,Math.min(1,E)),y&&(E=1-E),o||(E*=2)),(p?e in n.level_ids:"number"==typeof e)?h?c[Math.max(0,Math.min(c.length-1,Math.floor(o&&y?g-c.length%2+g*E:g*E)))]:"rgb("+(y?c[0][0][0]+E*c[0][1][0]+", "+(c[0][0][1]+E*c[0][1][1])+", "+(c[0][0][2]+E*c[0][1][2]):c[2][0][0]+E*c[2][1][0]+", "+(c[2][0][1]+E*c[2][1][1])+", "+(c[2][0][2]+E*c[2][1][2]))+")":b.missing}function A(e,i){if("button"in i||(i.button={}),"string"==typeof i.text&&(i.text=[i.text]),i.parts=t.createElement("span"),i.text.forEach((a=>{if(a in i.button){const s=i.button[a];if(i.parts.appendChild(t.createElement("button")),i.parts.lastElementChild.type="button",s.trigger=te.bind({id:e.id+s.text,note:s.target,wrapper:i.parts.lastElementChild}),"note"===s.type)i.parts.lastElementChild.setAttribute("aria-description",s.target),i.parts.lastElementChild.setAttribute("of",e.id+s.text),i.parts.lastElementChild.className="has-note",i.parts.lastElementChild.addEventListener("mouseover",s.trigger),i.parts.lastElementChild.addEventListener("focus",s.trigger),i.parts.lastElementChild.addEventListener("blur",ie);else{i.parts.lastElementChild.className="btn btn-link";const e=x[s.target];e&&"function"==typeof e[s.type]&&(i.parts.lastElementChild.setAttribute("aria-label",s.text.join("")),i.parts.lastElementChild.addEventListener("click",e[s.type]))}}else i.parts.appendChild(t.createElement("span"))})),"condition"in i)for(let t=i.condition.length;t--;){const a=i.condition[t];a.id&&("default"===a.id?a.check=function(){return!0}:(e.depends[a.id]="",a.check=function(){return"default"===this.id||DataHandler.prototype.checks[this.type](ee(this.id),ee(this.value))}.bind(a)))}}function O(e,a,n){if(!(a in i.data.sets))return i.data.data_queue[a][e.id]=function(){return O(e,a,n)},void(i.data.loaded[a]&&i.data.load_id_maps());n[a]={options:[],values:{},display:{}};const r=e.values,l=n[a].options,d=n[a].values,o=n[a].display,h="combobox"===e.type;var c=!e.sensitive&&!!e.current_set,p=0;e.settings.group&&(e.groups={e:[],by_name:{}}),Object.keys(i.data.entities).forEach((n=>{const m=i.data.entities[n];if(a===m.group)if(c&&!(n in r)&&(e.sensitive=!0,c=!1),e.groups){const i=m.features[e.settings.group]||"";if(!(i in e.groups.by_name)){if(h){const a=t.createElement("div"),n=e.id+"_"+i.replace(s.seps,"-");a.className="combobox-group combobox-component",a.role="group",a.setAttribute("aria-labelledby",n),a.appendChild(t.createElement("label")),a.firstElementChild.innerText=i,a.firstElementChild.id=n,a.firstElementChild.className="combobox-group-label combobox-component"}else{t.createElement("optgroup").label=i}e.groups.by_name[i]=J,e.groups.e.push(J)}e.groups.by_name[i].appendChild(e.add(n,m.features.name,!0))}else l.push(e.add(n,m.features.name)),d[n]=p,o[m.features.name]=p++})),e.settings.group&&(p=0,Object.keys(e.groups.by_name).forEach((t=>{e.groups.by_name[t].querySelectorAll(h?".combobox-option":"option").forEach((e=>{l.push(e),d[e.value]=p,o[e.innerText]=p++}))})))}function q(e,a,n){n[a]={options:[],values:{},display:{}};const r=e.values,l=n[a].options,d=n[a].values,o=n[a].display,h="combobox"===e.type;var c=!e.sensitive&&!!e.current_set,p=0;e.settings.group&&(e.groups={e:[],by_name:{}}),i.metadata.info[a].schema.fields.forEach((a=>{const n=i.data.variables[a.name];if(n&&!n.is_time){const n=i.data.format_label(a.name);if(c&&!(G in r)&&(e.sensitive=!0,c=!1),e.groups){const i=a.info[e.settings.group]||"";if(!(i in e.groups.by_name)){const a=t.createElement(h?"div":"optgroup");if(h){const n=e.id+"_"+i.replace(s.seps,"-");a.className="combobox-group combobox-component",a.role="group",a.setAttribute("aria-labelledby",n),a.appendChild(t.createElement("label")),a.firstElementChild.innerText=i,a.firstElementChild.id=n,a.firstElementChild.className="combobox-group-label combobox-component"}else a.label=i;e.groups.by_name[i]=a,e.groups.e.push(a)}e.groups.by_name[i].appendChild(e.add(a.name,n,!0,a))}else l.push(e.add(a.name,n,!0,a)),l[p].id=e.id+"-option"+p,d[a.name]=p,o[n]=p++}})),e.settings.group&&(p=0,Object.keys(e.groups.by_name).forEach((t=>{e.groups.by_name[t].querySelectorAll(h?".combobox-option":"option").forEach((t=>{l.push(t),l[p].id=e.id+"-option"+p,d[t.value]=p,o[t.firstChild&&t.firstChild.textContent||t.innerText]=p++}))})))}function j(e,t,a,s){const n=i.data.variables[a].info[t],r="string"===n.type?"levels":"ids",l=n[r];if(l){const i=t+a;s[i]={options:[],values:{},display:{}};const n=e.values,r=s[i].options,h=s[i].values,c=s[i].display;var d=!e.sensitive&&!!e.current_set,o=0;Object.keys(l).forEach((t=>{const i=l[t];d&&!(t in n)&&(e.sensitive=!0,d=!1),r.push(e.add(i.id,i.name,!0)),h[i.id]=o,c[i.name]=o++}))}else"ids"===r&&(i.data.data_queue[t][e.id]=function(){return j(e,t,a,s)},i.data.loaded[t]&&i.data.load_id_maps())}function S(e,t){return e.id in w&&t.id in w?w[e.id]._n.children-w[t.id]._n.children:-1/0}function M(e,t){e in C||(C[e]=[]),t.uid||(t.uid=JSON.stringify(t));const i=C[e];for(let e=i.length;e--;)if(t.uid===i[e].uid)return;i.push(t),e in w||(w[e]={_n:{children:0,parents:0},children:{},parents:{}}),t.id in w||(w[t.id]={_n:{children:0,parents:0},children:{},parents:{}}),w[e].children[t.id]=w[t.id],w[e]._n.children++,w[t.id].parents[e]=w[e],w[t.id]._n.parents++,i.sort(S),he(e)}function B(e,t){e in _||(_[e]=[]),_[e].push(t)}function I(e,t,i){if(e in _)for(var a=_[e].length;a--;)t in _[e][a]&&_[e][a][t](i,x[e])}function R(e){if(e.dark_theme!==i.settings.theme_dark){e.dark_theme=i.settings.theme_dark;const a=getComputedStyle(t.body);"style"in e||(e.style=e.options.layout,"font"in e.style||(e.style.font={}),"modebar"in e.style||(e.style.modebar={}),"font"in e.style.xaxis||(e.style.xaxis.font={}),"font"in e.style.yaxis||(e.style.yaxis.font={})),e.style.paper_bgcolor=a.backgroundColor,e.style.plot_bgcolor=a.backgroundColor,e.style.font.color=a.color,e.style.modebar.bgcolor=a.backgroundColor,e.style.modebar.color=a.color,e.e._fullLayout.xaxis.showgrid&&(e.style.xaxis.gridcolor=a.borderColor),e.e._fullLayout.yaxis.showgrid&&(e.style.yaxis.gridcolor=a.borderColor),e.style.xaxis.font.color=a.color,e.style.yaxis.font.color=a.color,Plotly.relayout(e.e,e.options.layout)}}function D(e,t,a,s,n,r){if(t.data&&e.parsed.x in i.data.variables){const l=i.data.retrievers.vector({variable:e.parsed.x,entity:t}),d=i.data.retrievers.vector({variable:e.parsed.y,entity:t}),o=JSON.parse(e.traces[e.base_trace]);for(let a=i.data.variables[e.parsed.x].time_range[e.parsed.dataset][2];a--;)o.text[a]=t.features.name,o.x[a]=e.parsed.x_range[0]<=a&&a<=e.parsed.x_range[1]?l[a-e.parsed.x_range[0]]:NaN,o.y[a]=e.parsed.y_range[0]<=a&&a<=e.parsed.y_range[1]?d[a-e.parsed.y_range[0]]:NaN;return o.type=e.parsed.base_trace,o.color=o.line.color=o.marker.color=o.textfont.color=r||N(t.get_value(e.parsed.color,e.parsed.time),e.parsed.palette,e.parsed.summary,e.parsed.time,a,s)||b.border,"bar"===o.type&&(o.marker.line.width=0),o.name=n||t.features.name,o.id=t.features.id,o}}function F(e){const i=t.createElement("li"),a=e.author.length;var n="",r=1===a?"":2===a?" & ":", & ";for(let t=a;t--;){const i=e.author[t];n=(t?r:"")+i.family+(i.given?", "+i.given.substring(0,1)+".":"")+n,r=", "}return i.innerHTML=n+" ("+e.year+"). "+e.title+"."+(e.journal?" <em>"+e.journal+(e.volume?", "+e.volume:"")+"</em>"+(e.page?", "+e.page:"")+".":"")+(e.version?" Version "+e.version+".":"")+(e.doi||e.url?(e.doi?" doi: ":" url: ")+(e.doi||e.url?'<a rel="noreferrer" target="_blank" href="'+(e.doi?"https://doi.org/"+e.doi:e.url)+'">'+(e.doi||e.url.replace(s.http,""))+"</a>":""):""),i}function H(e,i){const a=t.createElement(i?"tr":"div");let s;return i?(e.name&&(a.appendChild(s=t.createElement("td")),e.url?(s.appendChild(s=t.createElement("a")),s.target="_blank",s.rel="noreferrer",s.href=e.url):s.appendChild(t.createElement("span")),a.firstElementChild.firstElementChild.innerText=e.name),e.date_accessed&&(a.appendChild(s=t.createElement("td")),s.appendChild(t.createElement("span")),s.firstElementChild.innerText=e.date_accessed)):(a.className="card",e.name&&(a.appendChild(s=t.createElement("div")),s.className="card-header",e.url?(s.appendChild(s=t.createElement("a")),s.target="_blank",s.rel="noreferrer",s.href=e.url):s.appendChild(t.createElement("span")),a.firstElementChild.firstElementChild.innerText=e.name),a.appendChild(t.createElement("div")),a.lastElementChild.className="card-body",e.location&&(a.lastElementChild.appendChild(s=t.createElement("p")),s.appendChild(t.createElement("span")),s.lastElementChild.innerText="Location: ",s.appendChild(t.createElement("span")),e.location_url?(s.lastElementChild.appendChild(s=t.createElement("a")),s.target="_blank",s.rel="noreferrer",s.href=e.location_url,s.innerText=e.location):s.lastElementChild.innerText=e.location),e.date_accessed&&(a.lastElementChild.appendChild(s=t.createElement("p")),s.appendChild(t.createElement("span")),s.lastElementChild.innerText="Date Accessed: ",s.appendChild(t.createElement("span")),s.lastElementChild.innerText=e.date_accessed)),a}function z(){const e=x[this.view],t=i.data.variable_info[ee(this.v||e.y)];if(u.modal.info.header.firstElementChild.innerText=t.short_name,u.modal.info.title.innerText=t.long_name,u.modal.info.description.innerText=t.long_description||t.description||t.short_description||"",u.modal.info.name.lastElementChild.innerText=t.measure||"",u.modal.info.type.lastElementChild.innerText=t.type||"",t.sources&&t.sources.length?(u.modal.info.sources.lastElementChild.innerHTML="",u.modal.info.sources.classList.remove("hidden"),t.sources.forEach((e=>{u.modal.info.sources.lastElementChild.appendChild(H(e))}))):u.modal.info.sources.classList.add("hidden"),t.citations&&t.citations.length){if(u.modal.info.references.lastElementChild.innerHTML="",u.modal.info.references.classList.remove("hidden"),"string"==typeof t.citations&&(t.citations=[t.citations]),"references"in i.data&&(delete i.data.variable_info._references,delete i.data.references),!("_references"in i.data.variable_info)){const e={};i.data.variable_info._references=e,Object.keys(i.data.info).forEach((t=>{const a=i.data.info[t];"_references"in a&&Object.keys(a._references).forEach((t=>{t in e||(e[t]={reference:a._references[t],element:F(a._references[t])})}))}))}const e=i.data.variable_info._references;t.citations.forEach((t=>{t in e&&u.modal.info.references.lastElementChild.appendChild(e[t].element)}))}else u.modal.info.references.classList.add("hidden")}function P(e,t,a,n){if("statement"===t)for(var r,l;r=s.mustache.exec(e);)"value"===r[1]?(l=n?i.data.format_value(n.get_value(a.v,a.time),s.int_types.test(i.data.variable_info[a.v].type)):"unknown",e=e.replace(r[0],"unknown"!==l&&i.data.variable_info[a.v].type in d?d[i.data.variable_info[a.v].type](l):l),s.mustache.lastIndex=0):n&&("region_name"===r[1]?(e=e.replace(r[0],n.features.name),s.mustache.lastIndex=0):s.features.test(r[1])?(e=e.replace(r[0],n.features[r[1].replace(s.features,"")]),s.mustache.lastIndex=0):s.variables.test(r[1])?(e=e.replace(r[0],n.variables[a.v][r[1].replace(s.variables,"")]),s.mustache.lastIndex=0):s.data.test(r[1])&&(e=e.replace(r[0],n.get_value(r[1].replace(s.data,""),a.time)),s.mustache.lastIndex=0));return e}var G,J,V,U;if(i.query=G=e.location.search.replace("?",""),i.url_options={},G)for(J=G.split("&"),k=J.length;k--;)(U=J[k].split("=")).length<2&&U.push("true"),U[1]=s.bool.test(U[1])?!!U[1]||"true"===U[1]:U[1].replace(s.url_spaces," "),i.url_options[U[0]]=U[1],s.settings.test(U[0])&&o.set(U[0].replace(s.settings,""),U[1]);if(("embedded"in i.url_options||"hide_navbar"in i.url_options)&&("hide_logo"in i.url_options||(i.url_options.hide_logo=!0),"hide_title"in i.url_options||(i.url_options.hide_title=!0),"hide_navcontent"in i.url_options||(i.url_options.hide_navcontent=!0),"hide_panels"in i.url_options||(i.url_options.hide_panels=!0),"embedded"in i.url_options&&!("close_menus"in i.url_options)&&(i.url_options.close_menus=!0)),(J=u.navbar)&&(J.querySelectorAll("button").forEach((e=>{const i=t.querySelector(e.getAttribute("data-bs-target"));i&&"false"===i.getAttribute("data-bs-backdrop")&&(i.addEventListener("show.bs.offcanvas",(function(){u.content_bounds.outer_right=i.getBoundingClientRect().width,Y(void 0,!0),setTimeout(K,200)})),i.addEventListener("hide.bs.offcanvas",(function(){u.content_bounds.outer_right=0,Y(void 0,!0),setTimeout(K,200)})))})),"navcolor"in i.url_options&&(""===i.url_options.navcolor&&(i.url_options.navcolor=e.location.hash),J.style.backgroundColor=i.url_options.navcolor.replace("%23","#")),i.url_options.hide_logo&&i.url_options.hide_title&&i.url_options.hide_navcontent?J.classList.add("hidden"):((J=t.querySelector(".navbar-brand"))&&(i.url_options.hide_logo&&"IMG"===J.firstElementChild.tagName&&J.firstElementChild.classList.add("hidden"),i.url_options.hide_title&&"IMG"!==J.lastElementChild.tagName&&J.lastElementChild.classList.add("hidden")),i.url_options.hide_navcontent&&(t.querySelector(".navbar-toggler").classList.add("hidden"),(J=t.querySelector(".navbar-nav"))&&J.classList.add("hidden"))),i.url_options.hide_panels&&u.panels.length))for(k=u.panels.length;k--;)u.panels[k].classList.add("hidden");if(o.copy=o.get(),o.copy)for(const e in i.settings)if(e in o.copy){let t=o.copy[e];s.bool.test(t)?t=!!t||"true"===t:s.number.test(t)&&(t=parseFloat(t)),i.settings[e]=t}function Q(e,t,i){const a=i.length;for(var s=i[0][e]+t*i[1][e],n=2;n<a;n++)s+=Math.pow(t,n)*i[n][e];return Math.max(0,Math.min(255,s))}function X(){i.data.inited&&clearTimeout(i.data.inited.load_screen),u.wrap.style.visibility="visible",u.load_screen.style.display="none"}function Y(e,t){const i=u[t?"wrap":"content"];t||(i.style.top=(u.top_menu&&"open"===u.top_menu.state?u.top_menu.getBoundingClientRect().height:u.content_bounds.top+(!u.top_menu&&!u.left_menu&&!u.right_menu||u.right_menu&&"open"===u.right_menu.state||u.left_menu&&"open"===u.left_menu.state?0:40))+"px",i.style.bottom=u.content_bounds.bottom+(u.bottom_menu&&"closed"!==u.bottom_menu.state?u.bottom_menu.getBoundingClientRect().height:0)+"px",i.style.left=u.content_bounds.left+(u.left_menu&&"closed"!==u.left_menu.state?u.left_menu.getBoundingClientRect().width:0)+"px"),i.style.right=u.content_bounds[t?"outer_right":"right"]+(u.right_menu&&"closed"!==u.right_menu.state?u.right_menu.getBoundingClientRect().width:0)+"px"}function K(){"undefined"==typeof module&&e.dispatchEvent(new Event("resize"))}function W(){var t="";return E._u.forEach((e=>{if(x[e].input&&!s.settings.test(e)){const i=x[e].value();""!==i&&null!=i&&"-1"!=i&&(t+=(t?"&":"?")+e+"="+i)}})),i.data&&x._base_filter.c.size&&(t+="&"+x._base_filter.value([])),e.location.protocol+"//"+e.location.host+e.location.pathname+t}function Z(){function e(e,a){if("A"===e.target.tagName){a=a||{};const n=t.createElement("tr"),r={e:n,index:x._base_filter.c.size,variable:e.target.value,component:a.component||"last",operator:a.operator||">=",value:a.value||"",active:!0,id:"vf"+x._base_filter.c.size,passed:0,failed:0},d=i.data.variables[e.target.value].time_range[x[b.dataview].get.dataset()],o=i.data.meta.overall.value;var s;n.setAttribute("index",x._base_filter.c.size),x._base_filter.c.set(x._base_filter.c.size,r),a.time_component&&(r.component=String(o[r.component])),n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("p")),s.className="cell-text",s.innerText=e.target.innerText+" ("+o[d[0]]+"-"+o[d[1]]+")",n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("p")),s.className="cell-text",s.innerText="0/0",n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("label")),s.innerText="Active",s.className="filter-label",s.id=r.id+"_switch",n.lastElementChild.appendChild(s=t.createElement("div")),s.className="form-check form-switch filter-form-input",s.appendChild(s=t.createElement("input")),s.className="form-check-input",s.type="checkbox",s.role="switch",s.setAttribute("aria-labelledby",r.id+"_switch"),s.checked=!0,s.addEventListener("change",function(){r.active=!r.active,he("_base_filter")}.bind(r)),n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("label")),s.innerText="Component",s.className="filter-label",s.id=r.id+"_component";const h=l.combobox.create("component",c.Time);h.default=r.component,h.set(r.component),h.settings.strict=!1,n.lastElementChild.appendChild(h.e.parentElement),h.e.parentElement.removeChild(h.e.parentElement.lastElementChild),h.e.parentElement.classList.add("filter-form-input"),h.e.setAttribute("aria-labelledby",r.id+"_component"),h.onchange=function(){r.component=this.value(),he("_base_filter")}.bind(h),n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("label")),s.innerText="Operator",s.className="filter-label",s.id=r.id+"_operator",n.lastElementChild.appendChild(s=t.createElement("select")),s.className="form-select filter-form-input",s.setAttribute("aria-labelledby",r.id+"_value"),s.addEventListener("change",(e=>{r.operator=e.target.selectedOptions[0].value,he("_base_filter")})),[">=","=","!=","<="].forEach((e=>{s.appendChild(t.createElement("option")),s.lastElementChild.value=s.lastElementChild.innerText=e,e===r.operator&&(s.lastElementChild.selected=!0)})),n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("label")),s.innerText="Value",s.className="filter-label",s.id=r.id+"_value",n.lastElementChild.appendChild(s=t.createElement("input")),s.className="form-control filter-form-input",s.type="number",s.value=r.value,s.addEventListener("change",(e=>{r.value=e.target.value,he("_base_filter")})),n.appendChild(t.createElement("td")),n.lastElementChild.appendChild(s=t.createElement("label")),s.innerText="Remove",s.className="filter-label",s.id=r.id+"_remove",n.lastElementChild.appendChild(s=t.createElement("button")),s.className="btn btn-close filter-form-input",s.type="button",s.setAttribute("aria-labelledby",r.id+"_remove"),s.addEventListener("mouseup",function(e){1===e.which&&(delete x[r.id],this.e.parentElement.removeChild(this.e),x._base_filter.c.delete(this.index),he("_base_filter"))}.bind(r)),u.modal.filter.variable_filters.lastElementChild.lastElementChild.appendChild(n)}}E._u.forEach((async e=>{if(x[e].type in l){const t=x[e],n="combobox"===t.type;if(t.options_source)if(s.palette.test(t.options_source))t.options=[],Object.keys(a).forEach((e=>t.options.push(t.add(e,a[e].name)))),-1===t.default&&(t.default=b.palette);else if(s.datasets.test(t.options_source))t.options=[],i.metadata.datasets.forEach((e=>t.options.push(t.add(e))));else{t.sensitive=!1,t.option_sets={values:{},displays:{},options:[]},t.depends&&M(t.depends,{type:"options",id:t.id}),t.dataset in x&&M(t.dataset,{type:"options",id:t.id}),t.view&&M(t.view,{type:"options",id:t.id});const e=ee(t.dataset)||b.dataset;t.dataset||(t.dataset=e),e in i.metadata.info&&r.options(t)}if(n||"select"===t.type)Array.isArray(t.values)&&(t.values={},t.display={},t.options.forEach(((e,i)=>{t.values[e.value]=i,t.display[e.value]=i})),t.default in t.values||t.default in x||(t.default=Number(t.default),isNaN(t.default)&&(t.default=-1)),t.source="",t.id in i.url_options?t.set(i.url_options[t.id]):t.reset()),t.subset=t.e.getAttribute("subset")||"all",t.selection_subset=t.e.getAttribute("selection-subset")||t.subset,t.type in i&&t.id in i[t.type]&&(t.settings=i[t.type][t.id],t.settings.filters&&(t.filters=t.settings.filters,t.current_filter={},Object.keys(t.filters).forEach((e=>{M(t.filters[e],{type:"filter",id:t.id})})),t.filter=function(){var e;Object.keys(this.filters).forEach((e=>{this.current_filter[e]=ee(this.filters[e])})),Object.keys(this.values).forEach(((t,a)=>{var s=!1;if(t in i.data.variables&&"meta"in i.data.variables[t])for(const e in this.current_filter)if(e in i.data.variables[t].meta&&(s=i.data.variables[t].meta[e]===this.current_filter[e],!s))break;s&&!e&&(e=t),this.options[a].classList[s?"remove":"add"]("hidden")})),this.current_index=this.values[this.value()],e&&(-1===this.current_index||this.options[this.current_index].classList.contains("hidden"))&&this.set(e)}.bind(t)));else if("number"===t.type){if(t.min=t.e.getAttribute("min"),t.min_ref=parseFloat(t.min),t.max=t.e.getAttribute("max"),t.max_ref=parseFloat(t.max),t.ref=isNaN(t.min_ref)||isNaN(t.max_ref),t.range=[t.min_ref,t.max_ref],t.step=parseFloat(t.e.step)||1,t.parsed={min:void 0,max:void 0},t.depends={},t.update=async function(){const e=x[this.view],a=ee(t.variable||e.y);e.time_range||(e.time_range={time:[]});var n=e.get?e.get.dataset():ee(this.dataset),r=ee(this.min)||e.time,l=ee(this.max)||e.time;s.minmax.test(r)&&(r=x[this.min][r]),s.minmax.test(l)&&(l=x[this.max][l]),this.parsed.min=isNaN(this.min_ref)?void 0===r?e.time_range.time[0]:"number"==typeof r?r:r in i.data.variables?i.data.variables[r].info[n||i.data.variables[r].datasets[0]].min:parseFloat(r):this.min_ref,this.parsed.max=isNaN(this.max_ref)?void 0===l?e.time_range.time[1]:"number"==typeof l?l:l in i.data.variables?i.data.variables[l].info[n||i.data.variables[l].datasets[0]].max:parseFloat(l):this.min_ref,this.ref&&a in i.data.variables?(this.range[0]=this.e.min=isNaN(this.min_ref)?Math.max(e.time_range.time[0],this.parsed.min):this.min_ref,this.range[1]=this.e.max=isNaN(this.max_ref)?Math.min(e.time_range.time[1],this.parsed.max):this.max_ref,this.depends[e.y]||(this.depends[e.y]=!0,M(e.y,{type:"update",id:this.id})),a!==this.variable&&this.reset(),this.variable=await le(a,this.view)):(this.e.min=this.parsed.min,(this.parsed.min>this.source||!this.source&&"min"===this.default)&&this.set(this.parsed.min),this.e.max=this.parsed.max,(this.parsed.max<this.source||!this.source&&"max"===this.default)&&this.set(this.parsed.max))}.bind(t),t.view&&M(t.view,{type:"update",id:t.id}),t.max in i.data.variables?t.view&&M(t.view+"_time",{type:"max",id:t.id}):t.max in x?M(t.max,{type:"max",id:t.id}):t.e.max=parseFloat(t.max),t.min in i.data.variables?t.view&&M(t.view+"_time",{type:"min",id:t.id}):t.min in x?M(t.min,{type:"min",id:t.id}):t.e.min=parseFloat(t.min),void 0!==t.default&&(s.number.test(t.default)?t.default=Number(t.default):t.reset="max"===t.default||"last"===t.default?function(){this.range&&this.set(ee(this.range[1]))}.bind(t):"min"===t.default||"first"===t.default?function(){this.range&&this.set(ee(this.range[0]))}.bind(t):this.default in x?function(){this.set(ee(this.default))}.bind(t):function(){}),t.variable){const e=-1===i.metadata.datasets.indexOf(t.dataset)?b.dataset:t.dataset;t.variable in x?M(t.variable,{type:"update",id:t.id}):t.variable in i.data.variables&&(t.e.min=t.min=t.parsed.min=t.range[0]=i.data.variables[t.variable].info[e].min,t.e.max=t.max=t.parsed.max=t.range[1]=i.data.variables[t.variable].info[e].max)}}else"checkbox"===t.type&&(t.source=[],t.current_index=[],t.default=t.default.split(","));Array.isArray(t.values)&&(t.values.length||(t.values=[],t.options.length&&t.options.forEach((e=>t.values.push(e.value)))),t.values.length&&!(t.default in x)&&-1===t.values.indexOf(t.default)&&(t.default=parseInt(t.default),t.default=t.values.length>t.default?t.values[t.default]:"")),n||"select"===t.type||"number"===t.type?(t.e.addEventListener("change",t.listen),t.e.parentElement.lastElementChild&&t.e.parentElement.lastElementChild.classList.contains("select-reset")&&t.e.parentElement.lastElementChild.addEventListener("click",t.reset)):"switch"===t.type?("boolean"!=typeof t.default&&(t.default=t.e.checked),t.e.addEventListener("change",t.listen)):t.listen&&t.options.forEach((e=>e.addEventListener("click",t.listen))),s.settings.test(t.id)&&(t.setting=t.id.replace(s.settings,""),null==t.default&&t.setting in i.settings&&(t.default=i.settings[t.setting]),M(t.id,{type:"setting",id:t.id})),t.view||(t.view=b.dataview);const l=i.url_options[t.id]||o.get(t.id.replace(s.settings,""));l?t.set(s.bool.test(l)?!!l||"true"===l:l):t.reset&&t.reset()}})),Object.keys(i.dataviews).forEach((e=>{const t=i.dataviews[e];x[e]=t,t.id=e,t.value=function(){if(this.get)return this.reparse(),""+this.parsed.dataset+i.data.inited[this.parsed.dataset]+this.parsed.ids+this.parsed.features+this.parsed.variables+i.settings.summary_selection}.bind(t),"string"==typeof t.palette&&t.palette in x&&M(t.palette,{type:"dataview",id:e}),"string"==typeof t.dataset&&t.dataset in x&&M(t.dataset,{type:"dataview",id:e}),"string"==typeof t.ids&&t.ids in x&&M(t.ids,{type:"dataview",id:e}),t.time_range={dataset:"",variable:"",index:[],time:[],filtered:[]},M(e,{type:"time_range",id:e}),M("_base_filter",{type:"dataview",id:e}),t.x in x&&M(t.x,{type:"time_range",id:e}),t.y in x&&M(t.y,{type:"time_range",id:e}),t.features&&Object.keys(t.features).forEach((i=>{"string"==typeof t.features[i]&&t.features[i]in x&&M(t.features[i],{type:"dataview",id:e})})),t.variables&&t.variables.forEach((i=>{"variable"in i?i.variable in x&&M(i.variable,{type:"dataview",id:e}):t.variables.splice(k,1),"type"in i?i.type in x&&M(i.type,{type:"dataview",id:e}):i.type="=","value"in i?i.value in x&&M(i.value,{type:"dataview",id:e}):i.value=0})),function(e){e.times=[],e.time_filters&&(e.time_filters=[{variable:b.time,type:">=",value:"filter.time_min"},{variable:b.time,type:"<=",value:"filter.time_max"}],M(e.id+"_time",{type:"min",id:"filter.time_min"}),M(e.id+"_time",{type:"max",id:"filter.time_max"}),e.time_filters.forEach((t=>{t.value in x&&M(t.value,{type:"time_filters",id:e.id})})));e.selection={ids:{},features:{},variables:[],dataset:{},filtered:{},all:{}},e.n_selected={ids:0,features:0,variables:0,dataset:0,filtered:0,all:0},e.get={dataset:function(){return ee("string"==typeof e.dataset&&e.dataset in x?x[e.dataset].value():e.dataset)||b.dataset},ids:function(){return ee("string"==typeof e.ids&&e.ids in x?x[e.ids].value():e.ids)},features:function(){var t="";return e.features&&Object.keys(e.features).forEach((i=>{t+=i+ee(e.features[i])})),t},variables:function(){if(e.variables||x._base_filter.c.size){e.parsed.variable_values.length||e.reparse();var t="";return e.parsed.variable_values.forEach((e=>{t+=e.name+e.operator+e.component+e.value+e.active})),t}return""},time_filters:function(){var t="";return e.time_filters&&e.time_filters.forEach((e=>{t+=e.value in x?ee(e.value):e.value})),t}},e.ids_check="object"==typeof e.get.ids()?DataHandler.prototype.checks.includes:function(e,t){return!e||-1==e||e===t||t&&e.length>2&&e===String(t).substring(0,e.length)},e.parsed={dataset:"",ids:"",features:"",variables:"",time_filters:"",time_agg:0,id_source:"",variable_values:[],feature_values:{}},e.reparse=function(){if(this.parsed.dataset=this.get.dataset(),this.parsed.ids=this.get.ids(),this.parsed.time_filters=this.get.time_filters(),this.parsed.time_agg=this.parsed.dataset in i.data.meta.times?ee(this.time_agg)-i.data.meta.times[this.parsed.dataset].range[0]:0,"string"==typeof this.ids&&this.ids in x&&("virtual"===x[this.ids].type&&x[this.ids].source in x||"depends"in x[this.ids]&&x[this.ids].depends in x)&&(this.parsed.id_source="virtual"===x[this.ids].type?ee(x[x[this.ids].source].dataset):x[x[this.ids].depends].value()),this.features){for(var e in this.parsed.feature_values={},this.features)e in this.features&&(this.parsed.feature_values[e]={value:ee(this.features[e])},this.parsed.feature_values[e].operator="string"==typeof this.parsed.feature_values[e].value?"equals":"includes");this.parsed.features=this.get.features()}else this.parsed.features="";if(this.parsed.variable_values=[],x._base_filter.c.size&&x._base_filter.c.forEach((e=>{this.parsed.variable_values.push({filter:e,name:e.variable,range:i.data.variables[e.variable].info[this.parsed.dataset].time_range,operator:e.operator,value:e.value?Number(e.value):NaN,value_type:"number",component:e.component,active:e.active,comp_fun:ne(e.component)})})),this.variables||this.parsed.variable_values.length){if(this.variables)for(var t,a=this.variables.length;a--;)t=ee(this.variables[a].value),this.parsed.variable_values.push({name:ee(this.variables[a].variable),operator:ee(this.variables[a].type),value:t,value_type:typeof t});this.parsed.variables=this.get.variables()}else this.parsed.variables=""}.bind(e),e.checks={dataset:function(e){return this.parsed.dataset===e.group}.bind(e),ids:("string"==typeof e.ids&&e.ids in x&&("virtual"===x[e.ids].type&&x[e.ids].source in x||"depends"in x[e.ids]&&x[e.ids].depends in x)?"virtual"===x[e.ids].type?function(e){return e.features&&this.ids_check(this.parsed.ids,e.features[this.parsed.id_source&&e.group!==this.parsed.id_source&&this.parsed.id_source in e.features?this.parsed.id_source:"id"])}:function(e){return e.features&&this.ids_check(this.parsed.ids,this.parsed.id_source in e.features?ee(e.features[this.parsed.id_source]):e.features.id)}:function(e){return e.features&&this.ids_check(this.parsed.ids,e.features.id)}).bind(e),features:function(e){if(e.features){var t,i,a=!0;for(t in this.parsed.feature_values)if(t in this.parsed.feature_values&&(i=this.parsed.feature_values[t],!(a=DataHandler.prototype.checks[i.operator](i.value,ee(e.features[t])))))break;return a}return!0}.bind(e),variables:function(e){if(e.data){let t=!0;for(let i=this.parsed.variable_values.length;i--;){const a=this.parsed.variable_values[i];if(a.active&&!isNaN(a.value)){const i=a.comp_fun(e,a,this.parsed),s=!isNaN(i)&&DataHandler.prototype.checks[a.operator](i,a.value);a.filter[s?"passed":"failed"]++,t&&!s&&(t=!1)}else a.filter.failed++}return t}return!0}.bind(e)},e.check=function(e){return{ids:!this.ids||this.checks.ids(e),features:!this.features||this.checks.features(e),variables:!this.variables&&!x._base_filter.c.size||this.checks.variables(e),dataset:!this.dataset||this.checks.dataset(e)}}.bind(e)}(t),r.dataview(t),t.reparse()})),t.querySelectorAll(".auto-output").forEach(l.init_output),(J=u.modal.filter).body.className="filter-dialog",J.body.appendChild(J.variable_filters=t.createElement("div")),J.variable_filters.appendChild(t.createElement("p")),J.variable_filters.lastElementChild.className="h6 text-muted",J.variable_filters.lastElementChild.innerText="Variable Conditions",J.variable_filters.appendChild(V=t.createElement("div")),V.className="row",V.appendChild(t.createElement("div")),V.lastElementChild.className="col",V.lastElementChild.appendChild(U=t.createElement("div")),U.className="dropdown",U.appendChild(t.createElement("button")),U.lastElementChild.type="button",U.lastElementChild.id="filter_variable_dropdown",U.lastElementChild.className="btn dropdown-toggle",U.lastElementChild.setAttribute("data-bs-toggle","dropdown"),U.lastElementChild.setAttribute("aria-expanded",!1),U.lastElementChild.innerText="Add Variable Condition",U.appendChild(t.createElement("ul")),U.lastElementChild.addEventListener("click",e.bind(J)),U.lastElementChild.className="dropdown-menu",U.lastElementChild.setAttribute("aria-labelledby","filter_variable_dropdown"),Object.keys(i.data.variables).forEach((e=>{if(!i.data.variables[e].is_time){const a=t.createElement("li");a.appendChild(t.createElement("a")),a.lastElementChild.className="dropdown-item",a.lastElementChild.href="#",a.lastElementChild.value=e,a.lastElementChild.innerText=i.data.variable_info[e]&&i.data.variable_info[e].short_name||e,U.lastElementChild.appendChild(a)}})),J.variable_filters.appendChild(V=t.createElement("table")),V.className="table",V.appendChild(V=t.createElement("thead")),V.className="filter-header",J.variable_filters.lastElementChild.appendChild(t.createElement("tbody")),J.variable_filters.lastElementChild.lastElementChild.className="filter-body",V=V.appendChild(V=t.createElement("tr")),["Variable","Result","Active","Component","Operator","Value","Remove"].forEach((e=>{if(V.appendChild(t.createElement("th")),"Component"===e||"Result"===e){const i="Component"===e?{wrapper:t.createElement("label"),id:"filter_component_header",note:"Component refers to which single value to filter on for each entity; select a dynamic time reference, or enter a time."}:{wrapper:t.createElement("label"),id:"filter_result_header",note:"Passing / total entities acress datasets."};V.lastElementChild.appendChild(i.wrapper),V.lastElementChild.className="has-note",i.wrapper.innerText=e,i.wrapper.id=i.id,i.wrapper.setAttribute("of",i.id),i.wrapper.setAttribute("aria-description",i.note),V.lastElementChild.addEventListener("mouseover",te.bind(i))}else V.lastElementChild.innerText=e})),E._u=Object.keys(x),i.query&&(i.parsed_query=i.data.parse_query(i.query),i.parsed_query.variables.conditions.length&&i.parsed_query.variables.conditions.forEach((t=>{const a=i.data.variable_info[t.name];a&&e({target:{tagName:"A",value:t.name,innerText:a.short_name}},t)})))}function ee(e){return e in x&&(e=x[e]),e&&e.value&&(e=ee(e.value())),e}function te(){if(i.settings.hide_tooltips||this.id===u.tooltip.showing)return;u.tooltip.showing=this.id,u.tooltip.e.firstElementChild.innerText=this.note,u.tooltip.e.classList.remove("hidden");const e=this.wrapper.getBoundingClientRect(),t=u.tooltip.e.getBoundingClientRect();u.tooltip.e.style.left=Math.max(0,Math.min(e.x,e.x+e.width/2-t.width/2))+"px",u.tooltip.e.style.top=e.y+(e.y<t.height?e.height+5:-t.height-5)+"px"}function ie(e){!u.tooltip.showing||"blur"!==e.type&&u.tooltip.showing===(e.target.getAttribute("of")||e.target.id)||(u.tooltip.showing="",u.tooltip.e.classList.add("hidden"))}async function ae(t,a,n){if(a.url in i.map._raw)!function(e,t){var a,n;const r="time"in e,d=e.name+(r?e.time:"");if(i.map[t.id]._layers[d]=L.geoJSON(JSON.parse(i.map._raw[e.url]),{onEachFeature:(d,o)=>{o.on({mouseover:l.map.mouseover.bind(t),mouseout:l.map.mouseout.bind(t),click:l.map.click.bind(t)}),o.setStyle({weight:0,fillOpacity:0}),o.source=e,a=o.feature.properties,!((n=a[e.id_property])in i.data.entities)&&s.leading_zeros.test(n)&&(n=a[e.id_property]=n.replace(s.leading_zeros,"")),n in i.data.entities?"layer"in i.data.entities[n]||(i.data.entities[n].layer={}):i.data.entities[n]={layer:{},features:{id:n}},r?(t.id in i.data.entities[n].layer||(i.data.entities[n].layer[t.id]={has_time:!0}),i.data.entities[n].layer[t.id][e.time]=o):i.data.entities[n].layer[t.id]=o,o.entity=i.data.entities[n],i.data.entities[n].features&&Object.keys(a).forEach((e=>{e in i.data.entities[n].features||("name"!==e.toLowerCase()||"name"in i.data.entities[n].features&&i.data.entities[n].features.id!==i.data.entities[n].features.name?i.data.entities[n].features[e]=a[e]:i.data.entities[n].features[e.toLowerCase()]=a[e])}))}}),i.data.inited[d+t.id]=!0,i.map._waiting&&i.map._waiting[e.name])for(let t=i.map._waiting[e.name].length;t--;)he(i.map._waiting[e.name][t])}(a,t),i.map._queue[a.name+(a.time?a.time:"")].retrieved=!0,n&&n();else{const t=new e.XMLHttpRequest;t.onreadystatechange=()=>{4===t.readyState&&200===t.status&&(i.map._raw[a.url]=t.responseText,a.name&&(i.map._queue[a.name+(a.time||"")].retrieved=!0),n&&n())},t.open("GET",a.url,!0),t.send()}}function se(e,a,s){var n=0,r="string"==typeof a.source?a.source:"";if(!r&&a.source)for(n=a.source.length;n--;)if(!a.source[n].time||s===a.source[n].time){a.source[n].name&&delete a.source[n].name,r=a.source[n].url;break}if(r){if(!(r in i.map._raw))return ae(e,a.source[n],se.bind(null,e,a,s));r in i.map[e.id]._layers||(i.map[e.id]._layers[r]=L.geoJSON(JSON.parse(i.map._raw[r]),{pointToLayer:(e,t)=>L.circleMarker(t),onEachFeature:(e,i)=>{const a=t.createElement("table");Object.keys(e.properties).forEach((i=>{const s=t.createElement("tr");s.appendChild(t.createElement("td")),s.appendChild(t.createElement("td")),s.firstElementChild.innerText=i,s.lastElementChild.innerText=e.properties[i],a.appendChild(s)})),i.bindTooltip(a)}})),e.overlay.clearLayers();var l=0;i.map[e.id]._layers[r].eachLayer((t=>{if(a.filter)for(let e=a.filter.length;e--;)if(!a.filter[e].check(t.feature.properties[a.filter[e].feature],a.filter[e].value))return;l++,t.setRadius(i.settings.circle_radius).setStyle({weight:i.settings.polygon_outline,color:"white",opacity:.5,fillOpacity:.5,fillColor:"black"}),t.addTo(e.overlay)})),l&&e.overlay_control.addTo(e.map)}}function ne(e){return"string"==typeof e&&s.number.test(e)&&-1===(e=i.data.meta.overall.value.indexOf(Number(e)))?function(){return NaN}:"number"==typeof e?m.number.bind(e):e in m?m[e]:function(){return NaN}}function re(){e.localStorage&&o.perm.removeItem(o.name),e.location.reload()}async function le(e,t){return e in i.data.variables&&await i.data.calculate_summary(e,t,!0),i.data.variables[e]}function de(){g.retain_state=!1,E._u.forEach(he)}function oe(){g.retain_state=!1,E._u.forEach((e=>{!x[e].setting&&x[e].reset&&(x[e].reset(),he(e))}))}function he(e){f[e]=!0,clearTimeout(f._timeout),f._timeout=setTimeout(ce,20),g.lock_after=e}function ce(){clearTimeout(f._timeout),E._u.forEach((e=>{if(f[e]){const t=function(e){if(e in C){const t=x[e],a=C[e],s=[],n=t&&t.value()+"",l=t&&t.dataset&&ee(t.dataset)||n;if(t&&(!g.retain_state||t.state!==n)){if(l in i.metadata.info&&!i.data.loaded[l])return i.data.retrieve(l,i.metadata.info[l].site_file),l;t.state=n,a.forEach((e=>{"rule"===e.type?-1===s.indexOf(e.rule)&&s.push(e.rule):"function"==typeof x[e.id][e.type]?x[e.id][e.type]():r[e.type](x[e.id],t)})),s.forEach((e=>{var t=!1;const a=i.rules[e],s=a.condition.length;for(let e=0;e<s;e++){const i=a.condition[e];if(t=i.check(),i.any?t:!t)break}Object.keys(a.effects).forEach((e=>{const i=a.effects[e];t?"display"===e?i.e.classList.remove("hidden"):e in x&&x[e].set(ee(i)):"display"===e?(i.e.classList.add("hidden"),i.u&&i.u.reset(),i.e.querySelectorAll(".auto-input").forEach((e=>{e.id in x&&x[e.id].reset()}))):"default"in a&&e in x&&x[e].set(ee(a.default))}))})),e===g.lock_after&&(g.retain_state=!0)}}}(e);if(t)return i.data.data_queue[t][e]=ce,i.data.loaded[t]&&i.data.load_id_maps(),!1;f[e]=!1}}));let t=W();i.data.inited.first&&t!==i.state&&(i.state=t,Object.keys(i.url_options).forEach((e=>{s.embed_setting.test(e)&&(t+="&"+e+"="+("navcolor"===e?i.url_options[e].replace(s.hashes,"%23"):i.url_options[e]))})),i.settings.hide_url_parameters||e.history.replaceState(Date.now(),"",t),setTimeout(Y,50))}function pe(){const t=this.deferred||!this.tab||this.tab.classList.contains("show");t&&e.Plotly?(Plotly.newPlot(this.e,this.options),this.e.on("plotly_hover",l.plotly.mouseover.bind(this)).on("plotly_unhover",l.plotly.mouseout.bind(this)).on("plotly_click",l.plotly.click.bind(this)),R(this),this.update()):(this.deferred=!0,setTimeout(pe.bind(this),t?0:2e3))}function me(){const t=i.settings.theme_dark?"dark":"light",a=this.deferred||!this.tab||this.tab.classList.contains("show");if(a&&e.L){if(this.map=L.map(this.e,this.options),this.options=this.map.options,this.overlay=L.featureGroup().addTo(this.map),this.displaying=L.featureGroup().addTo(this.map),this.overlay_control=L.control.layers().setPosition("topleft").addOverlay(this.overlay,"Overlay").addTo(this.map),this.tiles={},this.id in i.map){const e=i.map[this.id].tiles;i.map[this.id].u=this,e&&(e.url?(this.tiles[t]=L.tileLayer(e.url,e.options),this.tiles[t].addTo(this.map)):Object.keys(e).forEach((i=>{this.tiles[i]=L.tileLayer(e[i].url,e[i].options),t===i&&this.tiles[i].addTo(this.map)}))),"_raw"in i.map||(i.map._raw={}),"_queue"in i.map||(i.map._queue={}),"_layers"in i.map[this.id]||(i.map[this.id]._layers={}),i.map[this.id].shapes.forEach(((e,t)=>{const a="time"in e;!i.map[this.id].has_time&&a&&(i.map[this.id].has_time=!0,M(this.view,{type:"update",id:this.id}),i.map[this.id].match_time="exact"===e.resolution?e=>e+"":e=>Number(e)>2019?"2020":"2010");var s=e.name;s||(e.name=s=i.metadata.datasets[t<i.metadata.datasets.length?t:0]);const n=s+(a?e.time:"");i.map._queue[n]=e,i.data.inited[n+this.id]=!1,!i.data.loaded[s]||s!==n&&e.time!=i.map[this.id].match_time(i.data.meta.overall.value[x[this.view].parsed.time_agg])||ae(this,e)})),i.map[this.id].triggers={},Array.isArray(i.map[this.id].overlays)&&i.map[this.id].overlays.forEach((e=>{"string"==typeof e.source&&(e.source=[{url:e.source}]);const t=e.source;t.forEach((e=>{e.retrieved=e.url in i.map._raw,i.map._queue[e.url]=e})),i.map[this.id].triggers[e.variable]={source:t};const a=e.filter;if(a){const t=Array.isArray(a)?a:[a];i.map[this.id].triggers[e.variable].filter=t,t.forEach((e=>{e.check=i.data.checks[e.operator]}))}}))}}else this.deferred=!0,setTimeout(me.bind(this),a?0:2e3)}function ue(){const t=this.deferred||!this.tab||this.tab.classList.contains("show");t&&e.jQuery&&e.DataTable&&"get"in i.dataviews[this.view]?(this.options.columns=this.header,this.table=$(this.e).DataTable(this.options),this.update()):(this.deferred=!0,setTimeout(ue.bind(this),t?0:2e3))}Object.keys(a).forEach((e=>{const t=a[e];if("continuous-polynomial"===t.type){const e=t.colors;t.type="discrete",t.colors=[];for(let i=0;i<255;i++){const a=i/255;t.colors.push("rgb("+Q(0,a,e)+", "+Q(1,a,e)+", "+Q(2,a,e)+")")}}})),e.onload=function(){if(u.navbar=t.querySelector(".navbar"),u.navbar=u.navbar?u.navbar.getBoundingClientRect():{height:0},u.content=t.querySelector(".content"),u.menus=t.querySelectorAll(".menu-wrapper"),u.panels=t.querySelectorAll(".panel"),u.content_bounds={top:u.navbar.height,right:0,bottom:0,left:0,outer_right:0},u.script_style=t.head.appendChild(t.createElement("style")),i.settings.hide_tooltips&&u.script_style.sheet.insertRule(n,0),u.menu_toggler={hide:function(){this.classList.add("hidden"),Y()},toggle:function(e){if(clearTimeout(u.menu_toggler.timeout),"closed"===this.parentElement.state)this.parentElement.state="open",this.parentElement.firstElementChild.classList.remove("hidden"),this.parentElement.style[e]="0px",u.content.style[e]=this.parentElement.getBoundingClientRect()["left"===e||"right"===e?"width":"height"]+"px","top"!==e&&"bottom"!==e||(this.style[e]=u.content_bounds[e]+"px"),setTimeout(K,300);else{if(this.parentElement.state="closed","left"===e||"right"===e)this.parentElement.style[e]=-this.parentElement.getBoundingClientRect().width+"px",u.content.style[e]=u.content_bounds[e]+"px";else{const t=this.parentElement.getBoundingClientRect();u.content.style[e]=u.content_bounds[e]+("top"===e?40:0)+"px",this.parentElement.style[e]=-t.height+("top"===e?u.content_bounds.top:0)+"px","top"!==e&&"bottom"!==e||(this.style[e]=t.height+"px")}u.menu_toggler.timeout=setTimeout(u.menu_toggler.hide.bind(this.parentElement.firstElementChild),300)}},timeout:-1},u.modal={info:{init:!1,e:t.createElement("div")},filter:{init:!1,e:t.createElement("div")}},u.load_screen=t.getElementById("load_screen"),J=u.modal.info.e,t.body.appendChild(J),u.modal.info.init=!0,J.id="variable_info_display",J.className="modal fade",J.setAttribute("tabindex","-1"),J.setAttribute("aria-labelledby","variable_info_title"),J.ariaHidden="true",J.appendChild(t.createElement("div")),J.firstElementChild.className="modal-dialog modal-dialog-scrollable",J.firstElementChild.appendChild(t.createElement("div")),J.firstElementChild.firstElementChild.className="modal-content",J.firstElementChild.firstElementChild.appendChild(u.modal.info.header=t.createElement("div")),(J=u.modal.info).header.className="modal-header",J.header.appendChild(t.createElement("p")),J.header.firstElementChild.className="h5 modal-title",J.header.firstElementChild.id="variable_info_title",J.header.appendChild(t.createElement("button")),J.header.lastElementChild.type="button",J.header.lastElementChild.className="btn-close",J.header.lastElementChild.setAttribute("data-bs-dismiss","modal"),J.header.lastElementChild.title="close",J.header.insertAdjacentElement("afterEnd",J.body=t.createElement("div")),J.body.className="modal-body",J.body.appendChild(J.title=t.createElement("p")),J.title.className="h4",J.body.appendChild(J.description=t.createElement("p")),J.body.appendChild(t.createElement("table")),J.body.lastElementChild.className="info-feature-table",J.body.lastElementChild.appendChild(J.name=t.createElement("tr")),J.name.appendChild(t.createElement("th")),J.name.firstElementChild.innerText="Name",J.name.appendChild(t.createElement("td")),J.body.lastElementChild.appendChild(J.type=t.createElement("tr")),J.type.appendChild(t.createElement("th")),J.type.firstElementChild.innerText="Type",J.type.appendChild(t.createElement("td")),J.body.appendChild(J.sources=t.createElement("div")),J.sources.appendChild(t.createElement("p")),J.sources.lastElementChild.innerText="Sources",J.sources.lastElementChild.className="h3",J.sources.appendChild(t.createElement("div")),J.sources.lastElementChild.className="sources-cards",(J=u.modal.info).body.appendChild(J.references=t.createElement("div")),J.references.appendChild(t.createElement("p")),J.references.firstElementChild.className="h3",J.references.firstElementChild.innerText="References",J.references.appendChild(J=t.createElement("ul")),J.className="reference-list",t.body.appendChild(J=u.modal.filter.e),u.modal.filter.init=!0,J.id="filter_display",J.className="modal fade",J.setAttribute("tabindex","-1"),J.setAttribute("aria-labelledby","filter_title"),J.ariaHidden="true",J.appendChild(t.createElement("div")),J.firstElementChild.className="modal-dialog",J.firstElementChild.appendChild(t.createElement("div")),J.firstElementChild.firstElementChild.className="modal-content",J.firstElementChild.firstElementChild.appendChild(u.modal.filter.header=t.createElement("div")),(J=u.modal.filter).header.className="modal-header",J.header.appendChild(t.createElement("p")),J.header.firstElementChild.className="h5 modal-title",J.header.firstElementChild.id="filter_title",J.header.firstElementChild.innerText="Filter",J.header.appendChild(t.createElement("button")),J.header.lastElementChild.type="button",J.header.lastElementChild.className="btn-close",J.header.lastElementChild.setAttribute("data-bs-dismiss","modal"),J.header.lastElementChild.title="close",J.header.insertAdjacentElement("afterEnd",J.body=t.createElement("div")),J.body.className="modal-body",J.body.appendChild(t.createElement("p")),J.body.lastElementChild.className="h6 text-muted",J.body.lastElementChild.innerText="Time Range",J.body.appendChild(J.time_range=t.createElement("div")),J.time_range.className="row",J.time_range.appendChild(t.createElement("div")),J.time_range.lastElementChild.className="col",J.time_range.lastElementChild.appendChild(V=t.createElement("div")),V.className="form-floating text-wrapper wrapper",V.appendChild(t.createElement("input")),V.lastElementChild.className="form-control auto-input",V.lastElementChild.setAttribute("auto-type","number"),V.lastElementChild.setAttribute("default","min"),V.lastElementChild.max="filter.time_max",V.lastElementChild.type="number",V.lastElementChild.autoType="number",V.lastElementChild.id="filter.time_min",V.appendChild(t.createElement("label")),V.lastElementChild.innerText="First Time",V.lastElementChild.setAttribute("for","filter.time_min"),J.time_range.appendChild(t.createElement("div")),J.time_range.lastElementChild.className="col",J.time_range.lastElementChild.appendChild(V=t.createElement("div")),V.className="form-floating text-wrapper wrapper",V.appendChild(t.createElement("input")),V.lastElementChild.className="form-control auto-input",V.lastElementChild.setAttribute("auto-type","number"),V.lastElementChild.setAttribute("default","max"),V.lastElementChild.min="filter.time_min",V.lastElementChild.type="number",V.lastElementChild.autoType="number",V.lastElementChild.id="filter.time_max",V.appendChild(t.createElement("label")),V.lastElementChild.innerText="Last Time",V.lastElementChild.setAttribute("for","filter.time_max"),u.panels.length&&u.panels.forEach((e=>{const t=e.classList.contains("panel-left")?"left":"right";u.content_bounds[t]=e.getBoundingClientRect().width,e.style.marginTop=u.content_bounds.top+"px",e.lastElementChild.addEventListener("click",function(){const i=e.getBoundingClientRect().width,a=e.lastElementChild.getBoundingClientRect().width;"true"===e.lastElementChild.getAttribute("aria-expanded")?(u.content_bounds[t]=a,u.top_menu&&(u.top_menu.style[t]=a+"px"),u.bottom_menu&&(u.bottom_menu.style[t]=a+"px"),e.style[t]=-i+a+"px",e.lastElementChild.setAttribute("aria-expanded","false")):(u.content_bounds[t]=i,u.top_menu&&(u.top_menu.style[t]=i+"px"),u.bottom_menu&&(u.bottom_menu.style[t]=i+"px"),e.style[t]="0px",e.lastElementChild.setAttribute("aria-expanded","true")),Y(),setTimeout(K,200)}.bind(e))})),u.menus.length&&u.menus.forEach((e=>{const t="BUTTON"===e.lastElementChild.tagName;e.state=e.getAttribute("state"),e.classList.contains("menu-top")?(u.top_menu=e,u.top_menu.style.left=u.content_bounds.left+"px",u.top_menu.style.right=u.content_bounds.right+"px",t&&(e.lastElementChild.addEventListener("click",u.menu_toggler.toggle.bind(e.lastElementChild,"top")),e.lastElementChild.style.top=u.content_bounds.top+"px")):e.classList.contains("menu-right")?(u.right_menu=e,u.right_menu.style.right=u.content_bounds.right+"px",t&&(e.lastElementChild.addEventListener("click",u.menu_toggler.toggle.bind(e.lastElementChild,"right")),e.lastElementChild.style.top=u.content_bounds.top+"px")):e.classList.contains("menu-bottom")?(u.bottom_menu=e,u.content_bounds.bottom=40,u.bottom_menu.style.left=u.content_bounds.left+"px",u.bottom_menu.style.right=u.content_bounds.right+"px",t&&e.lastElementChild.addEventListener("click",u.menu_toggler.toggle.bind(e.lastElementChild,"bottom"))):e.classList.contains("menu-left")&&(u.left_menu=e,u.left_menu.style.left=u.content_bounds.left+"px",t&&(e.lastElementChild.addEventListener("click",u.menu_toggler.toggle.bind(e.lastElementChild,"left")),e.lastElementChild.style.top=u.content_bounds.top+"px")),i.url_options.close_menus&&"open"===e.state&&e.lastElementChild.click()})),u.tooltip={e:t.createElement("div"),showing:""},u.tooltip.e.className="tooltip hidden",u.tooltip.e.appendChild(t.createElement("p")),t.body.appendChild(u.tooltip.e),t.body.addEventListener("mouseover",ie),i.dataviews){for(const e in i.dataviews)if(e in i.dataviews){b.dataview=e;break}}else i.dataviews={},i.dataviews[b.dataview]={};if(t.querySelectorAll(".auto-input").forEach(l.init_input),i.variables&&i.variables.length&&i.variables.forEach((e=>{const t=e.id;x[t]={id:t,type:"virtual",source:e.default,previous:void 0,default:e.default,current_index:-1,values:[],states:e.states,update:function(){this.source=void 0;for(var e,t=this.states.length;t--;){e=!0;for(let i=this.states[t].condition.length;i--;){const a=this.states[t].condition[i];if(DataHandler.prototype.checks[a.type](ee(a.id),ee(a.value))){if(a.any){e=!0;break}}else e=!1}if(e){this.source=this.states[t].value;break}}if(this.source||(this.source=this.default),this.source!==this.previous)this.previous=this.source,he(this.id);else if(this.source in x){const e=x[this.source].value();e!==this.previous&&(this.previous=e,he(this.id))}},value:function(){return ee(this.source)},set:function(e){if(-1!==this.values.indexOf(e))this.previous=this.source,this.source=e;else if(this.source){const t=x[this.source];("select"===t.type||"combobox"===t.type?e in t.values||e in t.display:-1!==t.values.indexOf(e))&&t.set(e)}he(this.id)}},x[t].source&&x[t].values.push(x[t].source);const i={};x[t].states.forEach((e=>{x[t].values.push(e.value),e.condition.forEach((e=>{e.id in i||(i[e.id]={type:"update",id:t})}))})),Object.keys(i).forEach((e=>M(e,i[e])))})),i.rules&&i.rules.length&&i.rules.forEach(((e,i)=>{"display"in e.effects&&(e.effects.display={e:t.getElementById(e.effects.display)},(J=e.effects.display.e.getElementsByClassName("auto-input")).length&&(e.effects.display.u=x[J[0].id])),e.condition.forEach((t=>{t.type in DataHandler.prototype.checks&&(t.check=function(){return DataHandler.prototype.checks[this.type](ee(this.id),ee(this.value))}.bind(t),t.id in x&&(M(t.id,{type:"rule",id:t.id,condition:t,rule:i}),t.id in y||(y[t.id]={}),y[t.id][i]=e),t.check()?Object.keys(e.effects).forEach((t=>{t in x&&x[t].set(ee(e.effects[t]))})):t.default&&Object.keys(e.effects).forEach((e=>{e in x&&x[e].set(ee(t.default))})))}))})),E._u=Object.keys(x),e.addEventListener("resize",Y),i.metadata.datasets||X(),!i.dataviews[b.dataview].dataset){if(1===i.metadata.datasets.length)b.dataset=i.metadata.datasets[0];else{const e=i.metadata.info;for(let t=E._u.length;t--;){const i=x[E._u[t]];if(i.dataset in e){b.dataset=i.dataset;break}if(i.default in e){b.dataset=i.default;break}if("select"===i.type&&i.options[i.default]&&i.options[i.default].value in e){b.dataset=i.options[i.default].value;break}if(Array.isArray(i.values)&&i.values[i.default]&&i.values[i.default]in e){b.dataset=i.values[i.default];break}}b.dataset||(b.dataset=i.metadata.datasets[i.metadata.datasets.length-1])}E._u.forEach((e=>{const t=x[e];t.dataset||(t.dataset=b.dataset)})),i.dataviews[b.dataview].dataset=b.dataset}"undefined"!=typeof DataHandler&&(b.dataset=ee(i.dataviews[b.dataview].dataset),"number"==typeof b.dataset&&(b.dataset=i.metadata.datasets[b.dataset]),i.data=new DataHandler(i,b,i.data,{init:Z,onload:function(){i.data.inited&&clearTimeout(i.data.inited.load_screen),setTimeout(X,600),delete this.onload},data_load:function(){Object.keys(C).forEach(he)}}),i.data.retrievers.vector=i.data.retrievers.vector.bind(i.data)),u.load_screen&&i.data.inited?i.data.inited.load_screen=setTimeout(X,3e3):u.wrap.style.visibility="visible"}};"undefined"==typeof module?e(window,document,site):module.exports=e}();