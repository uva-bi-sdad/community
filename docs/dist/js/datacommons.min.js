"use strict";function DataCommons(e,t,i){Object.hasOwn||Object.defineProperty(Object,"hasOwn",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)},configurable:!0,enumerable:!1,writable:!0}),this.definition=e,this.manifest=t,this.views=i,this.named_view={},this.counts={views:0,repos:0,files:0,variables:0,ids:0},this.variables={},this.ids={},this.repos={},this.providers={},this.dists={},this.file_ids={},this.files={},this.page={current_tab:"#repos",menu:{check_all:document.getElementById("refresh_button")},body:document.getElementsByClassName("content")[0],container:document.createElement("div"),tooltip:document.createElement("div"),tabs:{repos:document.createElement("div"),views:document.createElement("div")},views:{},repos:{},files:{},order:[]},this.page.body.appendChild(this.page.container),this.page.container.className="commons",this.page.container.appendChild(this.page.tabs.repos),this.requester.onmessage=e=>{const t=e.data;if(t.response){u.test(t.response)||(t.response=JSON.stringify({message:t.response}));const e=JSON.parse(t.response);var i=200!==t.status?t.status:e.status?e.status:e.message?"ERROR":"OK";if("provider"===t.type){this.repos[t.repo].providers[t.provider]=JSON.parse(t.response);const e=this.repos[t.repo],r=e.providers[t.provider],h=[];var s,a,l=0,n=0,d=!1;if(e.distributions[t.provider].display.lastElementChild.lastElementChild.className="","OK"===i){if(e.distributions[t.provider].display.classList.add("passed-check"),e.distributions[t.provider].display.classList.remove("failed-check"),"github"===t.provider)for(n=r.length;l<n;l++)Object.hasOwn(this.file_ids,r[l].name)&&(d=!0,a=this.file_ids[r[l].name],this.files[a].remote.github=r[l],Object.hasOwn(e.all_files,this.files[a].local.github.md5)||h.push(r[l].name));else if("dataverse"===t.provider)for(s=r.data.latestVersion.files,n=s.length;l<n;l++)Object.hasOwn(this.file_ids,s[l].dataFile.filename)&&(d=!0,a=this.file_ids[s[l].dataFile.filename],this.files[a].remote.dataverse=s[l].dataFile,Object.hasOwn(e.all_files,this.files[a].local.dataverse.md5)||h.push(s[l].dataFile.filename));d?h.length&&(i="WARN",r.message=(1===h.length?"A file was":"Files were")+" not associated with the distribution on record: "+h):(i="WARN",r.message=n?"None of the distribution files match those from the local record.":"The distribution had no files.")}"OK"!==i&&(e.distributions[t.provider].display.classList.remove("passed-check"),e.distributions[t.provider].display.classList.add("failed-check"),e.distributions[t.provider].display.lastElementChild.setAttribute("aria-description",r.message)),e.distributions[t.provider].display.lastElementChild.lastElementChild.innerText=i,this.display_repo(t.repo)}else if("view"===t.type){const s=this.named_view[t.view];var r,h;if(s.checks.github.lastElementChild.innerText=i,"OK"===i)for(r in e)if(Object.hasOwn(e,r)){if(!Object.hasOwn(this.repos,r)){e.message="A listed repository is not a part of this data commons: "+r+".",i="FAIL";break}for(l=e[r].files.length;l--;)if(h=e[r].files[l],!Object.hasOwn(this.file_ids,h.md5)){e.message="One of the files in "+r+" was not found in the data commons: "+h.md5,i="FAIL";break}}"OK"===i?(s.manifest=e,s.checks.github.classList.add("passed-check")):(s.checks.github.lastElementChild.setAttribute("aria-description",e.message),s.checks.github.classList.remove("passed-check"),s.checks.github.classList.add("failed-check"))}else"datapackage"===t.type&&(Object.hasOwn(t,"index")?(this.named_view[t.view].view.children[t.index].datapackage=e,this.check_child(this.named_view[t.view],t.index)):(this.named_view[t.view].datapackage=e,this.check_view(this.named_view[t.view])))}},this.page.menu.check_all&&this.page.menu.check_all.addEventListener("click",(()=>{var e,t;for(e in this.repos)if(Object.hasOwn(this.repos,e))for(t in this.repos[e].distributions)Object.hasOwn(this.repos[e].distributions,t)&&this.request_provider(e,t)}));var s,a,l,n,d,r,h,c,o,m=0,p=/^.*(?:\d{4}(?:q\d)?_)|\..*$/g,u=/^[[{]/;for(s in this.page.current_tab=window.location.hash||this.page.current_tab,(h=document.createElement("div")).className="toast",h.role="alert",h.setAttribute("aria-live","assertive"),h.setAttribute("aria-atomic","true"),h.appendChild(document.createElement("div")),h.lastElementChild.className="toast-header",h.lastElementChild.appendChild(document.createElement("strong")),h.lastElementChild.lastElementChild.className="me-auto",h.lastElementChild.appendChild(document.createElement("button")),h.lastElementChild.lastElementChild.type="button",h.lastElementChild.lastElementChild.className="btn-close",h.lastElementChild.lastElementChild.setAttribute("data-bs-dismiss","toast"),h.lastElementChild.lastElementChild.setAttribute("aria-label","close"),h.appendChild(document.createElement("div")),h.lastElementChild.className="toast-body",this.page.toast=new bootstrap.Toast(h),this.page.body.insertAdjacentElement("afterEnd",h),(h=this.page.tooltip).className="hover-note hidden",h.appendChild(document.createElement("p")),this.page.body.insertAdjacentElement("afterEnd",h),this.page.body.parentElement.addEventListener("mouseover",(e=>{const t=e.target.getAttribute("aria-description"),i=t||e.target.parentElement.getAttribute("aria-description");if(i){this.page.tooltip.firstElementChild.innerText=i,this.page.tooltip.classList.remove("hidden");const s=(t?e.target:e.target.parentElement).getBoundingClientRect(),a=this.page.tooltip.getBoundingClientRect();this.page.tooltip.style.top=s.bottom+10+"px",this.page.tooltip.style.left=Math.max(0,s.left+s.width/2-a.width/2)+"px"}else this.page.tooltip.classList.add("hidden")})),this.page.tabs)Object.hasOwn(this.page.tabs,s)&&(this.page.menu[s]=h=document.createElement("button"),h.addEventListener("click",this.show_tab.bind(this)),this.page.menu.check_all.insertAdjacentElement("beforeBegin",h),h.innerText=s,h.className="btn",h.type="button",r=s+"_tab",h.id=r+"_button",h.setAttribute("aria-controls",r),this.page.container.appendChild(h=this.page.tabs[s]),h.className="hidden",h.role="tabpanel",h.id=r,h.setAttribute("aria-labelledby",r+"_button"),this.page.current_tab==="#"+s&&this.show_tab({target:this.page.menu[s]}));for(s in t.repos)if(Object.hasOwn(t.repos,s)){for(l in this.counts.repos++,(a=this.repos[s]=t.repos[s]).checks={},a.providers={},a.file_ids=[],a.ufiles={},a.all_files=t.files[s],a.all_files)if(Object.hasOwn(a.all_files,l)){if(n=(d=a.all_files[l]).name,"string"==typeof d.providers&&(d.providers=[d.providers]),c="",Object.hasOwn(this.file_ids,l)?c=this.file_ids[l]:Object.hasOwn(this.file_ids,n)&&(c=this.file_ids[n]),c||(c="f"+m++,this.file_ids[l]=this.file_ids[n]=c),d.uid=c,!Object.hasOwn(this.files,c)){if(this.counts.files++,this.files[c]={content:d,local:{},remote:{},display:document.createElement("div")},d.prefix=d.name.replace(p,""),d.variables)for("string"==typeof d.variables&&(d.variables=[d.variables]),o=d.variables.length;o--;)r=d.variables[o],Object.hasOwn(this.variables,r)||(this.counts.variables++,this.variables[r]={display:document.createElement("div"),files:[]},this.variables[r].display.className="variable"),this.variables[r].files.push(this.files[c]);if(d.ids)for(o=d.ids.length;o--;)Object.hasOwn(this.ids,d.ids[o])||(this.counts.ids++,this.ids[d.ids[o]]={display:document.createElement("div"),files:[]},this.ids[d.ids[o]].display.className="id"),this.ids[d.ids[o]].files.push(this.files[c])}for(r in Object.hasOwn(a.ufiles,c)||(a.file_ids.push(c),a.ufiles[c]=this.files[c]),Object.hasOwn(a.files,n)&&(a.files[n].uid=c,a.files[n].parent=a,a.url="https://github.com/"+s,this.files[c].local.github=a.files[n]),a.distributions)Object.hasOwn(a.distributions,r)&&(Object.hasOwn(this.dists,r)||(this.dists[r]={}),Object.hasOwn(this.dists[r],a.distributions[r].doi)||(this.dists[r][a.distributions[r].doi]={}),this.dists[r][a.distributions[r].doi][s]=a,a.distributions[r].files&&Object.hasOwn(a.distributions[r].files,n)&&(a.distributions[r].files[n].uid=c,a.distributions[r].files[n].parent=a.distributions[r],this.files[c].local[r]=a.distributions[r].files[n]))}this.page.tabs.repos.appendChild(this.display_repo(s))}for(o=i.length;o--;)this.named_view[i[o].name]=i[o],i[o].parent=this,i[o].checks={},this.page.tabs.views.appendChild(this.display_view(i[o])),Object.hasOwn(i[o].view,"remote")&&this.requester.postMessage({type:"datapackage",view:i[o].name,url:"https://raw.githubusercontent.com/"+i[o].view.remote+"/main/docs/data/datapackage.json"})}DataCommons.prototype={constructor:DataCommons,requester:new Worker("request.js"),rates:{github:{resources:{core:{remaining:0,reset:-1/0}}}},queues:{distributions:[]},format:{date:Intl.DateTimeFormat("en-us",{month:"2-digit",day:"2-digit",year:"2-digit"}).format,time:Intl.DateTimeFormat("en-us",{hour:"numeric",minute:"numeric"}).format,size:function(e){return e<1e6?e/1e3+" KB":e<1e9?e/1e6+" MB":e/1e9+" GB"}},checks:{has_files:{name:"Files",domain:"repo",description:"Number of latent files between the repository and distributions.",check:function(e){return e.file_ids.length}},has_dist:{name:"Dist",domain:"repo",description:"Has an associated distribution repository.",check:function(e){return Object.keys(e.distributions).length>1}},aligned:{name:"Aligned",domain:"repo",description:"All latent file instances are aligned.",check:function(e){var t,i,s,a,l,n,d,r=!0;for(n in e.ufiles)if(Object.hasOwn(e.ufiles,n))for(i in t=e.ufiles[n],s=Object.hasOwn(t.local,"github")?"github":"dataverse",t.local)Object.hasOwn(t.local,i)&&(a="github"===i?"sha":"md5",d=!0,"remote"===(l=Object.hasOwn(t.remote,i)?"remote":"local")&&(d=t.local[i][a]===t.remote[i][a]),(d=d&&t.local[s].md5===t.local[i].md5)||(r=!1),t.local[i].display.classList[d?"remove":"add"]("failed-check"),t.local[i].display.lastElementChild.setAttribute("aria-description","Source: "+l),t.local[i].display.lastElementChild.innerText=t[l][i][a]);return r}.bind(this)},missed_variables:{name:"All Variables",domain:"view",description:"All of the requested variables were found in a dataset.",check:function(e){e.missed_variables=[];for(var t,i=!0,s=e.view.variables.length;s--;)t=e.view.variables[s],Object.hasOwn(e.parent.variables,t)?(e.variables[t].firstElementChild.innerText=e.parent.variables[t].files.length,e.variables[t].firstElementChild.classList.add("passed-check")):(e.variables[t].firstElementChild.classList.remove("passed-check"),e.variables[t].firstElementChild.innerText=0,e.missed_variables.push(t),i=!1);return i}},missed_ids:{name:"All IDs",domain:"view",description:"All of the requested IDs were found in a dataset.",check:function(e){e.missed_ids=[];for(var t,i=!0,s=e.view.ids.length;s--;)t=e.view.ids[s],Object.hasOwn(e.parent.ids,t)?(e.ids[t].firstElementChild.innerText=e.parent.ids[t].files.length,e.ids[t].classList.add("hidden")):(e.ids[t].firstElementChild.innerText=0,e.ids[t].classList.remove("hidden"),e.missed_ids.push(t),i=!1);return i}},datapackage:{name:"datapackage",domain:"view",description:"Retrieved the associated datapackage.json file.",check:function(e){return Object.hasOwn(e,"datapackage")}},updated:{name:"Up-To-Date",domain:"child",description:"The child site's datapackage points to the same files as the parent's.",check:function(e,t){if(Object.hasOwn(e,"datapackage")){var i=!1,s=e.datapackage.resources.length;if(Object.hasOwn(e.view.children[t],"datapackage")&&s===e.view.children[t].datapackage.resources.length)for(;s--&&(i=e.datapackage.resources[s].md5===e.view.children[t].datapackage.resources[s].md5););return i}return!0}}},show_tab:function(e){if(!e.target.classList.contains("active")&&Object.hasOwn(this.page.tabs,e.target.innerText)){const i=e.target.parentElement.getElementsByClassName("active");for(var t=i.length;t--;)this.page.tabs[i[t].innerText].classList.add("hidden"),i[t].classList.remove("disabled"),i[t].classList.remove("active");this.page.tabs[e.target.innerText].classList.remove("hidden"),e.target.classList.add("disabled"),e.target.classList.add("active"),this.page.current_tab=e.target.innerText,window.history.replaceState(Date.now(),"","#"+this.page.current_tab)}},check_repo:function(e){for(var t in this.checks)if(Object.hasOwn(this.checks,t)&&"repo"===this.checks[t].domain){const i=this.checks[t].check(e);e.checks[t].lastElementChild.innerText=i,e.checks[t].classList[i?"remove":"add"]("failed-check")}},check_view:function(e){var t,i;for(t in this.checks)if(Object.hasOwn(this.checks,t)&&"view"===this.checks[t].domain){const i=this.checks[t].check(e);e.checks[t].lastElementChild.innerText=i,e.checks[t].classList[i?"remove":"add"]("failed-check"),"missed_ids"!==t&&"missed_variables"!==t||this.page.views[e.name].lastElementChild.children["missed_ids"===t?2:1].classList[i?"add":"remove"]("hidden")}if(Object.hasOwn(e.view,"children"))for(i=e.view.children.length;i--;)this.check_child(e,i)},check_child:function(e,t){for(var i in this.checks)if(Object.hasOwn(this.checks,i)&&"child"===this.checks[i].domain){const s=this.checks[i].check(e,t);e.view.children[t].parts[i].lastElementChild.innerText=s,e.view.children[t].parts[i].classList[s?"remove":"add"]("failed-check")}},display_repo:function(e){const t=this.repos[e],i=Object.hasOwn(this.page.repos,e),s=i?this.page.repos[e]:document.createElement("div");if(Object.hasOwn(this.repos,e)){var a,l,n,d;if(!i){for(a in this.page.repos[e]=s,s.className="repo_container card",s.appendChild(l=document.createElement("div")),l.className="repo_header card-header",d=e.split("/"),l.appendChild(document.createElement("span")),l.lastElementChild.innerText=d[0]+"/",l.appendChild(document.createElement("span")),l.lastElementChild.innerText=d[1],l.appendChild(l=document.createElement("span")),l.className="repo_links card-links",Object.hasOwn(t,"distributions")||(t.distributions={}),t.distributions.github={url:t.url},t.distributions)Object.hasOwn(t.distributions,a)&&(t.distributions[a].display=document.createElement("div"),l.appendChild(t.distributions[a].display),l.lastElementChild.className="status-chip",l.lastElementChild.appendChild(n=document.createElement("a")),n.target="_blank",n.rel="noreferrer",n.innerText=a,n.href=this.get_provider_link(a,e),l.lastElementChild.appendChild(n=document.createElement("button")),n.className="btn",n.appendChild(document.createElement("span")),n.lastElementChild.innerText="check",n.addEventListener("click",this.request_provider.bind(this,e,a)));for(a in s.appendChild(document.createElement("div")),s.lastElementChild.className="repo_body card-body",s.lastElementChild.appendChild(l=document.createElement("div")),l.className="repo_status card-status",this.checks)Object.hasOwn(this.checks,a)&&"repo"===this.checks[a].domain&&(l.appendChild(t.checks[a]=document.createElement("div")),l.lastElementChild.className="status-chip",l.lastElementChild.setAttribute("aria-description",this.checks[a].description),l.lastElementChild.appendChild(document.createElement("span")),l.lastElementChild.firstElementChild.innerText=this.checks[a].name,l.lastElementChild.appendChild(document.createElement("span")));for(a in s.lastElementChild.appendChild(l=document.createElement("div")),l.className="repo_files card-section",t.all_files)Object.hasOwn(t.all_files,a)&&l.appendChild(this.display_file(a))}this.check_repo(t)}return s},display_file:function(e){if(Object.hasOwn(this.file_ids,e)){const s=this.file_ids[e],a=this.files[s],l=a.display;var t,i;if(!l.childElementCount)for(t in l.className="entry",l.appendChild(document.createElement("p")),l.lastElementChild.innerText=a.content.name,l.lastElementChild.className="entry-name",l.appendChild(document.createElement("p")),l.lastElementChild.className="entry-info",l.lastElementChild.appendChild(document.createElement("span")),l.lastElementChild.lastElementChild.className="entry-info-entry",l.lastElementChild.lastElementChild.innerText="git sha: ",l.lastElementChild.appendChild(document.createElement("span")),l.lastElementChild.appendChild(document.createElement("span")),l.lastElementChild.lastElementChild.className="entry-info-entry",l.lastElementChild.lastElementChild.innerText="md5: ",l.lastElementChild.appendChild(document.createElement("span")),t=Object.hasOwn(a.local,"github")?"github":"dataverse",Object.hasOwn(a.local,t)?(l.lastElementChild.children[1].innerText=a.local[t].sha||"none",l.lastElementChild.children[3].innerText=a.local[t].md5):l.lastElementChild.classList.add("hidden"),l.appendChild(document.createElement("div")),l.lastElementChild.className="entry-checks",a.local)Object.hasOwn(a.local,t)&&(a.local[t].display=document.createElement("div"),l.lastElementChild.appendChild(a.local[t].display),a.local[t].display.className="status-chip",a.local[t].display.appendChild(i=document.createElement("a")),i.target="_blank",i.rel="noreferrer",i.href=this.make_file_link(s,t),i.innerText=t,i.className=t+"-file",a.local[t].display.appendChild(document.createElement("span")));return l}return document.createElement("div")},display_view:function(e){const t=Object.hasOwn(this.page.views,e.name),i=t?this.page.views[e.name]:document.createElement("div");var s,a,l,n,d;if(!t){for(s in e.variables={},e.ids={},this.page.views[e.name]=i,i.className="view_container card",i.appendChild(a=document.createElement("div")),a.className="view_header card-header",a.appendChild(document.createElement("span")),e.view.url?(a.lastElementChild.appendChild(l=document.createElement("a")),l.target="_blank",l.rel="noreferrer",l.href=e.view.url,l.innerText=e.name):a.lastElementChild.innerText=e.name,a.appendChild(a=document.createElement("span")),a.className="view_links card-links",e.view.remote&&(a.appendChild(document.createElement("div")),a.lastElementChild.className="status-chip",e.checks.github=a.lastElementChild,a.lastElementChild.appendChild(l=document.createElement("a")),l.target="_blank",l.rel="noreferrer",l.href="https://github.com/"+e.view.remote,l.innerText="github",a.lastElementChild.appendChild(l=document.createElement("button")),l.className="btn",l.appendChild(document.createElement("span")),l.lastElementChild.innerText="check",l.addEventListener("click",this.request_manifest.bind(this,e,"https://raw.githubusercontent.com/"+e.view.remote+"/main/docs/data/manifest.json"))),i.appendChild(document.createElement("div")),i.lastElementChild.className="view_body card-body",i.lastElementChild.appendChild(a=document.createElement("div")),a.className="view_status card-status",this.checks)Object.hasOwn(this.checks,s)&&"view"===this.checks[s].domain&&(a.appendChild(e.checks[s]=document.createElement("div")),a.lastElementChild.className="status-chip",a.lastElementChild.setAttribute("aria-description",this.checks[s].description),a.lastElementChild.appendChild(document.createElement("span")),a.lastElementChild.firstElementChild.innerText=this.checks[s].name,a.lastElementChild.appendChild(document.createElement("span")));for(i.lastElementChild.appendChild(l=document.createElement("div")),l.className="card-section",l.appendChild(document.createElement("p")),l.lastElementChild.innerText="Variables",l.lastElementChild.className="card-section-header",l.appendChild(document.createElement("table")),l.lastElementChild.appendChild(document.createElement("thead")),l.lastElementChild.lastElementChild.appendChild(document.createElement("tr")),l.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),l.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="Files",l.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),l.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="Name",l.lastElementChild.appendChild(l=document.createElement("tbody")),d=0,n=e.view.variables.length;n--;)l.appendChild(e.variables[e.view.variables[n]]=document.createElement("tr")),l.lastElementChild.appendChild(document.createElement("td")),l.lastElementChild.lastElementChild.innerText=0,l.lastElementChild.appendChild(document.createElement("td")),l.lastElementChild.lastElementChild.innerText=e.view.variables[n],e.view.variables[n].length>d&&(d=e.view.variables[n].length);for(i.lastElementChild.appendChild(l=document.createElement("div")),l.className="card-section",l.appendChild(document.createElement("p")),l.lastElementChild.innerText="Missing IDs",l.lastElementChild.className="card-section-header",l.appendChild(document.createElement("table")),l.lastElementChild.appendChild(document.createElement("thead")),l.lastElementChild.lastElementChild.appendChild(document.createElement("tr")),l.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),l.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="Files",l.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),l.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="ID",l.lastElementChild.appendChild(l=document.createElement("tbody")),d=0,n=e.view.ids.length;n--;)l.appendChild(e.ids[e.view.ids[n]]=document.createElement("tr")),l.lastElementChild.classList.add("hidden"),l.lastElementChild.appendChild(document.createElement("td")),l.lastElementChild.lastElementChild.innerText=0,l.lastElementChild.appendChild(document.createElement("td")),l.lastElementChild.lastElementChild.innerText=e.view.ids[n],e.view.ids[n].length>d&&(d=e.view.ids[n].length);if(e.view.children.length)for(e.checks.children=[],i.lastElementChild.appendChild(a=document.createElement("div")),a.className="card-section",a.appendChild(document.createElement("p")),a.lastElementChild.innerText="Children",a.lastElementChild.className="card-section-header",n=e.view.children.length;n--;){for(s in(l=document.createElement("div")).className="status-chip",l.appendChild(document.createElement("span")),l.firstElementChild.innerText="github",l.appendChild(document.createElement("a")),l.lastElementChild.target="_blank",l.lastElementChild.rel="noreferrer",l.lastElementChild.innerText=e.view.children[n].remote,l.lastElementChild.href="https://github.com/"+e.view.children[n].remote,e.view.children[n].parts={repo:l},this.checks)Object.hasOwn(this.checks,s)&&"child"===this.checks[s].domain&&(e.view.children[n].parts[s]=l=document.createElement("div"),l.className="status-chip",l.appendChild(document.createElement("span")),l.firstElementChild.innerText=this.checks[s].name,l.appendChild(document.createElement("span")));for(s in a.appendChild(document.createElement("div")),a.lastElementChild.className="entry",a.lastElementChild.appendChild(document.createElement("p")),a.lastElementChild.lastElementChild.appendChild(l=document.createElement("a")),l.parentElement.className="entry-name",l.target="_blank",l.rel="noreferrer",l.innerText=e.view.children[n].name,l.href=e.view.children[n].url,a.lastElementChild.appendChild(l=document.createElement("div")),l.className="entry-checks",e.view.children[n].parts)Object.hasOwn(e.view.children[n].parts,s)&&l.appendChild(e.view.children[n].parts[s]);this.requester.postMessage({type:"datapackage",view:e.name,index:n,url:"https://raw.githubusercontent.com/"+e.view.children[n].remote+"/main/docs/data/datapackage.json"})}}return this.check_view(e),i},make_file_link:function(e,t){const i=this.files[e];if(i){if("github"===t&&Object.hasOwn(i.local,"github"))return i.local.github.parent.url+"/blob/"+(i.local.github.parent.providers.github&&i.local.github.parent.providers.github.default_branch||"main")+i.local.github.location+"/"+i.content.name;const e=i.local[t];if("dataverse"===t&&Object.hasOwn(i.local,"dataverse"))return e.parent.server+"file.xhtml?fileId="+e.id}},get_provider_link:function(e,t,i){if("github"===e)return i?"https://api.github.com/repos/"+t+"/contents/data":"https://github.com/"+t;const s=this.repos[t].distributions[e];return"dataverse"===e?s.server+(i?"api/datasets/:persistentId":"dataset.xhtml")+"?persistentId=doi:"+s.doi:void 0},request_manifest:function(e,t){this.requester.postMessage({type:"view",view:e.name,url:t})},request_provider:function(e,t){const i=this.get_provider_link(t,e,!0);i&&(this.queues.distributions.push({type:"provider",repo:e,provider:t,url:i}),this.prompt_dist_requester())},prompt_dist_requester:async function(){for(var e,t=this.queues.distributions.length;t--;){if("github"===(e=this.queues.distributions[t]).provider){if(!(this.rates.github.resources.core.remaining>0)){if(Date.now()/1e3>this.rates.github.resources.core.reset){if(!this.rates.github.resources.core.queued){const e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){if(200!==e.status)throw new TypeError("failed to retrieve github rate limit; "+e.responseText);this.rates.github=JSON.parse(e.responseText),this.prompt_dist_requester()}},e.open("GET","https://api.github.com/rate_limit",!0),e.send(),this.rates.github.resources.core.queued=!0}}else this.page.toast._element.firstElementChild.firstElementChild.innerText="GitHub Rate Limit",this.rates.github.resources.core.reset*=1e3,this.page.toast._element.lastElementChild.innerText="This IP has reached GitHub's API rate limit; this will reset at "+this.format.time(new Date(1e3*this.rates.github.resources.core.rese))+" (in "+Math.round((this.rates.github.resources.core.reset-Date.now())/60)+" minutes).",this.page.toast.show(),this.requester.onmessage({data:{response:JSON.stringify({status:"WARN",message:this.page.toast._element.lastElementChild.innerText}),repo:e.repo,provider:e.provider}}),this.queues.distributions.splice(t,1);continue}this.rates.github.resources.core.remaining--}this.requester.postMessage(this.queues.distributions.splice(t,1)[0])}}},"undefined"!=typeof module&&(module.export=DataCommons);