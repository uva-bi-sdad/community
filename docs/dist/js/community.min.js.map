{"version":3,"file":"community.min.js","sources":["../../../node_modules/tslib/tslib.es6.js","../../../js/data_handler/export_params.ts","../../../js/data_handler/checks.ts","../../../js/data_handler/filter_check.ts","../../../js/data_handler/patterns.ts","../../../js/data_handler/row_writers.ts","../../../js/data_handler/exporter.ts","../../../js/data_handler/retrievers.ts","../../../js/data_handler/formatters.ts","../../../js/data_handler/ingesters.ts","../../../js/data_handler/summary.ts","../../../js/data_handler/mappers.ts","../../../js/data_handler/parsers.ts","../../../js/data_handler/index.ts","../../../js/site/defaults.ts","../../../js/site/global_view.ts","../../../js/site/patterns.ts","../../../js/site/storage.ts","../../../js/site/subscriptions.ts","../../../js/site/static_refs.ts","../../../js/site/utils.ts","../../../js/site/conditionals.ts","../../../js/site/palettes.ts","../../../js/site/inputs/index.ts","../../../js/site/common_methods.ts","../../../js/site/time_funs.ts","../../../js/site/dataview.ts","../../../js/site/inputs/combobox.ts","../../../js/site/tutorials.ts","../../../js/site/page.ts","../../../js/site/inputs/virtual.ts","../../../js/site/value_types.ts","../../../js/site/outputs/index.ts","../../../js/site/outputs/info.ts","../../../js/site/outputs/legend.ts","../../../js/site/index.ts","../../../js/site/inputs/button.ts","../../../js/site/inputs/buttongroup.ts","../../../js/site/inputs/select.ts","../../../js/site/inputs/number.ts","../../../js/site/inputs/radio.ts","../../../js/site/inputs/switch.ts","../../../js/site/inputs/checkbox.ts","../../../js/site/inputs/text.ts","../../../js/site/outputs/map.ts","../../../js/site/outputs/plotly.ts","../../../js/site/outputs/datatables.ts","../../../js/site/outputs/table.ts","../../../js/site/outputs/text.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    function next() {\r\n        while (env.stack.length) {\r\n            var rec = env.stack.pop();\r\n            try {\r\n                var result = rec.dispose && rec.dispose.call(rec.value);\r\n                if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n};\r\n","import {UnparsedObject} from '../types'\r\n\r\nexport const defaults: UnparsedObject = {\r\n  file_format: 'csv',\r\n  table_format: 'mixed',\r\n  features: {ID: 'id', Name: 'name'},\r\n  feature_conditions: [],\r\n  variables: {\r\n    filter_by: [],\r\n    conditions: [],\r\n  },\r\n}\r\n\r\nexport const options: {[index: string]: string[]} = {\r\n  file_format: ['csv', 'tsv'],\r\n  table_format: ['tall', 'mixed', 'wide'],\r\n  filter_components: ['first', 'min', 'mean', 'sum', 'max', 'last'],\r\n}\r\n","import {options} from './export_params'\r\n\r\nexport const group_checks: {[index: string]: Function} = {\r\n  '!': function (this: string, v: string): boolean {\r\n    return this !== v\r\n  },\r\n  '=': function (this: string, v: string): boolean {\r\n    return this === v\r\n  },\r\n  includes: function (v: string): boolean {\r\n    return -1 !== this.indexOf(v)\r\n  },\r\n  excludes: function (v: string): boolean {\r\n    return -1 === this.indexOf(v)\r\n  },\r\n}\r\n\r\nexport const export_checks: {[index: string]: Function} = {\r\n  file_format: function (a: string): boolean {\r\n    return -1 === options.file_format.indexOf(a)\r\n  },\r\n  table_format: function (a: string): boolean {\r\n    return -1 === options.table_format.indexOf(a)\r\n  },\r\n  include: function (a: string, vars: {[index: string]: string}): string {\r\n    for (let i = a.length; i--; ) {\r\n      if (!(a[i] in vars)) return a[i]\r\n    }\r\n    return ''\r\n  },\r\n}\r\n\r\nexport const value_checks: {[index: string]: Function} = {\r\n  '!': function (a: number): boolean {\r\n    return !a || -1 == a\r\n  },\r\n  '': function (a: number): boolean {\r\n    return !!a && -1 != a\r\n  },\r\n  '=': function (a: number, b: number): boolean {\r\n    return a === b\r\n  },\r\n  '!=': function (a: number, b: number): boolean {\r\n    return a != b\r\n  },\r\n  '>': function (a: number, b: number): boolean {\r\n    return a > b\r\n  },\r\n  '<': function (a: number, b: number): boolean {\r\n    return a < b\r\n  },\r\n  '>=': function (a: number, b: number): boolean {\r\n    return a >= b\r\n  },\r\n  '<=': function (a: number, b: number): boolean {\r\n    return a <= b\r\n  },\r\n  equals: function (s: number, e: string | number): boolean {\r\n    return !s || -1 == s || s === e\r\n  },\r\n  includes: function (s: (string | number)[], e: string | number): boolean {\r\n    return !s || !s.length || -1 !== s.indexOf(e)\r\n  },\r\n  excludes: function (s: (string | number)[], e: string | number): boolean {\r\n    return !s || !s.length || -1 === s.indexOf(e)\r\n  },\r\n}\r\n","import {Filter, VariableFilter, Variables, VectorSummary, Entity} from '../types'\r\n\r\nfunction vector_summary(vec: number | number[], range: number[]): VectorSummary {\r\n  if (Array.isArray(vec)) {\r\n    const n = Math.min(range[1] + 1, vec.length),\r\n      r: VectorSummary = {\r\n        missing: 0,\r\n        first: vec[0],\r\n        min: Infinity,\r\n        mean: 0,\r\n        sum: 0,\r\n        max: -Infinity,\r\n        last: vec[n - 1],\r\n      }\r\n    let on = 0\r\n    for (let i = Math.max(range[0], 0); i < n; i++) {\r\n      const v = vec[i]\r\n      if ('number' === typeof v) {\r\n        if (isNaN(v)) {\r\n          r.missing++\r\n        } else {\r\n          on++\r\n          if (r.min > v) r.min = v\r\n          if (r.max < v) r.max = v\r\n          r.sum += v\r\n        }\r\n      } else {\r\n        if ('NA' !== v) on++\r\n      }\r\n    }\r\n    r.mean = on ? r.sum / on : 0\r\n    return r\r\n  } else {\r\n    return {missing: Number(isNaN(vec)) + 0, first: vec, min: vec, mean: vec, sum: vec, max: vec, last: vec}\r\n  }\r\n}\r\n\r\nexport function passes_filter(\r\n  entity: Entity,\r\n  time_range: number[],\r\n  filter: VariableFilter,\r\n  variables: Variables\r\n): boolean {\r\n  const s: {[index: string]: VectorSummary} = {},\r\n    adjs: {[index: string]: number} = {}\r\n  for (let i = filter.filter_by.length; i--; ) {\r\n    const f = filter.filter_by[i]\r\n    const c = variables[f].code\r\n    if (!(c in entity.data)) return false\r\n    const r =\r\n      entity.group in variables[f].info\r\n        ? variables[f].info[entity.group].time_range\r\n        : variables[f].time_range[entity.group]\r\n    if (!r) return false\r\n    adjs[f] = r[0]\r\n    s[f] = vector_summary(entity.data[c], [time_range[0] - r[0], Math.max(time_range[1] - r[0], time_range[1] - r[1])])\r\n  }\r\n  for (let i = filter.conditions.length; i--; ) {\r\n    const co = filter.conditions[i]\r\n    if (\r\n      !(co.time_component ? co.check(entity.data[variables[co.name].code], adjs[co.name] || 0) : co.check(s[co.name]))\r\n    )\r\n      return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport function passes_feature_filter(entities: {[index: string]: Entity}, id: string, filter: Filter[]): boolean {\r\n  const entity = entities[id]\r\n  for (let i = filter.length; i--; ) {\r\n    const value = filter[i].value\r\n    if (value !== '-1') {\r\n      let pass = false\r\n      const ck = (id: string) => {\r\n        if (!pass) {\r\n          const group = id in entities && entities[id].group\r\n          if (\r\n            group && group in entity.features\r\n              ? id === entity.features[group]\r\n              : id.length < entity.features.id.length\r\n              ? id === entity.features.id.substring(0, id.length)\r\n              : id === entity.features.id\r\n          )\r\n            pass = true\r\n        }\r\n      }\r\n      if ('id' === filter[i].name && Array.isArray(value)) {\r\n        value.forEach(ck)\r\n        return pass\r\n      } else {\r\n        ck(value + '')\r\n        return pass\r\n      }\r\n    }\r\n  }\r\n  return true\r\n}\r\n","export const patterns: {[index: string]: RegExp} = {\r\n  seps: /[\\s._-]/g,\r\n  comma: /,/,\r\n  word_start: /\\b(\\w)/g,\r\n  single_operator: /([<>!])([^=])/,\r\n  greater: /%3E$/,\r\n  less: /%3C$/,\r\n  operator_start: /[<>!]$/,\r\n  component: /^(.+)\\[(.+)\\]/,\r\n  number: /^[0-9.+-]+$/,\r\n  non_letter_num: /[^0-9a-z]+/g,\r\n}\r\n","import DataHandler from './index'\r\nimport {Entity, Features} from '../types'\r\n\r\nexport function tall(\r\n  this: DataHandler,\r\n  entity: Entity,\r\n  time_range: number[],\r\n  feats: Features,\r\n  vars: string[],\r\n  sep: string\r\n): string {\r\n  if (entity.group in this.meta.times) {\r\n    const op: string[] = [],\r\n      time = this.meta.times[entity.group].value as number[]\r\n    let tr = ''\r\n    Object.keys(feats).forEach(f => {\r\n      tr += '\"' + entity.features[feats[f]] + '\"' + sep\r\n    })\r\n    vars.forEach(k => {\r\n      const vc = entity.variables[k].code\r\n      if (vc in entity.data) {\r\n        const range: [number, number] = this.meta.variables[entity.group][k].time_range\r\n        let r = ''\r\n        const yn = time_range[1] + 1\r\n        for (let y = time_range[0]; y < yn; y++) {\r\n          if (y >= range[0] && y <= range[1]) {\r\n            const vec = entity.data[vc]\r\n            const value = Array.isArray(vec) ? vec[y - range[0]] : vec\r\n            if (!isNaN(value)) {\r\n              r += (r ? '\\n' : '') + tr + time[y] + sep + '\"' + k + '\"' + sep + value\r\n            }\r\n          }\r\n        }\r\n        if (r) op.push(r)\r\n      }\r\n    })\r\n    return op.join('\\n')\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function mixed(\r\n  this: DataHandler,\r\n  entity: Entity,\r\n  time_range: number[],\r\n  feats: Features,\r\n  vars: string[],\r\n  sep: string\r\n): string {\r\n  if (entity.group in this.meta.times) {\r\n    const op: string[] = [],\r\n      time = this.meta.times[entity.group].value as number[]\r\n    let tr = ''\r\n    Object.keys(feats).forEach(f => {\r\n      tr += '\"' + entity.features[feats[f]] + '\"' + sep\r\n    })\r\n    const yn = time_range[1] + 1\r\n    for (let y = time_range[0]; y < yn; y++) {\r\n      let r = tr + time[y]\r\n      vars.forEach((k: string) => {\r\n        const vc = entity.variables[k].code\r\n        if (vc in entity.data) {\r\n          const trange = this.meta.variables[entity.group][k].time_range\r\n          const vec = entity.data[vc]\r\n          let value = NaN\r\n          if (Array.isArray(vec)) {\r\n            if (y >= trange[0] && y <= trange[1]) value = vec[y - trange[0]]\r\n          } else if (y === trange[0]) {\r\n            value = vec\r\n          }\r\n          r += sep + (isNaN(value) ? 'NA' : value)\r\n        } else r += sep + 'NA'\r\n      })\r\n      op.push(r)\r\n    }\r\n    return op.join('\\n')\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function wide(\r\n  this: DataHandler,\r\n  entity: Entity,\r\n  time_range: number[],\r\n  feats: Features,\r\n  vars: string[],\r\n  sep: string\r\n): string {\r\n  if (entity.group in this.meta.times) {\r\n    let r = ''\r\n    Object.keys(feats).forEach(f => {\r\n      r += (r ? sep : '') + '\"' + entity.features[feats[f]] + '\"'\r\n    })\r\n    vars.forEach(k => {\r\n      const vc = entity.variables[k].code\r\n      const range: [number, number] = this.meta.ranges[k]\r\n      const trange: [number, number] = this.meta.variables[entity.group][k].time_range\r\n      const yn = time_range[1] + 1\r\n      for (let y = time_range[0]; y < yn; y++) {\r\n        if (y >= range[0] && y <= range[1]) {\r\n          if (vc in entity.data) {\r\n            const vec = entity.data[vc]\r\n            let value = NaN\r\n            if (Array.isArray(vec)) {\r\n              if (y >= trange[0] && y <= trange[1]) value = vec[y - trange[0]]\r\n            } else if (y === trange[0]) {\r\n              value = vec\r\n            }\r\n            r += sep + (isNaN(value) ? 'NA' : value)\r\n          } else r += sep + 'NA'\r\n        }\r\n      }\r\n    })\r\n    return r\r\n  }\r\n  return ''\r\n}\r\n","import * as params from './export_params'\r\nimport {group_checks, export_checks} from './checks'\r\nimport {passes_filter, passes_feature_filter} from './filter_check'\r\nimport {patterns} from './patterns'\r\nimport * as row_writers from './row_writers'\r\nimport type {Query, Entity, Features, Entities, RawQuery} from '../types'\r\nimport DataHandler from './index'\r\n\r\nexport async function exporter(\r\n  this: DataHandler,\r\n  query_string?: RawQuery,\r\n  entities?: Entities,\r\n  in_browser?: boolean,\r\n  all_data?: boolean\r\n) {\r\n  if (!in_browser) await this.data_ready\r\n  const query: Query = this.parse_query(query_string)\r\n  entities = entities || this.entities\r\n  if (-1 === params.options.file_format.indexOf(query.file_format)) query.file_format = params.defaults.file_format\r\n  if (!(query.table_format in row_writers)) query.table_format = params.defaults.table_format\r\n  const res = {\r\n      statusCode: 400,\r\n      headers: {'Content-Type': 'text/plain; charset=utf-8', 'Content-Disposition': 'attachment; filename='},\r\n      body: 'Invalid Request',\r\n    },\r\n    inc: string[] =\r\n      query.include && query.include.length\r\n        ? 'string' === typeof query.include\r\n          ? query.include in this.variables\r\n            ? [query.include]\r\n            : query.include.split(',')\r\n          : query.include\r\n        : Object.keys(this.variables),\r\n    exc = query.exclude || [],\r\n    vars: string[] = [],\r\n    feats: Features = query.features || JSON.parse(JSON.stringify(params.defaults.features)),\r\n    rows: string[] = [],\r\n    range = [Infinity, -Infinity],\r\n    sep = 'csv' === query.file_format ? ',' : '\\t',\r\n    rw: Function = row_writers[query.table_format].bind(this),\r\n    no_filter = !query.variables.filter_by.length,\r\n    no_feature_filter = !query.feature_conditions.length,\r\n    in_group: Function = !('dataset' in query)\r\n      ? () => true\r\n      : group_checks[query.dataset.operator].bind(\r\n          'number' === typeof query.dataset.value ? query.dataset.value + '' : query.dataset.value\r\n        )\r\n  let malformed = ''\r\n  inc.forEach(ii => {\r\n    if (ii in this.features && !(ii in feats)) {\r\n      feats[ii] = this.format_label(ii)\r\n    } else if (!(ii in this.variables)) {\r\n      malformed += ii + ','\r\n      if (malformed in this.variables) {\r\n        inc.push(malformed)\r\n        malformed = ''\r\n      }\r\n    }\r\n  })\r\n  for (const k in export_checks)\r\n    if (k in query) {\r\n      const r: string = export_checks[k]('include' === k ? inc : query[k as keyof Query], this.variables)\r\n      if (r) {\r\n        res.body = 'Failed check for ' + k + ': ' + r\r\n        return res\r\n      }\r\n    }\r\n  Object.keys(this.variable_codes).forEach(k => {\r\n    if (-1 !== inc.indexOf(this.variable_codes[k].name) && -1 === exc.indexOf(this.variable_codes[k].name)) {\r\n      vars.push(this.variable_codes[k].name)\r\n      const tr: [number, number] = this.meta.ranges[this.variable_codes[k].name]\r\n      if (tr[0] < range[0]) range[0] = tr[0]\r\n      if (tr[1] > range[1]) range[1] = tr[1]\r\n    }\r\n  })\r\n  if (query.time_range[0] < range[0]) query.time_range[0] = range[0]\r\n  if (query.time_range[1] > range[1]) query.time_range[1] = range[1]\r\n  rows.push(Object.keys(feats).join(sep))\r\n  if ('wide' === query.table_format) {\r\n    vars.forEach(vi => {\r\n      const tr: [number, number] = this.meta.ranges[vi],\r\n        yn = Math.min(query.time_range[1], tr[1]) + 1\r\n      for (let y = Math.max(query.time_range[0], tr[0]); y < yn; y++) {\r\n        rows[0] += sep + '\"' + vi + '_' + this.meta.overall.value[y] + '\"'\r\n      }\r\n    })\r\n  } else\r\n    rows[0] +=\r\n      sep +\r\n      'time' +\r\n      sep +\r\n      ('mixed' === query.table_format ? vars.map(n => '\"' + n + '\"') : ['variable', 'value']).join(sep)\r\n  let first_entity = ''\r\n  Object.keys(entities).forEach(k => {\r\n    const e: Entity = entities[k]\r\n    if (\r\n      in_group(e.group) &&\r\n      (no_feature_filter || passes_feature_filter(entities, k, query.feature_conditions)) &&\r\n      (no_filter || passes_filter(e, query.time_range, query.variables, this.variables))\r\n    ) {\r\n      const r: string = rw(e, query.time_range, feats, vars, sep)\r\n      if (r) {\r\n        if (!first_entity) first_entity = k\r\n        rows.push(r)\r\n      }\r\n    }\r\n  })\r\n  res.headers['Content-Type'] = 'text/' + (',' === sep ? 'csv' : 'plain') + '; charset=utf-8'\r\n  res.body = rows.join('\\n')\r\n  const times: number[] = this.meta.overall.value,\r\n    filename =\r\n      'export_' +\r\n      (in_browser && !all_data && first_entity\r\n        ? entities[first_entity].group + '_'\r\n        : query.dataset\r\n        ? query.dataset.value + '_'\r\n        : '') +\r\n      (query.time_range[0] === query.time_range[1]\r\n        ? times[query.time_range[0]]\r\n        : times[query.time_range[0]] + '-' + times[query.time_range[1]]) +\r\n      '_' +\r\n      (1 === vars.length\r\n        ? this.variables[vars[0]].meta.short_name.toLowerCase().replace(patterns.non_letter_num, '-')\r\n        : vars.length + '-variables') +\r\n      '_' +\r\n      (rows.join('\\n').split('\\n').length - 1) +\r\n      'x' +\r\n      rows[0].split(sep).length\r\n  if (in_browser) {\r\n    const e = document.createElement('a')\r\n    document.body.appendChild(e)\r\n    e.rel = 'noreferrer'\r\n    e.target = '_blank'\r\n    e.download = filename + '.' + query.file_format\r\n    e.href = URL.createObjectURL(new Blob([res.body], {type: res.headers['Content-Type']}))\r\n    setTimeout(function () {\r\n      e.dispatchEvent(new MouseEvent('click'))\r\n      URL.revokeObjectURL.bind(null, e.href)\r\n      document.body.removeChild(e)\r\n    }, 0)\r\n  }\r\n  res.statusCode = 200\r\n  res.headers['Content-Disposition'] += filename + '.' + query.file_format\r\n  return res\r\n}\r\n","import {Entity} from '../types'\r\n\r\nexport function single(this: Entity, v: string, t: number) {\r\n  if (t < 0) return NaN\r\n  if (this.variables[v].is_time) {\r\n    return Array.isArray(this.time.value) && t < this.time.value.length ? this.time.value[t] : NaN\r\n  } else {\r\n    v = this.variables[v].code\r\n    return 0 === t && v in this.data ? this.data[v] : NaN\r\n  }\r\n}\r\n\r\nexport function multi(this: Entity, v: string, t: number) {\r\n  if (t < 0) return NaN\r\n  if (this.variables[v].is_time) {\r\n    return Array.isArray(this.time.value) ? this.time.value[t] : this.time.value\r\n  } else {\r\n    v = this.variables[v].code\r\n    const value = this.data[v]\r\n    return v in this.data ? (Array.isArray(value) ? (t < value.length ? value[t] : NaN) : 0 === t ? value : NaN) : NaN\r\n  }\r\n}\r\n\r\nexport function row_time(\r\n  this: {i: number; o: number; format_value: Function},\r\n  d: number[],\r\n  type: string,\r\n  row: {offset: number; int: boolean}\r\n) {\r\n  const i = this.i - (row.offset - this.o)\r\n  return d && i >= 0 && i < d.length ? ('number' === typeof d[i] ? this.format_value(d[i], row.int) : d[i]) : NaN\r\n}\r\n","import DataHandler from './index'\r\nimport {Settings} from '../types'\r\nimport {patterns} from './patterns'\r\n\r\nexport function value(this: {settings: Settings}, v: null | number, int?: boolean): number | string {\r\n  if (null === v || isNaN(v)) {\r\n    return NaN\r\n  } else if (int) {\r\n    return v\r\n  } else {\r\n    return 'number' !== typeof this.settings.settings.digits\r\n      ? v\r\n      : v.toFixed(this.settings.settings.digits > 0 ? this.settings.settings.digits : 0)\r\n  }\r\n}\r\n\r\nexport function label(this: DataHandler, l: string): string {\r\n  return 'string' !== typeof l\r\n    ? ''\r\n    : l in this.variables && this.variables[l].meta && this.variables[l].meta.short_name\r\n    ? this.variables[l].meta.short_name\r\n    : l.replace(patterns.seps, ' ').replace(patterns.word_start, function (w) {\r\n        return w.toUpperCase()\r\n      })\r\n}\r\n","import DataHandler from './index'\r\nimport type {Data, EntityFeatureSet, EntityFeatures, IdMap} from '../types'\r\n\r\nexport function data(this: DataHandler, d: Data, name: string) {\r\n  this.sets[name] = d\r\n  this.loaded[name] = true\r\n  if (!(name in this.info)) this.info[name] = {name: name, site_file: name + '.json', schema: {fields: []}, ids: []}\r\n  if ('_meta' in d) {\r\n    const time = d._meta.time\r\n    this.meta.times[name] = time\r\n    if ('number' === typeof time.value) time.value = [time.value as number]\r\n    const times = time.value as number[]\r\n    time.n = times.length\r\n    time.is_single = 1 === time.n\r\n    time.range = [times[0], times[time.n - 1]]\r\n    if (d._meta.time.name in this.variables) {\r\n      time.info = this.variables[time.name]\r\n      time.info.is_time = true\r\n    }\r\n    if (time.range[0] < this.meta.overall.range[0]) this.meta.overall.range[0] = time.range[0]\r\n    if (time.range[1] > this.meta.overall.range[1]) this.meta.overall.range[1] = time.range[1]\r\n    times.forEach((v: number) => {\r\n      if (-1 === this.meta.overall.value.indexOf(v)) this.meta.overall.value.push(v)\r\n    })\r\n    this.meta.overall.value.sort()\r\n    this.meta.variables[name] = d._meta.variables || {}\r\n    Object.keys(this.meta.variables[name]).forEach((k: string) => {\r\n      if (!(k in this.variables)) {\r\n        this.variables[k] = {\r\n          datasets: [name],\r\n          info: {},\r\n          time_range: {},\r\n          type: 'unknown',\r\n          name: k,\r\n          code: k,\r\n          views: {},\r\n          meta: {\r\n            full_name: k,\r\n            measure: k.split(':')[1] || k,\r\n            short_name: this.format_label(k),\r\n            long_name: k,\r\n            type: 'unknown',\r\n          },\r\n        }\r\n        this.variable_info[k] = this.variables[k].meta\r\n      }\r\n      this.variables[k].name = k\r\n      this.variables[k].code = this.meta.variables[name][k].code\r\n      const t = this.meta.variables[name][k].time_range\r\n      this.variables[k].time_range[name] = t\r\n      this.variable_codes[this.variables[k].code] = this.variables[k]\r\n      if (-1 !== t[0]) {\r\n        if (k in this.meta.ranges) {\r\n          if (t[0] < this.meta.ranges[k][0]) this.meta.ranges[k][0] = t[0]\r\n          if (t[1] > this.meta.ranges[k][1]) this.meta.ranges[k][1] = t[1]\r\n        } else {\r\n          this.meta.ranges[k] = [t[0], t[1]]\r\n        }\r\n      }\r\n    })\r\n  }\r\n  this.load_id_maps()\r\n}\r\n\r\nexport async function id_maps(this: DataHandler) {\r\n  this.metadata.datasets &&\r\n    this.metadata.datasets.forEach((k: string) => {\r\n      let has_map = false\r\n      k in this.info &&\r\n        this.info[k].ids.forEach((id: IdMap, i: number) => {\r\n          if ('map' in id) {\r\n            has_map = true\r\n            const map = id.map\r\n            if (map in this.data_maps) {\r\n              if (this.data_maps[map].retrieved) {\r\n                const features = (\r\n                  k in this.data_maps[map].resource ? this.data_maps[map].resource[k] : this.data_maps[map].resource\r\n                ) as EntityFeatures\r\n                this.info[k].schema.fields[i].ids = this.entity_features[k] = features\r\n                this.map_entities(k)\r\n              } else {\r\n                const queue = this.data_maps[map].queue as string[]\r\n                if (-1 === queue.indexOf(k)) queue.push(k)\r\n              }\r\n            } else if ('string' !== typeof map || id.map_content) {\r\n              if ('string' === typeof map) {\r\n                this.data_maps[map] = {queue: [], resource: JSON.parse(id.map_content), retrieved: true}\r\n                const features = (\r\n                  k in this.data_maps[map].resource ? this.data_maps[map].resource[k] : this.data_maps[map].resource\r\n                ) as EntityFeatures\r\n                this.info[k].schema.fields[i].ids = this.entity_features[k] = features\r\n              } else {\r\n                this.entity_features[k] = map\r\n              }\r\n              this.map_entities(k)\r\n            } else {\r\n              this.data_maps[map] = {queue: [k], resource: {}, retrieved: false}\r\n              if (this.settings.entity_info && map in this.settings.entity_info) {\r\n                const e = this.settings.entity_info\r\n                if ('string' === typeof e[map]) e[map] = JSON.parse(e[map] as string)\r\n                this.ingest_map(e[map] as EntityFeatures, map, i)\r\n              } else if ('undefined' === typeof window) {\r\n                require('https')\r\n                  .get(map, (r: {req: {protocol: string; host: string; path: string}; on: Function}) => {\r\n                    const c: string[] = []\r\n                    r.on('data', (d: string) => {\r\n                      c.push(d)\r\n                    })\r\n                    r.on('end', () => {\r\n                      this.ingest_map(JSON.parse(c.join('')), r.req.protocol + '//' + r.req.host + r.req.path, i)\r\n                    })\r\n                  })\r\n                  .end()\r\n              } else {\r\n                const f = new window.XMLHttpRequest()\r\n                f.onreadystatechange = function (this: DataHandler, url: string, fi: number) {\r\n                  if (4 === f.readyState) {\r\n                    if (200 === f.status) {\r\n                      this.ingest_map(JSON.parse(f.responseText), url, fi)\r\n                    } else {\r\n                      throw new Error('data_handler.ingester.id_maps failed: ' + f.responseText)\r\n                    }\r\n                  }\r\n                }.bind(this, map, i)\r\n                f.open('GET', map, true)\r\n                f.send()\r\n              }\r\n            }\r\n          }\r\n        })\r\n      if (!has_map) {\r\n        this.entity_features[k] = {}\r\n        this.map_entities(k)\r\n      }\r\n    })\r\n}\r\n\r\nexport function map(this: DataHandler, m: EntityFeatures | EntityFeatureSet, url: string, field: number) {\r\n  this.data_maps[url].resource = m\r\n  this.data_maps[url].retrieved = true\r\n  this.data_maps[url].queue.forEach((k: string) => {\r\n    if (this.info[k].schema.fields.length > field) {\r\n      if (!(k in this.entity_features)) this.entity_features[k] = {}\r\n      const features = (\r\n        k in this.data_maps[url].resource ? this.data_maps[url].resource[k] : this.data_maps[url].resource\r\n      ) as EntityFeatures\r\n      this.info[k].schema.fields[field].ids = this.entity_features[k] = features\r\n      this.map_entities(k)\r\n    }\r\n  })\r\n  this.hooks.data_load && this.hooks.data_load()\r\n}\r\n","import DataHandler from './index'\r\nimport type {Order, Data, Variable, VariableView, EntityData, Summary, MeasureInfo} from '../types'\r\nimport {DataViewSelection, SiteDataView} from '../site/dataview'\r\n\r\nfunction sort_a1(a: [string, number], b: [string, number]): number {\r\n  return isNaN(a[1]) ? (isNaN(b[1]) ? 0 : -1) : isNaN(b[1]) ? 1 : a[1] - b[1]\r\n}\r\n\r\nfunction summary_template(): Summary {\r\n  return {\r\n    type: 'number',\r\n    filled: false,\r\n    missing: [],\r\n    n: [],\r\n    sum: [],\r\n    max: [],\r\n    q3: [],\r\n    mean: [],\r\n    range: [],\r\n    norm_median: [],\r\n    break_median: [],\r\n    lower_median_min: [],\r\n    lower_median_range: [],\r\n    upper_median_min: [],\r\n    upper_median_range: [],\r\n    norm_mean: [],\r\n    break_mean: [],\r\n    lower_mean_min: [],\r\n    lower_mean_range: [],\r\n    upper_mean_min: [],\r\n    upper_mean_range: [],\r\n    median: [],\r\n    q1: [],\r\n    min: [],\r\n    mode: [],\r\n    level_ids: {},\r\n    levels: [],\r\n  }\r\n}\r\n\r\nexport function init(this: DataHandler, v: string, d: string) {\r\n  if (!this.inited_summary[d + v]) {\r\n    this.settings.view_names.forEach((view: string) => {\r\n      const vi: Variable = this.variables[v]\r\n      if (!(view in vi.views))\r\n        vi.views[view] = {\r\n          order: {},\r\n          selected_order: {},\r\n          selected_summaries: {},\r\n          summaries: {},\r\n          state: {},\r\n          table: {},\r\n        }\r\n      if (!(d in vi.time_range)) {\r\n        vi.time_range[d] = [0, this.meta.times[d].n - 1]\r\n      }\r\n      const ny = (vi.time_range[d][2] = vi.time_range[d][1] - vi.time_range[d][0] + 1)\r\n      const m: VariableView = vi.views[view],\r\n        c = vi.code\r\n      if (d in this.sets) {\r\n        const da: Data = this.sets[d]\r\n        const n: number = this.info[d].entity_count\r\n        const at = !n || n > 65535 ? Uint32Array : n > 255 ? Uint16Array : Uint8Array\r\n        const info = vi.info[d]\r\n        const is_string = 'string' === info.type\r\n        let o = info.order\r\n        if (o) {\r\n          Object.keys(da).forEach((k: string) => {\r\n            if (!(k in this.entities)) return\r\n            if (!(view in this.entities[k].views))\r\n              this.entities[k].views[view] = {summary: {}, rank: {}, subset_rank: {}}\r\n            this.entities[k].views[view].rank[v] = new at(ny)\r\n            this.entities[k].views[view].subset_rank[v] = new at(ny)\r\n          })\r\n        } else {\r\n          info.order = o = []\r\n          for (let y = ny; y--; ) {\r\n            o.push([])\r\n          }\r\n          Object.keys(da).forEach((k: string) => {\r\n            const dak = da[k] as EntityData\r\n            if ('_meta' !== k && c in dak) {\r\n              const ev: number | number[] = dak[c]\r\n              if (Array.isArray(ev)) {\r\n                for (let y = ny; y--; ) {\r\n                  if (is_string && ev[y] in vi.level_ids) {\r\n                    ev[y] = vi.level_ids[ev[y]]\r\n                  } else if ('number' !== typeof ev[y]) ev[y] = NaN\r\n                  o[y].push([k, ev[y]])\r\n                }\r\n                Object.freeze(ev)\r\n              } else {\r\n                if (is_string && ev in vi.level_ids) {\r\n                  o[0].push([k, vi.level_ids[ev]])\r\n                } else if ('number' !== typeof ev) {\r\n                  dak[c] = NaN\r\n                  o[0].push([k, NaN])\r\n                } else o[0].push([k, ev])\r\n              }\r\n              if (!(k in this.entities)) return\r\n              if (!(view in this.entities[k].views))\r\n                this.entities[k].views[view] = {summary: {}, rank: {}, subset_rank: {}}\r\n              const eview = this.entities[k].views[view]\r\n              if (!(v in eview.rank)) {\r\n                eview.rank[v] = new at(ny)\r\n                eview.subset_rank[v] = new at(ny)\r\n              }\r\n            }\r\n          })\r\n        }\r\n        o.forEach((ev: Order, y: number) => {\r\n          if (!Object.isFrozen(ev)) {\r\n            ev.sort(sort_a1)\r\n            Object.freeze(ev)\r\n          }\r\n          ev.forEach((r, i) => {\r\n            this.entities[r[0]].views[view].rank[v][y] = i\r\n          })\r\n        })\r\n      }\r\n      if (!(d in m.summaries)) {\r\n        m.order[d] = []\r\n        m.selected_order[d] = []\r\n        m.selected_summaries[d] = summary_template()\r\n        const s = summary_template()\r\n        if ('string' === vi.info[d as keyof MeasureInfo].type) {\r\n          s.type = 'string'\r\n          s.level_ids = vi.level_ids\r\n          s.levels = vi.levels\r\n          m.table = {}\r\n          vi.levels.forEach((l: string) => {\r\n            m.table[l] = []\r\n            for (let y = ny; y--; ) m.table[l].push(0)\r\n          })\r\n          for (let y = ny; y--; ) {\r\n            m.order[d].push([])\r\n            m.selected_order[d].push([])\r\n            s.missing.push(0)\r\n            s.n.push(0)\r\n            s.mode.push('')\r\n          }\r\n          m.summaries[d] = s\r\n        } else {\r\n          for (let y = ny; y--; ) {\r\n            m.order[d].push([])\r\n            m.selected_order[d].push([])\r\n            m.selected_summaries[d].n.push(0)\r\n            m.selected_summaries[d].missing.push(0)\r\n            s.missing.push(0)\r\n            s.n.push(0)\r\n            s.sum.push(0)\r\n            s.max.push(-Infinity)\r\n            s.q3.push(0)\r\n            s.mean.push(0)\r\n            s.norm_median.push(0)\r\n            s.break_median.push(-1)\r\n            s.lower_median_min.push(-1)\r\n            s.lower_median_range.push(-1)\r\n            s.upper_median_min.push(-1)\r\n            s.upper_median_range.push(-1)\r\n            s.norm_mean.push(0)\r\n            s.break_mean.push(-1)\r\n            s.lower_mean_min.push(-1)\r\n            s.lower_mean_range.push(-1)\r\n            s.upper_mean_min.push(-1)\r\n            s.upper_mean_range.push(-1)\r\n            s.median.push(0)\r\n            s.q1.push(0)\r\n            s.min.push(Infinity)\r\n          }\r\n          m.summaries[d] = s\r\n        }\r\n        Object.seal(m.order[d])\r\n        Object.seal(m.selected_order[d])\r\n        Object.seal(m.selected_summaries[d])\r\n        Object.seal(m.summaries[d])\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction quantile(p: number, n: number, o: number, x: Order): number {\r\n  const a = p * (n - 1),\r\n    ap = a % 1,\r\n    bp = 1 - ap,\r\n    b = o + Math.ceil(a),\r\n    i = o + Math.floor(a)\r\n  return x[i][1] * ap + x[b][1] * bp\r\n}\r\n\r\nexport async function calculate(this: DataHandler, measure: string, v: SiteDataView, full: boolean): Promise<void> {\r\n  const view = v && v.id\r\n  const dataset: string = v.get.dataset()\r\n  await this.data_processed[dataset]\r\n  const summaryId = dataset + measure\r\n  if (!this.inited_summary[summaryId]) this.init_summary(measure, dataset)\r\n  this.inited_summary[summaryId] = new Promise(resolve => {\r\n    this.summary_ready[summaryId] = resolve\r\n  })\r\n  const variable = this.variables[measure],\r\n    m = variable.views[view]\r\n  if (v.valid[dataset] && m.state[dataset] !== v.state) {\r\n    const summary_set = this.settings.settings.summary_selection as keyof DataViewSelection,\r\n      s = v.selection[summary_set],\r\n      a = v.selection.all,\r\n      mo = m.order[dataset],\r\n      mso = m.selected_order[dataset],\r\n      ny = variable.time_range[dataset][2],\r\n      order = variable.info[dataset].order,\r\n      levels = variable.levels,\r\n      level_ids = variable.level_ids,\r\n      subset = v.n_selected[summary_set] !== v.n_selected.dataset,\r\n      mss = m.selected_summaries[dataset],\r\n      ms = m.summaries[dataset],\r\n      is_string = 'string' === variable.type\r\n    for (let y = ny; y--; ) {\r\n      mo[y] = subset ? [] : order[y]\r\n      mso[y] = subset ? [] : order[y]\r\n      mss.missing[y] = 0\r\n      mss.n[y] = 0\r\n      ms.missing[y] = 0\r\n      ms.n[y] = 0\r\n      if (is_string) {\r\n        ms.mode[y] = ''\r\n        levels.forEach(k => (m.table[k][y] = 0))\r\n      } else {\r\n        ms.sum[y] = 0\r\n        ms.mean[y] = 0\r\n        ms.max[y] = -Infinity\r\n        ms.min[y] = Infinity\r\n        ms.break_mean[y] = -1\r\n        ms.break_median[y] = -1\r\n      }\r\n    }\r\n    order.forEach((o, y) => {\r\n      const moy = mo[y],\r\n        msoy = mso[y]\r\n      let rank = 0\r\n      o.forEach(oi => {\r\n        const k = oi[0],\r\n          value = oi[1]\r\n        if (k in s) {\r\n          const en = s[k].views[view],\r\n            present = !isNaN(value)\r\n          if (!y) {\r\n            if (!(measure in en.summary)) en.summary[measure] = {n: 0, overall: ms, order: mo}\r\n            en.summary[measure].n = 0\r\n          }\r\n          if (full && subset) {\r\n            moy.push(oi)\r\n            if (k in a) {\r\n              msoy.push(oi)\r\n              if (present) {\r\n                mss.n[y]++\r\n              } else mss.missing[y]++\r\n            }\r\n          }\r\n          if (present) {\r\n            en.subset_rank[measure][y] = rank++\r\n            en.summary[measure].n++\r\n            ms.n[y]++\r\n            if (is_string) {\r\n              m.table[levels[value]][y]++\r\n            } else {\r\n              ms.sum[y] += value\r\n              if (value > ms.max[y]) ms.max[y] = value\r\n              if (value < ms.min[y]) ms.min[y] = value\r\n            }\r\n          } else ms.missing[y]++\r\n        }\r\n      })\r\n    })\r\n    if (full) {\r\n      mo.forEach((o, y) => {\r\n        if (is_string) {\r\n          if (ms.n[y]) {\r\n            let l = 0\r\n            Object.keys(m.table).forEach(k => {\r\n              if (m.table[k][y] > m.table[levels[l]][y]) l = level_ids[k]\r\n            })\r\n            ms.mode[y] = levels[l]\r\n          } else ms.mode[y] = ''\r\n        } else {\r\n          if (ms.n[y]) {\r\n            ms.mean[y] = ms.sum[y] / ms.n[y]\r\n            if (!isFinite(ms.min[y])) ms.min[y] = ms.mean[y]\r\n            if (!isFinite(ms.max[y])) ms.max[y] = ms.mean[y]\r\n            ms.range[y] = ms.max[y] - ms.min[y]\r\n            if (1 === ms.n[y]) {\r\n              ms.q3[y] = ms.median[y] = ms.q1[y] = null == o[0][1] ? ms.mean[y] : o[0][1]\r\n            } else {\r\n              ms.median[y] = quantile(0.5, ms.n[y], ms.missing[y], o)\r\n              ms.q3[y] = quantile(0.75, ms.n[y], ms.missing[y], o)\r\n              ms.q1[y] = quantile(0.25, ms.n[y], ms.missing[y], o)\r\n            }\r\n            const n = o.length\r\n            for (let i = ms.missing[y], bmd = false, bme = false; i < n; i++) {\r\n              const v = o[i][1]\r\n              if ('number' === typeof v) {\r\n                if (!bmd && v > ms.median[y]) {\r\n                  ms.break_median[y] = i - 1\r\n                  bmd = true\r\n                }\r\n                if (!bme && v > ms.mean[y]) {\r\n                  ms.break_mean[y] = i - 1\r\n                  bme = true\r\n                }\r\n              }\r\n              if (bmd && bme) break\r\n            }\r\n          } else {\r\n            ms.max[y] = 0\r\n            ms.q3[y] = 0\r\n            ms.median[y] = 0\r\n            ms.q1[y] = 0\r\n            ms.min[y] = 0\r\n          }\r\n          if (ms.n[y]) {\r\n            ms.norm_median[y] = ms.range[y] ? (ms.median[y] - ms.min[y]) / ms.range[y] : 0.5\r\n            if (-1 !== ms.break_median[y]) {\r\n              ms.lower_median_min[y] = ms.norm_median[y] - (o[ms.missing[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.lower_median_range[y] =\r\n                ms.norm_median[y] - ((o[ms.break_median[y]][1] - ms.min[y]) / ms.range[y] - ms.lower_median_min[y])\r\n              ms.upper_median_min[y] = ms.norm_median[y] - (o[ms.break_median[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.upper_median_range[y] =\r\n                (o[o.length - 1][1] - ms.min[y]) / ms.range[y] - ms.norm_median[y] - ms.upper_median_min[y]\r\n            }\r\n            ms.norm_mean[y] = ms.range[y] ? (ms.mean[y] - ms.min[y]) / ms.range[y] : 0.5\r\n            if (-1 !== ms.break_mean[y]) {\r\n              ms.lower_mean_min[y] = ms.norm_mean[y] - (o[ms.missing[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.lower_mean_range[y] =\r\n                ms.norm_mean[y] - ((o[ms.break_mean[y]][1] - ms.min[y]) / ms.range[y] - ms.lower_mean_min[y])\r\n              ms.upper_mean_min[y] = ms.norm_mean[y] - (o[ms.break_mean[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.upper_mean_range[y] =\r\n                (o[o.length - 1][1] - ms.min[y]) / ms.range[y] - ms.norm_mean[y] - ms.upper_mean_min[y]\r\n            }\r\n          }\r\n        }\r\n      })\r\n    } else {\r\n      for (let y = 0; y < ny; y++) {\r\n        if (ms.n[y]) {\r\n          if (is_string) {\r\n            let q1 = 0\r\n            Object.keys(m.table).forEach(k => {\r\n              if (m.table[k][y] > m.table[levels[q1]][y]) q1 = level_ids[k]\r\n            })\r\n            ms.mode[y] = levels[q1]\r\n          } else ms.mean[y] = ms.sum[y] / ms.n[y]\r\n        } else {\r\n          ms[is_string ? 'mode' : 'mean'][y] = NaN\r\n        }\r\n      }\r\n    }\r\n    ms.filled = true\r\n    m.state[dataset] = v.state\r\n    this.summary_ready[summaryId]()\r\n  } else await this.summary_ready[summaryId]\r\n}\r\n","import DataHandler from './index'\r\nimport type {Entity, EntityData, IdMap, MeasureInfo, ResourceField, ResourceFields, Variable} from '../types'\r\n\r\nexport function variables(this: DataHandler) {\r\n  this.metadata.datasets.forEach((k: string) => {\r\n    this.data_queue[k] = {}\r\n    const m = this.info[k]\r\n    if (m) {\r\n      m.id_vars = m.ids.map((id: IdMap) => id.variable)\r\n      m.schema.fields.forEach((v: ResourceField) => {\r\n        const vn = v.name\r\n        if (vn in this.variables) {\r\n          const ve = this.variables[vn]\r\n          ve.datasets.push(k)\r\n          ve.info[k] = v\r\n          if ('string' === v.type) {\r\n            ve.levels = []\r\n            ve.level_ids = {}\r\n            ;((v.info && v.info.levels) || Object.keys(v.table)).forEach(l => {\r\n              if (!(l in ve.level_ids)) {\r\n                ve.level_ids[l] = ve.levels.length\r\n                ve.levels.push(l)\r\n              }\r\n            })\r\n          }\r\n        } else {\r\n          const ve: Variable = (this.variables[vn] = {\r\n            datasets: [k],\r\n            info: {} as ResourceFields,\r\n            time_range: {},\r\n            type: v.type,\r\n            code: vn,\r\n            name: vn,\r\n            meta: v.info,\r\n            levels: [],\r\n            level_ids: {},\r\n            table: {},\r\n            order: [],\r\n            views: {},\r\n          })\r\n          ve.info[k] = v\r\n          if ('string' === v.type) {\r\n            ve.levels = []\r\n            ve.level_ids = {}\r\n            Object.keys(v.table).forEach(l => {\r\n              ve.level_ids[l] = ve.levels.length\r\n              ve.levels.push(l)\r\n            })\r\n          }\r\n          if (!ve.meta)\r\n            ve.meta = {\r\n              full_name: vn,\r\n              measure: vn.split(':')[1] || vn,\r\n              short_name: this.format_label(vn),\r\n              type: v.type || 'unknown',\r\n            }\r\n          ve.meta.full_name = vn\r\n          if (!('measure' in ve.meta)) ve.meta.measure = vn.split(':')[1] || vn\r\n          if (!('short_name' in ve.meta)) ve.meta.short_name = this.format_label(vn)\r\n          if (!('long_name' in ve.meta)) ve.meta.long_name = ve.meta.short_name\r\n          if (!(vn in this.variable_info)) this.variable_info[vn] = ve.meta as MeasureInfo\r\n        }\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\nexport async function entities(this: DataHandler, g: string): Promise<void> {\r\n  if (g in this.sets && !this.inited[g] && g in this.meta.times) {\r\n    const s = this.sets[g],\r\n      time = this.meta.times[g],\r\n      retriever = DataHandler.retrievers[time.is_single ? 'single' : 'multi'],\r\n      datasets = Object.keys(this.sets),\r\n      infos = this.info\r\n    Object.keys(s).forEach((id: string) => {\r\n      const si = s[id] as EntityData,\r\n        l = id.length\r\n      if ('_meta' !== id) {\r\n        const overwrite = this.entity_features[g][id]\r\n        const f = overwrite || {id: id, name: id}\r\n        f.id = id\r\n        if (!f.name) f.name = id\r\n        const e = (\r\n          id in this.entities\r\n            ? this.entities[id]\r\n            : {\r\n                group: g,\r\n                data: si,\r\n                variables: this.variables,\r\n                features: f,\r\n                views: {},\r\n              }\r\n        ) as Entity\r\n        if (id in this.entities) {\r\n          e.group = g\r\n          e.data = si\r\n          e.variables = this.variables\r\n          if (!e.features) e.features = {}\r\n          if (!e.views) e.views = {}\r\n        } else {\r\n          this.entities[id] = e\r\n        }\r\n        if (!(id in this.entity_tree)) this.entity_tree[id] = {parents: {}, children: {}}\r\n        const rel = this.entity_tree[id]\r\n        e.relations = rel\r\n        Object.keys(f).forEach((k: string) => {\r\n          if (!(k in this.features)) this.features[k] = this.format_label(k)\r\n          if ('id' === k || overwrite || !(k in e.features)) {\r\n            e.features[k] = f[k]\r\n          }\r\n          if (-1 !== this.metadata.datasets.indexOf(k)) {\r\n            if (!(f[k] in this.entity_tree)) this.entity_tree[f[k]] = {parents: {}, children: {}}\r\n            this.entity_tree[f[k]].children[id] = rel\r\n            rel.parents[f[k]] = this.entity_tree[f[k]]\r\n          }\r\n        })\r\n        if (infos) {\r\n          datasets.forEach((d: string) => {\r\n            const p = d in infos && infos[d].id_length\r\n            if (p && p < l) {\r\n              const sl = id.substring(0, p)\r\n              if (sl in this.sets[d]) {\r\n                if (!(sl in this.entity_tree)) this.entity_tree[sl] = {parents: {}, children: {}}\r\n                this.entity_tree[sl].children[id] = rel\r\n                rel.parents[sl] = this.entity_tree[sl]\r\n              }\r\n            }\r\n          })\r\n        }\r\n        this.settings.view_names.forEach((v: string) => {\r\n          if (!(v in e.views)) {\r\n            e.views[v] = {summary: {}, rank: {}, subset_rank: {}}\r\n          }\r\n        })\r\n        e.time = time\r\n        e.get_value = retriever.bind(e)\r\n      }\r\n    })\r\n    this.inited[g] = true\r\n    this.data_promise[g]()\r\n    setTimeout(() => {\r\n      if (!this.inited.first) {\r\n        this.hooks.init && this.hooks.init()\r\n        this.inited.first = true\r\n      }\r\n      g in this.data_queue &&\r\n        Object.keys(this.data_queue[g]).forEach((id: string) => {\r\n          this.data_queue[g][id]()\r\n          delete this.data_queue[g][id]\r\n        })\r\n      this.hooks.onload && this.hooks.onload(g)\r\n    }, 0)\r\n  }\r\n  for (const k in this.info) if (Object.prototype.hasOwnProperty.call(this.info, k) && !this.inited[k]) return void 0\r\n  this.all_data_ready()\r\n}\r\n","import {patterns} from './patterns'\r\nimport {Filter, MeasureInfo, MeasureInfos, Query, UnparsedObject} from '../types'\r\nimport * as params from './export_params'\r\nimport {group_checks} from './checks'\r\nimport DataHandler from './index'\r\n\r\nconst ps = {\r\n  any: /\\{(?:categor|variant)/,\r\n  category: /\\{categor(?:y|ies)(\\.[^}]+?)?\\}/g,\r\n  variant: /\\{variants?(\\.[^}]+?)?\\}/g,\r\n  all: /\\{(?:categor(?:y|ies)|variants?)(\\.[^}]+?)?\\}/g,\r\n  desc: /description$/,\r\n}\r\n\r\nfunction replace_dynamic(e: string, p: RegExp, s: UnparsedObject, v?: UnparsedObject, d = 'default'): string {\r\n  p.lastIndex = 0\r\n  for (let m, k; (m = p.exec(e)); ) {\r\n    const ss = v && 'v' === m[0].substring(1, 2) ? v : s\r\n    k = m[1] ? m[1].substring(1) : d\r\n    if (!(k in ss)) {\r\n      if ('description' in ss && ps.desc.test(k)) {\r\n        k = d = 'description'\r\n      } else if (k === d) {\r\n        k = 'default'\r\n      }\r\n    }\r\n    const r = ss[k]\r\n    if ('string' === typeof r) {\r\n      while (e.includes(m[0])) e = e.replace(m[0], r)\r\n      p.lastIndex = 0\r\n    }\r\n  }\r\n  return e\r\n}\r\n\r\nfunction prepare_source(name: string, o: UnparsedObject, s: UnparsedObject, p: RegExp): UnparsedObject {\r\n  const r: UnparsedObject = {name: 'blank' === name ? '' : name}\r\n  Object.keys(o).forEach(n => {\r\n    const e = o[n]\r\n    r[n] = 'string' === typeof e ? replace_dynamic(e, p, s) : e\r\n  })\r\n  if (!('default' in r)) r.default = r.name\r\n  return r\r\n}\r\n\r\nexport function measure_info(info: MeasureInfos): MeasureInfos {\r\n  Object.keys(info).forEach(name => {\r\n    if (ps.any.test(name)) {\r\n      const base = info[name] as MeasureInfo\r\n      const bn = Object.keys(base)\r\n      if (base.categories || base.variants) {\r\n        const categories: {[index: string]: any} = Array.isArray(base.categories) ? {} : base.categories || {}\r\n        const variants: {[index: string]: any} = Array.isArray(base.variants) ? {} : base.variants || {}\r\n        const cats: string[] = Array.isArray(base.categories) ? base.categories : Object.keys(categories)\r\n        if (!cats.length) cats.push('')\r\n        const vars: string[] = Array.isArray(base.variants) ? base.variants : Object.keys(variants)\r\n        if (!vars.length) vars.push('')\r\n        cats.forEach(cn => {\r\n          vars.forEach(vn => {\r\n            const cs = prepare_source(cn, categories[cn] || {}, variants[vn] || {}, ps.variant)\r\n            const vs = prepare_source(vn, variants[vn] || {}, categories[cn] || {}, ps.category)\r\n            const s = {...cs, ...vs}\r\n            const r: any = {}\r\n            bn.forEach((k: keyof MeasureInfo) => {\r\n              if ('categories' !== k && 'variants' !== k) {\r\n                const temp = base[k]\r\n                r[k] = 'string' === typeof temp ? replace_dynamic(temp, ps.all, cs, vs, k) : temp\r\n              }\r\n            })\r\n            Object.keys(s).forEach(k => {\r\n              if (\r\n                !(k in r) &&\r\n                'default' !== k &&\r\n                'name' !== k &&\r\n                ('description' !== k || !(r.long_description || r.short_description))\r\n              )\r\n                r[k] = s[k]\r\n            })\r\n            info[replace_dynamic(name, ps.all, cs, vs)] = r as MeasureInfo\r\n          })\r\n        })\r\n      }\r\n    }\r\n  })\r\n  return info\r\n}\r\n\r\nexport function query(this: DataHandler, q: any): Query {\r\n  const f: UnparsedObject = JSON.parse(JSON.stringify(params.defaults))\r\n  if ('string' === typeof q) {\r\n    if ('?' === q[0]) q = q.substring(1)\r\n    const aq: string[] = q.split('&')\r\n    q = {}\r\n    aq.forEach(aqi => {\r\n      const a = aqi.split('=')\r\n      q[a[0]] = a.length > 1 ? a[1] : ''\r\n    })\r\n  }\r\n  q &&\r\n    Object.keys(q).forEach(k => {\r\n      if ('include' === k || 'exclude' === k || k in f) {\r\n        f[k] = q[k]\r\n      } else {\r\n        let a: string[] = []\r\n        if (patterns.single_operator.test(k)) {\r\n          a = k.replace(patterns.single_operator, '$1=$2').split('=')\r\n          if (a.length > 1) {\r\n            k = a[0]\r\n            q[k] = a[1]\r\n          }\r\n        }\r\n        const aq = patterns.component.exec(k),\r\n          tf: Filter = {\r\n            name: k.replace(patterns.greater, '>').replace(patterns.less, '<'),\r\n            component: 'mean',\r\n            operator: '=',\r\n            value: patterns.number.test(q[k]) ? +q[k] : q[k],\r\n            time_component: false,\r\n            check: () => false,\r\n          }\r\n        if ('object' === typeof q[k]) {\r\n          if ('component' in q[k]) tf.component = q[k].component\r\n          if ('operator' in q[k]) tf.operator = q[k].operator\r\n          if ('value' in q[k]) tf.value = q[k].value\r\n        }\r\n        k = tf.name\r\n        if (aq) {\r\n          if (-1 !== params.options.filter_components.indexOf(aq[2])) {\r\n            tf.component = aq[2]\r\n            tf.name = aq[1]\r\n          } else if (patterns.number.test(aq[2])) {\r\n            const time = +aq[2]\r\n            const i = time > 0 && time < this.meta.overall.value.length ? time : this.meta.overall.value.indexOf(time)\r\n            if (-1 !== i) {\r\n              tf.time_component = true\r\n              tf.component = i\r\n              tf.name = aq[1]\r\n            }\r\n          }\r\n        }\r\n        if (patterns.operator_start.test(k) && k[k.length - 1] in DataHandler.checks) {\r\n          tf.operator = k[k.length - 1]\r\n          if (!a.length) tf.operator += '='\r\n          if (k === tf.name) tf.name = k.substring(0, k.length - 1)\r\n        }\r\n        if (undefined === tf.value || '-1' == tf.value) return\r\n        if (\r\n          ('=' === tf.operator || '!' === tf.operator) &&\r\n          'string' === typeof tf.value &&\r\n          patterns.comma.test(tf.value)\r\n        ) {\r\n          tf.value = tf.value.split(',')\r\n          tf.operator = '=' === tf.operator ? 'includes' : 'excludes'\r\n        }\r\n        if ('time_range' === tf.name) {\r\n          if (Array.isArray(tf.value)) {\r\n            f.time_range = [\r\n              this.meta.overall.value.indexOf(+tf.value[0]),\r\n              this.meta.overall.value.indexOf(+tf.value[1]),\r\n            ]\r\n          } else {\r\n            const i = this.meta.overall.value.indexOf(+tf.value)\r\n            f.time_range =\r\n              '=' === tf.operator ? [i, i] : '>' === tf.operator ? [i, this.meta.overall.value.length - 1] : [0, i]\r\n          }\r\n          if (-1 === f.time_range[0]) f.time_range[0] = 0\r\n          if (-1 === f.time_range[1])\r\n            f.time_range[1] = this.meta.overall.value.length ? this.meta.overall.value.length - 1 : 0\r\n        } else if ('dataset' === tf.name) {\r\n          f.dataset = tf\r\n        } else if (tf.name in this.features) {\r\n          if ('id' === tf.name && !tf.value) tf.value = (tf.value + '').split(',')\r\n          tf.check = group_checks[tf.operator].bind('number' === typeof tf.value ? tf.value + '' : tf.value)\r\n          f.feature_conditions.push(tf)\r\n        } else if (tf.name in this.variables) {\r\n          tf.check = (\r\n            tf.time_component\r\n              ? function (this: {check: Function; condition: Filter}, d: number | number[], adj: number) {\r\n                  const multi = 'number' !== typeof d,\r\n                    i = 'number' === typeof this.condition.component ? this.condition.component - adj : 0\r\n                  return multi\r\n                    ? this.check(d[i], this.condition.value)\r\n                    : !i\r\n                    ? this.check(d, this.condition.value)\r\n                    : false\r\n                }\r\n              : function (this: {check: Function; condition: Filter}, s: {[index: string]: string}) {\r\n                  return this.check(s[this.condition.component], this.condition.value)\r\n                }\r\n          ).bind({check: DataHandler.checks[tf.operator], condition: tf})\r\n          if (-1 === f.variables.filter_by.indexOf(tf.name)) f.variables.filter_by.push(tf.name)\r\n          f.variables.conditions.push(tf)\r\n        }\r\n      }\r\n    })\r\n  if (!('time_range' in f)) f.time_range = [0, this.meta.overall.value.length ? this.meta.overall.value.length - 1 : 0]\r\n  return f as Query\r\n}\r\n","'use strict'\r\nimport {value_checks} from './checks'\r\nimport {exporter} from './exporter'\r\nimport * as retrievers from './retrievers'\r\nimport * as formatter from './formatters'\r\nimport * as ingester from './ingesters'\r\nimport * as summary from './summary'\r\nimport * as mapper from './mappers'\r\nimport * as parser from './parsers'\r\nimport type {\r\n  Settings,\r\n  Variable,\r\n  Metadata,\r\n  MeasureInfos,\r\n  DataSets,\r\n  Features,\r\n  Variables,\r\n  References,\r\n  Entities,\r\n  Relations,\r\n  MetaTime,\r\n  LogicalObject,\r\n  Promises,\r\n  DataMaps,\r\n  DataResource,\r\n  MeasureInfo,\r\n  DataPackage,\r\n  EntityFeatureSet,\r\n  Entity,\r\n} from '../types'\r\nimport {SiteDataView} from '../site/dataview'\r\n\r\nexport default class DataHandler {\r\n  constructor(\r\n    settings?: Settings,\r\n    defaults?: {[index: string]: string},\r\n    data?: DataSets,\r\n    hooks?: {[index: string]: Function}\r\n  ) {\r\n    this.defaults = defaults || {}\r\n    this.settings = settings || {}\r\n    this.metadata = this.settings.metadata || {datasets: []}\r\n    this.sets = data || {}\r\n    this.hooks = hooks || {}\r\n    this.get_value = this.get_value.bind(this)\r\n    this.dynamic_load = 'dataviews' in this.settings && this.settings.settings && !!this.settings.settings.partial_init\r\n    this.settings.view_names = this.dynamic_load ? Object.keys(this.settings.dataviews) : ['default_view']\r\n    if ('string' === typeof this.metadata.datasets) this.metadata.datasets = [this.metadata.datasets]\r\n    const init = () => {\r\n      if (!this.metadata.datasets || !this.metadata.datasets.length) {\r\n        this.metadata.datasets = Object.keys(this.info)\r\n        if (!this.metadata.datasets.length) this.metadata.datasets = Object.keys(this.sets)\r\n      }\r\n      if (this.metadata.measure_info) {\r\n        const info = parser.measure_info(this.metadata.measure_info)\r\n        this.metadata.datasets.forEach((d: string) => {\r\n          if (info._references) this.info[d]._references = info._references\r\n          const v = this.info[d].schema.fields\r\n          v.forEach(e => (e.name in info ? (e.info = info[e.name] as MeasureInfo) : ''))\r\n        })\r\n      }\r\n      this.map_variables()\r\n      if (this.metadata.datasets.length) {\r\n        this.metadata.datasets.forEach((k: string) => {\r\n          this.loaded[k] = k in this.sets\r\n          this.inited[k] = false\r\n          this.data_processed[k] = new Promise(resolve => {\r\n            this.data_promise[k] = resolve\r\n          })\r\n          if (k in this.info)\r\n            this.info[k].site_file = (this.metadata.url ? this.metadata.url + '/' : '') + this.info[k].name + '.json'\r\n          if (this.loaded[k]) {\r\n            this.ingest_data(this.sets[k], k)\r\n          } else if (\r\n            !this.dynamic_load ||\r\n            (this.settings.settings && !this.settings.settings.partial_init) ||\r\n            !this.defaults.dataset ||\r\n            k === this.defaults.dataset\r\n          ) {\r\n            this.retrieve(k, this.info[k].site_file)\r\n          }\r\n        })\r\n      } else {\r\n        setTimeout(() => {\r\n          this.inited.first = true\r\n          this.hooks.init && this.hooks.init()\r\n          this.hooks.onload && this.hooks.onload()\r\n        }, 0)\r\n      }\r\n    }\r\n    if (this.metadata.package && !this.metadata.info) {\r\n      if ('undefined' === typeof window) {\r\n        require('https')\r\n          .get(this.metadata.url + this.metadata.package, (r: {on: Function}) => {\r\n            const c: string[] = []\r\n            r.on('data', (d: string) => {\r\n              c.push(d)\r\n            })\r\n            r.on('end', () => {\r\n              this.info = {}\r\n              const dp: DataPackage = JSON.parse(c.join(''))\r\n              if (dp.measure_info) this.metadata.measure_info = dp.measure_info\r\n              dp.resources.forEach((r: DataResource) => (this.info[r.name] = r))\r\n              init()\r\n            })\r\n          })\r\n          .end()\r\n      } else {\r\n        const f = new window.XMLHttpRequest()\r\n        f.onreadystatechange = () => {\r\n          if (4 === f.readyState) {\r\n            if (200 === f.status) {\r\n              this.info = {}\r\n              const dp = JSON.parse(f.responseText)\r\n              if (dp.measure_info) this.metadata.measure_info = dp.measure_info\r\n              dp.resources.forEach((r: DataResource) => (this.info[r.name] = r))\r\n              init()\r\n            } else {\r\n              throw new Error('failed to load datapackage: ' + f.responseText)\r\n            }\r\n          }\r\n        }\r\n        f.open('GET', this.metadata.url + this.metadata.package)\r\n        f.send()\r\n      }\r\n    } else {\r\n      if (this.metadata.info) this.info = this.metadata.info\r\n      init()\r\n    }\r\n  }\r\n  hooks: {[index: string]: Function} = {}\r\n  defaults: {[index: string]: string} = {dataview: 'default_view', time: 'time'}\r\n  settings: Settings = {}\r\n  metadata: Metadata = {datasets: []}\r\n  info: {[index: string]: DataResource} = {}\r\n  sets: DataSets = {}\r\n  dynamic_load = false\r\n  all_data_ready: Function = () => false\r\n  data_ready: Promise<void> = new Promise(resolve => {\r\n    this.all_data_ready = resolve\r\n  })\r\n  features: Features = {}\r\n  variables: Variables = {}\r\n  variable_codes: Variables = {}\r\n  variable_info: MeasureInfos = {}\r\n  references: References = {}\r\n  entities: Entities = {}\r\n  entity_tree: {[index: string]: Relations} = {}\r\n  meta: MetaTime = {\r\n    times: {},\r\n    variables: {},\r\n    ranges: {},\r\n    overall: {\r\n      range: [Infinity, -Infinity],\r\n      value: [],\r\n    },\r\n  }\r\n  loaded: LogicalObject = {}\r\n  onload: () => {}\r\n  inited: {[index: string]: number | NodeJS.Timeout | boolean} = {}\r\n  inited_summary: Promises = {}\r\n  summary_ready: {[index: string]: Function} = {}\r\n  entity_features: EntityFeatureSet = {}\r\n  data_maps: DataMaps = {}\r\n  data_queue: {[index: string]: {[index: string]: Function}} = {}\r\n  data_promise: {[index: string]: Function} = {}\r\n  data_processed: Promises = {}\r\n  load_requests: {[index: string]: string} = {}\r\n  retrieve = async function (this: DataHandler, name: string, url: string) {\r\n    if (!this.load_requests[name]) {\r\n      this.load_requests[name] = url\r\n      const f = new window.XMLHttpRequest()\r\n      f.onreadystatechange = () => {\r\n        if (4 === f.readyState) {\r\n          if (200 === f.status) {\r\n            this.ingest_data(JSON.parse(f.responseText), name)\r\n          } else {\r\n            throw new Error('DataHandler.retrieve failed: ' + f.responseText)\r\n          }\r\n        }\r\n      }\r\n      f.open('GET', url, true)\r\n      f.send()\r\n    }\r\n  }\r\n  format_value = formatter.value\r\n  format_label = formatter.label\r\n  ingest_data = ingester.data\r\n  ingest_map = ingester.map\r\n  load_id_maps = ingester.id_maps\r\n  init_summary = summary.init\r\n  calculate_summary = summary.calculate\r\n  map_variables = mapper.variables\r\n  map_entities = mapper.entities\r\n  parse_query = parser.query\r\n  export = exporter\r\n  get_variable = async function (this: DataHandler, variable: string, view: SiteDataView): Promise<Variable> {\r\n    if (variable in this.variables) await this.calculate_summary(variable, view, true)\r\n    return this.variables[variable]\r\n  }\r\n  get_value = function vector(this: DataHandler, r: {variable: string; entity: Entity}): number[] {\r\n    if (this.variables[r.variable].is_time) {\r\n      return r.entity.time.value as number[]\r\n    } else {\r\n      const v = this.variables[r.variable].code\r\n      return (\r\n        v in r.entity.data ? (Array.isArray(r.entity.data[v]) ? r.entity.data[v] : [r.entity.data[v]]) : [NaN]\r\n      ) as number[]\r\n    }\r\n  }\r\n  public static retrievers = retrievers\r\n  public static checks = value_checks\r\n}\r\n","export const defaults: {[index: string]: string} = {\r\n  time: 'time',\r\n  dataview: 'default_view',\r\n  palette: 'vik',\r\n  background_highlight: '#adadad',\r\n  border: '#7e7e7e',\r\n  border_highlight_true: '#ffffff',\r\n  border_highlight_false: '#000000',\r\n  missing: '#00000000',\r\n}\r\n","import type Community from './index'\r\nimport type {Entities, Entity, FilterParsed, LogicalObject} from '../types'\r\nimport type {DataViewParsed} from './dataview'\r\n\r\nexport class GlobalView {\r\n  site: Community\r\n  registered: LogicalObject = {}\r\n  selection: Entities = {}\r\n  entities: Map<string, Entity> = new Map()\r\n  selected: string[] = []\r\n  select_ids: {[index: string]: boolean} = {}\r\n  filters: Map<string, FilterParsed> = new Map()\r\n  times: number[]\r\n  dataview: DataViewParsed\r\n  states = {\r\n    id_state: 'initial',\r\n    filter_state: 'initial',\r\n  }\r\n  constructor(site: Community) {\r\n    this.site = site\r\n  }\r\n  init() {\r\n    this.times = this.site.data.meta.overall.value\r\n    this.dataview = this.site.dataviews[this.site.defaults.dataview].parsed\r\n  }\r\n  filter_state(q?: string[], agg?: number) {\r\n    const as_state = !q\r\n    if (as_state) q = []\r\n    this.filters.forEach(f => {\r\n      const component =\r\n        'selected' === f.component\r\n          ? this.times['undefined' === typeof agg ? this.dataview.time_agg : agg]\r\n          : f.time_component\r\n          ? this.times[f.component as number]\r\n          : f.component\r\n      if (f.value) q.push(f.variable + '[' + component + ']' + f.operator + f.value + (as_state ? f.active : ''))\r\n    })\r\n    return q.join('&')\r\n  }\r\n  id_state() {\r\n    return Object.keys(this.select_ids).join(',')\r\n  }\r\n  id_filter() {\r\n    const ids: {[index: string]: boolean} = {}\r\n    this.selected = []\r\n    this.select_ids = ids\r\n    if (this.site.data.metadata.datasets) {\r\n      const inputs = this.site.page.modal.filter.entity_inputs\r\n      this.site.data.metadata.datasets.forEach(d => {\r\n        if (d in inputs) {\r\n          const s = inputs[d].value() as string[],\r\n            cs: string[] = []\r\n          if (Array.isArray(s)) {\r\n            s.forEach(id => {\r\n              const e = this.site.data.entities[id]\r\n              if (e) {\r\n                cs.push(id)\r\n                this.selected.push(id)\r\n                ids[id] = true\r\n                if (e.relations) {\r\n                  Object.keys(e.relations.parents).forEach(k => (ids[k] = true))\r\n                  Object.keys(e.relations.children).forEach(k => (ids[k] = true))\r\n                }\r\n              }\r\n            })\r\n            inputs[d].source = cs\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n","export const patterns = {\r\n  seps: /[\\s,/._-]+/g,\r\n  period: /\\./,\r\n  all_periods: /\\./g,\r\n  word_start: /\\b(\\w)/g,\r\n  settings: /^settings?\\./,\r\n  features: /^features?\\./,\r\n  filter: /^filter\\./,\r\n  data: /^data\\./,\r\n  variables: /^variables?\\./,\r\n  properties: /prop/,\r\n  palette: /^pal/,\r\n  datasets: /^dat/,\r\n  variable: /^var/,\r\n  levels: /^lev/,\r\n  ids: /^ids/,\r\n  minmax: /^m[inax]{2}$/,\r\n  int_types: /^(?:year|int|integer)$/,\r\n  end_punct: /[.?!]$/,\r\n  mustache: /\\{([^}]+)\\}/g,\r\n  measure_name: /(?:^measure|_name)$/,\r\n  http: /^https?:\\/\\//,\r\n  bool: /^(?:true|false)$/,\r\n  number: /^[\\d-][\\d.,]*$/,\r\n  leading_zeros: /^0+/,\r\n  url_spaces: /%20/g,\r\n  hashes: /#/g,\r\n  embed_setting: /^(?:hide_|navcolor|close_menus)/,\r\n  median: /^med/i,\r\n  location_string: /^[^?]*/,\r\n  time_ref: /\\{time\\}/g,\r\n  pre_colon: /^[^:]*:/,\r\n  exclude_query: /^(?:features|time_range|id)$/,\r\n  space: /\\s+/,\r\n  has_html: /<(?:math|a|br)[/\\s>]/,\r\n  href: /\\\\(?:href|url)\\{([^}]+)\\}(?:\\{([^}]+)\\})?/g,\r\n  bracket_content: /(?:^|>)[^<]*(?:<|$)/,\r\n  html_tags: /^(?:semantics|m|a|br)/,\r\n  html_attributes:\r\n    /^(?:xmlns|display|style|encoding|stretchy|alttext|scriptlevel|fence|math|separator|href|rel|target)/,\r\n  id_escapes: /(?<=#[^\\s]+)([.[\\](){}?*-])/g,\r\n  repo: /\\.com[/:]([^\\/]+\\/[^\\/]+)/,\r\n  basename: /^.*\\//,\r\n}\r\n","import type {Generic} from '../types'\r\n\r\nexport const storage: {\r\n  name: string\r\n  perm: Storage\r\n  copy: Generic\r\n  set(opt: string, value: boolean | string | number): void\r\n  get(opt?: string): string | number | boolean | Generic\r\n} = {\r\n  name: window.location.pathname || 'default',\r\n  perm: window.localStorage,\r\n  copy: {},\r\n  set: function (opt: string, value: boolean | string | number) {\r\n    const s: Generic = JSON.parse(this.perm.getItem(this.name) || '{}')\r\n    s[opt] = value\r\n    this.perm.setItem(this.name, JSON.stringify(s))\r\n  },\r\n  get: function (opt?: string) {\r\n    const s: Generic = JSON.parse(this.perm.getItem(this.name) || '{}')\r\n    return opt ? s[opt] : s\r\n  },\r\n}\r\n","import type {Entity} from '../types'\r\nimport type Community from './index'\r\nimport type {SiteOutputs} from './outputs/index'\r\n\r\nexport class Subscriptions {\r\n  site: Community\r\n  subs: {[index: string]: Map<string, SiteOutputs>}\r\n  constructor(site: Community) {\r\n    this.site = site\r\n    this.subs = {}\r\n  }\r\n  add(id: string, o: SiteOutputs) {\r\n    if (!(id in this.subs)) this.subs[id] = new Map()\r\n    this.subs[id].set(o.id, o)\r\n  }\r\n  update(id: string, fun: string, e: Entity) {\r\n    if (id in this.subs) {\r\n      const tu = this.site.outputs[id]\r\n      this.subs[id].forEach(u => {\r\n        if (fun in u) (u[fun as keyof SiteOutputs] as Function)(e, tu)\r\n      })\r\n    }\r\n  }\r\n}\r\n","export const keymap = {\r\n  Enter: 'select',\r\n  NumpadEnter: 'select',\r\n  ArrowUp: 'move',\r\n  Home: 'move',\r\n  ArrowDown: 'move',\r\n  End: 'move',\r\n  Escape: 'close',\r\n  Tab: 'close',\r\n}\r\nexport const filter_components = {\r\n  Time: ['first', 'selected', 'last'],\r\n  summary: ['missing', 'min', 'q1', 'mean', 'median', 'q3', 'max'],\r\n}\r\n\r\nexport const tooltip_icon_rule =\r\n  'button.has-note::after,.button-wrapper.has-note ' +\r\n  'button::before,.has-note legend::before,.has-note ' +\r\n  'label::before,.wrapper.has-note > div > label::before{display:none}'\r\n","import type {MeasureInfo, MeasureSource, OptionSets, ResourceField, SlimNote} from '../types'\r\nimport type {InputCombobox} from './inputs/combobox'\r\nimport type {SiteInputs} from './inputs/index'\r\nimport type {InputSelect} from './inputs/select'\r\nimport {patterns} from './patterns'\r\n\r\nexport function set_description(e: HTMLElement, info: MeasureInfo) {\r\n  let description = info.long_description || info.description || info.short_description || ''\r\n  const subs: Map<string, string> = new Map()\r\n  for (let l; (l = patterns.href.exec(description)); ) {\r\n    subs.set(l[0], '<a href=\"' + l[1] + '\" target=\"_blank\" rel=\"noreferrer\">' + (l.length > 2 ? l[2] : l[1]) + '</a>')\r\n  }\r\n  if (subs.size) {\r\n    subs.forEach((f, r) => {\r\n      description = description.replace(r, f)\r\n    })\r\n  }\r\n  let has_html = patterns.has_html.test(description)\r\n  if (has_html) {\r\n    const tags = description.split(patterns.bracket_content)\r\n    for (let i = tags.length; i--; ) {\r\n      const t = tags[i]\r\n      if (t && '/' !== t.substring(0, 1)) {\r\n        const p = t.split(patterns.space),\r\n          n = p.length\r\n        has_html = patterns.html_tags.test(p[0])\r\n        if (!has_html) break\r\n        for (let a = 1; a < n; a++) {\r\n          has_html = patterns.html_attributes.test(p[a])\r\n          if (!has_html) break\r\n        }\r\n        if (!has_html) break\r\n      }\r\n    }\r\n  }\r\n  e[has_html ? 'innerHTML' : 'innerText'] = description\r\n}\r\n\r\nexport function toggle_input(u: InputCombobox | InputSelect, enable?: boolean) {\r\n  if (enable && !u.e.classList.contains('locked')) {\r\n    u.e.removeAttribute('disabled')\r\n    u.e.classList.remove('disabled')\r\n    if ('combobox' === u.type) u.input_element.removeAttribute('disabled')\r\n  } else {\r\n    u.e.setAttribute('disabled', 'true')\r\n    u.e.classList.add('disabled')\r\n    if ('combobox' === u.type) u.input_element.setAttribute('disabled', 'true')\r\n  }\r\n}\r\n\r\nexport function fill_ids_options(u: InputCombobox | InputSelect, d: string, out: OptionSets, onend?: Function) {\r\n  if (!(d in u.site.data.sets)) {\r\n    u.site.data.data_queue[d][u.id] = () => {\r\n      u.loader && u.e.removeEventListener('click', u.loader)\r\n      fill_ids_options(u, d, out, onend)\r\n      u.set_current()\r\n      u.current_set = d\r\n    }\r\n    return\r\n  }\r\n  out[d] = {options: [], values: {}, display: {}}\r\n  const current = u.values,\r\n    s = out[d].options as HTMLOptionElement[],\r\n    values = out[d].values,\r\n    disp = out[d].display,\r\n    combobox = 'combobox' === u.type\r\n  let ck = !u.sensitive && !!u.current_set,\r\n    n = 0\r\n  if (u.settings.group) {\r\n    out[d].groups = {e: [], by_name: {}}\r\n    if (combobox && u.settings.accordion) {\r\n      u.listbox.classList.add('accordion')\r\n      u.listbox.id = u.id + '-listbox'\r\n    }\r\n  }\r\n  const ugroup = out[d].groups\r\n  Object.keys(u.site.data.entities).forEach(k => {\r\n    const entity = u.site.data.entities[k]\r\n    if (d === entity.group) {\r\n      if (ck && !(k in current)) {\r\n        u.sensitive = true\r\n        ck = false\r\n      }\r\n      if (ugroup) {\r\n        let groups = entity.features[u.settings.group] || ['No Group']\r\n        if (!Array.isArray(groups)) groups = [groups]\r\n        for (let g = groups.length; g--; ) {\r\n          const group: string = groups[g]\r\n          if (!(group in ugroup.by_name)) {\r\n            const e = document.createElement(combobox ? 'div' : 'optgroup')\r\n            if (combobox) {\r\n              const id = u.id + '_' + group.replace(patterns.seps, '-')\r\n              let ee\r\n              if (u.settings.accordion) {\r\n                e.setAttribute('data-group', group)\r\n                e.className = 'combobox-group accordion-item combobox-component'\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.className = 'accordion-header combobox-component'\r\n                ee.appendChild((ee = document.createElement('button')))\r\n                ee.id = id + '-label'\r\n                ee.innerText = group\r\n                ee.type = 'button'\r\n                ee.className = 'accordion-button combobox-component collapsed'\r\n                ee.setAttribute('data-bs-toggle', 'collapse')\r\n                ee.setAttribute('data-bs-target', '#' + id)\r\n                ee.setAttribute('aria-expanded', 'false')\r\n                ee.setAttribute('aria-controls', id)\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.id = id\r\n                ee.className = 'combobox-component accordion-collapse collapse'\r\n                ee.setAttribute('data-bs-parent', '#' + u.id + '-listbox')\r\n                ee.appendChild((ee = document.createElement('div')))\r\n                ee.className = 'accordion-body combobox-component'\r\n                ee.role = 'group'\r\n                ee.setAttribute('aria-labelledby', id + '-label')\r\n              } else {\r\n                e.className = 'combobox-group combobox-component'\r\n                e.id = id\r\n                e.role = 'group'\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.appendChild((ee = document.createElement('label')))\r\n                ee.dataset.for = id\r\n                ee.innerText = group\r\n                ee.id = id + '-label'\r\n                ee.className = 'combobox-group-label combobox-component'\r\n              }\r\n            } else {\r\n              e.setAttribute('aria-label', group)\r\n            }\r\n            ugroup.by_name[group] = e\r\n            ugroup.e.push(e)\r\n          }\r\n          const o = u.add(k, entity.features.name, true)\r\n          o.setAttribute('data-group', group)\r\n          if (combobox && u.settings.accordion) {\r\n            ugroup.by_name[group].lastElementChild.lastElementChild.appendChild(o)\r\n          } else {\r\n            ugroup.by_name[group].appendChild(o)\r\n          }\r\n        }\r\n      } else {\r\n        s.push(u.add(k, entity.features.name) as HTMLOptionElement)\r\n        values[k] = n\r\n        disp[entity.features.name] = n++\r\n      }\r\n    }\r\n  })\r\n  if (u.settings.group) {\r\n    n = 0\r\n    Object.keys(ugroup.by_name).forEach(g => {\r\n      ugroup.by_name[g].querySelectorAll(combobox ? '.combobox-option' : 'option').forEach((c: HTMLOptionElement) => {\r\n        s.push(c)\r\n        values[combobox ? c.dataset.value : c.value] = n\r\n        disp[c.innerText] = n++\r\n      })\r\n    })\r\n  }\r\n  onend && onend()\r\n}\r\n\r\nexport function fill_variables_options(u: InputCombobox | InputSelect, d: string, out: OptionSets) {\r\n  out[d] = {options: [], values: {}, display: {}}\r\n  const current = u.values,\r\n    s = out[d].options as HTMLOptionElement[],\r\n    values = out[d].values,\r\n    disp = out[d].display,\r\n    combobox = 'combobox' === u.type\r\n  let ck = !u.sensitive && !!u.current_set,\r\n    n = 0\r\n  if (u.settings.group) {\r\n    out[d].groups = {e: [], by_name: {}}\r\n    if (combobox && u.settings.accordion) {\r\n      u.listbox.classList.add('accordion')\r\n      u.listbox.id = u.id + '-listbox'\r\n    }\r\n  }\r\n  const url_set = u.site.url_options[u.id] as string,\r\n    ugroup = out[d].groups\r\n  let ck_suffix = false\r\n  if (url_set && !(url_set in u.site.data.variables)) {\r\n    u.site.url_options[u.id] = url_set.replace(patterns.pre_colon, '')\r\n    if (!(url_set in u.site.data.variables)) ck_suffix = true\r\n  }\r\n  u.site.data.info[d].schema.fields.forEach(m => {\r\n    const v = u.site.data.variables[m.name]\r\n    if (v && !v.is_time) {\r\n      const l = u.site.data.format_label(m.name)\r\n      if (ck && !(m.name in current)) {\r\n        u.sensitive = true\r\n        ck = false\r\n      }\r\n      if (ugroup) {\r\n        let groups = (m.info && m.info[u.settings.group as keyof MeasureInfo]) || ['No Group']\r\n        if (!Array.isArray(groups)) groups = [groups as string]\r\n        for (let g = groups.length; g--; ) {\r\n          const group = groups[g] as string\r\n          if (!(group in ugroup.by_name)) {\r\n            const e = document.createElement(combobox ? 'div' : 'optgroup')\r\n            if (combobox) {\r\n              const id = u.id + '_' + group.replace(patterns.seps, '-')\r\n              let ee\r\n              if (u.settings.accordion) {\r\n                e.dataset.group = group\r\n                e.className = 'combobox-group accordion-item combobox-component'\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.className = 'accordion-header combobox-component'\r\n                ee.appendChild((ee = document.createElement('button')))\r\n                ee.id = id + '-label'\r\n                ee.innerText = group\r\n                ee.type = 'button'\r\n                ee.className = 'accordion-button combobox-component collapsed'\r\n                ee.setAttribute('data-bs-toggle', 'collapse')\r\n                ee.setAttribute('data-bs-target', '#' + id)\r\n                ee.setAttribute('aria-expanded', 'false')\r\n                ee.setAttribute('aria-controls', id)\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.id = id\r\n                ee.className = 'combobox-component accordion-collapse collapse'\r\n                ee.setAttribute('data-bs-parent', '#' + u.id + '-listbox')\r\n                ee.appendChild((ee = document.createElement('div')))\r\n                ee.className = 'accordion-body combobox-component'\r\n                ee.role = 'group'\r\n                ee.setAttribute('aria-labelledby', id + '-label')\r\n              } else {\r\n                e.className = 'combobox-group combobox-component'\r\n                e.role = 'group'\r\n                e.appendChild((ee = document.createElement('div')))\r\n                ee.appendChild((ee = document.createElement('label')))\r\n                ee.dataset.for = id\r\n                ee.innerText = group\r\n                ee.id = id\r\n                ee.className = 'combobox-group-label combobox-component'\r\n              }\r\n            } else {\r\n              e.setAttribute('aria-label', group)\r\n            }\r\n            ugroup.by_name[group] = e\r\n            ugroup.e.push(e)\r\n          }\r\n          const o = u.add(m.name, l, true, m)\r\n          o.dataset.group = group\r\n          if (combobox && u.settings.accordion) {\r\n            ugroup.by_name[group].lastElementChild.lastElementChild.appendChild(o)\r\n          } else {\r\n            ugroup.by_name[group].appendChild(o)\r\n          }\r\n        }\r\n      } else {\r\n        s.push(u.add(m.name, l, true, m) as HTMLOptionElement)\r\n        s[n].id = u.id + '-option' + n\r\n        values[m.name] = n\r\n        disp[l] = n++\r\n      }\r\n      if (ck_suffix && url_set === m.name.replace(patterns.pre_colon, '')) {\r\n        u.site.url_options[u.id] = m.name\r\n        ck_suffix = false\r\n      }\r\n    }\r\n  })\r\n  if (u.settings.group) {\r\n    n = 0\r\n    Object.keys(ugroup.by_name).forEach(g => {\r\n      ugroup.by_name[g].querySelectorAll(combobox ? '.combobox-option' : 'option').forEach((c: HTMLOptionElement) => {\r\n        s.push(c)\r\n        s[n].id = u.id + '-option' + n\r\n        values[combobox ? c.dataset.value : c.value] = n\r\n        disp[(c.firstChild && c.firstChild.textContent) || c.innerText] = n++\r\n      })\r\n    })\r\n  }\r\n  if (!u.settings.clearable && !(u.default in u.site.data.variables)) u.default = u.site.defaults.variable\r\n}\r\n\r\nexport function fill_overlay_properties_options(u: InputCombobox | InputSelect, source: string, out: OptionSets) {\r\n  out[source] = {options: [], values: {}, display: {}}\r\n  const current = u.values,\r\n    s = out[source].options as HTMLOptionElement[],\r\n    values = out[source].values,\r\n    disp = out[source].display,\r\n    combobox = 'combobox' === u.type\r\n  let ck = !u.sensitive && !!u.current_set,\r\n    n = 0\r\n  Object.keys(u.site.maps.queue[source].property_summaries).forEach(v => {\r\n    const l = u.site.data.format_label(v)\r\n    if (ck && !(l in current)) {\r\n      u.sensitive = true\r\n      ck = false\r\n    }\r\n    s.push(u.add(v, l) as HTMLOptionElement)\r\n    s[n].id = u.id + '-option' + n\r\n    values[v] = n\r\n    disp[l] = n++\r\n  })\r\n}\r\n\r\nexport function fill_levels_options(u: InputCombobox | InputSelect, d: string, v: string, out: OptionSets) {\r\n  const m = u.site.data.variables[v].info[d],\r\n    t = 'string' === m.type ? 'levels' : 'ids',\r\n    l = m[t]\r\n  if (l) {\r\n    const k = d + v\r\n    out[k] = {options: [], values: {}, display: {}}\r\n    const current = u.values,\r\n      s = out[k].options as HTMLOptionElement[],\r\n      values = out[k].values,\r\n      disp = out[k].display\r\n    let ck = !u.sensitive && !!u.current_set,\r\n      n = 0\r\n    Object.keys(l).forEach(k => {\r\n      const lk = l[k]\r\n      if (ck && !(k in current)) {\r\n        u.sensitive = true\r\n        ck = false\r\n      }\r\n      s.push(u.add(lk.id, lk.name, true) as HTMLOptionElement)\r\n      values[lk.id] = n\r\n      disp[lk.name] = n++\r\n    })\r\n  } else if ('ids' === t) {\r\n    u.site.data.data_queue[d][u.id] = function () {\r\n      return fill_levels_options(u, d, v, out)\r\n    }\r\n  }\r\n}\r\n\r\nexport function tooltip_trigger(this: SiteInputs | SlimNote): void {\r\n  if (this.site.spec.settings.hide_tooltips || this.id === this.site.page.tooltip.showing) return void 0\r\n  const tooltip = this.site.page.tooltip\r\n  tooltip.showing = this.id\r\n  ;(tooltip.e.firstElementChild as HTMLElement).innerText = this.note\r\n  tooltip.e.classList.remove('hidden')\r\n  const p = this.wrapper.getBoundingClientRect(),\r\n    t = tooltip.e.getBoundingClientRect()\r\n  tooltip.e.style.left = Math.max(0, Math.min(p.x, p.x + p.width / 2 - t.width / 2)) + 'px'\r\n  tooltip.e.style.top = p.y + (p.y < t.height ? p.height + 5 : -t.height - 5) + 'px'\r\n}\r\n\r\nexport function make_summary_table(\r\n  formatter: (v: number) => string | number,\r\n  parent: HTMLElement,\r\n  summary?: ResourceField,\r\n  additional?: {[index: string]: string}\r\n) {\r\n  parent.classList.add('info-summary-wrapper')\r\n  const table = document.createElement('table'),\r\n    headers = document.createElement('tr'),\r\n    row = document.createElement('tr')\r\n  table.className = 'info-summary'\r\n  table.appendChild(document.createElement('thead'))\r\n  table.appendChild(document.createElement('tbody'))\r\n  table.firstElementChild.appendChild(headers)\r\n  table.lastElementChild.appendChild(row)\r\n  if (additional) {\r\n    Object.keys(additional).forEach(h => {\r\n      const th = document.createElement('th'),\r\n        td = document.createElement('td')\r\n      headers.appendChild(th)\r\n      th.innerText = h\r\n      row.appendChild(td)\r\n      td.innerText = additional[h]\r\n    })\r\n  }\r\n  ;['NAs', 'Min', 'Q1', 'Mean', 'Median', 'Q3', 'Max'].forEach(h => {\r\n    const lower = h.toLowerCase() as keyof ResourceField\r\n    if (!summary || lower in summary) {\r\n      const th = document.createElement('th'),\r\n        td = document.createElement('td')\r\n      headers.appendChild(th)\r\n      th.innerText = h\r\n      row.appendChild(td)\r\n      td.innerText = summary ? formatter(summary[lower] as number) + '' : 'NA'\r\n    }\r\n  })\r\n  parent.appendChild(table)\r\n  return table\r\n}\r\n\r\nexport function make_variable_source(s: MeasureSource, table?: boolean) {\r\n  const e = document.createElement(table ? 'tr' : 'div')\r\n  let div = document.createElement('div'),\r\n    a = document.createElement('a'),\r\n    span = document.createElement('span'),\r\n    td = document.createElement('td'),\r\n    p = document.createElement('p')\r\n  if (table) {\r\n    if (s.name) {\r\n      e.appendChild(td)\r\n      if (s.url) {\r\n        td.appendChild(a)\r\n        a.target = '_blank'\r\n        a.rel = 'noreferrer'\r\n        a.href = s.url\r\n        a.innerText = s.name\r\n      } else {\r\n        td.appendChild(span)\r\n        span.innerText = s.name\r\n      }\r\n    }\r\n    if (s.date_accessed) {\r\n      e.appendChild((td = document.createElement('td')))\r\n      td.appendChild((span = document.createElement('span')))\r\n      span.innerText = s.date_accessed\r\n    }\r\n  } else {\r\n    e.className = 'card'\r\n    if (s.name) {\r\n      e.appendChild(div)\r\n      div.className = 'card-header'\r\n      if (s.url) {\r\n        div.appendChild(a)\r\n        a.target = '_blank'\r\n        a.rel = 'noreferrer'\r\n        a.href = s.url\r\n        a.innerText = s.name\r\n      } else {\r\n        div.appendChild(span)\r\n        span.innerText = s.name\r\n      }\r\n    }\r\n    e.appendChild(document.createElement('div'))\r\n    e.lastElementChild.className = 'card-body'\r\n    if (s.location) {\r\n      e.lastElementChild.appendChild(p)\r\n      p.appendChild((span = document.createElement('span')))\r\n      span.innerText = 'Location: '\r\n      p.appendChild((span = document.createElement('span')))\r\n      if (s.location_url) {\r\n        span.appendChild((a = document.createElement('a')))\r\n        a.target = '_blank'\r\n        a.rel = 'noreferrer'\r\n        a.href = s.location_url\r\n        a.innerText = s.location\r\n      } else {\r\n        span.innerText = s.location\r\n      }\r\n    }\r\n    if (s.date_accessed) {\r\n      e.lastElementChild.appendChild((p = document.createElement('p')))\r\n      p.appendChild((span = document.createElement('span')))\r\n      span.innerText = 'Date Accessed: '\r\n      p.appendChild((span = document.createElement('span')))\r\n      span.innerText = s.date_accessed\r\n    }\r\n  }\r\n  return e\r\n}\r\n","import type Community from './index'\r\nimport DataHandler from '../data_handler/index'\r\nimport type {BaseInput, SiteInputs} from './inputs/index'\r\nimport type {InputCombobox} from './inputs/combobox'\r\nimport type {InputNumber} from './inputs/number'\r\nimport {tooltip_icon_rule} from './static_refs'\r\nimport {fill_ids_options, fill_levels_options, fill_variables_options, toggle_input} from './utils'\r\nimport type {DataViewSelection, SiteDataView} from './dataview'\r\nimport type {OutputInfo} from './outputs/info'\r\nimport type {OutputPlotly} from './outputs/plotly'\r\nimport type {OutputMap} from './outputs/map'\r\nimport {GlobalView} from './global_view'\r\n\r\nexport function setting(this: Community, u: BaseInput) {\r\n  const current = this.spec.settings[u.setting],\r\n    v = u.value() as typeof current,\r\n    theme = v ? 'dark' : 'light'\r\n  if (v !== this.spec.settings[u.setting]) {\r\n    this.spec.settings[u.setting] = v\r\n    if ('theme_dark' === u.setting) {\r\n      v\r\n        ? document.body.classList.replace('light-theme', 'dark-theme')\r\n        : document.body.classList.replace('dark-theme', 'light-theme')\r\n      if (this.spec.plotly) Object.keys(this.spec.plotly).forEach(k => (this.outputs[k] as OutputPlotly).update_theme())\r\n      if (this.spec.map)\r\n        Object.keys(this.spec.map).forEach(k => {\r\n          const u = this.outputs[k] as OutputMap\r\n          if (u && theme in u.tiles) {\r\n            Object.keys(u.tiles).forEach(l => {\r\n              if (theme !== l) u.tiles[l].removeFrom(u.map)\r\n            })\r\n            u.tiles[theme].addTo(u.map)\r\n          }\r\n        })\r\n    } else if ('hide_url_parameters' === u.setting) {\r\n      window.history.replaceState(\r\n        Date.now(),\r\n        '',\r\n        this.spec.settings.hide_url_parameters\r\n          ? window.location.protocol + '//' + window.location.host + window.location.pathname\r\n          : this.get_options_url()\r\n      )\r\n    } else if ('hide_tooltips' === u.setting) {\r\n      v ? this.page.script_style.sheet.insertRule(tooltip_icon_rule, 0) : this.page.script_style.sheet.deleteRule(0)\r\n    } else if ('map_overlay' === u.setting) {\r\n      Object.keys(this.spec.map).forEach(id => {\r\n        if ('_' !== id[0]) {\r\n          const mu = this.outputs[id] as OutputMap\r\n          if (v) {\r\n            mu.update()\r\n          } else {\r\n            mu.overlay.clearLayers()\r\n            mu.overlay_control.remove()\r\n          }\r\n        }\r\n      })\r\n    } else if ('tracking' === u.setting) {\r\n      if (v && this.spec.tag_id) {\r\n        this.gtag('js', new Date())\r\n        this.gtag('config', this.spec.tag_id)\r\n        this.gtag('consent', 'default', {analytics_storage: 'denied'})\r\n      }\r\n      this.gtag('consent', 'update', {analytics_storage: v ? 'granted' : 'denied'})\r\n    } else {\r\n      this.global_update()\r\n    }\r\n    this.gtag('event', 'setting', {event_category: u.setting, event_label: v})\r\n    this.storage.set(u.setting, this.spec.settings[u.setting])\r\n  }\r\n}\r\nexport function options(this: Community, u: InputCombobox) {\r\n  const no_view = !u.view || !this.dataviews[u.view].selection,\r\n    d = (this.valueOf(u.dataset || no_view || this.spec.dataviews[u.view].dataset) || this.defaults.dataset) as string,\r\n    va = this.valueOf(u.variable) as string,\r\n    k = d + (va ? va : ''),\r\n    combobox = 'combobox' === u.type\r\n  if (!(k in u.option_sets)) {\r\n    if (this.patterns.variable.test(u.optionSource)) {\r\n      if ('number' === typeof u.default && -1 === u.default) u.default = this.defaults.variable\r\n      fill_variables_options(u, d, u.option_sets)\r\n    } else if (this.patterns.levels.test(u.optionSource)) {\r\n      fill_levels_options(u, d, va, u.option_sets)\r\n    } else if (this.patterns.ids.test(u.optionSource)) {\r\n      fill_ids_options(u, d, u.option_sets)\r\n    }\r\n  }\r\n  if (k in u.option_sets) {\r\n    const fresh = k !== u.current_set && (u.sensitive || !u.current_set),\r\n      c = u[combobox ? 'listbox' : 'e']\r\n    if (fresh || u.filter || u.selection_subset) {\r\n      if (fresh) {\r\n        c.innerHTML = ''\r\n        if (u.option_sets[k].groups) u.groups = u.option_sets[k].groups\r\n        u.values = u.option_sets[k].values\r\n        u.display = u.option_sets[k].display\r\n        u.options = u.option_sets[k].options as HTMLDivElement[]\r\n      }\r\n      let ns = 0\r\n      if ('ID' === u.variable || this.patterns.ids.test(u.optionSource)) {\r\n        const value = u.value()\r\n        let selection = -1 === value || '' === value ? u.subset : u.selection_subset,\r\n          v = {}\r\n        if (!no_view) {\r\n          if (selection in this.inputs) selection = this.valueOf(selection) as string\r\n          if ('siblings' === selection) {\r\n            const rel = this.data.entity_tree && this.data.entity_tree[value as string]\r\n            if (rel) {\r\n              const parents = Object.keys(rel.parents)\r\n              if (parents.length) {\r\n                v = {}\r\n                parents.forEach(id => {\r\n                  v = {...v, ...this.data.entity_tree[id].children}\r\n                })\r\n              }\r\n            }\r\n          } else {\r\n            v = this.dataviews[u.view].selection[selection as keyof DataViewSelection]\r\n          }\r\n        }\r\n        u.options.forEach((si: HTMLDivElement | HTMLOptionElement) => {\r\n          if (fresh && !u.groups) c.appendChild(si)\r\n          if (no_view || (combobox ? si.dataset.value : (si as HTMLOptionElement).value) in v) {\r\n            si.classList.remove('hidden')\r\n            ns++\r\n          } else {\r\n            si.classList.add('hidden')\r\n          }\r\n        })\r\n      } else if (fresh) {\r\n        u.options.forEach(si => {\r\n          si.classList.remove('hidden')\r\n          if (!u.groups) c.appendChild(si)\r\n          ns++\r\n        })\r\n      } else ns++\r\n      if (fresh && u.groups) u.groups.e.forEach(e => c.appendChild(e))\r\n      toggle_input(u, !!ns)\r\n      u.current_set = k\r\n      if (fresh) {\r\n        if (combobox) {\r\n          u.source = []\r\n        } else {\r\n          ;(u.e as HTMLSelectElement).selectedIndex = -1\r\n          u.source = ''\r\n        }\r\n        u.id in this.url_options\r\n          ? u.set(this.url_options[u.id] as string | number)\r\n          : u.state in u.values\r\n          ? u.set(u.state)\r\n          : u.reset()\r\n      }\r\n      if (u.filter) u.filter()\r\n    }\r\n  }\r\n}\r\nexport async function min(this: Community, u: InputNumber, c: InputNumber) {\r\n  let cv = c.value() as string | number,\r\n    uv = u.value(),\r\n    v = this.dataviews[u.view || c.view],\r\n    variable\r\n  if ('string' === typeof cv) {\r\n    cv = this.patterns.minmax.test(cv) ? c.parsed.min : parseFloat(cv)\r\n  }\r\n  if (v && v.y) {\r\n    variable = this.valueOf(v.y) as string\r\n    if (variable in this.data.variables) {\r\n      if (!v.time_range.time.length) await this.conditionals.time_range(v, u, true)\r\n      cv = Math.max(v.time_range.time[0], cv)\r\n    }\r\n    u.update()\r\n  }\r\n  u.e.min = ('undefined' === typeof u.parsed.min ? cv : Math.max(u.parsed.min, cv)) + ''\r\n  if (!u.e.value) {\r\n    u.reset()\r\n  } else if ('number' === typeof uv && isFinite(uv) && uv < cv) {\r\n    u.set(cv)\r\n  }\r\n  if (u.min_indicator) (u.min_indicator.firstElementChild as HTMLElement).innerText = cv + ''\r\n}\r\nexport async function max(this: Community, u: InputNumber, c: InputNumber) {\r\n  let cv = c.value() as string | number,\r\n    uv = u.value(),\r\n    v = this.dataviews[u.view || c.view],\r\n    variable: string\r\n  if ('string' === typeof cv) {\r\n    cv = this.patterns.minmax.test(cv) ? c.parsed.min : parseFloat(cv)\r\n  }\r\n  if (v && v.y) {\r\n    variable = this.valueOf(v.y) as string\r\n    if (variable in this.data.variables) {\r\n      if (!v.time_range.time.length) await this.conditionals.time_range(v, u, true)\r\n      cv = Math.min(v.time_range.time[1], cv)\r\n    }\r\n    u.update()\r\n  }\r\n  u.e.max = ('undefined' === typeof u.parsed.max ? cv : Math.min(u.parsed.max, cv)) + ''\r\n  if (!u.e.value) {\r\n    u.reset()\r\n  } else if ('number' === typeof uv && isFinite(uv) && uv > cv) {\r\n    u.set(cv)\r\n  }\r\n  if (u.max_indicator) (u.max_indicator.firstElementChild as HTMLElement).innerText = cv + ''\r\n}\r\nexport function time_filters(this: Community, u: SiteDataView) {\r\n  u.time_range.filtered[0] = Infinity\r\n  u.time_range.filtered[1] = -Infinity\r\n  const d = u.get.dataset(),\r\n    time = this.data.meta.times[d],\r\n    current = u.time_range.filtered_index + ''\r\n  if (!this.data.inited[d]) return\r\n  for (let i = time.n; i--; ) {\r\n    let pass = false\r\n    if (i >= u.time_range.index[0] && i <= u.time_range.index[1]) {\r\n      for (let f = u.time_filters.length; f--; ) {\r\n        const v: {[index: string]: number} = {},\r\n          tf = u.time_filters[f]\r\n        if (!(tf.value in v)) v[tf.value] = this.valueOf(tf.value) as number\r\n        pass = DataHandler.checks[tf.type](time.value[i], v[tf.value])\r\n        if (!pass) break\r\n      }\r\n    }\r\n    u.times[i] = pass\r\n    if (pass) {\r\n      if (u.time_range.filtered[0] > time.value[i]) u.time_range.filtered[0] = time.value[i]\r\n      if (u.time_range.filtered[1] < time.value[i]) u.time_range.filtered[1] = time.value[i]\r\n    }\r\n  }\r\n  u.time_range.filtered_index = [\r\n    u.time_range.index[0] + u.time_range.filtered[0] - u.time_range.time[0],\r\n    u.time_range.index[1] + u.time_range.filtered[1] - u.time_range.time[1],\r\n  ]\r\n  if (current !== u.time_range.filtered_index + '') {\r\n    const c = this.dependencies[u.id + '_filter']\r\n    if (c)\r\n      c.forEach(ci => {\r\n        if ('update' === ci.type) {\r\n          if (ci.id in this.inputs) {\r\n            ;(this.inputs[ci.id] as InputNumber).update()\r\n          } else {\r\n            ;(this.outputs[ci.id] as OutputInfo).update()\r\n          }\r\n        } else if (ci.type in this.conditionals) {\r\n          this.conditionals[ci.type as keyof typeof this.conditionals](this.inputs[ci.id], u)\r\n        }\r\n      })\r\n  }\r\n}\r\nexport async function time_range(this: Community, u: SiteDataView, c?: GlobalView | SiteInputs, passive?: boolean) {\r\n  const v = c && 'value' in c && (c.value() as string),\r\n    d = u.get.dataset(),\r\n    tv = u.time ? (this.valueOf(u.time) as string) : this.defaults.time,\r\n    t = tv in this.data.variables ? this.data.variables[tv].info[d].min : 1,\r\n    s = this.dependencies[u.id + '_time'],\r\n    variable = v in this.data.variables ? v : (this.valueOf(u.y) as string)\r\n  let r = variable && (await this.data.get_variable(variable, u))\r\n  if (r) {\r\n    const reset = d + variable != u.time_range.dataset + u.time_range.variable\r\n    const range = r.time_range[d]\r\n    if (-1 !== range[0]) {\r\n      u.time_range.dataset = d\r\n      u.time_range.variable = variable\r\n      u.time_range.index[0] = range[0]\r\n      u.time_range.time[0] = u.time_range.filtered[0] = t + range[0]\r\n      u.time_range.index[1] = range[1]\r\n      u.time_range.time[1] = u.time_range.filtered[1] = t + range[1]\r\n    }\r\n    if (!passive && s) {\r\n      s.forEach(si => {\r\n        const su = this.inputs[si.id] as InputNumber,\r\n          value = su.value() as number\r\n        if ('min' === si.type) {\r\n          if (reset || (isFinite(u.time_range.time[0]) && parseFloat(su.e.min) !== u.time_range.time[0])) {\r\n            su.e.min = u.time_range.time[0] + ''\r\n            if (reset || !this.meta.retain_state || u.time_range.time[0] > value) {\r\n              su.current_default = u.time_range.time[0]\r\n              su.set(su.current_default)\r\n            }\r\n          }\r\n        } else if ('max' === si.type) {\r\n          if (reset || (isFinite(u.time_range.time[1]) && parseFloat(su.e.max) !== u.time_range.time[1])) {\r\n            su.e.max = u.time_range.time[1] + ''\r\n            if (reset || !this.meta.retain_state || u.time_range.time[1] < value || value < u.time_range.time[0]) {\r\n              su.current_default = u.time_range.time[1]\r\n              su.set(su.current_default)\r\n            }\r\n          }\r\n        }\r\n      })\r\n      this.conditionals.time_filters(u)\r\n    }\r\n  } else {\r\n    u.time_range.dataset = d\r\n    u.time_range.index[0] = 0\r\n    u.time_range.time[0] = u.time_range.filtered[0] = 1\r\n    u.time_range.index[1] = 0\r\n    u.time_range.time[1] = u.time_range.filtered[1] = 1\r\n  }\r\n}\r\n","interface BasePalette {\r\n  name: string\r\n  odd?: number\r\n}\r\nexport interface DiscretePalette extends BasePalette {\r\n  type: 'discrete'\r\n  colors: string[]\r\n}\r\ntype triple = [number, number, number]\r\ninterface ContinuousPalette extends BasePalette {\r\n  type: 'continuous' | 'continuous-divergent'\r\n  colors: [[triple, triple], triple, [triple, triple]]\r\n}\r\ninterface PolynomialPalette extends BasePalette {\r\n  type: 'continuous-polynomial'\r\n  colors: triple[]\r\n}\r\n\r\ntype SitePalette = {\r\n  [index: string]: DiscretePalette | ContinuousPalette | PolynomialPalette\r\n}\r\n\r\nexport const palettes: SitePalette = {\r\n  // discrete palettes from https://colorbrewer2.org\r\n  rdylbu7: {\r\n    name: 'Red-Yellow-Blue (7)',\r\n    type: 'discrete',\r\n    colors: ['#d73027', '#fc8d59', '#fee090', '#adadad', '#e0f3f8', '#91bfdb', '#4575b4'],\r\n  },\r\n  orrd7: {\r\n    name: 'Orange-Red (7)',\r\n    type: 'discrete',\r\n    colors: ['#fef0d9', '#fdd49e', '#fdbb84', '#fc8d59', '#ef6548', '#d7301f', '#990000'],\r\n  },\r\n  gnbu7: {\r\n    name: 'Green-Blue (7)',\r\n    type: 'discrete',\r\n    colors: ['#a8ddb5', '#ccebc5', '#f0f9e8', '#adadad', '#4eb3d3', '#2b8cbe', '#08589e'],\r\n  },\r\n  brbg7: {\r\n    name: 'Brown-Teal (7)',\r\n    type: 'discrete',\r\n    colors: ['#8c510a', '#d8b365', '#f6e8c3', '#adadad', '#c7eae5', '#5ab4ac', '#01665e'],\r\n  },\r\n  puor7: {\r\n    name: 'Purple-Orange (7)',\r\n    type: 'discrete',\r\n    colors: ['#b35806', '#f1a340', '#fee0b6', '#adadad', '#d8daeb', '#998ec3', '#542788'],\r\n  },\r\n  prgn6: {\r\n    name: 'Purple-Green (6)',\r\n    type: 'discrete',\r\n    colors: ['#762a83', '#af8dc3', '#e7d4e8', '#d9f0d3', '#7fbf7b', '#1b7837'],\r\n  },\r\n  reds5: {\r\n    name: 'Red (5)',\r\n    type: 'discrete',\r\n    colors: ['#f1eef6', '#d7b5d8', '#df65b0', '#dd1c77', '#980043'],\r\n  },\r\n  greens5: {\r\n    name: 'Green (5)',\r\n    type: 'discrete',\r\n    colors: ['#ffffcc', '#c2e699', '#78c679', '#31a354', '#006837'],\r\n  },\r\n  paired4: {\r\n    name: 'Blue-Green (4)',\r\n    type: 'discrete',\r\n    colors: ['#1f78b4', '#a6cee3', '#b2df8a', '#33a02c'],\r\n  },\r\n  greys4: {\r\n    name: 'Grey (4)',\r\n    type: 'discrete',\r\n    colors: ['#f7f7f7', '#cccccc', '#969696', '#525252'],\r\n  },\r\n  grey: {\r\n    name: 'Grey',\r\n    type: 'continuous',\r\n    colors: [\r\n      [\r\n        [70, 70, 70],\r\n        [80, 80, 80],\r\n      ],\r\n      [150, 150, 150],\r\n      [\r\n        [230, 230, 230],\r\n        [-80, -80, -80],\r\n      ],\r\n    ],\r\n  },\r\n  brown: {\r\n    name: 'Brown',\r\n    type: 'continuous',\r\n    colors: [\r\n      [\r\n        [131, 30, 0],\r\n        [62, 85, 95],\r\n      ],\r\n      [193, 115, 95],\r\n      [\r\n        [255, 200, 190],\r\n        [-62, -85, -95],\r\n      ],\r\n    ],\r\n  },\r\n  purple: {\r\n    name: 'Purple',\r\n    type: 'continuous',\r\n    colors: [\r\n      [\r\n        [90, 14, 213],\r\n        [52.5, 89, 16],\r\n      ],\r\n      [142.5, 103, 229],\r\n      [\r\n        [195, 192, 245],\r\n        [-52.5, -89, -16],\r\n      ],\r\n    ],\r\n  },\r\n  prgn: {\r\n    name: 'Purple-Green',\r\n    type: 'continuous-divergent',\r\n    colors: [\r\n      [\r\n        [27, 120, 55],\r\n        [207, 107, 168.5],\r\n      ],\r\n      [234, 227, 223.5],\r\n      [\r\n        [118, 42, 131],\r\n        [116, 185, 92.5],\r\n      ],\r\n    ],\r\n  },\r\n  puor: {\r\n    name: 'Purple-Orange',\r\n    type: 'continuous-divergent',\r\n    colors: [\r\n      [\r\n        [179, 88, 6],\r\n        [56, 133, 202.5],\r\n      ],\r\n      [235, 221, 208.5],\r\n      [\r\n        [84, 39, 136],\r\n        [151, 182, 72.5],\r\n      ],\r\n    ],\r\n  },\r\n  rdbu: {\r\n    name: 'Red-Blue',\r\n    type: 'continuous-divergent',\r\n    colors: [\r\n      [\r\n        [69, 117, 180],\r\n        [170, 116.5, 16],\r\n      ],\r\n      [239, 233.5, 196],\r\n      [\r\n        [215, 48, 39],\r\n        [24, 185.5, 157],\r\n      ],\r\n    ],\r\n  },\r\n  vik: {\r\n    name: 'vik',\r\n    type: 'continuous-polynomial',\r\n    colors: [\r\n      [97.031, 18.4251, 0.4149],\r\n      [461.7602, 637.5326, 244.4647],\r\n      [-2434.798, -2838.5427, -5893.4695],\r\n      [9665.3469, 14405.823, 44072.722],\r\n      [-2575.9109, -25871.106, -109792.1319],\r\n      [-42510.0569, 8528.3288, 120953.8594],\r\n      [63342.3061, 14006.291, -59644.4457],\r\n      [-26045.0391, -8868.9621, 10155.5667],\r\n    ],\r\n  },\r\n  lajolla: {\r\n    name: 'lajolla',\r\n    type: 'continuous-polynomial',\r\n    colors: [\r\n      [256.0016, 255.9138, 204.945],\r\n      [-187.6735, -46.2889, -768.5655],\r\n      [1022.785, -1057.5602, 1782.0325],\r\n      [-2032.382, 1490.8271, -1785.9056],\r\n      [966.8373, -617.1949, 567.7715],\r\n    ],\r\n  },\r\n}\r\n","import {tooltip_trigger} from '../utils'\r\nimport type {LogicalObject, SiteRule, SiteSpec} from '../../types'\r\nimport type Community from '../index'\r\nimport type {InputButton} from './button'\r\nimport type {InputButtonGroup} from './buttongroup'\r\nimport type {InputCheckbox} from './checkbox'\r\nimport type {InputCombobox} from './combobox'\r\nimport type {InputNumber} from './number'\r\nimport type {InputRadio} from './radio'\r\nimport type {InputSelect} from './select'\r\nimport type {InputVirtual} from './virtual'\r\nimport type {InputSwitch} from './switch'\r\nimport type {InputText} from './text'\r\n\r\ntype InputTypes =\r\n  | 'number'\r\n  | 'radio'\r\n  | 'switch'\r\n  | 'checkbox'\r\n  | 'button'\r\n  | 'text'\r\n  | 'buttongroup'\r\n  | 'select'\r\n  | 'combobox'\r\n  | 'virtual'\r\nexport type SiteInputs =\r\n  | InputCombobox\r\n  | InputSelect\r\n  | InputNumber\r\n  | InputButton\r\n  | InputVirtual\r\n  | InputRadio\r\n  | InputText\r\n  | InputSwitch\r\n  | InputCheckbox\r\n  | InputButtonGroup\r\nexport type RegisteredInputs = {[index: string]: SiteInputs}\r\n\r\nexport abstract class BaseInput {\r\n  type: InputTypes\r\n  input = true\r\n  site: Community\r\n  e: HTMLElement\r\n  wrapper: HTMLElement\r\n  id: string\r\n  settings: {[index: string]: any} = {}\r\n  default: string | string[] | number\r\n  source: boolean | string | number | (string | number)[]\r\n  optionSource: string\r\n  subset: string\r\n  selection_subset: string\r\n  depends: string | LogicalObject\r\n  variable: string\r\n  dataset: string\r\n  view: string\r\n  note: string\r\n  current_index: number | number[] = -1\r\n  previous: boolean | string | number | (string | number)[] = ''\r\n  state = 'initial'\r\n  setting?: string\r\n  deferred?: boolean\r\n  rule?: SiteRule\r\n  constructor(e: HTMLElement, site: Community) {\r\n    this.e = e\r\n    this.site = site\r\n    this.default = e.dataset.default\r\n    this.optionSource = e.dataset.optionsource\r\n    this.subset = e.dataset.subset || 'all'\r\n    this.selection_subset = e.dataset.selectionsubset || this.subset\r\n    this.depends = e.dataset.depends\r\n    this.variable = e.dataset.variable\r\n    this.dataset = e.dataset.dataset\r\n    this.view = e.dataset.view\r\n    this.id = e.id || this.optionSource || 'ui' + site.page.elementCount++\r\n    this.note = e.getAttribute('aria-description') || ''\r\n    this.type = e.dataset.autotype as InputTypes\r\n    if (this.type in site.spec) {\r\n      const spec = site.spec[this.type as keyof SiteSpec] as SiteInputs\r\n      if (this.id in spec) this.settings = (spec as any)[this.id]\r\n    }\r\n    if (e.parentElement)\r\n      this.wrapper = e.parentElement.classList.contains('wrapper') ? e.parentElement : e.parentElement.parentElement\r\n    if (this.wrapper) {\r\n      if (this.note) this.wrapper.classList.add('has-note')\r\n      this.wrapper.setAttribute('data-of', this.id)\r\n      ;['div', 'span', 'label', 'fieldset', 'legend', 'input', 'button'].forEach(type => {\r\n        const c = this.wrapper.querySelectorAll(type)\r\n        if (c.length) c.forEach(ci => ci.setAttribute('data-of', this.id))\r\n      })\r\n    }\r\n    if (this.note) {\r\n      const trigger = tooltip_trigger.bind(this)\r\n      this.wrapper.addEventListener('mouseover', trigger)\r\n      const p = 'DIV' !== e.tagName ? e : e.querySelector('input')\r\n      if (p) {\r\n        p.addEventListener('focus', trigger)\r\n        p.addEventListener('blur', this.site.page.tooltip_clear)\r\n      }\r\n    }\r\n    if (site.patterns.number.test(this.default)) this.default = +this.default\r\n  }\r\n  value() {\r\n    if (Array.isArray(this.source)) return this.source\r\n    const v = this.site.valueOf(this.source)\r\n    return 'undefined' === typeof v ? this.site.valueOf(this.default) : v\r\n  }\r\n  set(v: any) {\r\n    this.source = v\r\n  }\r\n  reset() {\r\n    this.set(this.site.valueOf(this.default))\r\n  }\r\n}\r\n","import type {MeasureInfo} from '../types'\r\nimport type {InputCombobox} from './inputs/combobox'\r\nimport type {InputSelect} from './inputs/select'\r\n\r\nexport function options_filter(this: InputCombobox | InputSelect) {\r\n  if (this.settings.filters) {\r\n    Object.keys(this.settings.filters).forEach(f => {\r\n      this.current_filter[f] = this.site.valueOf(this.settings.filters[f]) as keyof MeasureInfo\r\n    })\r\n    let first = ''\r\n    Object.keys(this.values).forEach((v, i) => {\r\n      let pass = false\r\n      if (v in this.site.data.variables && 'meta' in this.site.data.variables[v]) {\r\n        const info = this.site.data.variables[v].meta as MeasureInfo\r\n        for (const k in this.current_filter)\r\n          if (k in info) {\r\n            pass = info[k as keyof MeasureInfo] === this.current_filter[k]\r\n            if (!pass) break\r\n          }\r\n      }\r\n      if (pass && !first) first = v\r\n      this.options[i].classList[pass ? 'remove' : 'add']('hidden')\r\n    })\r\n    this.current_index = this.values[this.value() as string]\r\n    if (first && (-1 === this.current_index || this.options[this.current_index].classList.contains('hidden'))) {\r\n      this.set(first)\r\n    }\r\n  }\r\n}\r\n\r\nexport function set_current_options(this: InputCombobox | InputSelect) {\r\n  const to = this.option_sets[this.dataset]\r\n  this.values = to.values\r\n  this.display = to.display\r\n  this.options = to.options as typeof this.options\r\n  this.groups = to.groups\r\n  this.source = ''\r\n  this.id in this.site.url_options\r\n    ? this.set(this.site.url_options[this.id] as string)\r\n    : this.state in this.values\r\n    ? this.set(this.state)\r\n    : this.reset()\r\n}\r\n\r\nexport function loader(this: InputCombobox | InputSelect) {\r\n  if (!this.e.classList.contains('locked')) {\r\n    this.deferred = false\r\n    this.e.removeEventListener('click', this.loader)\r\n    this.site.request_queue(false, this.id)\r\n  }\r\n}\r\n","import type {VariableFilterParsed} from '../types'\r\nimport type {DataViewParsed} from './dataview'\r\nimport {patterns} from './patterns'\r\n\r\ntype TimeFuns = {\r\n  number: Function\r\n  first: Function\r\n  selected: Function\r\n  last: Function\r\n}\r\n\r\nconst time_funs = {\r\n  number: function (this: number, v: VariableFilterParsed) {\r\n    return this - v.range[0]\r\n  },\r\n  first: function (v: VariableFilterParsed) {\r\n    return 0\r\n  },\r\n  selected: function (v: VariableFilterParsed, p: DataViewParsed) {\r\n    return p.time_agg - v.range[0]\r\n  },\r\n  last: function (v: VariableFilterParsed) {\r\n    return v.range[1] - v.range[0]\r\n  },\r\n}\r\n\r\nexport function component_fun(times: number[], c: string | number): Function {\r\n  if ('string' === typeof c && patterns.number.test(c)) {\r\n    c = times.indexOf(+c)\r\n    if (-1 === c)\r\n      return function () {\r\n        return NaN\r\n      }\r\n  }\r\n  return 'number' === typeof c\r\n    ? time_funs.number.bind(c)\r\n    : c in time_funs\r\n    ? time_funs[c as keyof TimeFuns]\r\n    : function () {\r\n        return NaN\r\n      }\r\n}\r\n","import DataHandler from '../data_handler/index'\r\nimport type {Entities, Entity, Filter, Generic, SiteCondition, VariableFilterParsed} from '../types'\r\nimport Community from './index'\r\nimport {component_fun} from './time_funs'\r\n\r\ntype VariableCondition = {\r\n  variable: string\r\n  type?: string\r\n  value?: string | number\r\n  operator?: string\r\n  component?: string\r\n}\r\n\r\nexport type DataViewSpec = {\r\n  dataset?: string\r\n  ids?: string\r\n  palette?: string\r\n  time?: string\r\n  time_agg?: string\r\n  time_filters?: VariableCondition[]\r\n  x?: string\r\n  y?: string\r\n}\r\n\r\nexport type DataViewParsed = {\r\n  dataset: string\r\n  ids: EntitySelection | false\r\n  features: string\r\n  variables: string\r\n  time_filters: string\r\n  time_agg: number\r\n  id_source: string\r\n  palette: string\r\n  variable_values: Map<string, VariableFilterParsed>\r\n  feature_values: {[index: string]: Filter}\r\n}\r\n\r\ntype EntitySelection = {[index: string]: boolean | Entity}\r\n\r\nexport type DataViewSelection = {\r\n  ids: Entities\r\n  children: Entities\r\n  features: Entities\r\n  variables: Entities\r\n  dataset: Entities\r\n  filtered: Entities\r\n  full_filter: Entities\r\n  all: Entities\r\n}\r\ntype DataViewSelectionCount = {\r\n  ids: number\r\n  children: number\r\n  features: number\r\n  variables: number\r\n  dataset: number\r\n  filtered: number\r\n  full_filter: number\r\n  all: number\r\n}\r\n\r\nexport class SiteDataView {\r\n  id: string\r\n  palette: string\r\n  y: string\r\n  x: string\r\n  time: string\r\n  time_agg: string | number\r\n  time_filters: VariableCondition[]\r\n  time_range = {\r\n    dataset: '',\r\n    variable: '',\r\n    filtered: [-Infinity, Infinity],\r\n    filtered_index: [-Infinity, Infinity],\r\n    index: [-Infinity, Infinity],\r\n    time: [-Infinity, Infinity],\r\n  }\r\n  dataset: string\r\n  ids: string\r\n  features: Generic\r\n  state = 'initial'\r\n  valid: {[index: string]: boolean} = {}\r\n  get: {\r\n    dataset: () => string\r\n    single_id: () => string\r\n    ids: () => EntitySelection | false\r\n    features: () => string\r\n    variables: () => string\r\n    time_filters: () => string\r\n  }\r\n  checks: {\r\n    dataset: (e: Entity) => boolean\r\n    ids: (e: Entity) => boolean\r\n    features: (e: Entity) => boolean\r\n    variables: (e: Entity) => boolean\r\n  }\r\n  site: Community\r\n  parsed: DataViewParsed = {\r\n    dataset: '',\r\n    ids: false,\r\n    features: '',\r\n    variables: '',\r\n    time_filters: '',\r\n    time_agg: 0,\r\n    id_source: '',\r\n    palette: '',\r\n    variable_values: new Map(),\r\n    feature_values: {},\r\n  }\r\n  selection: DataViewSelection = {\r\n    ids: {},\r\n    children: {},\r\n    features: {},\r\n    variables: {},\r\n    dataset: {},\r\n    filtered: {},\r\n    full_filter: {},\r\n    all: {},\r\n  }\r\n  n_selected: DataViewSelectionCount = {\r\n    ids: 0,\r\n    children: 0,\r\n    features: 0,\r\n    variables: 0,\r\n    dataset: 0,\r\n    filtered: 0,\r\n    full_filter: 0,\r\n    all: 0,\r\n  }\r\n  variables: VariableCondition[]\r\n  times: boolean[]\r\n  constructor(site: Community, id: string, spec?: DataViewSpec) {\r\n    this.site = site\r\n    this.id = id\r\n    this.update = this.update.bind(this)\r\n    site.dataviews[id] = this\r\n    if (spec)\r\n      Object.keys(spec).forEach((k: keyof DataViewSpec) => {\r\n        ;(this as any)[k] = spec[k]\r\n      })\r\n    if ('string' === typeof this.palette && this.palette in this.site.inputs) {\r\n      this.site.add_dependency(this.palette, {type: 'dataview', id: id})\r\n    }\r\n    if ('string' === typeof this.dataset && this.dataset in this.site.inputs) {\r\n      this.site.add_dependency(this.dataset, {type: 'dataview', id: id})\r\n    }\r\n    if ('string' === typeof this.ids && this.ids in this.site.inputs) {\r\n      this.site.add_dependency(this.ids, {type: 'dataview', id: id})\r\n    }\r\n    this.site.add_dependency(id, {type: 'time_range', id: id})\r\n    this.site.add_dependency('view.filter', {type: 'dataview', id: id})\r\n    this.site.add_dependency('view.id', {type: 'dataview', id: id})\r\n    if (this.x in this.site.inputs) this.site.add_dependency(this.x, {type: 'time_range', id: id})\r\n    if (this.y in this.site.inputs) this.site.add_dependency(this.y, {type: 'time_range', id: id})\r\n    if (this.features) {\r\n      Object.keys(this.features).forEach(f => {\r\n        const value = this.features[f]\r\n        if ('string' === typeof value && value in this.site.inputs) {\r\n          this.site.add_dependency(value, {type: 'dataview', id: id})\r\n        }\r\n      })\r\n    }\r\n    if (this.variables) {\r\n      this.variables.forEach(v => {\r\n        if (v.variable in this.site.inputs) {\r\n          this.site.add_dependency(v.variable, {type: 'dataview', id: id})\r\n        }\r\n        if (!('type' in v)) v.type = '='\r\n        if (v.type in this.site.inputs) {\r\n          this.site.add_dependency(v.type, {type: 'dataview', id: id})\r\n        }\r\n        if (!('value' in v)) v.value = 0\r\n        if ('string' === typeof v.value && v.value in this.site.inputs) {\r\n          this.site.add_dependency(v.value, {type: 'dataview', id: id})\r\n        }\r\n      })\r\n    }\r\n    this.compile()\r\n  }\r\n  value() {\r\n    if (this.get) {\r\n      this.reparse()\r\n      return (\r\n        '' +\r\n        this.parsed.dataset +\r\n        this.site.view.entities.size +\r\n        this.site.data.inited[this.parsed.dataset] +\r\n        this.parsed.id_source +\r\n        Object.keys(this.parsed.ids) +\r\n        this.parsed.features +\r\n        this.parsed.variables +\r\n        this.parsed.palette +\r\n        this.site.spec.settings.summary_selection\r\n      )\r\n    }\r\n  }\r\n  update() {\r\n    const state = this.value()\r\n    if (state !== this.state && this.site.view.registered[this.parsed.dataset]) {\r\n      if (this.site.data.inited[this.parsed.dataset]) {\r\n        this.valid[this.parsed.dataset] = true\r\n        this.n_selected.ids = 0\r\n        this.n_selected.children = 0\r\n        this.n_selected.features = 0\r\n        this.n_selected.variables = 0\r\n        this.n_selected.dataset = 0\r\n        this.n_selected.filtered = 0\r\n        this.n_selected.full_filter = 0\r\n        this.n_selected.all = 0\r\n        this.selection.ids = {}\r\n        this.selection.children = {}\r\n        this.selection.features = {}\r\n        this.selection.variables = {}\r\n        this.selection.dataset = {}\r\n        this.selection.filtered = {}\r\n        this.selection.full_filter = {}\r\n        this.selection.all = {}\r\n        this.site.view.filters.forEach(f => {\r\n          f.passed = 0\r\n          f.failed = 0\r\n        })\r\n        this.site.view.entities.forEach(e => {\r\n          const c = this.check(e),\r\n            id = e.features.id\r\n          if (c.ids) {\r\n            this.selection.ids[id] = e\r\n            this.n_selected.ids++\r\n            c.all++\r\n          }\r\n          if (c.features) {\r\n            this.selection.features[id] = e\r\n            this.n_selected.features++\r\n            c.all++\r\n          }\r\n          if (c.variables) {\r\n            this.selection.variables[id] = e\r\n            this.n_selected.variables++\r\n            c.all++\r\n          }\r\n          if (c.dataset) {\r\n            this.selection.dataset[id] = e\r\n            this.n_selected.dataset++\r\n            c.all++\r\n          }\r\n          if (c.dataset && c.ids) {\r\n            this.selection.children[id] = e\r\n            this.n_selected.children++\r\n          }\r\n          if (c.features && c.variables) {\r\n            this.selection.full_filter[id] = e\r\n            this.n_selected.full_filter++\r\n          }\r\n          if (c.variables && c.features && c.ids) {\r\n            this.selection.filtered[id] = e\r\n            this.n_selected.filtered++\r\n          }\r\n          if (4 === c.all) {\r\n            this.selection.all[id] = e\r\n            this.n_selected.all++\r\n          }\r\n        })\r\n        this.site.request_queue(this.id)\r\n      } else {\r\n        this.valid[this.parsed.dataset] = false\r\n        this.site.data.data_queue[this.parsed.dataset][this.id] = this.update\r\n      }\r\n    }\r\n  }\r\n  compile() {\r\n    this.times = []\r\n    if (this.time_filters) {\r\n      this.time_filters = [\r\n        {variable: this.site.defaults.time, type: '>=', value: 'filter.time_min'},\r\n        {variable: this.site.defaults.time, type: '<=', value: 'filter.time_max'},\r\n      ]\r\n      this.site.add_dependency(this.id + '_time', {type: 'min', id: 'filter.time_min'})\r\n      this.site.add_dependency(this.id + '_time', {type: 'max', id: 'filter.time_max'})\r\n      this.time_filters.forEach(f => {\r\n        if ('string' === typeof f.value && f.value in this.site.inputs) {\r\n          this.site.add_dependency(f.value, {type: 'time_filters', id: this.id})\r\n        }\r\n      })\r\n    }\r\n    this.get = {\r\n      dataset: () => {\r\n        let d = this.site.defaults.dataset\r\n        if ('string' === typeof this.dataset && this.dataset in this.site.inputs) {\r\n          d = this.site.valueOf(this.site.inputs[this.dataset].value()) as string\r\n          if (!(d in this.site.data.data_queue)) {\r\n            d = this.site.defaults.dataset\r\n            this.site.inputs[this.dataset].set(d)\r\n          }\r\n        } else {\r\n          d = this.site.valueOf(this.dataset) as string\r\n        }\r\n        return d in this.site.data.data_queue ? d : this.site.defaults.dataset\r\n      },\r\n      single_id: () => {\r\n        const id = this.site.valueOf(\r\n          'string' === typeof this.ids && this.ids in this.site.inputs ? this.site.inputs[this.ids].value() : this.ids\r\n        )\r\n        return 'string' === typeof id ? id : ''\r\n      },\r\n      ids: () => {\r\n        const id = this.site.valueOf(\r\n          'string' === typeof this.ids && this.ids in this.site.inputs ? this.site.inputs[this.ids].value() : this.ids\r\n        )\r\n        if ('string' === typeof id && '' !== id && '-1' !== id) {\r\n          const ids: {[index: string]: boolean} = {},\r\n            e = this.site.data.entities[id]\r\n          ids[id] = true\r\n          if (e && e.relations) Object.keys(e.relations.children).forEach(k => (ids[k] = true))\r\n          return ids\r\n        } else if (this.site.view.selected.length) {\r\n          return this.site.view.select_ids\r\n        }\r\n        return false\r\n      },\r\n      features: () => {\r\n        let s = ''\r\n        this.features &&\r\n          Object.keys(this.features).forEach(k => {\r\n            s += k + this.site.valueOf(this.features[k])\r\n          })\r\n        return s\r\n      },\r\n      variables: () => {\r\n        if (this.variables || this.site.view.filters.size) {\r\n          if (!this.parsed.variable_values.size) this.reparse()\r\n          let s = ''\r\n          this.parsed.variable_values.forEach(vi => {\r\n            vi.filter.summary.update()\r\n            s += vi.name + vi.operator + vi.component + vi.value + vi.active\r\n          })\r\n          return s\r\n        } else return ''\r\n      },\r\n      time_filters: () => {\r\n        let s = ''\r\n        this.time_filters &&\r\n          this.time_filters.forEach(f => {\r\n            s += f.value in this.site.inputs ? this.site.valueOf(f.value) : f.value\r\n          })\r\n        return s\r\n      },\r\n    }\r\n    this.checks = {\r\n      dataset: (e: Entity) => {\r\n        return this.parsed.dataset === e.group\r\n      },\r\n      ids: (e: Entity) => {\r\n        return e.features && this.ids_check(this.parsed.ids, e.features.id)\r\n      },\r\n      features: (e: Entity) => {\r\n        if (e.features) {\r\n          let k,\r\n            v,\r\n            pass = true\r\n          for (k in this.parsed.feature_values) {\r\n            if (k in this.parsed.feature_values) {\r\n              v = this.parsed.feature_values[k]\r\n              pass = DataHandler.checks[v.operator](v.value, this.site.valueOf(e.features[k]))\r\n              if (!pass) break\r\n            }\r\n          }\r\n          return pass\r\n        } else return true\r\n      },\r\n      variables: (e: Entity) => {\r\n        if (e.data) {\r\n          let pass = true\r\n          this.parsed.variable_values.forEach(v => {\r\n            if (v.active && !isNaN(+v.value)) {\r\n              const ev = e.get_value(v.name, v.comp_fun(v, this.parsed)),\r\n                ck = !isNaN(ev) && DataHandler.checks[v.operator](ev, v.value)\r\n              v.filter[ck ? 'passed' : 'failed']++\r\n              if (pass && !ck) pass = false\r\n            } else {\r\n              v.filter.failed++\r\n            }\r\n          })\r\n          return pass\r\n        } else return true\r\n      },\r\n    }\r\n  }\r\n  ids_check(a: EntitySelection | false, b: string) {\r\n    return !a || b in a\r\n  }\r\n  check(e: Entity) {\r\n    return {\r\n      ids: !this.ids || this.checks.ids(e),\r\n      features: !this.features || this.checks.features(e),\r\n      variables: (!this.variables && !this.site.view.filters.size) || this.checks.variables(e),\r\n      dataset: !this.dataset || this.checks.dataset(e),\r\n      all: 0,\r\n    }\r\n  }\r\n  reparse() {\r\n    this.parsed.dataset = this.get.dataset()\r\n    this.parsed.ids = this.get.ids()\r\n    this.parsed.time_filters = this.get.time_filters()\r\n    this.parsed.time_agg =\r\n      this.parsed.dataset in this.site.data.meta.times\r\n        ? (this.site.valueOf(this.time_agg) as number) - this.site.data.meta.times[this.parsed.dataset].range[0]\r\n        : 0\r\n    if ('string' === typeof this.ids) {\r\n      const u = this.site.inputs[this.ids]\r\n      if (\r\n        this.ids in this.site.inputs &&\r\n        (('virtual' === u.type && u.source in this.site.inputs) ||\r\n          ('depends' in u && (u.depends as string) in this.site.inputs))\r\n      ) {\r\n        this.parsed.id_source = (\r\n          'virtual' === u.type\r\n            ? this.site.valueOf(this.site.inputs[u.source].dataset)\r\n            : this.site.inputs[u.depends as string].value()\r\n        ) as string\r\n      }\r\n    }\r\n    if (this.palette) this.parsed.palette = this.site.valueOf(this.palette) as string\r\n    if (this.features) {\r\n      this.parsed.feature_values = {}\r\n      Object.keys(this.features).forEach(k => {\r\n        const value = this.site.valueOf(this.features[k]) as string | string[]\r\n        this.parsed.feature_values[k] = {\r\n          value: value,\r\n          operator: 'string' === typeof value ? 'equals' : 'includes',\r\n        }\r\n      })\r\n      this.parsed.features = this.get.features()\r\n    } else this.parsed.features = ''\r\n    this.parsed.variable_values.clear()\r\n    if (this.site.view.filters.size)\r\n      this.site.view.filters.forEach(f => {\r\n        this.parsed.variable_values.set(f.id, {\r\n          filter: f,\r\n          name: f.variable,\r\n          range: this.site.data.variables[f.variable].info[this.parsed.dataset].time_range,\r\n          operator: f.operator,\r\n          value: f.value ? +f.value : NaN,\r\n          value_type: 'number',\r\n          component: f.component,\r\n          active: f.active,\r\n          comp_fun: component_fun(this.site.data.meta.overall.value, f.component),\r\n        })\r\n      })\r\n    if (this.variables || this.parsed.variable_values.size) {\r\n      if (this.variables)\r\n        this.variables.forEach(v => {\r\n          const value = this.site.valueOf(v.value) as string | number\r\n          this.parsed.variable_values.set(this.parsed.variable_values.size + '', {\r\n            name: v.variable,\r\n            operator: v.operator,\r\n            value: value,\r\n            component: v.component,\r\n            active: true,\r\n            comp_fun: component_fun(this.site.data.meta.overall.value, v.component),\r\n          })\r\n        })\r\n      this.parsed.variables = this.get.variables()\r\n    } else this.parsed.variables = ''\r\n  }\r\n}\r\n","import {BaseInput} from './index'\r\nimport type Community from '../index'\r\nimport type {Generic, ObjectIndex, OptionSets, ResourceField} from '../../types'\r\nimport {keymap} from '../static_refs'\r\nimport {loader, options_filter, set_current_options} from '../common_methods'\r\nimport {patterns} from '../patterns'\r\n\r\nexport type ComboboxSpec = {\r\n  strict?: boolean\r\n  numeric?: boolean\r\n  search?: boolean\r\n  multi?: boolean\r\n  accordion?: boolean\r\n  group?: string\r\n  filters?: Generic\r\n}\r\n\r\nexport class InputCombobox extends BaseInput {\r\n  type: 'combobox' = 'combobox'\r\n  hover_index = -1\r\n  cleared_selection = ''\r\n  default: string | number\r\n  expanded = false\r\n  listbox: HTMLElement\r\n  groups: {e: HTMLElement[]; by_name: {[index: string]: HTMLElement}}\r\n  container = document.createElement('div')\r\n  selection: HTMLElement\r\n  input_element: HTMLInputElement\r\n  filter_index: number[]\r\n  current_filter: {[index: string]: string} = {}\r\n  onchange: Function\r\n  value_type: string\r\n  values: ObjectIndex = {}\r\n  display: ObjectIndex = {}\r\n  options: HTMLDivElement[] = []\r\n  option_sets: OptionSets = {}\r\n  current_set = ''\r\n  sensitive = false\r\n  loader?: (...args: any) => void\r\n  filter = options_filter\r\n  reformat_label = false\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.set = this.set.bind(this)\r\n    this.reset = this.reset.bind(this)\r\n    this.resize = this.resize.bind(this)\r\n    this.toggle = this.toggle.bind(this)\r\n    this.highlight = this.highlight.bind(this)\r\n    this.filterer = this.filterer.bind(this)\r\n    this.close = this.close.bind(this)\r\n    this.set_selected = this.set_selected.bind(this)\r\n    this.settings.use_display = this.settings.search || this.settings.multi\r\n    this.listbox = this.e.parentElement.children[1] as HTMLElement\r\n    this.options = [...this.listbox.querySelectorAll('.combobox-option')] as HTMLDivElement[]\r\n    if (this.optionSource && this.site.patterns.ids.test(this.optionSource)) {\r\n      this.loader = loader.bind(this)\r\n      e.addEventListener('click', this.loader)\r\n      this.deferred = true\r\n    }\r\n    if (this.options.length) {\r\n      this.reformat_label = true\r\n      this.options.forEach((e, i) => {\r\n        this.values[e.dataset.value] = i\r\n        if (this.reformat_label) this.reformat_label = e.dataset.value === e.innerText\r\n      })\r\n      const group: NodeListOf<HTMLElement> = this.listbox.querySelectorAll('.combobox-group')\r\n      if (group.length) {\r\n        this.groups = {e: [], by_name: {}}\r\n        group.forEach(e => {\r\n          const name = e.dataset.group\r\n          this.groups.e.push(e)\r\n          this.groups.by_name[name] = e\r\n        })\r\n      }\r\n    }\r\n    this.container.className = 'combobox-options-container combobox-component hidden'\r\n    this.site.page.overlay.appendChild(this.container)\r\n    this.container.appendChild(this.listbox)\r\n    this.selection = this.e.firstElementChild.firstElementChild as HTMLElement\r\n    this.input_element = this.e.firstElementChild.lastElementChild as HTMLInputElement\r\n    if (2 === this.e.childElementCount) {\r\n      this.e.lastElementChild.addEventListener(\r\n        'click',\r\n        function (this: InputCombobox) {\r\n          if (!this.e.classList.contains('locked')) {\r\n            this.cleared_selection = ''\r\n            this.set([])\r\n            this.input_element.focus()\r\n          }\r\n        }.bind(this)\r\n      )\r\n    }\r\n    this.input_element.addEventListener(\r\n      'focus',\r\n      function (this: HTMLElement) {\r\n        this.classList.add('focused')\r\n      }.bind(this.e)\r\n    )\r\n    this.input_element.addEventListener(\r\n      'blur',\r\n      function (this: HTMLElement) {\r\n        this.classList.remove('focused')\r\n      }.bind(this.e)\r\n    )\r\n    this.listbox.addEventListener('click', this.set)\r\n    window.addEventListener('resize', this.resize)\r\n    this.e.addEventListener('mousedown', this.toggle)\r\n    this.listbox.addEventListener('mouseover', this.highlight)\r\n    if (this.settings.accordion) {\r\n      this.listbox.addEventListener('show.bs.collapse', e => {\r\n        const group = this.hover_index === -1 ? '' : this.options[this.hover_index].dataset.group\r\n        const et = e.target as HTMLElement\r\n        if (group !== et.dataset.group) {\r\n          et.firstElementChild.firstElementChild.dispatchEvent(new MouseEvent('mouseover'))\r\n          this.input_element.focus()\r\n        }\r\n      })\r\n    }\r\n    if (this.settings.search) {\r\n      this.input_element.addEventListener('keyup', this.filterer)\r\n    }\r\n    this.input_element.addEventListener(\r\n      'keydown',\r\n      function (this: InputCombobox, e: KeyboardEvent) {\r\n        const action = keymap[e.code as keyof typeof keymap]\r\n        if (action) {\r\n          if ('close' === action) {\r\n            this.close()\r\n          } else if ('select' === action) {\r\n            if (!this.expanded) return this.toggle(void 0, this.input_element)\r\n            this.set(e)\r\n          } else if ('move' === action) {\r\n            const value = this.input_element.value\r\n            if (this.settings.strict || (this.expanded && '' === value)) {\r\n              e.preventDefault()\r\n              if ('ArrowUp' === e.code) {\r\n                if (this.filter_index && this.filter_index.length) {\r\n                  this.hover_index = this.filter_index.indexOf(this.hover_index) - 1\r\n                  this.hover_index = this.filter_index[0 > this.hover_index ? 0 : this.hover_index]\r\n                } else {\r\n                  this.hover_index = Math.max(0, this.hover_index - 1)\r\n                }\r\n              } else if ('ArrowDown' === e.code) {\r\n                if (this.filter_index && this.filter_index.length) {\r\n                  this.hover_index = this.filter_index.indexOf(this.hover_index) + 1\r\n                  this.hover_index =\r\n                    this.filter_index[\r\n                      this.filter_index.length - 1 < this.hover_index ? this.filter_index.length - 1 : this.hover_index\r\n                    ]\r\n                } else {\r\n                  this.hover_index = Math.min(this.options.length - 1, this.hover_index + 1)\r\n                }\r\n              } else if ('Home' === e.code) {\r\n                this.hover_index = 0\r\n              } else if ('End' === e.code) {\r\n                this.hover_index = this.options.length - 1\r\n              }\r\n              if (this.expanded) {\r\n                this.highlight()\r\n              } else {\r\n                this.set(this.hover_index)\r\n              }\r\n            } else if (this.site.patterns.number.test(value)) {\r\n              this.set(+value + ('ArrowUp' === e.code ? 1 : -1))\r\n            }\r\n          }\r\n        } else if (!this.expanded) {\r\n          this.toggle(void 0, this.input_element)\r\n        } else {\r\n          this.clear_highlight()\r\n        }\r\n      }.bind(this)\r\n    )\r\n  }\r\n  init() {\r\n    this.options.forEach((e, i) => {\r\n      if (this.reformat_label) e.innerText = this.site.data.format_label(e.dataset.value)\r\n      this.display[e.innerText] = i\r\n    })\r\n  }\r\n  set_current = set_current_options\r\n  filterer() {\r\n    const q = this.input_element.value.toLowerCase()\r\n    if ('' === q) {\r\n      this.filter_reset()\r\n    } else {\r\n      this.filter_index = []\r\n      if (this.groups) {\r\n        this.groups.e.forEach(g => g.firstElementChild.firstElementChild.classList.add('hidden'))\r\n      }\r\n      this.options.forEach((o, i) => {\r\n        if (!o.classList.contains('hidden') && o.innerText.toLowerCase().includes(q)) {\r\n          o.classList.remove('filter-hidden')\r\n          this.filter_index.push(i)\r\n          const group = o.dataset.group\r\n          if (group) {\r\n            this.groups.by_name[group].firstElementChild.firstElementChild.classList.remove('hidden')\r\n            if (this.settings.accordion) {\r\n              const g = this.groups.by_name[group]\r\n              g.firstElementChild.nextElementSibling.classList.add('show')\r\n              g.firstElementChild.firstElementChild.classList.remove('collapsed')\r\n              g.firstElementChild.firstElementChild.setAttribute('aria-expanded', 'true')\r\n            }\r\n          }\r\n        } else {\r\n          o.classList.add('filter-hidden')\r\n        }\r\n      })\r\n    }\r\n  }\r\n  highlight(e?: MouseEvent, target?: HTMLElement) {\r\n    if (e && !target) target = e.target as HTMLElement\r\n    if (!target || target.dataset.value in this.values) {\r\n      if (!this.groups) this.settings.accordion = false\r\n      if (target && target.dataset.value) {\r\n        this.hover_index = this.values[target.dataset.value]\r\n      } else if (-1 === this.hover_index && Array.isArray(this.source)) {\r\n        this.hover_index = this.values[this.source[0]]\r\n      }\r\n      if ('undefined' === typeof this.hover_index) this.hover_index = -1\r\n      const o = this.options[this.hover_index]\r\n      if (o) {\r\n        const previous = this.listbox.querySelector('.highlighted')\r\n        if (previous) previous.classList.remove('highlighted')\r\n        if (e && 'mouseover' === e.type) {\r\n          target.classList.add('highlighted')\r\n        } else {\r\n          o.classList.add('highlighted')\r\n          if (this.settings.accordion) {\r\n            const c = o.parentElement.parentElement\r\n            if (!c.classList.contains('show')) {\r\n              c.classList.add('show')\r\n              c.previousElementSibling.firstElementChild.classList.remove('collapsed')\r\n              c.previousElementSibling.firstElementChild.setAttribute('aria-expanded', 'true')\r\n            }\r\n          }\r\n          this.input_element.setAttribute('aria-activedescendant', o.id)\r\n          const port = this.container.getBoundingClientRect(),\r\n            item = o.getBoundingClientRect()\r\n          let top = port.top\r\n          if (this.groups && o.dataset.group)\r\n            top += this.groups.by_name[o.dataset.group].firstElementChild.getBoundingClientRect().height\r\n          if (top > item.top) {\r\n            this.container.scrollTo(0, this.container.scrollTop + item.top - top)\r\n          } else if (port.bottom < item.bottom) {\r\n            this.container.scrollTo(0, this.container.scrollTop + item.bottom - port.bottom)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  toggle(e?: MouseEvent, target?: HTMLElement) {\r\n    if (e && !target) target = e.target as HTMLElement\r\n    if (target && (!e || !e.button) && !this.e.classList.contains('disabled') && 'BUTTON' !== target.tagName) {\r\n      if (this.expanded) {\r\n        if (target !== this.input_element) this.close()\r\n      } else {\r\n        if (this.site.spec.combobox)\r\n          Object.keys(this.site.spec.combobox).forEach(id => {\r\n            if (id !== this.id) {\r\n              const ou = this.site.inputs[id] as InputCombobox\r\n              ou.expanded && ou.close()\r\n            }\r\n          })\r\n        this.container.classList.remove('hidden')\r\n        if ('' !== this.selection.innerText) this.cleared_selection = this.selection.innerText\r\n        if (this.cleared_selection in this.display)\r\n          this.highlight(void 0, this.options[this.display[this.cleared_selection]])\r\n        if (this.settings.use_display) this.selection.innerText = ''\r\n        window.addEventListener('click', this.close)\r\n        this.e.setAttribute('aria-expanded', 'true')\r\n        if (!e || e.target !== this.input_element) setTimeout(() => this.input_element.focus(), 0)\r\n        this.resize()\r\n        this.expanded = true\r\n      }\r\n    }\r\n  }\r\n  value() {\r\n    return this.source\r\n      ? this.settings.multi\r\n        ? this.source\r\n        : Array.isArray(this.source) && this.source.length\r\n        ? this.source[0]\r\n        : ''\r\n      : this.site.valueOf(this.default)\r\n  }\r\n  close(e?: MouseEvent) {\r\n    if (\r\n      this.expanded &&\r\n      (!e ||\r\n        !(e.target as HTMLElement).classList ||\r\n        !(e.target as HTMLElement).classList.contains('combobox-component'))\r\n    ) {\r\n      if (\r\n        this.settings.use_display &&\r\n        '' === this.selection.innerText &&\r\n        Array.isArray(this.source) &&\r\n        this.source.length\r\n      )\r\n        this.selection.innerText = this.cleared_selection\r\n      if ('' !== this.input_element.value) setTimeout(this.set, 0)\r\n      this.e.setAttribute('aria-expanded', 'false')\r\n      this.expanded = false\r\n      this.container.classList.add('hidden')\r\n      window.removeEventListener('click', this.close)\r\n    }\r\n  }\r\n  resize() {\r\n    const s = this.e.getBoundingClientRect()\r\n    this.container.style.left = s.x + 'px'\r\n    this.container.style.width = s.width + 'px'\r\n    if (window.screen.height / 2 > s.y) {\r\n      this.container.style.top = s.y + s.height + 'px'\r\n      this.container.style.bottom = ''\r\n    } else {\r\n      this.container.style.top = ''\r\n      this.container.style.bottom = -s.y + 'px'\r\n    }\r\n  }\r\n  clear_highlight() {\r\n    if (-1 !== this.hover_index) {\r\n      this.options[this.hover_index].classList.remove('highlighted')\r\n      this.hover_index = -1\r\n    }\r\n  }\r\n  filter_reset() {\r\n    if (this.groups)\r\n      this.groups.e.forEach(g => {\r\n        ;(this.settings.accordion ? g.firstElementChild.firstElementChild : g).classList.remove('hidden')\r\n      })\r\n    this.input_element.value = ''\r\n    this.filter_index = []\r\n    this.options.forEach((o, i) => {\r\n      if (!o.classList.contains('hidden')) this.filter_index.push(i)\r\n    })\r\n    this.listbox.querySelectorAll('.filter-hidden').forEach(o => o.classList.remove('filter-hidden'))\r\n  }\r\n  set_selected(value: string | number) {\r\n    if (value in this.values) {\r\n      const option = this.options[this.values[value] as number]\r\n      option.classList.add('selected')\r\n      option.setAttribute('aria-selected', 'true')\r\n    }\r\n  }\r\n  static create(\r\n    site: Community,\r\n    label: string,\r\n    options?: string[] | {[index: string]: string[]},\r\n    settings?: Generic,\r\n    id?: string\r\n  ) {\r\n    id = id || 'created_combobox_' + ++site.page.elementCount\r\n    const main = document.createElement('div')\r\n    let e = document.createElement('div'),\r\n      div = document.createElement('div'),\r\n      input = document.createElement('input'),\r\n      lab = document.createElement('label')\r\n    if (settings) {\r\n      if (!site.spec.combobox) site.spec.combobox = {}\r\n      site.spec.combobox[id] = settings\r\n    }\r\n    e.className = 'wrapper combobox-wrapper'\r\n    if (settings && settings.floating) {\r\n      e.appendChild(div)\r\n      div.className = 'form-floating'\r\n      div.dataset.of = id\r\n      e = div\r\n    }\r\n    e.appendChild(main)\r\n    main.id = id\r\n    main.dataset.autotype = 'combobox'\r\n    main.className = 'auto-input form-select combobox combobox-component'\r\n    main.role = 'combobox'\r\n    main.appendChild((div = document.createElement('div')))\r\n    div.className = 'combobox-selection combobox-component'\r\n    div.appendChild(document.createElement('span'))\r\n    div.lastElementChild.className = 'combobox-component'\r\n    div.lastElementChild.setAttribute('aria-live', 'assertive')\r\n    div.lastElementChild.setAttribute('aria-atomic', 'true')\r\n    div.lastElementChild.role = 'log'\r\n    div.appendChild(input)\r\n    input.setAttribute('aria-haspopup', 'listbox')\r\n    input.setAttribute('aria-expanded', 'false')\r\n    input.setAttribute('aria-controls', id + '-listbox')\r\n    input.className = 'combobox-input combobox-component'\r\n    input.type = 'text'\r\n    input.role = 'combobox'\r\n    input.id = id + '-input'\r\n    input.autocomplete = 'off'\r\n    if (settings && settings.clearable) {\r\n      const button = document.createElement('button')\r\n      e.firstElementChild.appendChild(button)\r\n      button.type = 'button'\r\n      button.className = 'btn-close'\r\n      button.title = 'clear selection'\r\n    }\r\n    e.appendChild((div = document.createElement('div')))\r\n    div.className = 'combobox-options combobox-component'\r\n    div.setAttribute('aria-labelledby', id + '-label')\r\n    div.role = 'listbox'\r\n    div.tabIndex = -1\r\n    div.id = id + '-listbox'\r\n    e.appendChild(lab)\r\n    lab.id = id + '-label'\r\n    lab.innerText = label\r\n    lab.setAttribute('for', id + '-input')\r\n    const u = new InputCombobox(main, site)\r\n    site.inputs[id] = u\r\n    let n = 0\r\n    if (options)\r\n      if (Array.isArray(options)) {\r\n        options.forEach(o => {\r\n          const l = site.data.format_label(o)\r\n          u.display[l] = n\r\n          u.values[o] = n++\r\n          u.add(o, l)\r\n        })\r\n      } else {\r\n        u.groups = {e: [], by_name: {}}\r\n        Object.keys(options).forEach(k => {\r\n          const g = options[k]\r\n          const e = document.createElement('div'),\r\n            id = u.id + '_group_' + k.replace(patterns.seps, '-')\r\n          e.dataset.group = k\r\n          e.className = 'combobox-group combobox-component'\r\n          e.setAttribute('aria-labelledby', id)\r\n          e.appendChild((lab = document.createElement('label')))\r\n          lab.dataset.for = id\r\n          lab.innerText = k\r\n          lab.id = id\r\n          lab.className = 'combobox-group-label combobox-component'\r\n          u.groups.by_name[k] = e\r\n          u.groups.e.push(e)\r\n          g.forEach(o => e.appendChild(u.add(o, o, true)))\r\n          u.listbox.appendChild(e)\r\n        })\r\n        Object.keys(u.groups.by_name).forEach(g => {\r\n          u.groups.by_name[g].querySelectorAll('.combobox-option').forEach((c: HTMLElement) => {\r\n            ;(u.options as HTMLElement[]).push(c)\r\n            c.dataset.group = g\r\n            u.values[c.dataset.value] = n\r\n            u.display[c.innerText] = n++\r\n          })\r\n        })\r\n      }\r\n    return u\r\n  }\r\n  get() {\r\n    const s: string[] = []\r\n    this.listbox.querySelectorAll('.selected').forEach((o: HTMLElement) => s.push(o.dataset.value))\r\n    this.source = s\r\n    this.site.request_queue(false, this.id)\r\n  }\r\n  set(v?: MouseEvent | KeyboardEvent | string | number | (string | number)[], toggle?: boolean): void {\r\n    if ('number' !== typeof v && !v) v = this.input_element.value\r\n    let update = false,\r\n      i = -1\r\n    if (!Array.isArray(v) && 'object' === typeof v) {\r\n      const t = v.target as HTMLElement\r\n      if ((this.settings.accordion ? 'BUTTON' : 'LABEL') === t.tagName) return void 0\r\n      i = this.hover_index\r\n      if (\r\n        -1 !== i &&\r\n        (this.options[i].classList.contains('hidden') || this.options[i].classList.contains('filter-hidden'))\r\n      )\r\n        i = -1\r\n      v =\r\n        -1 === i\r\n          ? 'INPUT' === t.tagName\r\n            ? this.input_element.value\r\n            : t.dataset.value || t.innerText\r\n          : this.options[i].dataset.value || this.options[i].innerText\r\n      toggle = this.settings.multi\r\n    }\r\n    this.filter_reset()\r\n    if (Array.isArray(v)) {\r\n      if (this.settings.multi) {\r\n        this.listbox.querySelectorAll('.selected').forEach(e => {\r\n          e.classList.remove('selected')\r\n          e.setAttribute('aria-selected', 'false')\r\n        })\r\n        this.source = -1 === v[0] ? [] : v\r\n        v.forEach(this.set_selected)\r\n        update = true\r\n      } else v = v[0]\r\n    }\r\n    if (!Array.isArray(this.source)) this.source = []\r\n    if (!Array.isArray(v)) {\r\n      if (this.settings.strict && 'string' === typeof v && !(v in this.values) && this.site.patterns.number.test(v))\r\n        v = +v\r\n      if ('number' !== this.value_type && 'number' === typeof v && this.options[v]) {\r\n        v = this.options[v].dataset.value\r\n      }\r\n      if ('string' === typeof v && v in this.display) v = this.options[this.display[v]].dataset.value\r\n      if (this.settings.strict && !(v in this.values)) v = this.default\r\n      i = this.source.indexOf(v)\r\n      if (-1 === i) {\r\n        update = true\r\n        if (-1 === v || '' === v) {\r\n          this.source = []\r\n        } else {\r\n          if (this.settings.multi) {\r\n            this.source.push(v)\r\n          } else this.source[0] = v\r\n        }\r\n        if (v in this.values) {\r\n          if (!this.settings.multi) {\r\n            const selected = this.listbox.querySelector('.selected')\r\n            if (selected) {\r\n              selected.classList.remove('selected')\r\n              selected.setAttribute('aria-selected', 'false')\r\n            }\r\n          }\r\n          this.set_selected(v)\r\n        }\r\n      } else if (toggle) {\r\n        update = true\r\n        this.source.splice(i, 1)\r\n        if (v in this.values) {\r\n          const selection = this.options[this.values[v]]\r\n          selection.classList.remove('selected')\r\n          selection.setAttribute('aria-selected', 'false')\r\n        }\r\n      }\r\n    }\r\n    if (!this.settings.multi && this.expanded) {\r\n      this.input_element.focus()\r\n      this.close()\r\n      this.filter_reset()\r\n    }\r\n    let display: string | HTMLElement = this.source.length\r\n      ? this.settings.multi\r\n        ? this.source.length + ' of ' + this.options.length + ' selected'\r\n        : this.source[0] in this.values\r\n        ? this.options[this.values[this.source[0]]]\r\n        : this.settings.strict || -1 === this.source[0]\r\n        ? ''\r\n        : this.source[0] + ''\r\n      : ''\r\n    if ('string' !== typeof display) {\r\n      display = display.firstChild ? display.firstChild.textContent : display.innerText\r\n    }\r\n    if (this.settings.use_display) {\r\n      this.selection.innerText = display\r\n    } else {\r\n      this.input_element.value = display\r\n    }\r\n    if (this.onchange) this.onchange()\r\n    if (update) this.site.request_queue(false, this.id)\r\n  }\r\n  add(value: string, display?: string, noadd?: boolean, meta?: ResourceField) {\r\n    const e = document.createElement('div')\r\n    e.id = this.id + '_' + value\r\n    e.role = 'option'\r\n    e.setAttribute('aria-selected', 'false')\r\n    e.tabIndex = 0\r\n    e.className = 'combobox-option combobox-component'\r\n    e.dataset.value = value\r\n    e.innerText = display || this.site.data.format_label(value)\r\n    if (meta && meta.info) {\r\n      e.appendChild(document.createElement('p'))\r\n      e.lastElementChild.className = 'combobox-option-description combobox-component'\r\n      ;(e.lastElementChild as HTMLElement).innerText = meta.info.description || meta.info.short_description || ''\r\n    }\r\n    if (!noadd) {\r\n      this.listbox.appendChild(e)\r\n      this.options.push(e)\r\n    }\r\n    return e\r\n  }\r\n}\r\n","import type {RegisteredInputs, SiteInputs} from './inputs/index'\r\nimport {patterns} from './patterns'\r\n\r\ntype Actions = string[] | {[index: string]: string}\r\ntype TutorialStep = {\r\n  focus: string\r\n  description?: string\r\n  option?: string | string[]\r\n  before?: Actions\r\n  after?: Actions\r\n  wait?: number\r\n  time?: number\r\n  disable_continue?: boolean\r\n}\r\ntype Tutorial = {\r\n  name: string\r\n  title: string\r\n  description: string\r\n  steps: TutorialStep[]\r\n  reset?: boolean\r\n  manager?: TutorialManager\r\n  n_steps?: number\r\n  current_step?: number\r\n  run?: Function\r\n}\r\nexport type Tutorials = {[index: string]: Tutorial}\r\n\r\nexport class TutorialManager {\r\n  tutorials: Tutorials\r\n  site_elements: RegisteredInputs\r\n  container = document.createElement('div')\r\n  backdrop = document.createElement('div')\r\n  highlight = document.createElement('div')\r\n  menu = document.createElement('div')\r\n  frame = document.createElement('div')\r\n  header = document.createElement('p')\r\n  dialog = document.createElement('p')\r\n  timer = document.createElement('div')\r\n  running_timer: number | NodeJS.Timer\r\n  focuser: number | NodeJS.Timer\r\n  progress = document.createElement('div')\r\n  continue = document.createElement('button')\r\n  in_progress = ''\r\n  waiting = false\r\n  current_step = 0\r\n  current_time = 0\r\n  current_element: HTMLElement\r\n  current_site_element: SiteInputs\r\n  site_reset: Function\r\n  constructor(tutorials: Tutorials, elements?: RegisteredInputs, resetter?: Function) {\r\n    this.tutorials = tutorials\r\n    this.site_elements = elements || {}\r\n    this.site_reset = resetter || (() => {})\r\n    this.start_tutorial = this.start_tutorial.bind(this)\r\n    this.progress_tutorial = this.progress_tutorial.bind(this)\r\n    this.execute_step = this.execute_step.bind(this)\r\n    this.end_tutorial = this.end_tutorial.bind(this)\r\n\r\n    // prepare menu\r\n    document.body.appendChild(this.menu)\r\n    this.menu.id = 'community_tutorials_menu'\r\n    this.menu.className = 'modal fade'\r\n    this.menu.tabIndex = -1\r\n    let e = document.createElement('div')\r\n    this.menu.appendChild(e)\r\n    e.className = 'modal-dialog modal-dialog-scrollable'\r\n    e.appendChild((e = document.createElement('div')))\r\n    e.className = 'modal-content'\r\n    e.appendChild((e = document.createElement('div')))\r\n    e.className = 'modal-header'\r\n    e.appendChild((e = document.createElement('p')))\r\n    e.className = 'modal-title h5'\r\n    e.innerText = 'Tutorials'\r\n    let close = document.createElement('button')\r\n    e.insertAdjacentElement('afterend', close)\r\n    close.type = 'button'\r\n    close.className = 'btn-close'\r\n    close.setAttribute('data-bs-dismiss', 'modal')\r\n    close.setAttribute('aria-label', 'Close')\r\n    const l = document.createElement('div')\r\n    this.menu.lastElementChild.lastElementChild.appendChild(l)\r\n    l.className = 'modal-body'\r\n    Object.keys(tutorials).forEach(name => {\r\n      const t = tutorials[name],\r\n        e = document.createElement('div'),\r\n        description = document.createElement('div'),\r\n        start = document.createElement('button')\r\n      t.manager = this\r\n      t.n_steps = t.steps.length\r\n      let p = document.createElement('div')\r\n      l.appendChild(e)\r\n      e.className = 'tutorial-listing card'\r\n      e.appendChild(p)\r\n      p.className = 'card-header'\r\n      p.innerText = t.title || name\r\n      e.appendChild((p = document.createElement('div')))\r\n      p.className = 'card-body'\r\n      p.appendChild(description)\r\n      description.appendChild(document.createElement('p'))\r\n      ;(description.firstElementChild as HTMLParagraphElement).innerText = t.description || ''\r\n      if (t.steps.length && t.steps[0].before && !Array.isArray(t.steps[0].before)) {\r\n        const before = t.steps[0].before,\r\n          setting_display = document.createElement('div'),\r\n          header = document.createElement('span')\r\n        setting_display.className = 'tutorial-initial-settings'\r\n        setting_display.appendChild(header)\r\n        header.innerText = 'Initial Settings'\r\n        header.className = 'h6'\r\n        Object.keys(t.steps[0].before).forEach((k, i) => {\r\n          const row = document.createElement('p')\r\n          let part = document.createElement('span')\r\n          part.className = 'syntax-variable'\r\n          part.innerText = k.replace(patterns.settings, '')\r\n          row.appendChild(part)\r\n          part = document.createElement('span')\r\n          part.className = 'syntax-operator'\r\n          part.innerText = ' = '\r\n          row.appendChild(part)\r\n          part = document.createElement('span')\r\n          part.className = 'syntax-value'\r\n          part.innerText = before[k]\r\n          row.appendChild(part)\r\n          setting_display.appendChild(row)\r\n        })\r\n        description.appendChild(setting_display)\r\n      }\r\n      p.appendChild(start)\r\n      start.type = 'button'\r\n      start.className = 'btn'\r\n      start.innerText = 'Start'\r\n      start.dataset.name = name\r\n      start.addEventListener('click', this.start_tutorial)\r\n    })\r\n\r\n    // prepare step display\r\n    document.body.appendChild(this.container)\r\n    this.container.appendChild(this.backdrop)\r\n    this.container.className = 'tutorial-container hidden'\r\n    this.container.addEventListener('keyup', this.progress_tutorial)\r\n    this.backdrop.addEventListener('click', this.progress_tutorial)\r\n    this.backdrop.className = 'tutorial-backdrop'\r\n    this.container.appendChild(this.highlight)\r\n    this.highlight.className = 'tutorial-highlight'\r\n    this.highlight.addEventListener('click', this.progress_tutorial)\r\n    this.container.appendChild(this.frame)\r\n    this.frame.className = 'tutorial-frame'\r\n    this.frame.style.left = '50%'\r\n    this.frame.tabIndex = -1\r\n    this.frame.appendChild((e = document.createElement('div')))\r\n    this.frame.id = 'community_tutorial_frame'\r\n    this.frame.role = 'dialog'\r\n    this.frame.setAttribute('aria-labelledby', 'community_tutorial_description')\r\n    e.className = 'tutorial-step card'\r\n    e.appendChild((e = document.createElement('div')))\r\n    e.className = 'card-header'\r\n    e.appendChild(this.header)\r\n    this.header.className = 'card-title'\r\n    this.header.id = 'community_tutorial_title'\r\n    close = document.createElement('button')\r\n    e.appendChild(close)\r\n    close.type = 'button'\r\n    close.className = 'btn-close'\r\n    close.setAttribute('aria-label', 'Close Tutorial')\r\n    close.addEventListener('click', this.end_tutorial)\r\n    this.frame.firstElementChild.appendChild((e = document.createElement('div')))\r\n    e.className = 'card-body'\r\n    e.appendChild(this.dialog)\r\n    this.dialog.role = 'status'\r\n    this.dialog.id = 'community_tutorial_description'\r\n    this.dialog.setAttribute('aria-labelledby', 'community_tutorial_progress')\r\n    this.dialog.setAttribute('aria-live', 'polite')\r\n    e.lastElementChild.className = 'card-text'\r\n    this.frame.firstElementChild.appendChild((e = document.createElement('div')))\r\n    e.className = 'tutorial-footer card-footer'\r\n    e.appendChild(this.progress)\r\n    this.progress.role = 'progressbar'\r\n    this.progress.id = 'community_tutorial_progress'\r\n    e.appendChild(this.timer)\r\n    this.timer.role = 'timer'\r\n    e.appendChild(this.continue)\r\n    this.continue.addEventListener('click', this.progress_tutorial)\r\n    this.continue.type = 'button'\r\n    this.continue.className = 'btn'\r\n    this.continue.innerText = 'Next'\r\n    this.continue.setAttribute('aria-controls', 'community_tutorial_frame')\r\n  }\r\n  retrieve_element(this: TutorialManager, name: string): HTMLElement {\r\n    let e: HTMLElement\r\n    if (name in this.site_elements) {\r\n      this.current_site_element = this.site_elements[name]\r\n      e = this.current_site_element.e\r\n    } else if ('nav:' === name.substring(0, 4).toLowerCase()) {\r\n      const text = name.replace(patterns.pre_colon, '')\r\n      document.querySelectorAll('.nav-item button').forEach((item: HTMLButtonElement) => {\r\n        if (text === item.innerText) e = item\r\n      })\r\n    } else {\r\n      try {\r\n        e = document.querySelector(name.replace(patterns.id_escapes, '\\\\$1'))\r\n      } catch (error) {}\r\n    }\r\n    return e\r\n  }\r\n  start_tutorial(this: TutorialManager, event?: MouseEvent, name?: string): void {\r\n    this.end_tutorial()\r\n    document.querySelectorAll('[data-bs-dismiss]').forEach((close: HTMLButtonElement) => close.click())\r\n    this.in_progress = name ? name : (event.target as HTMLButtonElement).dataset.name\r\n    if (!(this.in_progress in this.tutorials)) {\r\n      console.error('tutorial does not exist:', this.in_progress)\r\n      this.in_progress = ''\r\n      return\r\n    }\r\n    this.container.classList.remove('hidden')\r\n    this.header.innerText = this.tutorials[this.in_progress].title || this.in_progress\r\n    this.current_step = 0\r\n    this.current_time = 0\r\n    this.dialog.innerText = 'Starting tutorial ' + this.header.innerText\r\n    this.timer.innerText = ''\r\n    this.continue.innerText = 'Next'\r\n    if (this.tutorials[this.in_progress].reset) this.site_reset()\r\n    this.progress_tutorial()\r\n  }\r\n  progress_tutorial(this: TutorialManager, event?: KeyboardEvent): void {\r\n    const isClick = !event || !event.code\r\n    if (!isClick && 'Escape' === event.code) this.end_tutorial()\r\n    if (this.in_progress && !this.waiting && (isClick || 'Enter' === event.code || 'ArrowRight' === event.code)) {\r\n      this.waiting = true\r\n      clearTimeout(this.focuser as number)\r\n      clearInterval(this.running_timer as number)\r\n      const t = this.tutorials[this.in_progress]\r\n      let step: TutorialStep\r\n      const handle_object = (obj: {[index: string]: string}) => {\r\n        Object.keys(obj).forEach(k => {\r\n          if (patterns.number.test(k)) {\r\n            do_action(obj[k])\r\n          } else {\r\n            if (k in this.site_elements && this.site_elements[k].set) {\r\n              this.site_elements[k].set(obj[k])\r\n            }\r\n          }\r\n        })\r\n      }\r\n      const set_value = (value: string | string[]) => {\r\n        if (this.current_site_element && this.current_site_element.set) {\r\n          this.current_site_element.set(value as string)\r\n        } else {\r\n          const input =\r\n            'value' in this.current_element ? this.current_element : this.current_element.querySelector('input')\r\n          if (input) {\r\n            input.value = value\r\n            input.dispatchEvent(new Event('change'))\r\n            input.dispatchEvent(new KeyboardEvent('keydown', {code: 'Enter'}))\r\n          }\r\n        }\r\n      }\r\n      const do_action = (action: string) => {\r\n        if ('set' === action) {\r\n          if ('option' in step) set_value(step.option)\r\n        } else if ('click' === action) {\r\n          const u = this.current_site_element\r\n          if (u) {\r\n            if (action === u.id && 'toggle' in u) {\r\n              if (!u.expanded) u.toggle(void 0, u.e)\r\n            } else {\r\n              u.e.click()\r\n            }\r\n          } else {\r\n            this.current_element && this.current_element.click()\r\n          }\r\n        } else if ('close' === action) {\r\n          document.querySelectorAll('[data-bs-dismiss]').forEach((close: HTMLButtonElement) => close.click())\r\n        } else if ('value' === action.substring(0, 5)) {\r\n          set_value(action.replace(patterns.pre_colon, '').trimStart())\r\n        } else {\r\n          const e = this.retrieve_element(action)\r\n          if (e) e.click()\r\n        }\r\n      }\r\n      // handle previous step's after action\r\n      if (this.current_step > 0) {\r\n        step = t.steps[this.current_step - 1]\r\n        if ('after' in step) {\r\n          if (Array.isArray(step.after)) {\r\n            step.after.forEach(do_action)\r\n          } else {\r\n            handle_object(step.after)\r\n          }\r\n        }\r\n      }\r\n      if (this.current_step >= t.n_steps) {\r\n        this.end_tutorial()\r\n      } else {\r\n        this.current_site_element = void 0\r\n        // handle current step's before action\r\n        step = t.steps[this.current_step]\r\n        this.current_element = this.retrieve_element(step.focus)\r\n        if ('before' in step) {\r\n          if (Array.isArray(step.before)) {\r\n            step.before.forEach(do_action)\r\n          } else {\r\n            handle_object(step.before)\r\n          }\r\n        }\r\n        if (this.current_step === t.n_steps - 1) this.continue.innerText = 'Finish'\r\n        if (this.current_element && this.current_element.scrollIntoView) this.current_element.scrollIntoView()\r\n        // execute current step after actions have resolved\r\n        setTimeout(this.execute_step, 'wait' in step ? step.wait : 400)\r\n      }\r\n    }\r\n  }\r\n  execute_step(this: TutorialManager): void {\r\n    if (this.in_progress) {\r\n      const t = this.tutorials[this.in_progress]\r\n      const step = t.steps[this.current_step]\r\n      if (!this.current_element) {\r\n        const e = this.retrieve_element(step.focus)\r\n        if (!e) {\r\n          console.error('failed to retrieve element', step.focus)\r\n          return this.end_tutorial()\r\n        }\r\n        this.current_element = e\r\n        if (e.scrollIntoView) e.scrollIntoView()\r\n        setTimeout(this.execute_step, 0)\r\n        return\r\n      }\r\n      this.continue.disabled = !!step.disable_continue\r\n      const b = this.current_element.getBoundingClientRect(),\r\n        f = this.frame.getBoundingClientRect()\r\n      this.highlight.style.top = b.top + 'px'\r\n      this.highlight.style.left = b.left + 'px'\r\n      this.highlight.style.width = b.width + 'px'\r\n      this.highlight.style.height = b.height + 'px'\r\n      this.frame.style.top = (b.y < screen.availHeight / 2 ? b.y + b.height + 10 : b.y - f.height - 10) + 'px'\r\n      this.frame.style.marginLeft = -f.width / 2 + 'px'\r\n      if (step.time) {\r\n        this.current_time = step.time\r\n        this.timer.innerText = step.time + ''\r\n        this.running_timer = setInterval(() => {\r\n          this.current_time--\r\n          this.timer.innerText = this.current_time + ''\r\n          if (this.current_time <= 0) {\r\n            clearInterval(this.running_timer as number)\r\n            this.progress_tutorial()\r\n          }\r\n        }, 1e3)\r\n      } else {\r\n        this.timer.innerText = ''\r\n      }\r\n      this.progress.innerText = 'Step ' + (this.current_step + 1) + ' of ' + t.n_steps\r\n      this.dialog.innerText = step.description\r\n      this.current_step++\r\n      this.waiting = false\r\n      this.focuser = setTimeout(() => this.continue.focus(), 0)\r\n    }\r\n  }\r\n  end_tutorial(this: TutorialManager): void {\r\n    this.in_progress = ''\r\n    this.current_step = 0\r\n    this.container.classList.add('hidden')\r\n    this.waiting = false\r\n    clearTimeout(this.focuser as number)\r\n  }\r\n}\r\n","import type {\r\n  Filter,\r\n  FilterParsed,\r\n  MeasureInfo,\r\n  Reference,\r\n  ReferencesParsed,\r\n  ResourceField,\r\n  SlimNote,\r\n  Summary,\r\n  VariableFilterParsed,\r\n} from '../types'\r\nimport {InputCombobox} from './inputs/combobox'\r\nimport type Community from './index'\r\nimport {patterns} from './patterns'\r\nimport {filter_components} from './static_refs'\r\nimport {TutorialManager} from './tutorials'\r\nimport {\r\n  fill_ids_options,\r\n  make_summary_table,\r\n  make_variable_source,\r\n  set_description,\r\n  toggle_input,\r\n  tooltip_trigger,\r\n} from './utils'\r\n\r\ninterface Modal {\r\n  init: boolean\r\n  e: HTMLElement\r\n  header: HTMLElement\r\n  body: HTMLElement\r\n}\r\n\r\ninterface FilterUI extends Modal {\r\n  conditions: HTMLTableElement\r\n  variable_filters: HTMLElement\r\n  entity_filters: HTMLElement\r\n  entity_inputs: {[index: string]: InputCombobox}\r\n  time_range: HTMLElement\r\n}\r\n\r\ninterface InfoUI extends Modal {\r\n  body: HTMLElement\r\n  title: HTMLElement\r\n  description: HTMLElement\r\n  name: HTMLElement\r\n  type: HTMLElement\r\n  sources: HTMLElement\r\n  references: HTMLElement\r\n  origin: HTMLElement\r\n  source_file: HTMLElement\r\n}\r\n\r\ntype Side = 'top' | 'left' | 'bottom' | 'right'\r\n\r\nfunction make_variable_reference(c: Reference) {\r\n  if (!Array.isArray(c.author)) c.author = [c.author]\r\n  const e = document.createElement('li'),\r\n    n = c.author.length\r\n  let s = '',\r\n    j = 1 === n ? '' : 2 === n ? ' & ' : ', & ',\r\n    span = document.createElement('span')\r\n  for (let i = n; i--; ) {\r\n    const a = c.author[i]\r\n    s =\r\n      (i ? j : '') + ('string' === typeof a ? a : a.family + (a.given ? ', ' + a.given.substring(0, 1) + '.' : '')) + s\r\n    j = ', '\r\n  }\r\n  e.innerText = s + ' (' + c.year + '). ' + c.title + '.'\r\n  if (c.journal) {\r\n    e.appendChild(span)\r\n    span.innerText = c.journal + (c.volume ? ', ' + c.volume : '')\r\n    span.style.fontStyle = 'italic'\r\n    e.appendChild((span = document.createElement('span')))\r\n    span.innerText = (c.page ? ', ' + c.page : '') + '.'\r\n  }\r\n  if (c.version) {\r\n    e.appendChild((span = document.createElement('span')))\r\n    span.innerText = ' Version ' + c.version + '.'\r\n  }\r\n  if (c.doi || c.url) {\r\n    e.appendChild((span = document.createElement('span')))\r\n    span.innerText = c.doi ? ' doi: ' : ' url: '\r\n    const a = document.createElement('a')\r\n    e.appendChild(a)\r\n    a.rel = 'noreferrer'\r\n    a.target = '_blank'\r\n    a.href = c.doi ? 'https://doi.org/' + c.doi : c.url\r\n    a.innerText = c.doi || c.url.replace(patterns.http, '')\r\n  }\r\n  return e\r\n}\r\n\r\nclass PageMenu {\r\n  e: HTMLElement\r\n  wrapper: HTMLElement\r\n  toggler?: HTMLButtonElement\r\n  side: Side\r\n  page: Page\r\n  timeout: number | NodeJS.Timeout = -1\r\n  constructor(e: HTMLElement, page: Page) {\r\n    this.e = e\r\n    this.wrapper = e.parentElement\r\n    this.page = page\r\n    this.hide = this.hide.bind(this)\r\n    this.toggle = this.toggle.bind(this)\r\n    const has_toggler = e.lastElementChild.tagName === 'BUTTON'\r\n    if (has_toggler) this.toggler = e.lastElementChild as HTMLButtonElement\r\n    if (e.classList.contains('menu-top')) {\r\n      this.side = 'top'\r\n      page.top_menu = this\r\n      e.style.left = page.content_bounds.left + 'px'\r\n      e.style.right = page.content_bounds.right + 'px'\r\n      if (has_toggler) {\r\n        this.toggler.addEventListener('click', this.toggle)\r\n        this.toggler.style.top = page.content_bounds.top + 'px'\r\n      }\r\n    } else if (e.classList.contains('menu-right')) {\r\n      this.side = 'right'\r\n      page.right_menu = this\r\n      e.style.right = page.content_bounds.right + 'px'\r\n      if (has_toggler) {\r\n        this.toggler.addEventListener('click', this.toggle)\r\n        this.toggler.style.top = page.content_bounds.top + 'px'\r\n      }\r\n    } else if (e.classList.contains('menu-bottom')) {\r\n      this.side = 'bottom'\r\n      page.bottom_menu = this\r\n      page.content_bounds.bottom = 40\r\n      page.bottom_menu.e.style.left = page.content_bounds.left + 'px'\r\n      page.bottom_menu.e.style.right = page.content_bounds.right + 'px'\r\n      if (has_toggler) {\r\n        this.toggler.addEventListener('click', this.toggle)\r\n      }\r\n    } else if (e.classList.contains('menu-left')) {\r\n      this.side = 'left'\r\n      page.left_menu = this\r\n      e.style.left = page.content_bounds.left + 'px'\r\n      if (has_toggler) {\r\n        this.toggler.addEventListener('click', this.toggle)\r\n        this.toggler.style.top = page.content_bounds.top + 'px'\r\n      }\r\n    }\r\n  }\r\n  hide() {\r\n    this.timeout = -1\r\n    this.e.firstElementChild.classList.add('hidden')\r\n    this.page.resize()\r\n  }\r\n  toggle() {\r\n    if (this.timeout !== -1) clearTimeout(this.timeout)\r\n    this.timeout = -1\r\n    if ('closed' === this.e.dataset.state) {\r\n      this.e.dataset.state = 'open'\r\n      this.e.firstElementChild.classList.remove('hidden')\r\n      this.e.style[this.side] = '0px'\r\n      this.page.content.style[this.side] =\r\n        this.e.getBoundingClientRect()['left' === this.side || 'right' === this.side ? 'width' : 'height'] + 'px'\r\n      if ('top' === this.side || 'bottom' === this.side)\r\n        this.toggler.style[this.side] = this.page.content_bounds[this.side] + 'px'\r\n      setTimeout(this.page.trigger_resize, 300)\r\n    } else {\r\n      this.e.dataset.state = 'closed'\r\n      if ('left' === this.side || 'right' === this.side) {\r\n        this.e.style[this.side] = -this.e.getBoundingClientRect().width + 'px'\r\n        this.page.content.style[this.side] = this.page.content_bounds[this.side] + 'px'\r\n      } else {\r\n        const b = this.e.getBoundingClientRect()\r\n        this.page.content.style[this.side] = this.page.content_bounds[this.side] + ('top' === this.side ? 40 : 0) + 'px'\r\n        this.e.style[this.side] = -b.height + ('top' === this.side ? this.page.content_bounds.top : 0) + 'px'\r\n        if ('top' === this.side || 'bottom' === this.side) this.toggler.style[this.side] = b.height + 'px'\r\n      }\r\n      this.timeout = setTimeout(this.hide, 300)\r\n    }\r\n  }\r\n}\r\n\r\nexport class Page {\r\n  site: Community\r\n  load_screen: HTMLElement\r\n  wrap: HTMLElement\r\n  navbar: DOMRect | {height: number}\r\n  content: HTMLElement\r\n  menus: PageMenu[] = []\r\n  panels: NodeListOf<HTMLElement>\r\n  overlay = document.createElement('div')\r\n  selection = document.createElement('span')\r\n  script_style = document.createElement('style')\r\n  modal: {info: InfoUI; filter: FilterUI} = {\r\n    info: {\r\n      init: false,\r\n      e: document.createElement('div'),\r\n      header: document.createElement('div'),\r\n      body: document.createElement('div'),\r\n      title: document.createElement('div'),\r\n      description: document.createElement('div'),\r\n      name: document.createElement('tr'),\r\n      type: document.createElement('tr'),\r\n      sources: document.createElement('div'),\r\n      references: document.createElement('div'),\r\n      origin: document.createElement('div'),\r\n      source_file: document.createElement('div'),\r\n    },\r\n    filter: {\r\n      init: false,\r\n      e: document.createElement('div'),\r\n      header: document.createElement('div'),\r\n      body: document.createElement('div'),\r\n      conditions: document.createElement('table'),\r\n      variable_filters: document.createElement('div'),\r\n      entity_filters: document.createElement('div'),\r\n      entity_inputs: {},\r\n      time_range: document.createElement('div'),\r\n    },\r\n  }\r\n  tooltip = {\r\n    showing: '',\r\n    e: document.createElement('div'),\r\n  }\r\n  content_bounds = {\r\n    top: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    left: 0,\r\n    outer_right: 0,\r\n  }\r\n  elementCount = 0\r\n  top_menu?: PageMenu\r\n  right_menu?: PageMenu\r\n  bottom_menu?: PageMenu\r\n  left_menu?: PageMenu\r\n  tutorials?: TutorialManager\r\n  constructor(site: Community) {\r\n    this.site = site\r\n    this.render_credits = this.render_credits.bind(this)\r\n    this.show_variable_info = this.show_variable_info.bind(this)\r\n    this.tooltip_clear = this.tooltip_clear.bind(this)\r\n    this.site.page = this\r\n    this.load_screen = document.getElementById('load_screen') || document.createElement('div')\r\n    this.wrap = document.getElementById('site_wrap') || document.createElement('div')\r\n    const navbar = document.querySelector('.navbar') as HTMLElement\r\n    if (navbar) {\r\n      this.navbar = navbar.getBoundingClientRect()\r\n      navbar.querySelectorAll('button').forEach(b => {\r\n        const panel = document.querySelector(b.getAttribute('data-bs-target'))\r\n        if (panel && 'false' === panel.getAttribute('data-bs-backdrop')) {\r\n          panel.addEventListener(\r\n            'show.bs.offcanvas',\r\n            function (this: Page) {\r\n              this.content_bounds.outer_right = panel.getBoundingClientRect().width\r\n              this.resize(true)\r\n              setTimeout(this.trigger_resize, 200)\r\n            }.bind(this)\r\n          )\r\n          panel.addEventListener(\r\n            'hide.bs.offcanvas',\r\n            function (this: Page) {\r\n              this.content_bounds.outer_right = 0\r\n              this.resize(true)\r\n              setTimeout(this.trigger_resize, 200)\r\n            }.bind(this)\r\n          )\r\n        }\r\n      })\r\n      if ('navcolor' in site.url_options) {\r\n        if ('' === site.url_options.navcolor) site.url_options.navcolor = window.location.hash\r\n        navbar.style.backgroundColor = (site.url_options.navcolor as string).replace('%23', '#')\r\n      }\r\n      if (site.url_options.hide_logo && site.url_options.hide_title && site.url_options.hide_navcontent) {\r\n        navbar.classList.add('hidden')\r\n      } else {\r\n        const brand = document.querySelector('.navbar-brand')\r\n        if (brand) {\r\n          if (site.url_options.hide_logo && 'IMG' === brand.firstElementChild.tagName)\r\n            brand.firstElementChild.classList.add('hidden')\r\n          if (site.url_options.hide_title && 'IMG' !== brand.lastElementChild.tagName)\r\n            brand.lastElementChild.classList.add('hidden')\r\n        }\r\n        if (site.url_options.hide_navcontent) {\r\n          document.querySelector('.navbar-toggler').classList.add('hidden')\r\n          const nav = document.querySelector('.navbar-nav')\r\n          if (nav) nav.classList.add('hidden')\r\n        }\r\n      }\r\n      if (site.url_options.hide_panels && this.panels.length) {\r\n        this.panels.forEach(p => p.classList.add('hidden'))\r\n      }\r\n    } else {\r\n      this.navbar = {height: 0}\r\n    }\r\n    this.content = document.querySelector('.content') || document.createElement('div')\r\n    this.panels = document.querySelectorAll('.panel')\r\n    this.init_panel = this.init_panel.bind(this)\r\n    this.resize = this.resize.bind(this)\r\n    window.addEventListener('resize', this.resize)\r\n    this.tooltip.e.className = 'tooltip hidden'\r\n    this.tooltip.e.appendChild(document.createElement('p'))\r\n    document.head.appendChild(this.script_style)\r\n    document.body.appendChild(this.tooltip.e)\r\n    document.body.addEventListener('mouseover', this.tooltip_clear)\r\n    this.overlay.className = 'content-overlay'\r\n    document.body.appendChild(this.overlay)\r\n    document.body.className =\r\n      this.site.storage.get('theme_dark') || this.site.spec.settings.theme_dark ? 'dark-theme' : 'light-theme'\r\n    this.content_bounds.top = this.navbar.height\r\n    this.init_variable_info()\r\n    this.init_filter()\r\n    document.querySelectorAll('[data-autotype=credits]').forEach(this.render_credits)\r\n    if (site.spec.tutorials) {\r\n      this.tutorials = new TutorialManager(site.spec.tutorials, site.inputs, site.global_reset)\r\n      this.overlay.appendChild(this.tutorials.container)\r\n    }\r\n  }\r\n  init() {\r\n    this.panels.length && this.panels.forEach(this.init_panel)\r\n    document.querySelectorAll('.menu-wrapper').forEach((m: HTMLElement) => {\r\n      const menu = new PageMenu(m, this)\r\n      this.menus.push(menu)\r\n      if (this.site.url_options.close_menus && 'open' === menu.wrapper.dataset.state) menu.toggler.click()\r\n    })\r\n    if (this.content) {\r\n      this.content.style.top =\r\n        (this.top_menu ? this.top_menu.e.getBoundingClientRect().height : this.navbar.height) + 'px'\r\n    }\r\n    Object.keys(this.site.data.loaded)\r\n      .reverse()\r\n      .forEach(d => {\r\n        const u = InputCombobox.create(\r\n            this.site,\r\n            d,\r\n            void 0,\r\n            {search: true, multi: true, clearable: true},\r\n            'filter.' + d\r\n          ),\r\n          div = document.createElement('div')\r\n        this.modal.filter.entity_inputs[d] = u\r\n        this.modal.filter.entity_filters.lastElementChild.appendChild(div)\r\n        div.className = 'col-sm'\r\n        div.appendChild(u.e.parentElement)\r\n        u.e.parentElement.classList.add('form-floating')\r\n        u.listbox.classList.add('multi')\r\n        u.dataset = d\r\n        u.loader = () => {\r\n          u.site.data.retrieve(u.dataset, u.site.data.info[u.dataset].site_file)\r\n          u.e.removeEventListener('click', u.loader)\r\n        }\r\n        if (!u.site.data.loaded[d]) {\r\n          u.e.addEventListener('click', u.loader)\r\n        }\r\n        u.onchange = () => {\r\n          this.site.view.id_filter()\r\n          this.site.request_queue('view.id')\r\n        }\r\n        fill_ids_options(\r\n          u,\r\n          d,\r\n          u.option_sets,\r\n          function (this: InputCombobox) {\r\n            this.set_current()\r\n            toggle_input(u, !!this.options.length)\r\n            Object.keys(this.values).forEach(id => {\r\n              this.site.view.entities.set(id, this.site.data.entities[id])\r\n            })\r\n            this.site.view.registered[d] = true\r\n            this.set(this.id in this.site.url_options ? (this.site.url_options[this.id] as string).split(',') : -1)\r\n          }.bind(u)\r\n        )\r\n        toggle_input(u, !!u.options.length)\r\n        this.site.registered_inputs.set(u.id, u)\r\n        this.site.inputs[u.id] = u\r\n      })\r\n  }\r\n  init_panel(p: HTMLElement) {\r\n    const side = p.classList.contains('panel-left') ? 'left' : 'right'\r\n    this.content_bounds[side] = p.getBoundingClientRect().width\r\n    p.style.marginTop = this.content_bounds.top + 'px'\r\n    p.lastElementChild.addEventListener('click', () => {\r\n      const w = p.getBoundingClientRect().width,\r\n        bw = p.lastElementChild.getBoundingClientRect().width\r\n      if ('true' === p.lastElementChild.getAttribute('aria-expanded')) {\r\n        this.content_bounds[side] = bw\r\n        if (this.top_menu) this.top_menu.e.style[side] = bw + 'px'\r\n        if (this.bottom_menu) this.bottom_menu.e.style[side] = bw + 'px'\r\n        p.style[side] = -w + bw + 'px'\r\n        p.lastElementChild.setAttribute('aria-expanded', 'false')\r\n      } else {\r\n        this.content_bounds[side] = w\r\n        if (this.top_menu) this.top_menu.e.style[side] = w + 'px'\r\n        if (this.bottom_menu) this.bottom_menu.e.style[side] = w + 'px'\r\n        p.style[side] = '0px'\r\n        p.lastElementChild.setAttribute('aria-expanded', 'true')\r\n      }\r\n      this.resize()\r\n      setTimeout(this.trigger_resize, 200)\r\n    })\r\n  }\r\n  init_variable_info() {\r\n    const e = this.modal.info,\r\n      button = document.createElement('button'),\r\n      a = document.createElement('a')\r\n    let th = document.createElement('th'),\r\n      p = document.createElement('p'),\r\n      div = document.createElement('div'),\r\n      ul = document.createElement('ul')\r\n    document.body.appendChild(e.e)\r\n    this.modal.info.init = true\r\n    e.e.id = 'variable_info_display'\r\n    e.e.className = 'modal fade'\r\n    e.e.setAttribute('tabindex', '-1')\r\n    e.e.setAttribute('aria-labelledby', 'variable_info_title')\r\n    e.e.setAttribute('aria-hidden', 'true')\r\n    e.e.appendChild(div)\r\n    div.className = 'modal-dialog modal-dialog-scrollable'\r\n    div.appendChild((div = document.createElement('div')))\r\n    div.className = 'modal-content'\r\n    div.appendChild(e.header)\r\n    e.header.className = 'modal-header'\r\n    e.header.appendChild(document.createElement('p'))\r\n    e.header.firstElementChild.className = 'h5 modal-title'\r\n    e.header.firstElementChild.id = 'variable_info_title'\r\n    e.header.appendChild(button)\r\n    button.type = 'button'\r\n    button.className = 'btn-close'\r\n    button.setAttribute('data-bs-dismiss', 'modal')\r\n    button.title = 'close'\r\n    e.header.insertAdjacentElement('afterend', e.body)\r\n    e.body.className = 'modal-body'\r\n    e.body.appendChild((e.title = document.createElement('p')))\r\n    e.title.className = 'h4'\r\n    e.body.appendChild((e.description = document.createElement('p')))\r\n\r\n    e.body.appendChild(document.createElement('table'))\r\n    e.body.lastElementChild.className = 'info-feature-table'\r\n\r\n    e.body.lastElementChild.appendChild((e.name = document.createElement('tr')))\r\n    e.name.appendChild(th)\r\n    th.innerText = 'Name'\r\n    e.name.appendChild(document.createElement('td'))\r\n\r\n    e.body.lastElementChild.appendChild((e.type = document.createElement('tr')))\r\n    e.type.appendChild((th = document.createElement('th')))\r\n    th.innerText = 'Type'\r\n    e.type.appendChild(document.createElement('td'))\r\n\r\n    e.body.appendChild(e.sources)\r\n    e.sources.appendChild(p)\r\n    p.innerText = 'Sources'\r\n    p.className = 'h3'\r\n    e.sources.appendChild((div = document.createElement('div')))\r\n    div.className = 'sources-cards'\r\n\r\n    e.body.appendChild(e.references)\r\n    e.references.appendChild((p = document.createElement('p')))\r\n    p.className = 'h3'\r\n    p.innerText = 'References'\r\n    e.references.appendChild(ul)\r\n    ul.className = 'reference-list'\r\n\r\n    e.body.appendChild(e.origin)\r\n    e.origin.appendChild((p = document.createElement('p')))\r\n    p.className = 'h3'\r\n    p.innerText = 'Origin'\r\n    e.origin.appendChild((ul = document.createElement('ul')))\r\n    ul.className = 'origin-list'\r\n\r\n    e.body.appendChild(e.source_file)\r\n    e.source_file.className = 'info-source-file'\r\n    e.source_file.appendChild(a)\r\n    a.innerText = 'source'\r\n    a.target = '_blank'\r\n    a.rel = 'noreferrer'\r\n  }\r\n  show_variable_info(e: MouseEvent) {\r\n    const v = this.site.dataviews[this.site.defaults.dataview],\r\n      name = this.site.valueOf((e.target && (e.target as HTMLButtonElement).dataset.variable) || v.y) as string,\r\n      info = this.site.data.variable_info[name] as MeasureInfo\r\n    ;(this.modal.info.header.firstElementChild as HTMLElement).innerText = info.short_name\r\n    this.modal.info.title.innerText = info.long_name\r\n    set_description(this.modal.info.description, info)\r\n    ;(this.modal.info.name.lastElementChild as HTMLElement).innerText = name\r\n    ;(this.modal.info.type.lastElementChild as HTMLElement).innerText =\r\n      info.unit || info.aggregation_method || info.type || ''\r\n    if (info.sources && info.sources.length) {\r\n      this.modal.info.sources.lastElementChild.innerHTML = ''\r\n      this.modal.info.sources.classList.remove('hidden')\r\n      info.sources.forEach(s => {\r\n        this.modal.info.sources.lastElementChild.appendChild(make_variable_source(s))\r\n      })\r\n    } else this.modal.info.sources.classList.add('hidden')\r\n    if (info.citations && info.citations.length) {\r\n      this.modal.info.references.lastElementChild.innerHTML = ''\r\n      this.modal.info.references.classList.remove('hidden')\r\n      if ('string' === typeof info.citations) info.citations = [info.citations]\r\n      if ('references' in this.site.data) {\r\n        delete this.site.data.variable_info._references\r\n        delete this.site.data.references\r\n      }\r\n      if (!('_references' in this.site.data.variable_info)) {\r\n        const r: ReferencesParsed = {}\r\n        this.site.data.variable_info._references_parsed = r\r\n        Object.keys(this.site.data.info).forEach(d => {\r\n          const m = this.site.data.info[d]\r\n          if ('_references' in m) {\r\n            Object.keys(m._references).forEach(t => {\r\n              if (!(t in r))\r\n                r[t] = {\r\n                  reference: m._references[t],\r\n                  element: make_variable_reference(m._references[t]),\r\n                }\r\n            })\r\n          }\r\n        })\r\n      }\r\n      const r = this.site.data.variable_info._references_parsed\r\n      info.citations.forEach(c => {\r\n        if (c in r) this.modal.info.references.lastElementChild.appendChild(r[c].element)\r\n      })\r\n    } else this.modal.info.references.classList.add('hidden')\r\n    if ('origin' in info) {\r\n      this.modal.info.origin.classList.remove('hidden')\r\n      const l = this.modal.info.origin.lastElementChild\r\n      l.innerHTML = ''\r\n      if ('string' === typeof info.origin) info.origin = [info.origin]\r\n      info.origin.forEach(url => {\r\n        const c = document.createElement('li'),\r\n          repo = patterns.repo.exec(url)[1]\r\n        let link = document.createElement('a')\r\n        link.href = 'https://github.com/' + repo\r\n        link.target = '_blank'\r\n        link.rel = 'noreferrer'\r\n        link.innerText = repo\r\n        c.appendChild(link)\r\n        c.appendChild(document.createElement('span'))\r\n        ;(c.lastElementChild as HTMLElement).innerText = ' / '\r\n        link = document.createElement('a')\r\n        link.href = url\r\n        link.target = '_blank'\r\n        link.rel = 'noreferrer'\r\n        link.innerText = url.replace(patterns.basename, '')\r\n        c.appendChild(link)\r\n        l.appendChild(c)\r\n      })\r\n    } else this.modal.info.origin.classList.add('hidden')\r\n    if (info.source_file) {\r\n      this.modal.info.source_file.classList.remove('hidden')\r\n      ;(this.modal.info.source_file.firstElementChild as HTMLLinkElement).href = info.source_file\r\n    } else this.modal.info.source_file.classList.add('hidden')\r\n  }\r\n  init_filter() {\r\n    // set up filter's time range\r\n    const e = this.modal.filter,\r\n      button = document.createElement('button')\r\n    let p = document.createElement('p'),\r\n      div = document.createElement('div'),\r\n      input = document.createElement('input'),\r\n      label = document.createElement('label'),\r\n      span = document.createElement('span'),\r\n      tr = document.createElement('tr')\r\n    document.body.appendChild(e.e)\r\n    this.modal.filter.init = true\r\n    e.e.id = 'filter_display'\r\n    e.e.className = 'modal fade'\r\n    e.e.setAttribute('aria-labelledby', 'filter_title')\r\n    e.e.setAttribute('aria-hidden', 'true')\r\n    e.e.appendChild(div)\r\n    div.className = 'modal-dialog'\r\n    div.appendChild((div = document.createElement('div')))\r\n    div.className = 'modal-content'\r\n    div.appendChild(e.header)\r\n\r\n    e.header.className = 'modal-header'\r\n    e.header.appendChild(p)\r\n    p.className = 'h5 modal-title'\r\n    p.id = 'filter_title'\r\n    p.innerText = 'Filter'\r\n    e.header.appendChild(button)\r\n    button.type = 'button'\r\n    button.className = 'btn-close'\r\n    button.setAttribute('data-bs-dismiss', 'modal')\r\n    button.title = 'close'\r\n    e.header.insertAdjacentElement('afterend', e.body)\r\n    e.body.className = 'filter-dialog'\r\n    e.body.appendChild((p = document.createElement('p')))\r\n    p.className = 'h6'\r\n    p.innerText = 'Time Range'\r\n\r\n    e.body.appendChild(e.time_range)\r\n    e.time_range.className = 'row'\r\n\r\n    e.time_range.appendChild((div = document.createElement('div')))\r\n    div.className = 'col'\r\n    div.appendChild((div = document.createElement('div')))\r\n    div.className = 'form-floating text-wrapper wrapper'\r\n    div.appendChild(input)\r\n    input.className = 'form-control auto-input'\r\n    input.setAttribute('data-autoType', 'number')\r\n    input.setAttribute('data-default', 'min')\r\n    input.max = 'filter.time_max'\r\n    input.type = 'number'\r\n    input.id = 'filter.time_min'\r\n    div.appendChild(label)\r\n    label.innerText = 'First Time'\r\n    label.setAttribute('for', 'filter.time_min')\r\n    e.time_range.appendChild((div = document.createElement('div')))\r\n    div.className = 'col'\r\n    div.appendChild((div = document.createElement('div')))\r\n    div.className = 'form-floating text-wrapper wrapper'\r\n    div.appendChild((input = document.createElement('input')))\r\n    input.className = 'form-control auto-input'\r\n    input.setAttribute('data-autoType', 'number')\r\n    input.setAttribute('data-default', 'max')\r\n    input.min = 'filter.time_min'\r\n    input.type = 'number'\r\n    input.id = 'filter.time_max'\r\n    div.appendChild((label = document.createElement('label')))\r\n    label.innerText = 'Last Time'\r\n    label.setAttribute('for', 'filter.time_max')\r\n\r\n    // entity filter\r\n    e.body.appendChild(e.entity_filters)\r\n    e.entity_filters.appendChild((p = document.createElement('p')))\r\n    p.className = 'h6'\r\n    p.innerText = 'Select Entities'\r\n    span.className = 'note'\r\n    span.innerText = '(click disabled selectors to load)'\r\n    p.appendChild(span)\r\n    e.entity_filters.appendChild((div = document.createElement('div')))\r\n    div.className = 'row'\r\n    e.entity_inputs = {}\r\n\r\n    e.body.appendChild(e.variable_filters)\r\n    e.variable_filters.appendChild((p = document.createElement('p')))\r\n    p.className = 'h6'\r\n    p.innerText = 'Variable Conditions'\r\n    // variable filter dropdown\r\n    e.variable_filters.appendChild((div = document.createElement('div')))\r\n    div.className = 'row'\r\n    div.appendChild((div = document.createElement('div')))\r\n    div.className = 'col'\r\n    div.appendChild((div = document.createElement('div')))\r\n    const filter_select = InputCombobox.create(\r\n      this.site,\r\n      'Add Variable Condition',\r\n      void 0,\r\n      {strict: true, search: true, clearable: true, floating: true, accordion: true},\r\n      'filter_variable_dropdown'\r\n    )\r\n    filter_select.input = false\r\n    filter_select.settings.filter_table = document.querySelector('.filter-body')\r\n    filter_select.onchange = () => {\r\n      const value = filter_select.value() as string\r\n      if (value in this.site.data.variables) {\r\n        this.add_filter_condition(value)\r\n        filter_select.selection.innerText = ''\r\n        const input = document.querySelectorAll('.filter-body .combobox-input') as NodeListOf<HTMLElement>\r\n        if (input && input.length) input[input.length - 1].focus()\r\n      }\r\n    }\r\n    filter_select.view = this.site.defaults.dataview\r\n    filter_select.optionSource = 'variables'\r\n    this.site.add_dependency(this.site.defaults.dataview, {type: 'options', id: filter_select.id})\r\n    div.appendChild(filter_select.e.parentElement)\r\n    // variable filter table\r\n    e.variable_filters.appendChild((div = document.createElement('div')))\r\n    div.className = 'hidden'\r\n    div.appendChild(e.conditions)\r\n    e.conditions.className = 'filter-conditions-table table'\r\n    e.conditions.appendChild(document.createElement('thead'))\r\n    e.conditions.lastElementChild.className = 'filter-header'\r\n    e.conditions.appendChild(document.createElement('tbody'))\r\n    e.conditions.lastElementChild.className = 'filter-body'\r\n    e.conditions.firstElementChild.appendChild(tr)\r\n    ;['Variable', 'Result', 'Active', 'Component', 'Operator', 'Value', 'Remove'].forEach(h => {\r\n      const th = document.createElement('th')\r\n      tr.appendChild(th)\r\n      if ('Component' === h || 'Result' === h) {\r\n        const l: SlimNote = {\r\n          id: '',\r\n          note: '',\r\n          site: this.site,\r\n          wrapper: document.createElement('label'),\r\n        }\r\n        if ('Component' === h) {\r\n          l.id = 'filter_component_header'\r\n          l.note =\r\n            'Component refers to which single value to filter on for each entity; select a dynamic time reference, or enter a time.'\r\n        } else {\r\n          l.id = 'filter_result_header'\r\n          l.note = 'Passing / total entities across loaded datasets.'\r\n        }\r\n        th.appendChild(l.wrapper)\r\n        th.className = 'has-note'\r\n        l.wrapper.innerText = h\r\n        l.wrapper.id = l.id\r\n        l.wrapper.setAttribute('data-of', l.id)\r\n        l.wrapper.setAttribute('aria-description', l.note)\r\n        th.addEventListener('mouseover', tooltip_trigger.bind(l))\r\n      } else {\r\n        th.innerText = h\r\n      }\r\n    })\r\n    e.variable_filters.lastElementChild.appendChild((p = document.createElement('p')))\r\n    p.className = 'note'\r\n    p.innerText = 'Summaries are across time within each unfiltered dataset.'\r\n  }\r\n  resize(e?: Event | boolean) {\r\n    const full = e && 'boolean' === typeof e,\r\n      f = this[full ? 'wrap' : 'content']\r\n    if (!full) {\r\n      f.style.top =\r\n        (this.top_menu && 'open' === this.top_menu.e.dataset.state\r\n          ? this.top_menu.e.getBoundingClientRect().height\r\n          : this.content_bounds.top +\r\n            ((!this.top_menu && !this.left_menu && !this.right_menu) ||\r\n            (this.right_menu && 'open' === this.right_menu.e.dataset.state) ||\r\n            (this.left_menu && 'open' === this.left_menu.e.dataset.state)\r\n              ? 0\r\n              : 40)) + 'px'\r\n      f.style.bottom =\r\n        this.content_bounds.bottom +\r\n        (!this.bottom_menu || 'closed' === this.bottom_menu.e.dataset.state\r\n          ? 0\r\n          : this.bottom_menu.e.getBoundingClientRect().height) +\r\n        'px'\r\n      f.style.left =\r\n        this.content_bounds.left +\r\n        (!this.left_menu || 'closed' === this.left_menu.e.dataset.state\r\n          ? 0\r\n          : this.left_menu.e.getBoundingClientRect().width) +\r\n        'px'\r\n    }\r\n    f.style.right =\r\n      this.content_bounds[full ? 'outer_right' : 'right'] +\r\n      (!this.right_menu || 'closed' === this.right_menu.e.dataset.state\r\n        ? 0\r\n        : this.right_menu.e.getBoundingClientRect().width) +\r\n      'px'\r\n  }\r\n  tooltip_clear(e: MouseEvent) {\r\n    const target = e.target as HTMLElement\r\n    if (this.tooltip.showing && ('blur' === e.type || this.tooltip.showing !== (target.dataset.of || target.id))) {\r\n      this.tooltip.showing = ''\r\n      this.tooltip.e.classList.add('hidden')\r\n    }\r\n  }\r\n  add_filter_condition(variable: string, presets?: VariableFilterParsed | Filter) {\r\n    presets = presets || {operator: '>=', value: 0}\r\n    let tr = document.createElement('tr'),\r\n      td = document.createElement('td'),\r\n      p = document.createElement('p'),\r\n      label = document.createElement('label'),\r\n      div = document.createElement('div'),\r\n      input = document.createElement('input'),\r\n      select = document.createElement('select'),\r\n      button = document.createElement('button')\r\n    const f: FilterParsed = {\r\n        e: tr,\r\n        variable: variable,\r\n        component: presets.component || 'last',\r\n        operator: presets.operator || '>=',\r\n        value: (presets.value as string | number) || 0,\r\n        active: true,\r\n        id: variable + '_' + Date.now(),\r\n        passed: 0,\r\n        failed: 0,\r\n        info: this.site.data.variables[variable].info,\r\n        view: this.site.dataviews[this.site.defaults.dataview],\r\n      },\r\n      d = f.view.get.dataset(),\r\n      range = f.info[d].time_range,\r\n      times = this.site.data.meta.overall.value,\r\n      formatter = this.site.data.format_value.bind(this.site.data)\r\n    this.site.view.filters.set(f.id, f)\r\n    if ('number' === typeof f.component) f.component = times[f.component] + ''\r\n    // variable name\r\n    tr.appendChild(td)\r\n    td.appendChild(p)\r\n    p.id = f.id\r\n    p.className = 'cell-text'\r\n    p.innerText = f.info[d].info.short_name\r\n    td.appendChild(p)\r\n    td.appendChild((p = document.createElement('p')))\r\n    f.summary = {\r\n      f,\r\n      update: function () {\r\n        const d = f.view.get.dataset(),\r\n          range = f.info[d].time_range\r\n        if (d !== this.add.Dataset) {\r\n          this.add.Dataset = d\r\n          this.add.First = this.times[range[0]] + '' || 'NA'\r\n          this.add.Last = this.times[range[1]] + '' || 'NA'\r\n          const s = this.f.info[d],\r\n            heads = this.table.firstElementChild.firstElementChild.children as HTMLCollectionOf<HTMLTableCellElement>,\r\n            cells = this.table.lastElementChild.firstElementChild.children as HTMLCollectionOf<HTMLTableCellElement>\r\n          for (let i = cells.length; i--; ) {\r\n            const h = heads[i].innerText as keyof typeof this.add,\r\n              n = h.toLowerCase() as keyof ResourceField\r\n            cells[i].innerText = n in s ? this.format(s[n] as number) + '' : this.add[h]\r\n          }\r\n        }\r\n      },\r\n      add: {\r\n        Dataset: d,\r\n        First: times[range[0]] + '' || 'NA',\r\n        Last: times[range[1]] + '' || 'NA',\r\n      },\r\n      times: this.site.data.meta.overall.value,\r\n      format: formatter,\r\n    }\r\n    f.summary.table = make_summary_table(formatter, p, f.info[d], f.summary.add)\r\n    // filter result\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild((p = document.createElement('p')))\r\n    p.setAttribute('aria-describedby', f.id)\r\n    p.className = 'cell-text'\r\n    p.innerText = '0/0'\r\n    // active switch\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild(label)\r\n    label.innerText = 'Active'\r\n    label.className = 'filter-label'\r\n    label.id = f.id + '_switch'\r\n    td.appendChild(div)\r\n    div.className = 'form-check form-switch filter-form-input'\r\n    div.appendChild(input)\r\n    input.className = 'form-check-input'\r\n    input.type = 'checkbox'\r\n    input.role = 'switch'\r\n    input.setAttribute('aria-labelledby', f.id + '_switch')\r\n    input.setAttribute('aria-describedby', f.id)\r\n    input.checked = true\r\n    input.addEventListener('change', () => {\r\n      f.active = !f.active\r\n      this.site.request_queue('view.filter')\r\n    })\r\n    // component combobox\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild((label = document.createElement('label')))\r\n    label.innerText = 'Component'\r\n    label.className = 'filter-label'\r\n    label.id = f.id + '_component'\r\n    const comp_select = InputCombobox.create(this.site, 'component', filter_components.Time)\r\n    comp_select.default = f.component\r\n    comp_select.set(f.component)\r\n    tr.lastElementChild.appendChild(comp_select.e.parentElement)\r\n    comp_select.e.parentElement.removeChild(comp_select.e.parentElement.lastElementChild)\r\n    comp_select.e.parentElement.classList.add('filter-form-input')\r\n    comp_select.e.setAttribute('aria-labelledby', f.id + '_component')\r\n    comp_select.input_element.setAttribute('aria-labelledby', f.id + '_component')\r\n    comp_select.input_element.setAttribute('aria-describedby', f.id)\r\n    comp_select.listbox.setAttribute('aria-labelledby', f.id + '_component')\r\n    comp_select.onchange = () => {\r\n      f.component = comp_select.value() as string\r\n      this.site.request_queue('view.filter')\r\n    }\r\n    // operator select\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild((label = document.createElement('label')))\r\n    label.innerText = 'Operator'\r\n    label.className = 'filter-label'\r\n    label.id = f.id + '_operator'\r\n    tr.lastElementChild.appendChild(select)\r\n    select.className = 'form-select filter-form-input'\r\n    select.setAttribute('aria-labelledby', f.id + '_operator')\r\n    select.setAttribute('aria-describedby', f.id)\r\n    select.addEventListener('change', e => {\r\n      f.operator = (e.target as HTMLSelectElement).selectedOptions[0].value\r\n      this.site.request_queue('view.filter')\r\n    })\r\n    ;['>=', '=', '!=', '<='].forEach(k => {\r\n      const option = document.createElement('option')\r\n      select.appendChild(option)\r\n      option.value = option.innerText = k\r\n      if (k === f.operator) option.selected = true\r\n    })\r\n    // value input\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild((label = document.createElement('label')))\r\n    label.innerText = 'Value'\r\n    label.className = 'filter-label'\r\n    label.id = f.id + '_value'\r\n    const value_select = InputCombobox.create(this.site, 'component', ['min', 'q1', 'median', 'mean', 'q3', 'max'])\r\n    value_select.value_type = 'number'\r\n    value_select.default = f.value\r\n    value_select.set(f.value)\r\n    td.appendChild(value_select.e.parentElement)\r\n    value_select.e.parentElement.removeChild(value_select.e.parentElement.lastElementChild)\r\n    value_select.e.parentElement.classList.add('filter-form-input')\r\n    value_select.e.setAttribute('aria-labelledby', f.id + '_value')\r\n    value_select.input_element.setAttribute('aria-labelledby', f.id + '_value')\r\n    value_select.input_element.setAttribute('aria-describedby', f.id)\r\n    value_select.listbox.setAttribute('aria-labelledby', f.id + '_value')\r\n    value_select.onchange = async function (this: InputCombobox, f: FilterParsed) {\r\n      f.value = this.value() as number | string\r\n      if (this.site.patterns.number.test(f.value + '')) {\r\n        f.value = +f.value\r\n        f.value_source = ''\r\n      } else {\r\n        f.view.reparse()\r\n        const v = await this.site.data.get_variable(f.variable, f.view),\r\n          s = v && v.views[f.view.id].summaries[f.view.parsed.dataset]\r\n        if (s && f.value in s) {\r\n          const a = f.view.parsed.variable_values.get(f.id),\r\n            k = f.value as keyof Summary,\r\n            time = a.comp_fun(a, f.view.parsed) as number\r\n          f.value_source = f.value\r\n          f.value = (s[k] as (number | string)[])[time]\r\n        }\r\n      }\r\n      this.site.request_queue('view.filter')\r\n    }.bind(value_select, f)\r\n    // remove button\r\n    tr.appendChild((td = document.createElement('td')))\r\n    td.appendChild((label = document.createElement('label')))\r\n    label.innerText = 'Remove'\r\n    label.className = 'filter-label'\r\n    label.id = f.id + '_remove'\r\n    td.appendChild(button)\r\n    button.className = 'btn-close filter-form-input'\r\n    button.type = 'button'\r\n    button.setAttribute('aria-labelledby', f.id + '_remove')\r\n    button.setAttribute('aria-describedby', f.id)\r\n    button.addEventListener(\r\n      'mouseup',\r\n      function (this: {filter: FilterParsed; site: Community}, e: MouseEvent) {\r\n        if (!e.button) {\r\n          this.filter.e.parentElement.removeChild(this.filter.e)\r\n          this.site.view.filters.delete(this.filter.id)\r\n          if (!this.site.view.filters.size)\r\n            this.site.page.modal.filter.variable_filters.lastElementChild.classList.add('hidden')\r\n          this.site.request_queue('view.filter')\r\n        }\r\n      }.bind({filter: f, site: this.site})\r\n    )\r\n    this.site.request_queue('view.filter')\r\n    this.modal.filter.conditions.lastElementChild.appendChild(tr)\r\n    this.modal.filter.variable_filters.lastElementChild.classList.remove('hidden')\r\n  }\r\n  trigger_resize() {\r\n    window.dispatchEvent(new Event('resize'))\r\n  }\r\n  render_credits(e: HTMLElement) {\r\n    const s = this.site.spec.credit_output && this.site.spec.credit_output[e.id],\r\n      exclude = (s && s.exclude) || [],\r\n      add = (s && s.add) || {},\r\n      credits = {...this.site.spec.credits, ...add}\r\n    e.appendChild(document.createElement('ul'))\r\n    Object.keys(credits).forEach(k => {\r\n      if (-1 === exclude.indexOf(k)) {\r\n        const c = credits[k],\r\n          li = document.createElement('li')\r\n        e.lastElementChild.appendChild(li)\r\n        if ('url' in c) {\r\n          const a = document.createElement('a')\r\n          li.appendChild(a)\r\n          a.href = c.url\r\n          a.target = '_blank'\r\n          a.rel = 'noreferrer'\r\n          a.innerText = c.name\r\n        } else {\r\n          li.innerText = c.name\r\n        }\r\n        if ('version' in c) {\r\n          const span = document.createElement('span')\r\n          li.appendChild(span)\r\n          span.className = 'version-tag'\r\n          span.innerText = c.version\r\n        }\r\n        if ('description' in c) {\r\n          const p = document.createElement('p')\r\n          li.parentElement.appendChild(p)\r\n          p.innerText = c.description\r\n        }\r\n      }\r\n    })\r\n  }\r\n}\r\n","import DataHandler from '../../data_handler/index'\r\nimport type {Generic, SiteCondition} from '../../types'\r\nimport type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport type VirtualSpec = {\r\n  id: string\r\n  states: {\r\n    condition: SiteCondition[]\r\n    value: string\r\n  }[]\r\n  default: string\r\n  display: Generic\r\n}\r\n\r\nexport class InputVirtual extends BaseInput {\r\n  type: 'virtual' = 'virtual'\r\n  spec: VirtualSpec\r\n  states: {\r\n    condition: SiteCondition[]\r\n    value: string | number\r\n  }[] = []\r\n  source: string | number\r\n  values: (string | number)[] = []\r\n  display: Generic\r\n  constructor(spec: VirtualSpec, site: Community) {\r\n    const e = document.createElement('input')\r\n    e.id = spec.id\r\n    super(e, site)\r\n    this.source = this.default = spec.default\r\n    if (this.source) this.values.push(this.source)\r\n    if (spec.states) this.states = spec.states\r\n    if (spec.display) this.display = spec.display\r\n    const p: {[index: string]: {type: 'update'; id: string}} = {}\r\n    this.states.forEach(si => {\r\n      this.values.push(si.value)\r\n      si.condition.forEach(c => {\r\n        p[c.id] = {type: 'update', id: this.id}\r\n        this.site.add_dependency(c.id, p[c.id])\r\n      })\r\n    })\r\n    this.update()\r\n  }\r\n  init() {\r\n    this.values.forEach(id => {\r\n      if ('string' === typeof id && id in this.site.inputs) this.site.add_dependency(id, {type: 'update', id: this.id})\r\n    })\r\n  }\r\n  update() {\r\n    this.source = void 0\r\n    for (let p, i = this.states.length; i--; ) {\r\n      p = true\r\n      for (let c = this.states[i].condition.length; c--; ) {\r\n        const r = this.states[i].condition[c]\r\n        if (DataHandler.checks[r.type](this.site.valueOf(r.id), this.site.valueOf(r.value))) {\r\n          if (r.any) {\r\n            p = true\r\n            break\r\n          }\r\n        } else p = false\r\n      }\r\n      if (p) {\r\n        this.source = this.states[i].value\r\n        break\r\n      }\r\n    }\r\n    if (!this.source) this.source = this.default as string\r\n    if (this.source !== this.previous) {\r\n      this.previous = this.source\r\n      this.site.request_queue(this.id)\r\n    } else if (this.source in this.site.inputs) {\r\n      const r = this.site.inputs[this.source].value()\r\n      if (r !== this.previous) {\r\n        this.previous = r\r\n        this.site.request_queue(this.id)\r\n      }\r\n    }\r\n  }\r\n  value() {\r\n    return this.site.valueOf(this.source)\r\n  }\r\n  set(v: string | number) {\r\n    if (-1 !== this.values.indexOf(v)) {\r\n      this.previous = this.source\r\n      this.source = v\r\n    } else if (this.source in this.site.inputs) {\r\n      const c = this.site.inputs[this.source]\r\n      if (\r\n        'values' in c &&\r\n        (Array.isArray(c.values) ? -1 !== c.values.indexOf(v) : v in c.values || ('display' in c && v in c.display))\r\n      ) {\r\n        c.set(v)\r\n      }\r\n    }\r\n    this.site.request_queue(this.id)\r\n  }\r\n}\r\n","export const value_types: {[index: string]: Function} = {\r\n  percent: function (v: number): string {\r\n    return v + '%'\r\n  },\r\n  minute: function (v: number): string {\r\n    return v + ' minutes'\r\n  },\r\n  minutes: function (v: number): string {\r\n    return v + ' minutes'\r\n  },\r\n  dollars: function (v: number): string {\r\n    return '$' + v\r\n  },\r\n  'Mb/s': function (v: number): string {\r\n    return v + ' Mbps'\r\n  },\r\n}\r\n","import type {SiteSpec} from '../../types'\r\nimport type Community from '../index'\r\nimport type {OutputDataTable} from './datatables'\r\nimport type {OutputInfo} from './info'\r\nimport type {OutputLegend} from './legend'\r\nimport type {OutputMap} from './map'\r\nimport type {OutputPlotly} from './plotly'\r\nimport type {OutputTable} from './table'\r\nimport type {OutputText} from './text'\r\n\r\ntype OutputTypes = 'info' | 'map' | 'plotly' | 'text' | 'datatable' | 'table' | 'legend'\r\nexport type SiteOutputs =\r\n  | OutputInfo\r\n  | OutputMap\r\n  | OutputPlotly\r\n  | OutputText\r\n  | OutputDataTable\r\n  | OutputTable\r\n  | OutputLegend\r\nexport type RegisteredOutputs = {[index: string]: SiteOutputs}\r\n\r\nexport abstract class BaseOutput {\r\n  type: OutputTypes\r\n  input = false\r\n  site: Community\r\n  view: string\r\n  e: HTMLElement\r\n  tab?: HTMLElement\r\n  id: string\r\n  note: string\r\n  color?: string\r\n  x?: string\r\n  y?: string\r\n  spec: {[index: string]: any} = {}\r\n  deferred = false\r\n  constructor(e: HTMLElement, site: Community) {\r\n    this.e = e\r\n    this.tab = 'tabpanel' === e.parentElement.getAttribute('role') ? e.parentElement : void 0\r\n    this.site = site\r\n    this.view = e.dataset.view || site.defaults.dataview\r\n    this.id = e.id || 'ui' + site.page.elementCount++\r\n    this.note = e.getAttribute('aria-description') || ''\r\n    this.type = e.dataset.autotype as OutputTypes\r\n    if (this.type in site.spec) {\r\n      const spec = site.spec[this.type as keyof SiteSpec] as SiteOutputs\r\n      if (this.id in spec) this.spec = (spec as any)[this.id]\r\n    }\r\n  }\r\n}\r\n","import type {Entity, LogicalObject, MeasureInfo, Summary, Variable} from '../../types'\r\nimport type Community from '../index'\r\nimport {filter_components} from '../static_refs'\r\nimport {make_summary_table, make_variable_source} from '../utils'\r\nimport {value_types} from '../value_types'\r\nimport {BaseOutput, SiteOutputs} from './index'\r\n\r\ntype InfoSpec = {\r\n  title?: string\r\n  body?: {name: string; value: string; style: string}[]\r\n  subto?: string[]\r\n  dataview: string\r\n  variable?: string\r\n  default?: {body?: string; title?: string}\r\n  variable_info?: boolean\r\n  show_summary?: boolean\r\n  floating?: boolean\r\n}\r\n\r\ntype Parsed = {\r\n  data?: string\r\n  variables?: string\r\n  features?: string\r\n  summary?: HTMLTableElement\r\n  filter?: HTMLTableElement\r\n}\r\n\r\nclass InfoPart {\r\n  parent: OutputInfo\r\n  text: string\r\n  value_source: string\r\n  parsed: Parsed = {}\r\n  ref = true\r\n  selection = false\r\n  base?: HTMLButtonElement | HTMLParagraphElement\r\n  temp?: HTMLButtonElement | HTMLParagraphElement\r\n  default?: HTMLButtonElement | HTMLParagraphElement\r\n  rows?: {name: InfoPart; value: InfoPart}[]\r\n  constructor(parent: OutputInfo, text: string) {\r\n    this.parent = parent\r\n    this.text = text\r\n    if ('value' === text) {\r\n      this.parsed.data = parent.spec.variable\r\n    } else if ('summary' === text) {\r\n      parent.spec.show_summary = true\r\n    } else if ('filter' === text) {\r\n      const e = document.createElement('table')\r\n      e.className = 'info-filter'\r\n      this.parsed.filter = e\r\n    }\r\n    const patterns = parent.site.patterns\r\n    if (patterns.features.test(text)) {\r\n      this.parsed.features = text.replace(patterns.features, '')\r\n    } else if (parent.site.patterns.data.test(text)) {\r\n      this.parsed.data = text.replace(patterns.data, '')\r\n    } else if (patterns.variables.test(text)) {\r\n      this.parsed.variables = text.replace(patterns.variables, '')\r\n    } else this.ref = false\r\n  }\r\n  get(entity?: Entity, caller?: SiteOutputs) {\r\n    if (this.ref && this.parent.site.data) {\r\n      if (entity)\r\n        if ('features' in this.parsed) {\r\n          return entity.features[this.parsed.features]\r\n        } else if ('data' in this.parsed) {\r\n          if ('value' === this.text) {\r\n            this.parsed.data = this.parent.site.valueOf(\r\n              this.parent.spec.variable ||\r\n                (caller && (caller.color || caller.y)) ||\r\n                this.parent.site.dataviews[this.parent.view].y\r\n            ) as string\r\n          } else if (this.text in this.parent.site.inputs)\r\n            this.parsed.data = this.parent.site.valueOf(this.text) as string\r\n          if (!(this.parsed.data in this.parent.site.data.variables)) return this.parsed.data\r\n          const info = this.parent.site.data.variables[this.parsed.data],\r\n            v = this.parent.site.data.format_value(\r\n              entity.get_value(this.parsed.data, this.parent.time),\r\n              info && info.info[entity.group] && 'integer' === info.info[entity.group].type\r\n            )\r\n          let type = info.meta.unit || info.meta.type\r\n          if (info.meta.aggregation_method && !(type in value_types)) type = info.meta.aggregation_method\r\n          return (!isNaN(v as number) && type in value_types ? value_types[type](v) : v) + ''\r\n        }\r\n      const info = this.parent.site.data.variable_info\r\n      if ('data' in this.parsed) {\r\n        return this.parent.site.data.meta.times[this.parent.dataset].value[this.parent.time_agg] + ''\r\n      } else if ('variables' in this.parsed && (this.value_source || this.parent.v in info)) {\r\n        const v = this.parent.site.valueOf(this.value_source || this.parent.v) as string,\r\n          i = info[v] as MeasureInfo\r\n        return (this.parsed.variables in i ? i[this.parsed.variables as keyof MeasureInfo] : this.text) as string\r\n      }\r\n      return this.text\r\n    } else return this.text\r\n  }\r\n}\r\n\r\nexport class OutputInfo extends BaseOutput {\r\n  type: 'info' = 'info'\r\n  dataset: string\r\n  time_agg: number\r\n  time: number\r\n  v: string\r\n  showing = false\r\n  has_default = false\r\n  selection = false\r\n  processed = false\r\n  depends: LogicalObject = {}\r\n  parts: {\r\n    title?: InfoPart\r\n    body?: {\r\n      base: HTMLElement\r\n      temp: HTMLElement\r\n      default: HTMLElement\r\n      rows: {base: HTMLElement; temp: HTMLElement; name: InfoPart; value: InfoPart}[]\r\n    }\r\n  } = {}\r\n  var: Variable\r\n  summary: Summary\r\n  options: InfoSpec\r\n  queue: number | NodeJS.Timeout\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.update = this.update.bind(this)\r\n    this.has_default = this.spec.default && (!!this.spec.default.title || !!this.spec.default.body)\r\n    this.site.subs.add(this.view, this)\r\n    if (this.spec.floating) {\r\n      document.body.appendChild(this.e)\r\n      this.e.classList.add('hidden')\r\n      document.addEventListener(\r\n        'mousemove',\r\n        function (this: OutputInfo, e: MouseEvent) {\r\n          if (this.showing) {\r\n            const f = this.site.page.content.getBoundingClientRect()\r\n            this.e.style.top = (e.y > f.height / 2 ? e.y - this.e.getBoundingClientRect().height - 10 : e.y + 10) + 'px'\r\n            this.e.style.left = (e.x > f.width / 2 ? e.x - this.e.getBoundingClientRect().width - 10 : e.x + 10) + 'px'\r\n          }\r\n        }.bind(this)\r\n      )\r\n    }\r\n    if (this.spec.title) {\r\n      this.parts.title = new InfoPart(this, this.spec.title)\r\n      if (\r\n        this.spec.variable_info &&\r\n        'variables' in this.parts.title.parsed &&\r\n        this.site.patterns.measure_name.test(this.parts.title.parsed.variables)\r\n      ) {\r\n        this.parts.title.base = document.createElement('button')\r\n        this.parts.title.base.type = 'button'\r\n        this.parts.title.base.setAttribute('data-bs-toggle', 'modal')\r\n        this.parts.title.base.setAttribute('data-bs-target', '#variable_info_display')\r\n        this.parts.title.base.addEventListener('click', this.site.page.show_variable_info)\r\n      } else this.parts.title.base = document.createElement('p')\r\n      this.parts.title.base.appendChild(document.createElement('span'))\r\n      this.parts.title.temp = document.createElement('p')\r\n      this.parts.title.default = document.createElement('p')\r\n      this.parts.title.temp.className =\r\n        this.parts.title.base.className =\r\n        this.parts.title.default.className =\r\n          'info-title hidden'\r\n      if (this.has_default && this.spec.default.title) {\r\n        this.e.appendChild(this.parts.title.default)\r\n        this.parts.title.default.innerText = this.spec.default.title\r\n      }\r\n      if (!this.parts.title.ref)\r\n        (this.parts.title.base.firstElementChild as HTMLElement).innerText = this.parts.title.get()\r\n      this.e.appendChild(this.parts.title.base)\r\n      this.e.appendChild(this.parts.title.temp)\r\n      this.parts.title.base.classList.add('hidden')\r\n      this.parts.title.temp.classList.add('hidden')\r\n    }\r\n    if (this.spec.body || (this.has_default && this.spec.default.body)) {\r\n      this.parts.body = {\r\n        base: document.createElement('div'),\r\n        temp: document.createElement('div'),\r\n        default: document.createElement('div'),\r\n        rows: [],\r\n      }\r\n      this.parts.body.temp.className =\r\n        this.parts.body.base.className =\r\n        this.parts.body.default.className =\r\n          'info-body hidden'\r\n      if (this.has_default && this.spec.default.body) this.parts.body.default.innerText = this.spec.default.body\r\n      let h = 0\r\n      this.spec.body &&\r\n        (this.spec.body as {name: string; value: string; style: string}[]).forEach((op, i) => {\r\n          const p = {\r\n              name: new InfoPart(this, op.name),\r\n              value: new InfoPart(this, op.value),\r\n              base: document.createElement('div'),\r\n              temp: document.createElement('div'),\r\n            },\r\n            base = document.createElement('div'),\r\n            temp = document.createElement('div')\r\n          this.parts.body.rows[i] = p\r\n          this.parts.body.base.appendChild(p.base)\r\n          this.parts.body.temp.appendChild(p.temp)\r\n          p.temp.className = p.base.className = 'info-body-row-' + op.style\r\n          h += 24 + ('stack' === op.style ? 24 : 0)\r\n          if (p.name) {\r\n            if (\r\n              this.spec.variable_info &&\r\n              'variables' in p.name.parsed &&\r\n              this.site.patterns.measure_name.test(p.name.parsed.variables)\r\n            ) {\r\n              p.base.appendChild(document.createElement('button'))\r\n              p.base.lastElementChild.role = 'button'\r\n              p.base.lastElementChild.setAttribute('data-bs-toggle', 'modal')\r\n              p.base.lastElementChild.setAttribute('data-bs-target', '#variable_info_display')\r\n              p.base.lastElementChild.addEventListener('click', this.site.page.show_variable_info)\r\n            } else p.base.appendChild(base)\r\n            p.temp.appendChild(temp)\r\n            base.className = temp.className = 'info-body-row-name'\r\n            base.innerText = temp.innerText = p.name.get()\r\n          }\r\n          if (p.value) {\r\n            p.base.appendChild(document.createElement('div'))\r\n            p.temp.appendChild(document.createElement('div'))\r\n          }\r\n        })\r\n      this.e.style.minHeight = h + 'px'\r\n      this.e.appendChild(this.parts.body.base)\r\n      this.e.appendChild(this.parts.body.default)\r\n      this.e.appendChild(this.parts.body.temp)\r\n    }\r\n  }\r\n  init() {\r\n    if (this.spec.title && 'summary' === this.spec.title) {\r\n      this.parts.title.parsed.summary = make_summary_table(this.site.data.format_value, this.e)\r\n    }\r\n    if (this.parts.body && this.parts.body.rows)\r\n      this.parts.body.rows.forEach(r => {\r\n        if (r.name && 'summary' === r.name.text)\r\n          r.name.parsed.summary = make_summary_table(this.site.data.format_value, this.e)\r\n        if (r.value) {\r\n          if ('summary' === r.value.text) {\r\n            r.value.parsed.summary = make_summary_table(this.site.data.format_value, this.e)\r\n            r.base.lastElementChild.appendChild(r.value.parsed.summary)\r\n          } else if ('filter' in r.value.parsed) {\r\n            r.base.lastElementChild.appendChild(r.value.parsed.filter)\r\n          } else {\r\n            const base = r.base.lastElementChild as HTMLElement,\r\n              temp = r.temp.lastElementChild as HTMLElement\r\n            temp.className = base.className =\r\n              'info-body-row-value' + ('statement' === r.value.parsed.variables ? ' statement' : '')\r\n            if (r.name.ref && 'value' === r.value.text) r.value.ref = true\r\n            if (!r.value.ref) temp.innerText = base.innerText = r.value.get()\r\n          }\r\n        }\r\n      })\r\n    this.update()\r\n  }\r\n  show(e: Entity, u: SiteOutputs) {\r\n    this.update(e, u)\r\n    this.showing = true\r\n    if (this.spec.floating) this.e.classList.remove('hidden')\r\n    if (this.parts.title) {\r\n      if (this.selection) {\r\n        this.parts.title.base.classList.add('hidden')\r\n      } else this.parts.title.default.classList.add('hidden')\r\n      this.parts.title.temp.classList.remove('hidden')\r\n    }\r\n    if (this.parts.body) {\r\n      if (this.selection) {\r\n        this.parts.body.base.classList.add('hidden')\r\n      } else this.parts.body.default.classList.add('hidden')\r\n      this.parts.body.temp.classList.remove('hidden')\r\n    }\r\n  }\r\n  revert() {\r\n    this.showing = false\r\n    if (this.spec.floating) {\r\n      this.e.classList.add('hidden')\r\n    } else {\r\n      if (this.parts.title) {\r\n        if (this.selection) {\r\n          this.parts.title.base.classList.remove('hidden')\r\n        } else if (this.has_default) this.parts.title.default.classList.remove('hidden')\r\n        this.parts.title.temp.classList.add('hidden')\r\n      }\r\n      if (this.parts.body) {\r\n        if (this.selection) {\r\n          this.parts.body.base.classList.remove('hidden')\r\n        } else if (this.has_default) this.parts.body.default.classList.remove('hidden')\r\n        this.parts.body.temp.classList.add('hidden')\r\n      }\r\n    }\r\n  }\r\n  async update(entity?: Entity, caller?: SiteOutputs, pass?: boolean) {\r\n    const v = this.site.dataviews[this.view]\r\n    if (!v) return\r\n    const y = this.site.inputs[v.time_agg]\r\n    this.v = this.site.valueOf(this.spec.variable || (caller && (caller.color || caller.y)) || v.y) as string\r\n    this.dataset = v.get.dataset()\r\n    if (y && !(this.dataset in this.site.data.meta.times)) {\r\n      if (!(this.id in this.site.data.data_queue[this.dataset]))\r\n        this.site.data.data_queue[this.dataset][this.id] = this.update\r\n      return\r\n    }\r\n    this.time_agg = y ? (y.value() as number) - this.site.data.meta.times[this.dataset].range[0] : 0\r\n    const time_range = this.v in this.site.data.variables && this.site.data.variables[this.v].time_range[this.dataset]\r\n    this.time = time_range ? this.time_agg - time_range[0] : 0\r\n    if (this.spec.show_summary) {\r\n      this.var = this.v && (await this.site.data.get_variable(this.v, this.site.dataviews[this.view]))\r\n      this.summary = this.view in this.var.views && this.var.views[this.view].summaries[this.dataset]\r\n    }\r\n    if (!this.processed) {\r\n      this.processed = true\r\n      if (!this.spec.floating) {\r\n        this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n        if (v.y in this.site.inputs) this.site.add_dependency(v.y, {type: 'update', id: this.id})\r\n        if (y) this.site.add_dependency(v.time_agg as string, {type: 'update', id: this.id})\r\n        if (this.spec.variable in this.site.inputs)\r\n          this.site.add_dependency(this.spec.variable, {type: 'update', id: this.id})\r\n      }\r\n      if (this.parts.body)\r\n        this.parts.body.rows.forEach(p => {\r\n          if (!p.value.ref && p.value.text in this.site.inputs && 'variables' in p.name.parsed) {\r\n            p.name.value_source = p.value.value_source = p.value.text\r\n            p.value.ref = true\r\n            p.value.parsed.data = ''\r\n          }\r\n        })\r\n    }\r\n    if (entity) {\r\n      // hover information\r\n      if (this.parts.title) {\r\n        this.parts.title.temp.innerText = this.parts.title.get(entity, caller)\r\n      }\r\n      if (this.parts.body) {\r\n        this.parts.body.rows.forEach(p => {\r\n          if (p.name.ref) {\r\n            if (p.name.value_source) p.name.value_source = p.value.text\r\n            const e = p.name.get(entity, caller)\r\n            if ('object' !== typeof e) {\r\n              ;(p.temp.firstElementChild as HTMLElement).innerText = this.parse_variables(\r\n                e,\r\n                p.value.parsed.variables,\r\n                entity\r\n              )\r\n            }\r\n          }\r\n          if (p.value.ref) {\r\n            if (p.value.value_source) p.value.value_source = p.value.text\r\n            const e = p.value.get(entity, caller)\r\n            if ('object' !== typeof e) {\r\n              ;(p.temp.lastElementChild as HTMLElement).innerText = this.parse_variables(\r\n                e,\r\n                p.value.parsed.variables,\r\n                entity\r\n              )\r\n            }\r\n          }\r\n        })\r\n      }\r\n    } else if (!this.spec.floating) {\r\n      if ((this.queue as number) > 0) clearTimeout(this.queue)\r\n      this.queue = -1\r\n      if (!pass) {\r\n        if (!this.tab || this.tab.classList.contains('show'))\r\n          this.queue = setTimeout(() => this.update(void 0, void 0, true), 50)\r\n      } else {\r\n        // base information\r\n        entity = this.site.data.entities[v.get.single_id()]\r\n        if (entity) {\r\n          // when showing a selected region\r\n          this.selection = true\r\n          if (this.parts.title) {\r\n            this.parts.title.base.classList.remove('hidden')\r\n            this.parts.title.default.classList.add('hidden')\r\n          }\r\n          if (this.parts.body && this.has_default) this.parts.body.default.classList.add('hidden')\r\n        } else {\r\n          // when no ID is selected\r\n          this.selection = false\r\n          if (this.parts.title) {\r\n            if (this.has_default) {\r\n              this.parts.title.base.classList.add('hidden')\r\n              this.parts.title.default.classList.remove('hidden')\r\n            } else if (!this.parts.title.ref || !('features' in this.parts.title.parsed))\r\n              this.parts.title.base.classList.remove('hidden')\r\n          }\r\n          if (this.parts.body) {\r\n            this.parts.body.base.classList.add('hidden')\r\n            if (this.has_default) this.parts.body.default.classList.remove('hidden')\r\n          }\r\n        }\r\n        if (this.parts.title) {\r\n          ;(this.parts.title.base.firstElementChild as HTMLElement).innerText = this.parts.title.get(entity, caller)\r\n        }\r\n        if (this.parts.body) {\r\n          if (!this.spec.subto) this.parts.body.base.classList.remove('hidden')\r\n          this.parts.body.rows.forEach(p => {\r\n            if ('summary' in p.value.parsed) {\r\n              this.fill_summary_table(p.value.parsed.summary, this.summary, this.time)\r\n            } else if ('filter' in p.value.parsed) {\r\n              const e = p.value.parsed.filter\r\n              let n = 0\r\n              e.innerHTML = ''\r\n              if (this.site.view.selected.length) {\r\n                n++\r\n                const s = document.createElement('tr')\r\n                s.className = 'filter-display'\r\n                let ss = document.createElement('td'),\r\n                  span = document.createElement('span')\r\n                s.appendChild(ss)\r\n                ss.appendChild(span)\r\n                span.className = 'syntax-variable'\r\n                span.innerText = 'Select Entities'\r\n                s.appendChild((ss = document.createElement('td')))\r\n                ss.appendChild((span = document.createElement('span')))\r\n                span.className = 'syntax-operator'\r\n                span.innerText = ':'\r\n                s.appendChild((ss = document.createElement('td')))\r\n                ss.setAttribute('colspan', '2')\r\n                ss.appendChild((span = document.createElement('span')))\r\n                span.className = 'syntax-value'\r\n                let ids = ''\r\n                this.site.view.selected.forEach(id => {\r\n                  const entity = this.site.data.entities[id]\r\n                  ids += (ids ? ', ' : '') + (entity && entity.features ? entity.features.name : id)\r\n                })\r\n                span.innerText = ids\r\n                e.appendChild(s)\r\n              }\r\n              this.site.view.filters.forEach(f => {\r\n                const checked = f.passed + f.failed\r\n                if (f.active && checked) {\r\n                  const result = f.passed + '/' + checked\r\n                  ;(f.e.children[1].lastElementChild as HTMLElement).innerText = result\r\n                  n++\r\n                  const s = document.createElement('tr'),\r\n                    info = this.site.data.variable_info[f.variable]\r\n                  s.className = 'filter-display'\r\n                  let ss = document.createElement('td'),\r\n                    span = document.createElement('span')\r\n                  s.appendChild(ss)\r\n                  ss.appendChild(span)\r\n                  span.className = 'syntax-variable'\r\n                  span.title = f.variable\r\n                  span.innerText = info.short_name as string\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.innerText = ' ('\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.className = 'syntax-component'\r\n                  span.innerText = f.component as string\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.innerText = ')'\r\n                  ss = document.createElement('td')\r\n                  s.appendChild(ss)\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.className = 'syntax-operator'\r\n                  span.innerText = f.operator\r\n                  ss = document.createElement('td')\r\n                  s.appendChild(ss)\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.className = 'syntax-value'\r\n                  span.innerText = (\r\n                    'number' === typeof f.value ? this.site.data.format_value(f.value) : f.value\r\n                  ) as string\r\n                  ss = document.createElement('td')\r\n                  s.appendChild(ss)\r\n                  ss.appendChild((span = document.createElement('span')))\r\n                  span.innerText = '(' + (f.value_source ? f.value_source + '; ' : '') + result + ')'\r\n                  e.appendChild(s)\r\n                }\r\n              })\r\n              this.e.classList[n ? 'remove' : 'add']('hidden')\r\n            }\r\n            if (('variables' in p.value.parsed || 'summary' in p.value.parsed) && !(v.y in this.depends)) {\r\n              this.depends[v.y] = true\r\n              this.site.add_dependency(v.y, {type: 'update', id: this.id})\r\n            } else if ('filter' in p.value.parsed && !('viewFilter' in this.depends)) {\r\n              this.depends.viewFilter = true\r\n              this.site.add_dependency('view.filter', {type: 'update', id: this.id})\r\n            }\r\n            if (p.name.ref) {\r\n              if (p.name.value_source) p.name.value_source = p.value.text\r\n              const e = p.name.get(entity, caller)\r\n              if ('object' !== typeof e) {\r\n                ;(p.base.firstElementChild as HTMLElement).innerText = e\r\n              }\r\n            }\r\n            if (p.value.ref) {\r\n              const e = p.value.get(entity, caller)\r\n              if (Array.isArray(e)) {\r\n                if ('sources' === p.value.parsed.variables) {\r\n                  p.base.innerHTML = ''\r\n                  p.base.appendChild(document.createElement('table'))\r\n                  p.base.lastElementChild.className = 'source-table'\r\n                  p.base.firstElementChild.appendChild(document.createElement('thead'))\r\n                  p.base.firstElementChild.firstElementChild.appendChild(document.createElement('tr'))\r\n                  p.base.firstElementChild.firstElementChild.firstElementChild.appendChild(document.createElement('th'))\r\n                  p.base.firstElementChild.firstElementChild.firstElementChild.appendChild(document.createElement('th'))\r\n                  ;(\r\n                    p.base.firstElementChild.firstElementChild.firstElementChild.firstElementChild as HTMLElement\r\n                  ).innerText = 'Source'\r\n                  ;(\r\n                    p.base.firstElementChild.firstElementChild.firstElementChild.lastElementChild as HTMLElement\r\n                  ).innerText = 'Accessed'\r\n                  p.base.firstElementChild.appendChild(document.createElement('tbody'))\r\n                  e.forEach(ei => {\r\n                    p.base.firstElementChild.lastElementChild.appendChild(make_variable_source(ei, true))\r\n                  })\r\n                }\r\n              } else {\r\n                ;(p.base.lastElementChild as HTMLElement).innerText = this.parse_variables(\r\n                  e,\r\n                  p.value.parsed.variables,\r\n                  entity\r\n                )\r\n              }\r\n            }\r\n          })\r\n        }\r\n      }\r\n    }\r\n    this.revert()\r\n  }\r\n  parse_variables(s: string, type: string, entity: Entity) {\r\n    if ('statement' === type) {\r\n      const patterns = this.site.patterns\r\n      for (let m, v; (m = patterns.mustache.exec(s)); ) {\r\n        if ('value' === m[1]) {\r\n          v = entity\r\n            ? this.site.data.format_value(\r\n                entity.get_value(this.v, this.time),\r\n                this.dataset in this.site.data.variables[this.v].info &&\r\n                  'integer' === this.site.data.variables[this.v].info[this.dataset].type\r\n              )\r\n            : NaN\r\n          const info = this.site.data.variable_info[this.v] as MeasureInfo\r\n          let type = info.unit || info.type\r\n          if (info.aggregation_method && !(type in value_types)) type = info.aggregation_method\r\n          s = s.replace(m[0], !isNaN(v as number) && type in value_types ? value_types[type](v) : v)\r\n          patterns.mustache.lastIndex = 0\r\n        } else if (entity) {\r\n          if ('region_name' === m[1]) {\r\n            s = s.replace(m[0], entity.features.name)\r\n            patterns.mustache.lastIndex = 0\r\n          } else if (patterns.features.test(m[1])) {\r\n            s = s.replace(m[0], entity.features[m[1].replace(patterns.features, '')])\r\n            patterns.mustache.lastIndex = 0\r\n          } else if (patterns.variables.test(m[1])) {\r\n            s = s.replace(\r\n              m[0],\r\n              entity.variables[this.v][m[1].replace(patterns.variables, '') as keyof Variable] as string\r\n            )\r\n            patterns.mustache.lastIndex = 0\r\n          } else if (patterns.data.test(m[1])) {\r\n            s = s.replace(m[0], entity.get_value(m[1].replace(patterns.data, ''), this.time))\r\n            patterns.mustache.lastIndex = 0\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return s\r\n  }\r\n  fill_summary_table(table: HTMLTableElement, summary: Summary, time: number) {\r\n    const e = table.lastElementChild.firstElementChild.children as HTMLCollectionOf<HTMLTableRowElement>\r\n    filter_components.summary.forEach((c: keyof Summary, i) => {\r\n      e[i].innerText = this.site.data.format_value((summary[c] as number[])[time], 0 === i) as string\r\n    })\r\n  }\r\n}\r\n","import type {Entity, Order, Summary} from '../../types'\r\nimport type Community from '../index'\r\nimport type {SiteInputs} from '../inputs/index'\r\nimport {BaseOutput} from './index'\r\n\r\nconst summary_levels: {[index: string]: string} = {\r\n  dataset: 'Overall',\r\n  filtered: 'Filtered',\r\n  children: 'Unfiltered selection',\r\n  all: 'Selection',\r\n}\r\n\r\nexport class OutputLegend extends BaseOutput {\r\n  type: 'legend' = 'legend'\r\n  clickto?: SiteInputs\r\n  palette: string\r\n  variable: string\r\n  state = ''\r\n  parsed: {\r\n    summary?: Summary\r\n    order?: Order\r\n    time: number\r\n    color: string\r\n    bins: number\r\n    rank: boolean\r\n  } = {time: 0, color: '', bins: 0, rank: false}\r\n  queue: {\r\n    e?: HTMLElement\r\n    lock: boolean\r\n    cooldown: number | NodeJS.Timeout\r\n    reset: () => void\r\n    trigger?: () => void\r\n  } = {\r\n    lock: false,\r\n    cooldown: -1,\r\n    reset: function () {\r\n      this.lock = false\r\n    },\r\n  }\r\n  integer = false\r\n  entity: Entity\r\n  parts: {\r\n    ticks: HTMLElement\r\n    scale: HTMLElement\r\n    summary: HTMLElement\r\n  }\r\n  ticks = {\r\n    center: document.createElement('div'),\r\n    min: document.createElement('div'),\r\n    max: document.createElement('div'),\r\n    entity: document.createElement('div'),\r\n  }\r\n  current_palette = ''\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.mouseover = this.mouseover.bind(this)\r\n    this.mouseout = this.mouseout.bind(this)\r\n    this.click = this.click.bind(this)\r\n    this.update = this.update.bind(this)\r\n    e.addEventListener('mousemove', this.mouseover)\r\n    e.addEventListener('mouseout', this.mouseout)\r\n    e.addEventListener('click', this.click)\r\n    this.variable = this.e.dataset.variable\r\n    this.queue.trigger = function (this: OutputLegend) {\r\n      this.mouseover(this.queue.e)\r\n    }.bind(this)\r\n    this.queue.reset = this.queue.reset.bind(this.queue)\r\n    this.parts = {\r\n      ticks: this.e.querySelector('.legend-ticks'),\r\n      scale: this.e.querySelector('.legend-scale'),\r\n      summary: this.e.querySelector('.legend-summary'),\r\n    }\r\n    this.parts.ticks.dataset.of = this.parts.scale.dataset.of = this.parts.summary.dataset.of = this.id\r\n    this.parts.summary.appendChild(this.ticks.center)\r\n    this.parts.summary.appendChild(this.ticks.min)\r\n    this.parts.summary.appendChild(this.ticks.max)\r\n    this.parts.ticks.appendChild(this.ticks.entity)\r\n  }\r\n  init() {\r\n    this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n    const view = this.site.dataviews[this.view]\r\n    if ('string' === typeof view.time_agg && view.time_agg in this.site.inputs)\r\n      this.site.add_dependency(view.time_agg, {type: 'update', id: this.id})\r\n    if (!this.palette) {\r\n      if (view.palette) {\r\n        this.palette = view.palette\r\n        if (view.palette in this.site.inputs) this.site.add_dependency(view.palette, {type: 'update', id: this.id})\r\n      } else {\r\n        this.palette =\r\n          'settings.palette' in this.site.inputs ? 'settings.palette' : (this.site.spec.settings.palette as string)\r\n      }\r\n    }\r\n    if (this.variable) {\r\n      if (this.variable in this.site.inputs) this.site.add_dependency(this.variable, {type: 'update', id: this.id})\r\n    } else if (view.y in this.site.inputs) this.site.add_dependency(view.y, {type: 'update', id: this.id})\r\n    if (this.palette in this.site.inputs) {\r\n      const palette = this.site.inputs[this.palette]\r\n      if (palette.e) {\r\n        palette.e.addEventListener('change', this.update)\r\n      }\r\n    }\r\n    const click_ref = this.e.dataset.click\r\n    if (click_ref in this.site.inputs) this.clickto = this.site.inputs[click_ref]\r\n    Object.keys(this.ticks).forEach((t: keyof typeof this.ticks) => {\r\n      const div = document.createElement('div')\r\n      let p = document.createElement('p')\r\n      this.ticks[t].dataset.of = this.id\r\n      this.ticks[t].className = 'legend-tick'\r\n      this.ticks[t].appendChild(div)\r\n      div.dataset.of = p.dataset.of = this.id\r\n      div.appendChild(p)\r\n      if ('m' !== t.substring(0, 1)) {\r\n        div.appendChild((p = document.createElement('p')))\r\n        p.dataset.of = this.id\r\n        div.appendChild((p = document.createElement('p')))\r\n        p.dataset.of = this.id\r\n        if ('entity' === t) {\r\n          this.ticks[t].firstElementChild.lastElementChild.classList.add('entity')\r\n        } else {\r\n          this.ticks[t].firstElementChild.firstElementChild.classList.add('summary')\r\n        }\r\n      }\r\n    })\r\n    this.ticks.entity.firstElementChild.classList.add('hidden')\r\n    this.ticks.max.className = 'legend-tick-end max'\r\n    this.ticks.min.className = 'legend-tick-end min'\r\n    this.ticks.center.style.left = '50%'\r\n    this.update()\r\n  }\r\n  show(e: Entity) {\r\n    if (e && e.features.name) {\r\n      const view = this.site.dataviews[this.view],\r\n        summary = this.parsed.summary,\r\n        time = this.parsed.time,\r\n        color = this.parsed.color,\r\n        string = summary && 'string' === summary.type,\r\n        min = summary && !string ? summary.min[time] : 0,\r\n        range = summary ? (string ? summary.levels.length - min : summary.range[time]) : 1,\r\n        n = summary.n[time],\r\n        subset = n === view.n_selected.dataset ? 'rank' : 'subset_rank',\r\n        es = this.site.data.entities[e.features.id].views[this.view],\r\n        value = e.get_value(color, time),\r\n        p =\r\n          ((string ? value in summary.level_ids : 'number' === typeof value)\r\n            ? this.site.spec.settings.color_by_order\r\n              ? NaN\r\n              : Math.max(0, Math.min(1, range ? ((string ? summary.level_ids[value] : value) - min) / range : 0.5))\r\n            : NaN) * 100,\r\n        container = this.ticks.entity,\r\n        t = container.firstElementChild.children[1] as HTMLElement\r\n      if (isFinite(p)) {\r\n        t.parentElement.classList.remove('hidden')\r\n        t.innerText = this.site.data.format_value(value, this.integer) as string\r\n        container.style.left = p + '%'\r\n        ;(container.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n          (p > 96 || p < 4) && e.features.name.length > 13 ? e.features.name.substring(0, 12) + '' : e.features.name\r\n      } else if (this.site.spec.settings.color_by_order && color in es[subset]) {\r\n        const i = es[subset][color][time],\r\n          po = n > 1 ? (i / (n - 1)) * 100 : 0\r\n        ;(container.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n          i > -1 && (po > 96 || po < 4) && e.features.name.length > 13\r\n            ? e.features.name.substring(0, 12) + ''\r\n            : e.features.name\r\n        if (i > -1) {\r\n          t.parentElement.classList.remove('hidden')\r\n          t.innerText = '# ' + (n - i)\r\n          container.style.left = po + '%'\r\n        }\r\n      }\r\n      container.style.marginLeft = -container.getBoundingClientRect().width / 2 + 'px'\r\n    }\r\n  }\r\n  revert() {\r\n    this.ticks.entity.firstElementChild.classList.add('hidden')\r\n  }\r\n  async update() {\r\n    const view = this.site.dataviews[this.view],\r\n      variable = this.site.valueOf(this.variable || view.y) as string,\r\n      d = view.get.dataset(),\r\n      var_info = await this.site.data.get_variable(variable, view),\r\n      time = this.site.valueOf(view.time_agg),\r\n      palettes = this.site.palettes\r\n    if (null !== time && view.valid[d] && var_info && this.view in var_info.views) {\r\n      const y =\r\n          ('number' === typeof time ? time - this.site.data.meta.times[d].range[0] : 0) - var_info.time_range[d][0],\r\n        summary = var_info.views[this.view].summaries[d],\r\n        ep = (this.site.valueOf(this.palette) as string).toLowerCase(),\r\n        pn =\r\n          ep in palettes\r\n            ? ep\r\n            : (this.site.spec.settings.palette as string) in palettes\r\n            ? (this.site.spec.settings.palette as string)\r\n            : this.site.defaults.palette,\r\n        p = palettes[pn],\r\n        nc = p.colors.length,\r\n        s = this.parts.scale,\r\n        ticks = this.ticks\r\n      this.parsed.summary = summary\r\n      this.parsed.order = var_info.views[this.view].order[d][y]\r\n      this.parsed.time = y\r\n      this.parsed.color = variable\r\n      if (summary && y < summary.n.length) {\r\n        this.integer = d in var_info.info && 'integer' === var_info.info[d].type\r\n        const refresh = this.site.spec.settings.color_by_order !== this.parsed.rank,\r\n          bins = s.querySelectorAll('span'),\r\n          odd = p.odd,\r\n          remake =\r\n            'discrete' === p.type\r\n              ? !bins.length || nc !== this.parsed.bins\r\n              : !s.firstElementChild || 'SPAN' !== s.firstElementChild.tagName\r\n        this.parsed.bins = nc\r\n        if (pn + this.site.spec.settings.color_scale_center !== this.current_palette || refresh) {\r\n          this.current_palette = pn + this.site.spec.settings.color_scale_center\r\n          this.parsed.rank = this.site.spec.settings.color_by_order as boolean\r\n          if (remake) s.innerHTML = ''\r\n          if ('discrete' === p.type) {\r\n            const n = Math.ceil(nc / 2)\r\n            let i = 0,\r\n              div = document.createElement('div'),\r\n              span: HTMLSpanElement\r\n            if (remake) {\r\n              s.appendChild(div)\r\n              div.dataset.of = this.id\r\n              div.style.left = '0'\r\n              const prop = (1 / (n - odd / 2)) * 100 + '%'\r\n              for (; i < n; i++) {\r\n                div.appendChild((span = document.createElement('span')))\r\n                span.dataset.of = this.id\r\n                span.style.backgroundColor = p.colors[i]\r\n                span.style.width = prop\r\n              }\r\n              if (odd) span.style.width = ((1 / (n - odd / 2)) * 100) / 2 + '%'\r\n              s.appendChild((div = document.createElement('div')))\r\n              div.dataset.of = this.id\r\n              div.style.right = '0'\r\n              for (i = Math.floor(nc / 2); i < nc; i++) {\r\n                div.appendChild((span = document.createElement('span')))\r\n                span.dataset.of = this.id\r\n                span.style.backgroundColor = p.colors[i]\r\n                span.style.width = prop\r\n              }\r\n              if (odd)\r\n                (div.firstElementChild as HTMLElement).style.width =\r\n                  ((1 / (Math.ceil(nc / 2) - odd / 2)) * 100) / 2 + '%'\r\n            } else {\r\n              for (; i < n; i++) {\r\n                bins[i].style.backgroundColor = p.colors[i]\r\n              }\r\n              for (i = Math.floor(nc / 2); i < nc; i++) {\r\n                bins[i + odd].style.backgroundColor = p.colors[i]\r\n              }\r\n            }\r\n          } else if ('continuous-polynomial' !== p.type) {\r\n            if (remake) {\r\n              s.appendChild(document.createElement('span'))\r\n              s.appendChild(document.createElement('span'))\r\n            }\r\n            ;(s.firstElementChild as HTMLElement).style.background =\r\n              'linear-gradient(0.25turn, rgb(' +\r\n              p.colors[2][0][0] +\r\n              ', ' +\r\n              p.colors[2][0][1] +\r\n              ', ' +\r\n              p.colors[2][0][2] +\r\n              '), rgb(' +\r\n              p.colors[1][0] +\r\n              ', ' +\r\n              p.colors[1][1] +\r\n              ', ' +\r\n              p.colors[1][2] +\r\n              '))'\r\n            ;(s.lastElementChild as HTMLElement).style.background =\r\n              'linear-gradient(0.25turn, rgb(' +\r\n              p.colors[1][0] +\r\n              ', ' +\r\n              p.colors[1][1] +\r\n              ', ' +\r\n              p.colors[1][2] +\r\n              '), rgb(' +\r\n              p.colors[0][0][0] +\r\n              ', ' +\r\n              p.colors[0][0][1] +\r\n              ', ' +\r\n              p.colors[0][0][2] +\r\n              '))'\r\n          }\r\n        }\r\n        const center = this.site.spec.settings.color_scale_center as keyof Summary | 'none'\r\n        if ('string' === var_info.type) {\r\n          ticks.center.classList.remove('hidden')\r\n          ;(ticks.min.firstElementChild.firstElementChild as HTMLElement).innerText = var_info.levels[0]\r\n          ;(ticks.max.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n            var_info.levels[var_info.levels.length - 1]\r\n        } else if (this.site.spec.settings.color_by_order) {\r\n          ticks.center.classList.add('hidden')\r\n          ;(ticks.min.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n            '# ' + (summary.n[y] ? summary.n[y] : 0)\r\n          ;(ticks.max.firstElementChild.firstElementChild as HTMLElement).innerText = '# ' + (summary.n[y] ? 1 : 0)\r\n        } else {\r\n          const state =\r\n            '' +\r\n            summary.n[y] +\r\n            summary.min[y] +\r\n            summary.max[y] +\r\n            this.site.spec.settings.digits +\r\n            center +\r\n            this.site.spec.settings.summary_selection\r\n          if (remake || refresh || state !== this.state) {\r\n            this.state = state\r\n            ticks.center.classList.remove('hidden')\r\n            ;(ticks.min.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n              (summary.n[y]\r\n                ? isFinite(summary.min[y])\r\n                  ? this.site.data.format_value(summary.min[y], this.integer)\r\n                  : NaN\r\n                : NaN) + ''\r\n            ;(ticks.max.firstElementChild.firstElementChild as HTMLElement).innerText =\r\n              (summary.n[y]\r\n                ? isFinite(summary.max[y])\r\n                  ? this.site.data.format_value(summary.max[y], this.integer)\r\n                  : NaN\r\n                : NaN) + ''\r\n            if ('none' === center) {\r\n              ;(ticks.center.firstElementChild.lastElementChild as HTMLElement).innerText =\r\n                summary_levels[this.site.spec.settings.summary_selection as string] + ' median'\r\n              ;(ticks.center.firstElementChild.children[1] as HTMLElement).innerText = this.site.data.format_value(\r\n                summary.median[y]\r\n              ) as string\r\n              ticks.center.style.left = summary.norm_median[y] * 100 + '%'\r\n            } else {\r\n              ;(ticks.center.firstElementChild.lastElementChild as HTMLElement).innerText =\r\n                summary_levels[this.site.spec.settings.summary_selection as string] + ' ' + center\r\n              ;(ticks.center.firstElementChild.children[1] as HTMLElement).innerText = this.site.data.format_value(\r\n                (summary[center] as number[])[y]\r\n              ) as string\r\n              ticks.center.style.left = summary[('norm_' + center) as 'norm_mean'][y] * 100 + '%'\r\n            }\r\n            ticks.center.style.marginLeft = -ticks.center.getBoundingClientRect().width / 2 + 'px'\r\n          }\r\n        }\r\n        if (this.site.spec.settings.color_by_order || 'none' === center) {\r\n          ;(s.firstElementChild as HTMLElement).style.width = '50%'\r\n          ;(s.lastElementChild as HTMLElement).style.width = '50%'\r\n        } else {\r\n          ;(s.firstElementChild as HTMLElement).style.width = summary[('norm_' + center) as 'norm_mean'][y] * 100 + '%'\r\n          ;(s.lastElementChild as HTMLElement).style.width =\r\n            100 - summary[('norm_' + center) as 'norm_mean'][y] * 100 + '%'\r\n        }\r\n      }\r\n    }\r\n  }\r\n  mouseover(e: MouseEvent | HTMLElement) {\r\n    if (!this.queue.lock && 'clientX' in e) {\r\n      this.queue.lock = true\r\n      const s = this.parts.scale.getBoundingClientRect(),\r\n        p = (Math.max(s.x, Math.min(s.x + s.width, e.clientX)) - s.x) / s.width\r\n      let entity: Entity\r\n      if (this.site.spec.settings.color_by_order) {\r\n        if (this.parsed.order && this.parsed.order.length)\r\n          entity =\r\n            this.site.data.entities[\r\n              this.parsed.order[\r\n                Math.max(\r\n                  this.parsed.summary.missing[this.parsed.time],\r\n                  Math.min(this.parsed.order.length - 1, Math.floor((this.parsed.order.length - 1) * p))\r\n                )\r\n              ][0]\r\n            ]\r\n      } else if ('min' in this.parsed.summary) {\r\n        const min = this.parsed.summary.min[this.parsed.time],\r\n          max = this.parsed.summary.max[this.parsed.time],\r\n          tv = min + p * (max - min)\r\n        let i, n\r\n        if (this.parsed.order && this.parsed.order.length) {\r\n          n = this.parsed.summary.missing[this.parsed.time]\r\n          if (n < this.parsed.order.length) {\r\n            if (1 === this.parsed.order.length || !p) {\r\n              entity = this.site.data.entities[this.parsed.order[n][0]]\r\n            } else {\r\n              for (i = this.parsed.order.length - 2; i >= n; --i) {\r\n                if ((this.parsed.order[i][1] + this.parsed.order[i + 1][1]) / 2 <= tv) break\r\n              }\r\n              i++\r\n              entity = this.site.data.entities[this.parsed.order[i][0]]\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (entity) {\r\n        this.show(entity)\r\n        if (!this.entity || entity.features.id !== this.entity.features.id) {\r\n          if (!this.entity) {\r\n            this.entity = entity\r\n          } else this.site.subs.update(this.id, 'revert', this.entity)\r\n          this.site.subs.update(this.id, 'show', entity)\r\n          this.entity = entity\r\n        }\r\n      }\r\n      setTimeout(this.queue.reset, 200)\r\n    } else {\r\n      if ((this.queue.cooldown as number) > 0) clearTimeout(this.queue.cooldown)\r\n      this.queue.e = e as HTMLElement\r\n      this.queue.cooldown = setTimeout(this.queue.trigger, 100)\r\n    }\r\n  }\r\n  mouseout(e: MouseEvent) {\r\n    const target = e.relatedTarget as HTMLElement\r\n    if (target && this.id !== target.dataset.of) {\r\n      if ((this.queue.cooldown as number) > 0) clearTimeout(this.queue.cooldown)\r\n      this.queue.cooldown = -1\r\n      this.revert()\r\n      if (this.entity) {\r\n        this.site.subs.update(this.id, 'revert', this.entity)\r\n        this.entity = undefined\r\n      }\r\n    }\r\n  }\r\n  click() {\r\n    if (this.clickto && this.entity) {\r\n      this.revert()\r\n      this.clickto.set(this.entity.features.id)\r\n    }\r\n  }\r\n}\r\n","import DataHandler from '../data_handler/index'\r\nimport type {DataSets, Generic, MapInfo, Query, SiteCondition, SiteRule, SiteSpec, Summary} from '../types'\r\nimport {defaults} from './defaults'\r\nimport type {BaseInput, RegisteredInputs, SiteInputs} from './inputs/index'\r\nimport type {RegisteredOutputs, SiteOutputs} from './outputs/index'\r\nimport {GlobalView} from './global_view'\r\nimport {patterns} from './patterns'\r\nimport {storage} from './storage'\r\nimport {Subscriptions} from './subscriptions'\r\nimport * as conditionals from './conditionals'\r\nimport * as utils from './utils'\r\nimport {DiscretePalette, palettes} from './palettes'\r\nimport {InputSelect} from './inputs/select'\r\nimport {InputNumber} from './inputs/number'\r\nimport {SiteDataView} from './dataview'\r\nimport {Page} from './page'\r\nimport {InputVirtual} from './inputs/virtual'\r\nimport {InputButton} from './inputs/button'\r\nimport {InputCombobox} from './inputs/combobox'\r\nimport {InputRadio} from './inputs/radio'\r\nimport {InputCheckbox} from './inputs/checkbox'\r\nimport {OutputInfo} from './outputs/info'\r\nimport {OutputMap} from './outputs/map'\r\nimport {OutputPlotly} from './outputs/plotly'\r\nimport {InputButtonGroup} from './inputs/buttongroup'\r\nimport {InputSwitch} from './inputs/switch'\r\nimport {InputText} from './inputs/text'\r\nimport {OutputDataTable} from './outputs/datatables'\r\nimport {OutputTable} from './outputs/table'\r\nimport {OutputLegend} from './outputs/legend'\r\nimport {OutputText} from './outputs/text'\r\n\r\ntype Queue = {\r\n  timeout: NodeJS.Timer | number\r\n  elements: Map<string, boolean>\r\n}\r\n\r\nconst inputs = {\r\n  button: InputButton,\r\n  buttongroup: InputButtonGroup,\r\n  combobox: InputCombobox,\r\n  select: InputSelect,\r\n  number: InputNumber,\r\n  radio: InputRadio,\r\n  switch: InputSwitch,\r\n  checkbox: InputCheckbox,\r\n  text: InputText,\r\n}\r\nconst outputs = {\r\n  info: OutputInfo,\r\n  map: OutputMap,\r\n  plotly: OutputPlotly,\r\n  datatable: OutputDataTable,\r\n  table: OutputTable,\r\n  legend: OutputLegend,\r\n  text: OutputText,\r\n}\r\n\r\nexport type Dependency = {\r\n  id: string\r\n  type: 'rule' | 'update' | 'filter' | 'display' | 'dataview' | keyof typeof conditionals | keyof BaseInput\r\n  conditional?: keyof typeof conditionals\r\n  condition?: SiteCondition\r\n  uid?: string\r\n  rule?: number\r\n}\r\n\r\ntype Tree = {\r\n  _n: {children: number; parents: number}\r\n  children: {[index: string]: Tree}\r\n  parents: {[index: string]: Tree}\r\n}\r\n\r\nexport default class Community {\r\n  spec: SiteSpec\r\n  storage = storage\r\n  patterns = patterns\r\n  palettes = palettes\r\n  conditionals: {[index: string]: Function} = {}\r\n  data: DataHandler\r\n  page: Page\r\n  view: GlobalView\r\n  subs: Subscriptions\r\n  registered_inputs: Map<string, SiteInputs> = new Map()\r\n  registered_outputs: Map<string, SiteOutputs> = new Map()\r\n  defaults = defaults\r\n  dataviews: {[index: string]: SiteDataView} = {}\r\n  inputs: RegisteredInputs = {}\r\n  outputs: RegisteredOutputs = {}\r\n  dependencies: {[index: string]: Dependency[]} = {}\r\n  url_options: {[index: string]: boolean | string} = {}\r\n  queue: Queue = {timeout: 0, elements: new Map()}\r\n  tree: {[index: string]: Tree} = {}\r\n  maps: MapInfo = {\r\n    queue: {},\r\n    waiting: {},\r\n    overlay_property_selectors: [],\r\n  }\r\n  meta = {\r\n    retain_state: true,\r\n    lock_after: '',\r\n  }\r\n  state = ''\r\n  query = ''\r\n  parsed_query: Query = {}\r\n  endpoint?: string\r\n  rule_conditions: {[index: string]: SiteRule[]} = {}\r\n  constructor(spec?: SiteSpec) {\r\n    if (spec) {\r\n      this.spec = spec\r\n      spec.active = this\r\n    }\r\n    if (!spec.settings) spec.settings = {}\r\n    if (!('dataLayer' in window)) (window as any).dataLayer = []\r\n    storage.copy = storage.get() as Generic\r\n    if (storage.copy)\r\n      for (const k in spec.settings) {\r\n        if (k in storage.copy) {\r\n          let c = storage.copy[k]\r\n          if ('string' === typeof c) {\r\n            if (patterns.bool.test(c)) {\r\n              c = !!c || 'true' === c\r\n            } else if (patterns.number.test(c)) c = parseFloat(c)\r\n          }\r\n          spec.settings[k] = c\r\n        }\r\n      }\r\n    function poly_channel(ch: number, pos: number, coefs: number[][]) {\r\n      const n = coefs.length\r\n      let v = coefs[0][ch] + pos * coefs[1][ch],\r\n        i = 2\r\n      for (; i < n; i++) {\r\n        v += Math.pow(pos, i) * coefs[i][ch]\r\n      }\r\n      return Math.max(0, Math.min(255, v))\r\n    }\r\n    Object.keys(palettes).forEach(k => {\r\n      const n = 255\r\n      let p = palettes[k]\r\n      if ('continuous-polynomial' === p.type) {\r\n        const c = p.colors as number[][],\r\n          r: DiscretePalette = {name: k, type: 'discrete', colors: []}\r\n        for (let i = 0; i < n; i++) {\r\n          const v = i / n\r\n          r.colors.push(\r\n            'rgb(' + poly_channel(0, v, c) + ', ' + poly_channel(1, v, c) + ', ' + poly_channel(2, v, c) + ')'\r\n          )\r\n        }\r\n        p = palettes[k] = r\r\n      }\r\n      p.odd = p.colors.length % 2\r\n    })\r\n    this.query = window.location.search.replace('?', '')\r\n    if (this.query) {\r\n      this.query.split('&').forEach(a => {\r\n        const c = a.split('='),\r\n          k = c[0]\r\n        let v: string | boolean\r\n        if (c.length < 2) c.push('true')\r\n        v = patterns.bool.test(c[1]) ? !!c[1] || 'true' === c[1] : c[1].replace(patterns.url_spaces, ' ')\r\n        this.url_options[c[0]] = v\r\n        if (patterns.settings.test(c[0])) storage.set(c[0].replace(patterns.settings, ''), v)\r\n      })\r\n    }\r\n    if ('embedded' in this.url_options || 'hide_navbar' in this.url_options) {\r\n      if (!('hide_logo' in this.url_options)) this.url_options.hide_logo = true\r\n      if (!('hide_title' in this.url_options)) this.url_options.hide_title = true\r\n      if (!('hide_navcontent' in this.url_options)) this.url_options.hide_navcontent = true\r\n      if (!('hide_panels' in this.url_options)) this.url_options.hide_panels = true\r\n      if ('embedded' in this.url_options && !('close_menus' in this.url_options)) this.url_options.close_menus = true\r\n    }\r\n    this.init = this.init.bind(this)\r\n    this.request_queue = this.request_queue.bind(this)\r\n    this.run_queue = this.run_queue.bind(this)\r\n    this.global_reset = this.global_reset.bind(this)\r\n    Object.keys(conditionals).forEach(\r\n      (k: keyof typeof conditionals) => (this.conditionals[k] = conditionals[k].bind(this))\r\n    )\r\n    if (this.spec.dataviews) {\r\n      this.defaults.dataview = Object.keys(this.spec.dataviews)[0]\r\n    } else {\r\n      this.spec.dataviews = {}\r\n      this.spec.dataviews[this.defaults.dataview] = {}\r\n    }\r\n    if (!this.maps.overlay_property_selectors) this.maps.overlay_property_selectors = []\r\n    this.view = new GlobalView(this)\r\n    new Page(this)\r\n    document.querySelectorAll('.auto-input').forEach((e: HTMLElement) => {\r\n      if (e.dataset.autotype in inputs && !(e.id in this.inputs)) {\r\n        const u = new inputs[e.dataset.autotype as keyof typeof inputs](e, this)\r\n        this.registered_inputs.set(u.id, u)\r\n        this.inputs[u.id] = u\r\n      }\r\n    })\r\n    this.subs = new Subscriptions(this)\r\n    document.querySelectorAll('.auto-output').forEach((e: HTMLElement) => {\r\n      if (e.dataset.autotype in outputs && !(e.id in this.outputs)) {\r\n        const u = new outputs[e.dataset.autotype as keyof typeof outputs](e, this)\r\n        this.registered_outputs.set(u.id, u)\r\n        this.outputs[u.id] = u\r\n        const opt = 'options' in u ? u.options : u.spec\r\n        if ('subto' in opt) {\r\n          if ('string' === typeof opt.subto) opt.subto = [opt.subto]\r\n          if (Array.isArray(opt.subto)) opt.subto.forEach(v => this.subs.add(v, u))\r\n        }\r\n      }\r\n    })\r\n    if (spec.variables && spec.variables.length)\r\n      spec.variables.forEach(v => {\r\n        const u = new InputVirtual(v, this)\r\n        this.registered_inputs.set(v.id, u)\r\n        this.inputs[v.id] = u\r\n      })\r\n    this.defaults.dataset = this.spec.dataviews[defaults.dataview].dataset\r\n    if (!this.spec.metadata) this.spec.metadata = {datasets: []}\r\n    const sets = this.spec.metadata.datasets\r\n    if (sets && sets.length && -1 === sets.indexOf(this.defaults.dataset)) {\r\n      if (1 === sets.length) {\r\n        this.defaults.dataset = sets[0]\r\n      } else {\r\n        this.registered_inputs.forEach(u => {\r\n          if (!this.defaults.dataset) {\r\n            const d = u.default\r\n            if (-1 !== sets.indexOf(u.dataset)) {\r\n              this.defaults.dataset = u.dataset\r\n            } else if ('string' === typeof d && -1 !== sets.indexOf(d)) {\r\n              this.defaults.dataset = d\r\n            } else if (\r\n              'select' === u.type &&\r\n              'number' === typeof d &&\r\n              u.options[d] &&\r\n              -1 !== sets.indexOf(u.options[d].value)\r\n            ) {\r\n              this.defaults.dataset = u.options[d].value\r\n            } else if (\r\n              ('select' === u.type || 'combobox' === u.type) &&\r\n              Array.isArray(u.values) &&\r\n              u.values[u.default] &&\r\n              -1 !== sets.indexOf(u.values[u.default])\r\n            ) {\r\n              this.defaults.dataset = u.values[u.default]\r\n            }\r\n          }\r\n        })\r\n        if (!this.defaults.dataset) this.defaults.dataset = sets[sets.length - 1]\r\n      }\r\n      this.defaults.dataset = this.valueOf(this.defaults.dataset) as string\r\n      if (-1 === sets.indexOf(this.defaults.dataset)) this.defaults.dataset = sets[0]\r\n      this.registered_inputs.forEach(u => {\r\n        if (!u.dataset) u.dataset = this.defaults.dataset\r\n      })\r\n      if (!this.spec.dataviews[defaults.dataview].dataset)\r\n        this.spec.dataviews[defaults.dataview].dataset = this.defaults.dataset\r\n    }\r\n    if (spec.rules && spec.rules.length) {\r\n      spec.rules.forEach((r, i) => {\r\n        r.parsed = {}\r\n        if ('display' in r.effects) {\r\n          r.parsed.display = {e: document.getElementById(r.effects.display)}\r\n          const e = r.parsed.display.e.querySelector('.auto-input')\r\n          if (e) {\r\n            const u = this.inputs[e.id]\r\n            u.rule = r\r\n            r.parsed.display.u = u\r\n          }\r\n        }\r\n        if ('lock' in r.effects) {\r\n          const us = new Map()\r\n          document.querySelectorAll('#' + r.effects.lock + ' .auto-input').forEach(e => us.set(e.id, this.inputs[e.id]))\r\n          r.parsed.lock = us\r\n        }\r\n        r.condition.forEach(c => {\r\n          if (c.type in DataHandler.checks) {\r\n            c.check = function (this: {c: SiteCondition; site: Community}) {\r\n              return DataHandler.checks[this.c.type](this.site.valueOf(this.c.id), this.site.valueOf(this.c.value))\r\n            }.bind({c, site: this})\r\n            if (c.id in this.inputs) {\r\n              this.add_dependency(c.id, {type: 'rule', id: c.id, condition: c, rule: i})\r\n              if (!(c.id in this.rule_conditions)) this.rule_conditions[c.id] = []\r\n              this.rule_conditions[c.id][i] = r\r\n            }\r\n            if (c.check()) {\r\n              Object.keys(r.effects).forEach(k => {\r\n                if (k in this.inputs) this.inputs[k].set(this.valueOf(r.effects[k]) as string)\r\n              })\r\n            } else if (c.default) {\r\n              Object.keys(r.effects).forEach(k => {\r\n                if (k in this.inputs) this.inputs[k].set(this.valueOf(c.default) as string)\r\n              })\r\n            }\r\n          }\r\n        })\r\n      })\r\n    }\r\n    const dataset = this.valueOf(this.spec.dataviews[this.defaults.dataview].dataset) as string | number\r\n    this.defaults.dataset = 'number' === typeof dataset ? sets[dataset] : dataset\r\n    if (-1 === sets.indexOf(this.defaults.dataset)) this.defaults.dataset = sets[0]\r\n    this.data = new DataHandler(this.spec, this.defaults, this.data as unknown as DataSets, {\r\n      init: this.init,\r\n      onload: function (this: Community) {\r\n        if (this.data.inited) clearTimeout(this.data.inited.load_screen as NodeJS.Timeout)\r\n        setTimeout(this.drop_load_screen.bind(this), 600)\r\n        delete this.data.onload\r\n      }.bind(this),\r\n      data_load: function (this: Community) {\r\n        Object.keys(this.dependencies).forEach(k => this.request_queue(false, k))\r\n      }.bind(this),\r\n    })\r\n  }\r\n  init() {\r\n    if (this.data.variables) {\r\n      const variable = Object.keys(this.data.variables)\r\n      this.defaults.variable = variable[variable.length - 1]\r\n    }\r\n    Object.keys(this.spec.dataviews).forEach(id => new SiteDataView(this, id, this.spec.dataviews[id]))\r\n    this.view.init()\r\n    this.page.init()\r\n    if (this.query) {\r\n      this.parsed_query = this.data.parse_query(this.query)\r\n      if (this.parsed_query.variables.conditions.length) {\r\n        this.parsed_query.variables.conditions.forEach(f => {\r\n          const info = this.data.variable_info[f.name]\r\n          if (info) this.page.add_filter_condition(f.name, f)\r\n        })\r\n      }\r\n    }\r\n    this.run_queue()\r\n    this.registered_inputs.forEach(async o => {\r\n      const combobox = 'combobox' === o.type\r\n      if (o.optionSource && 'options' in o) {\r\n        if (patterns.palette.test(o.optionSource)) {\r\n          o.options = []\r\n          Object.keys(palettes).forEach(v => o.add(v, palettes[v].name))\r\n          if (-1 === o.default) o.default = defaults.palette\r\n        } else if (patterns.datasets.test(o.optionSource)) {\r\n          if (-1 === o.default) o.default = defaults.dataset\r\n          o.options = []\r\n          this.spec.metadata.datasets.forEach(d => o.add(d))\r\n        } else if ('option_sets' in o) {\r\n          o.sensitive = false\r\n          if (patterns.properties.test(o.optionSource)) {\r\n            this.maps.overlay_property_selectors.push(o)\r\n          }\r\n          if (o.depends) this.add_dependency(o.depends as string, {type: 'options', id: o.id})\r\n          if (o.dataset in this.inputs) this.add_dependency(o.dataset, {type: 'options', id: o.id})\r\n          if (o.view) this.add_dependency(o.view, {type: 'options', id: o.id})\r\n          const v = this.valueOf(o.dataset) || defaults.dataset\r\n          if ('string' === typeof v) {\r\n            if (!o.dataset) o.dataset = v\r\n            if (v in this.data.info) this.conditionals.options(o)\r\n          }\r\n        }\r\n      }\r\n      if (combobox || 'select' === o.type) {\r\n        // resolve options\r\n        if (Array.isArray(o.values)) {\r\n          o.values = {}\r\n          o.display = {}\r\n          let new_display = true\r\n          const select = 'select' === o.type\r\n          o.options.forEach(e => {\r\n            if (select) e.dataset.value = (e as HTMLOptionElement).value\r\n            if (new_display) new_display = e.dataset.value === e.innerText\r\n          })\r\n          o.options.forEach((e, i) => {\r\n            o.values[e.dataset.value] = i\r\n            if (new_display) e.innerText = this.data.format_label(e.dataset.value)\r\n            o.display[e.innerText] = i\r\n          })\r\n          if (!(o.default in o.values) && !(o.default in this.inputs)) {\r\n            o.default = +o.default\r\n            if (isNaN(o.default)) o.default = -1\r\n            if (-1 !== o.default && o.default < o.options.length) {\r\n              o.default = o.options[o.default].dataset.value\r\n            } else {\r\n              o.default = -1\r\n            }\r\n          }\r\n          o.source = ''\r\n          o.id in this.url_options ? o.set(this.url_options[o.id] as string) : o.reset()\r\n        }\r\n        o.subset = o.e.dataset.subset || 'all'\r\n        o.selection_subset = o.e.dataset.selectionSubset || o.subset\r\n        if (o.type in this.spec && o.id in this.spec[o.type]) {\r\n          o.settings = this.spec[o.type][o.id]\r\n          if (o.settings.filters) {\r\n            Object.keys(o.settings.filters).forEach(f => {\r\n              this.add_dependency(o.settings.filters[f], {type: 'filter', id: o.id})\r\n            })\r\n          }\r\n        }\r\n      } else if ('number' === o.type) {\r\n        // retrieve option values\r\n        o.min = o.e.getAttribute('min')\r\n        o.min_ref = parseFloat(o.min)\r\n        o.min_indicator = o.e.parentElement.parentElement.querySelector('.indicator-min')\r\n        if (o.min_indicator) {\r\n          o.min_indicator.addEventListener(\r\n            'click',\r\n            function (this: InputNumber) {\r\n              this.set(this.parsed.min)\r\n            }.bind(o)\r\n          )\r\n        }\r\n        o.max = o.e.getAttribute('max')\r\n        o.max_ref = parseFloat(o.max)\r\n        o.max_indicator = o.e.parentElement.parentElement.querySelector('.indicator-max')\r\n        if (o.max_indicator) {\r\n          o.max_indicator.addEventListener(\r\n            'click',\r\n            function (this: InputNumber) {\r\n              this.set(this.parsed.max)\r\n            }.bind(o)\r\n          )\r\n        }\r\n        o.ref = isNaN(o.min_ref) || isNaN(o.max_ref)\r\n        o.range = [o.min_ref, o.max_ref]\r\n        o.step = parseFloat(o.e.step) || 1\r\n        o.parsed = {min: undefined, max: undefined}\r\n        o.depends = {}\r\n        o.default_max = 'max' === o.default || 'last' === o.default\r\n        o.default_min = 'min' === o.default || 'first' === o.default\r\n        if (o.view) this.add_dependency(o.view, {type: 'update', id: o.id})\r\n        if (!(o.max in this.data.variables)) {\r\n          if (o.max in this.inputs) {\r\n            this.add_dependency(o.max, {type: 'max', id: o.id})\r\n          } else o.e.max = o.max\r\n        } else if (o.view) {\r\n          this.add_dependency(o.view + '_time', {type: 'max', id: o.id})\r\n        }\r\n        if (!(o.min in this.data.variables)) {\r\n          if (o.min in this.inputs) {\r\n            this.add_dependency(o.min, {type: 'min', id: o.id})\r\n          } else o.e.min = o.min\r\n        } else if (o.view) {\r\n          this.add_dependency(o.view + '_time', {type: 'min', id: o.id})\r\n        }\r\n        if ('undefined' !== typeof o.default) {\r\n          if (patterns.number.test(o.default as string)) {\r\n            o.default = +o.default\r\n          } else\r\n            o.reset = o.default_max\r\n              ? function (this: InputNumber) {\r\n                  if (this.range) {\r\n                    this.current_default = this.site.valueOf(this.range[1]) as number\r\n                    this.set(this.current_default)\r\n                  }\r\n                }.bind(o)\r\n              : o.default_max\r\n              ? function (this: InputNumber) {\r\n                  if (this.range) {\r\n                    this.current_default = this.site.valueOf(this.range[0]) as number\r\n                    this.set(this.current_default)\r\n                  }\r\n                }.bind(o)\r\n              : o.default in this.inputs\r\n              ? function (this: InputNumber) {\r\n                  this.current_default = this.site.valueOf(this.default) as number\r\n                  this.set(this.current_default)\r\n                }.bind(o)\r\n              : function () {}\r\n        }\r\n        if (o.variable) {\r\n          const d = -1 === this.spec.metadata.datasets.indexOf(o.dataset) ? defaults.dataset : o.dataset\r\n          if (o.variable in this.inputs) {\r\n            this.add_dependency(o.variable, {type: 'update', id: o.id})\r\n          } else if (o.variable in this.data.variables) {\r\n            o.min = o.parsed.min = o.range[0] = this.data.variables[o.variable].info[d].min\r\n            o.e.min = o.min + ''\r\n            o.max = o.parsed.max = o.range[1] = this.data.variables[o.variable].info[d].max\r\n            o.e.max = o.max + ''\r\n          }\r\n        }\r\n      }\r\n      if ('select' === o.type || 'number' === o.type || 'text' === o.type) {\r\n        if (\r\n          o.e.parentElement.lastElementChild &&\r\n          o.e.parentElement.lastElementChild.classList.contains('select-reset')\r\n        ) {\r\n          o.e.parentElement.lastElementChild.addEventListener('click', o.reset.bind(o))\r\n        }\r\n      }\r\n      if (patterns.settings.test(o.id)) {\r\n        o.setting = o.id.replace(patterns.settings, '')\r\n        if (null == o.default && o.setting in this.spec.settings) o.default = this.spec.settings[o.setting] as string\r\n        this.add_dependency(o.id, {type: 'setting', id: o.id})\r\n      }\r\n      if (!o.view) o.view = defaults.dataview\r\n      const v = this.url_options[o.id] || storage.get(o.id.replace(patterns.settings, ''))\r\n      if ('init' in o) o.init()\r\n      if (v) {\r\n        o.set(v as string)\r\n      } else {\r\n        o.reset()\r\n      }\r\n    })\r\n    this.registered_outputs.forEach(o => {\r\n      if ('init' in o) o.init()\r\n    })\r\n  }\r\n  global_update() {\r\n    this.meta.retain_state = false\r\n    this.queue.elements.forEach(this.request_queue)\r\n    this.registered_outputs.forEach(u => u.update())\r\n  }\r\n  global_reset() {\r\n    this.meta.retain_state = false\r\n    this.registered_inputs.forEach((u, k) => {\r\n      if (!u.setting && u.reset) {\r\n        u.reset()\r\n        this.request_queue(false, k)\r\n      }\r\n    })\r\n  }\r\n  clear_storage() {\r\n    if (window.localStorage) storage.perm.removeItem(storage.name)\r\n    window.location.reload()\r\n  }\r\n  request_queue(waiting: boolean | string, id?: string) {\r\n    if ('boolean' !== typeof waiting) {\r\n      id = waiting as string\r\n      waiting = false\r\n    }\r\n    if (!waiting && (-1 === this.queue.timeout || !this.queue.elements.get(id))) {\r\n      this.queue.elements.set(id, true)\r\n      if ((this.queue.timeout as number) > 0) clearTimeout(this.queue.timeout as number)\r\n      this.queue.timeout = setTimeout(this.run_queue, 20)\r\n      this.meta.lock_after = id\r\n    }\r\n  }\r\n  run_queue() {\r\n    if ((this.queue.timeout as number) > 0) clearTimeout(this.queue.timeout as number)\r\n    this.queue.timeout = -1\r\n    this.queue.elements.forEach((fire, k) => {\r\n      if (fire) {\r\n        const d = this.refresh_conditions(k) as string\r\n        if (d) {\r\n          if (!(k in this.data.data_queue[d])) this.data.data_queue[d][k] = this.run_queue\r\n          return false\r\n        }\r\n        this.queue.elements.set(k, false)\r\n      }\r\n    })\r\n    let k = this.get_options_url()\r\n    if (this.data.inited.first && k !== this.state) {\r\n      this.state = k\r\n      Object.keys(this.url_options).forEach(s => {\r\n        const v = this.url_options[s]\r\n        if ('string' === typeof v && patterns.embed_setting.test(s))\r\n          k += '&' + s + '=' + ('navcolor' === s ? v.replace(patterns.hashes, '%23') : v)\r\n      })\r\n      if (!this.spec.settings.hide_url_parameters) {\r\n        window.history.replaceState(Date.now(), '', k)\r\n      }\r\n      setTimeout(this.page.resize, 50)\r\n    }\r\n  }\r\n  refresh_conditions(id: string) {\r\n    if (id in this.dependencies) {\r\n      const d = this.dependencies[id],\r\n        r: number[] = [],\r\n        c = 'view.' === id.substring(0, 5) ? this.view : id in this.dataviews ? this.dataviews[id] : this.inputs[id],\r\n        is_view = c instanceof SiteDataView,\r\n        is_global = c instanceof GlobalView,\r\n        part = 'id' === id.substring(5) ? 'id_state' : 'filter_state',\r\n        v = is_global ? c[part]() : c && c.value() + '',\r\n        state = is_global ? c.states[part] : c && c.state\r\n      if (c && (!this.meta.retain_state || state !== v)) {\r\n        if (is_global) {\r\n          c.states[part] = v\r\n        } else if (!is_view) {\r\n          const view = this.dataviews[c.view],\r\n            dd =\r\n              v in this.data.loaded ? v : c.dataset ? (this.valueOf(c.dataset) as string) : view && view.get.dataset()\r\n          if (this.data.info && dd in this.data.loaded && !this.data.loaded[dd]) {\r\n            if (!c.deferred) this.data.retrieve(dd, this.data.info[dd].site_file)\r\n            return dd\r\n          }\r\n          c.state = v\r\n        } else {\r\n          c.state = v\r\n        }\r\n        d.forEach(di => {\r\n          if ('rule' === di.type) {\r\n            if (-1 === r.indexOf(di.rule)) {\r\n              r.push(di.rule)\r\n            }\r\n          } else if ('dataview' === di.type) {\r\n            this.dataviews[di.id].update()\r\n          } else if (di.conditional) {\r\n            this.conditionals[di.conditional](di.id in this.dataviews ? this.dataviews[di.id] : this.inputs[di.id], c)\r\n          } else if (di.id in this.inputs) {\r\n            const du = this.inputs[di.id]\r\n            di.type in du && (du[di.type as keyof BaseInput] as Function)()\r\n          } else if (di.id in this.outputs) {\r\n            const du = this.outputs[di.id]\r\n            di.type in du && du[di.type as 'update']()\r\n          }\r\n        })\r\n        r.forEach(i => {\r\n          let pass = false\r\n          const ri = this.spec.rules[i],\r\n            n = ri.condition.length\r\n          for (let i = 0; i < n; i++) {\r\n            const ck = ri.condition[i]\r\n            pass = ck.check()\r\n            if (ck.any ? pass : !pass) break\r\n          }\r\n          Object.keys(ri.parsed).forEach(k => {\r\n            if (pass) {\r\n              if ('display' === k) {\r\n                ri.parsed[k].e.classList.remove('hidden')\r\n              } else if ('lock' === k) {\r\n                ri.parsed[k].forEach((u: InputSelect) => {\r\n                  u.e.classList.remove('locked')\r\n                  utils.toggle_input(u, true)\r\n                })\r\n              } else if (k in this.inputs) {\r\n                const value = this.valueOf(ri.effects[k]) as string\r\n                this.inputs[k].set(value)\r\n              }\r\n            } else if ('display' === k) {\r\n              const e = ri.parsed[k]\r\n              if (!e.e.classList.contains('hidden')) {\r\n                e.e.classList.add('hidden')\r\n                if (e.u && e.u.reset) e.u.reset()\r\n                e.e.querySelectorAll('.auto-input').forEach(c => {\r\n                  const input = this.inputs[c.id]\r\n                  if (input && input.reset) input.reset()\r\n                })\r\n              }\r\n            } else if ('lock' === k) {\r\n              ri.parsed[k].forEach((u: InputSelect) => {\r\n                u.e.classList.add('locked')\r\n                utils.toggle_input(u)\r\n              })\r\n            } else if ('default' in ri) {\r\n              if (k in this.inputs) {\r\n                this.inputs[k].set(this.valueOf(ri.default) as string)\r\n              }\r\n            }\r\n          })\r\n        })\r\n      }\r\n      if (id === this.meta.lock_after) this.meta.retain_state = true\r\n    }\r\n  }\r\n  valueOf(v: boolean | string | number | (string | number)[]): boolean | string | number | (string | number)[] {\r\n    return 'string' === typeof v && v in this.inputs ? this.valueOf(this.inputs[v].value()) : v\r\n  }\r\n  get_options_url() {\r\n    let s = ''\r\n    this.registered_inputs.forEach((u, k) => {\r\n      if ('virtual' !== u.type && !patterns.settings.test(k)) {\r\n        if (!('range' in u) || u.range[0] !== u.range[1]) {\r\n          let v = u.value() as number | string | string[]\r\n          if ('off_default' in u ? u.off_default : v !== u.default) {\r\n            if (Array.isArray(v)) v = v.join(',')\r\n            if ('' !== v && null != v && '-1' != v) s += (s ? '&' : '?') + k + '=' + v\r\n          }\r\n        }\r\n      }\r\n    })\r\n    if (this.data && this.view.filters.size) s += (s ? '&' : '?') + this.view.filter_state([])\r\n    return window.location.protocol + '//' + window.location.host + window.location.pathname + s\r\n  }\r\n  gtag(...args: any) {\r\n    if (this.spec.settings.tracking) (window as any).dataLayer.push(arguments)\r\n  }\r\n  drop_load_screen() {\r\n    if (this.data && this.data.inited) clearTimeout(+this.data.inited.load_screen)\r\n    this.page.wrap.style.visibility = 'visible'\r\n    this.page.load_screen.style.display = 'none'\r\n    if (this.spec.tutorials && 'tutorial' in this.url_options) {\r\n      setTimeout(\r\n        this.page.tutorials.start_tutorial.bind(this.page.tutorials, {\r\n          target: {dataset: {name: this.url_options.tutorial}},\r\n        }),\r\n        0\r\n      )\r\n    }\r\n  }\r\n  add_dependency(id: string, o: Dependency): void {\r\n    if (!(id in this.dependencies)) this.dependencies[id] = []\r\n    if (!o.uid) o.uid = JSON.stringify(o)\r\n    if (o.type in this.conditionals) {\r\n      o.conditional = o.type as keyof typeof conditionals\r\n    }\r\n    const c = this.dependencies[id]\r\n    for (let i = c.length; i--; ) if (o.uid === c[i].uid) return void 0\r\n    c.push(o)\r\n    if (!(id in this.tree)) this.tree[id] = {_n: {children: 0, parents: 0}, children: {}, parents: {}}\r\n    if (!(o.id in this.tree)) this.tree[o.id] = {_n: {children: 0, parents: 0}, children: {}, parents: {}}\r\n    this.tree[id].children[o.id] = this.tree[o.id]\r\n    this.tree[id]._n.children++\r\n    this.tree[o.id].parents[id] = this.tree[id]\r\n    this.tree[o.id]._n.parents++\r\n    c.sort((a, b) => {\r\n      return !(a.id in this.tree) || !(b.id in this.tree)\r\n        ? -Infinity\r\n        : this.tree[a.id]._n.children - this.tree[b.id]._n.children\r\n    })\r\n    this.request_queue(true, id)\r\n  }\r\n  get_color(value: number, which: string, summary: Summary, index: number, rank: number, total: number) {\r\n    const pal = palettes[which]\r\n    if (isNaN(value) || 'continuous-polynomial' === pal.type) return this.defaults.missing\r\n    const settings = this.spec.settings,\r\n      centered = 'none' !== settings.color_scale_center && !settings.color_by_order,\r\n      fixed = 'discrete' === pal.type,\r\n      string = 'string' === summary.type,\r\n      min = !string ? summary.min[index] : 0,\r\n      range = string ? summary.levels.length - min : summary.range[index],\r\n      stat =\r\n        'none' === settings.color_scale_center || patterns.median.test(settings.color_scale_center as string)\r\n          ? 'median'\r\n          : 'mean',\r\n      center_source = ((settings.color_by_order ? 'break_' : 'norm_') + stat) as 'break_mean',\r\n      center = settings.color_by_order\r\n        ? centered\r\n          ? summary[center_source][index] / total\r\n          : 0.5\r\n        : isNaN(summary[center_source][index])\r\n        ? 0.5\r\n        : summary[center_source][index],\r\n      r = fixed\r\n        ? centered && !settings.color_by_order\r\n          ? Math.ceil(pal.colors.length / 2) - pal.odd / 2\r\n          : pal.colors.length\r\n        : 1,\r\n      p = settings.color_by_order\r\n        ? (rank + 0.5) / total\r\n        : range\r\n        ? ((string ? summary.level_ids[value] : value) - min) / range\r\n        : 0.5,\r\n      upper = p > (centered ? center : 0.5),\r\n      bound_ref = upper ? 'upper_' : 'lower_',\r\n      value_min = (bound_ref + stat + '_min') as 'upper_mean_min',\r\n      value_range = (bound_ref + stat + '_range') as 'upper_mean_range'\r\n    let v = centered\r\n      ? range\r\n        ? ((upper ? p - center : p + center) - summary[value_min][index]) / summary[value_range][index]\r\n        : 1\r\n      : p\r\n    if (!fixed) {\r\n      v = Math.max(0, Math.min(1, v))\r\n      if (upper) v = 1 - v\r\n      if (!centered) v *= 2\r\n    }\r\n    return (string ? value in summary.level_ids : 'number' === typeof value)\r\n      ? fixed\r\n        ? pal.colors[\r\n            Math.max(0, Math.min(pal.colors.length - 1, Math.floor(centered ? (upper ? r + r * v : r * v) : r * v)))\r\n          ]\r\n        : 'rgb(' +\r\n          (upper\r\n            ? pal.colors[0][0][0] +\r\n              v * pal.colors[0][1][0] +\r\n              ', ' +\r\n              (pal.colors[0][0][1] + v * pal.colors[0][1][1]) +\r\n              ', ' +\r\n              (pal.colors[0][0][2] + v * pal.colors[0][1][2])\r\n            : pal.colors[2][0][0] +\r\n              v * pal.colors[2][1][0] +\r\n              ', ' +\r\n              (pal.colors[2][0][1] + v * pal.colors[2][1][1]) +\r\n              ', ' +\r\n              (pal.colors[2][0][2] + v * pal.colors[2][1][2])) +\r\n          ')'\r\n      : defaults.missing\r\n  }\r\n}\r\n","import {BaseInput} from './index'\r\nimport type Community from '../index'\r\nimport {patterns} from '../patterns'\r\nimport type {Generic} from '../../types'\r\n\r\nexport class InputButton extends BaseInput {\r\n  type: 'button' = 'button'\r\n  e: HTMLButtonElement\r\n  target: string\r\n  text: string\r\n  api?: string\r\n  notification: HTMLElement\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.update = this.update.bind(this)\r\n    this.target = this.e.dataset.target\r\n    if ('copy' === this.target) this.settings.endpoint = site.spec.endpoint\r\n    if ('filter' === this.target) {\r\n      e.setAttribute('data-bs-toggle', 'modal')\r\n      e.setAttribute('data-bs-target', '#filter_display')\r\n      this.notification = document.createElement('span')\r\n      this.notification.className = 'filter-notification hidden'\r\n      e.parentElement.appendChild(this.notification)\r\n      site.add_dependency('view.filter', {type: 'update', id: this.id})\r\n      site.add_dependency('view.id', {type: 'update', id: this.id})\r\n      if (site.data) this.update()\r\n    } else\r\n      e.addEventListener(\r\n        'click',\r\n        this.settings.effects\r\n          ? 'export' === this.target || 'copy' === this.target\r\n            ? () => {\r\n                const f: {[index: string]: boolean | string | number | (string | number)[]} = {},\r\n                  s = this.settings,\r\n                  v = site.dataviews[s.dataview],\r\n                  d = v && v.parsed.dataset\r\n                Object.keys(s.query).forEach(k => (f[k] = site.valueOf(s.query[k])))\r\n                if (v) {\r\n                  if (!('include' in f) && v.y) f.include = site.valueOf(v.y)\r\n                  if (!('id' in f) && v.ids) f.id = site.valueOf(v.ids)\r\n                }\r\n                if ('copy' === this.target || this.api) {\r\n                  let q = []\r\n                  if ('id' in f && '' !== f.id && -1 != f.id) {\r\n                    q.push('id=' + f.id)\r\n                  } else {\r\n                    if (site.view.selected.length) q.push('id=' + site.view.selected.join(','))\r\n                  }\r\n                  if (v) {\r\n                    if (!f.time_range && v.time_range.filtered_index + '' !== v.time_range.index + '') {\r\n                      q.push(\r\n                        'time_range=' +\r\n                          site.data.meta.times[d].value[v.time_range.filtered_index[0]] +\r\n                          ',' +\r\n                          site.data.meta.times[d].value[v.time_range.filtered_index[1]]\r\n                      )\r\n                    }\r\n                    if (!v.features) v.features = {}\r\n                    Object.keys(v.features).forEach(k => {\r\n                      if (!(k in f)) {\r\n                        let fv = site.valueOf(v.features[k])\r\n                        if (Array.isArray(fv)) fv = fv.join(',')\r\n                        f[k] = fv\r\n                        q.push(k + '=' + fv)\r\n                      }\r\n                    })\r\n                    if (site.view.filters.size) site.view.filter_state(q, v.parsed.time_agg)\r\n                  }\r\n                  Object.keys(f).forEach(k => {\r\n                    if (!patterns.exclude_query.test(k) && !(k in v.features)) q.push(k + '=' + f[k])\r\n                  })\r\n                  const k = s.endpoint + (q.length ? '?' + q.join('&') : '')\r\n                  if (this.api) {\r\n                    window.location.href = k\r\n                  } else {\r\n                    navigator.clipboard.writeText(k).then(\r\n                      () => {\r\n                        if ('Copied!' !== e.innerText) {\r\n                          this.text = e.innerText\r\n                          e.innerText = 'Copied!'\r\n                          setTimeout(() => {\r\n                            e.innerText = this.text\r\n                          }, 500)\r\n                          site.gtag('event', 'export', {event_category: 'api link'})\r\n                        }\r\n                      },\r\n                      e => {\r\n                        if (e !== this.e.innerText) {\r\n                          this.text = this.e.innerText\r\n                          this.e.innerText = e\r\n                          setTimeout(() => {\r\n                            this.e.innerText = this.text\r\n                          }, 1500)\r\n                        }\r\n                      }\r\n                    )\r\n                  }\r\n                } else {\r\n                  if (v && 'selection' in v) {\r\n                    if (!f.time_range)\r\n                      f.time_range =\r\n                        site.data.meta.times[d].value[v.time_range.filtered_index[0]] +\r\n                        ',' +\r\n                        site.data.meta.times[d].value[v.time_range.filtered_index[1]]\r\n                    site.data.export(f as Generic, v.selection.all, true)\r\n                  } else site.data.export(f as Generic, site.data.entities, true, true)\r\n                  site.gtag('event', 'export', {event_category: 'download'})\r\n                }\r\n              }\r\n            : () => {\r\n                Object.keys(this.settings.effects).forEach(k => {\r\n                  this.settings.effects[k] === '' || -1 == this.settings.effects[k]\r\n                    ? site.inputs[k].reset()\r\n                    : site.inputs[k].set(this.settings.effects[k])\r\n                })\r\n              }\r\n          : 'refresh' === this.target\r\n          ? site.global_update\r\n          : 'reset_selection' === this.target\r\n          ? site.global_reset\r\n          : 'reset_storage' === this.target\r\n          ? site.clear_storage\r\n          : () => {\r\n              if (this.target in site.inputs) site.inputs[this.target].reset()\r\n            }\r\n      )\r\n  }\r\n  update() {\r\n    let n = +(0 !== this.site.view.selected.length)\r\n    this.site.view.filters.forEach(f => (n += +f.active))\r\n    if (n) {\r\n      this.notification.innerText = n + ''\r\n      this.notification.classList.remove('hidden')\r\n    } else {\r\n      this.notification.classList.add('hidden')\r\n    }\r\n  }\r\n}\r\n","import type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport class InputButtonGroup extends BaseInput {\r\n  type: 'buttongroup' = 'buttongroup'\r\n  options: NodeListOf<HTMLInputElement>\r\n  values: (string | number)[] = []\r\n  source: string | number\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    e.addEventListener('click', this.listen)\r\n    this.options = e.querySelectorAll('input')\r\n  }\r\n  get() {\r\n    for (let i = this.options.length; i--; ) {\r\n      if (this.options[i].checked) {\r\n        this.set(i)\r\n        break\r\n      }\r\n    }\r\n  }\r\n  set(v: string | number) {\r\n    this.previous = this.value()\r\n    this.current_index = 'string' === typeof v ? this.values.indexOf(v) : v\r\n    if (-1 !== this.current_index) {\r\n      this.source =\r\n        this.values[this.current_index] in this.site.inputs\r\n          ? (this.site.valueOf(this.values[this.current_index]) as string)\r\n          : this.values[this.current_index]\r\n      this.options[this.current_index].checked = true\r\n    } else this.source = undefined\r\n    this.site.request_queue(this.id)\r\n  }\r\n  listen(e: MouseEvent) {\r\n    this.set((e.target as HTMLInputElement).value)\r\n  }\r\n  add(value: string, display?: string, noadd?: boolean) {\r\n    const input = document.createElement('input'),\r\n      label = document.createElement('label')\r\n    input.autocomplete = 'off'\r\n    input.className = 'btn-check'\r\n    input.type = 'radio'\r\n    input.name = this.e.id + '_options'\r\n    input.id = this.e.id + '_option' + this.e.childElementCount\r\n    input.value = value\r\n    label.innerText = display || this.site.data.format_label(value)\r\n    label.className = 'btn btn-primary'\r\n    label.dataset.for = this.e.firstElementChild.id\r\n    if (!noadd) {\r\n      this.e.appendChild(input)\r\n      this.e.appendChild(label)\r\n    }\r\n    return input\r\n  }\r\n}\r\n","import {BaseInput} from './index'\r\nimport type Community from '../index'\r\nimport type {Generic, ObjectIndex, OptionSets, ResourceField} from '../../types'\r\nimport {loader, options_filter, set_current_options} from '../common_methods'\r\n\r\nexport type SelectSpec = {\r\n  group?: string\r\n  filters?: Generic\r\n}\r\n\r\nexport class InputSelect extends BaseInput {\r\n  type: 'select' = 'select'\r\n  e: HTMLSelectElement\r\n  default: string | number\r\n  current_filter: {[index: string]: string} = {}\r\n  groups: {e: HTMLElement[]; by_name: {[index: string]: HTMLElement}}\r\n  options: HTMLOptionElement[]\r\n  values: ObjectIndex = {}\r\n  display: ObjectIndex = {}\r\n  option_sets: OptionSets = {}\r\n  current_set = ''\r\n  sensitive = false\r\n  loader?: (...args: any) => void\r\n  filter = options_filter\r\n  reformat_label = false\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    e.addEventListener('change', this.listen)\r\n    this.options = [...e.querySelectorAll('option')]\r\n    if (this.optionSource && this.site.patterns.ids.test(this.optionSource)) {\r\n      this.loader = loader.bind(this)\r\n      e.addEventListener('click', this.loader)\r\n      this.deferred = true\r\n    } else if (\r\n      'number' === typeof this.default &&\r\n      this.default > -1 &&\r\n      this.options.length &&\r\n      this.default < this.options.length\r\n    ) {\r\n      this.default = this.options[this.default].value || this.options[this.default].dataset.value\r\n    }\r\n    if (this.options.length) {\r\n      this.reformat_label = true\r\n      this.options.forEach((e, i) => {\r\n        e.dataset.value = e.value\r\n        this.values[e.value] = i\r\n        if (this.reformat_label) this.reformat_label = e.value === e.innerText\r\n      })\r\n      const group: NodeListOf<HTMLOptGroupElement> = e.querySelectorAll('optgroup')\r\n      if (group.length) {\r\n        this.groups = {e: [], by_name: {}}\r\n        group.forEach(e => {\r\n          const name = e.dataset.group\r\n          this.groups.e.push(e)\r\n          this.groups.by_name[name] = e\r\n        })\r\n      }\r\n    }\r\n  }\r\n  init() {\r\n    this.options.forEach((e, i) => {\r\n      if (this.reformat_label) e.innerText = this.site.data.format_label(e.value)\r\n      this.display[e.innerText] = i\r\n    })\r\n  }\r\n  set_current = set_current_options\r\n  get() {\r\n    this.set(this.e.selectedIndex)\r\n  }\r\n  set(v: string | number) {\r\n    if ('string' === typeof v && !(v in this.values) && this.site.patterns.number.test(v)) v = +v\r\n    if ('number' === typeof v) v = this.options[v] ? this.options[v].value : v\r\n    if (!(v in this.values) && v in this.display) v = this.options[this.display[v]].value\r\n    if (v !== this.source) {\r\n      this.e.selectedIndex = v in this.values ? this.values[v] : -1\r\n      this.source = v\r\n      this.site.request_queue(this.id)\r\n    }\r\n  }\r\n  listen(e: MouseEvent) {\r\n    this.set((e.target as HTMLSelectElement).selectedIndex)\r\n  }\r\n  add(value: string, display?: string, noadd?: boolean, meta?: ResourceField) {\r\n    const e = document.createElement('option')\r\n    e.value = value\r\n    e.innerText = display || this.site.data.format_label(value)\r\n    if (meta && meta.info) {\r\n      e.title = (meta.info.description || meta.info.short_description) as string\r\n    }\r\n    if (!noadd) this.e.appendChild(e)\r\n    this.values[value] = this.display[e.innerText] = this.options.length\r\n    this.options.push(e)\r\n    return e\r\n  }\r\n}\r\n","import {BaseInput} from './index'\r\nimport type Community from '../index'\r\nimport type {LogicalObject} from '../../types'\r\n\r\nexport type NumberSpec = {}\r\n\r\nexport class InputNumber extends BaseInput {\r\n  type: 'number' = 'number'\r\n  e: HTMLInputElement\r\n  default: string | number\r\n  source: number\r\n  parsed = {min: -Infinity, max: Infinity}\r\n  min: string | number\r\n  default_min: boolean\r\n  min_ref: number\r\n  min_indicator?: HTMLElement\r\n  max: string | number\r\n  default_max: boolean\r\n  max_ref: number\r\n  max_indicator?: HTMLElement\r\n  step?: number\r\n  current_default: number\r\n  previous: number\r\n  off_default?: boolean\r\n  value: () => number\r\n  ref: boolean\r\n  range: [number, number]\r\n  depends: LogicalObject\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    e.addEventListener('change', this.listen)\r\n    this.update = this.update.bind(this)\r\n    const up = e.parentElement.parentElement.querySelector('.number-up')\r\n    const down = e.parentElement.parentElement.querySelector('.number-down')\r\n    if (down) {\r\n      down.addEventListener('click', () => {\r\n        this.set(Math.max(this.parsed.min, this.value() - 1))\r\n      })\r\n    }\r\n    if (up) {\r\n      up.addEventListener('click', () => {\r\n        this.set(Math.min(this.parsed.max, this.value() + 1))\r\n      })\r\n    }\r\n  }\r\n  get() {\r\n    this.set(this.e.value)\r\n  }\r\n  set(v: string | number, check?: boolean) {\r\n    if (!v) v = null\r\n    if ('string' === typeof v) v = parseFloat(v)\r\n    if (isFinite(v) && v !== this.source) {\r\n      this.previous = parseFloat(this.e.value)\r\n      if (check) {\r\n        if (isFinite(this.parsed.min) && v < this.parsed.min) {\r\n          v = this.parsed.min\r\n        } else if (isFinite(this.parsed.max) && v > this.parsed.max) {\r\n          v = this.parsed.max\r\n        }\r\n      }\r\n      this.off_default = v !== this.current_default\r\n      this.source = v\r\n      this.e.value = v + ''\r\n      this.current_index = v - this.parsed.min\r\n      if ('range' === this.e.type) {\r\n        ;(this.e.nextElementSibling.firstElementChild as HTMLElement).innerText = this.e.value\r\n      }\r\n      this.site.request_queue(this.id)\r\n    }\r\n  }\r\n  listen() {\r\n    this.set(this.e.value, true)\r\n  }\r\n  async update() {\r\n    const view = this.site.dataviews[this.view],\r\n      variable = this.site.valueOf(this.variable || view.y) as string\r\n    // if (!view.time_range) view.time_range = {time: []}\r\n    let d = view.get ? view.get.dataset() : (this.site.valueOf(this.dataset) as string),\r\n      min = (this.site.valueOf(this.min) || view.time) as string | number | undefined,\r\n      max = (this.site.valueOf(this.max) || view.time) as string | number | undefined\r\n    if ('string' === typeof min && this.site.patterns.minmax.test(min))\r\n      min = (this.site.inputs[this.min] as InputNumber).min\r\n    if ('string' === typeof max && this.site.patterns.minmax.test(max))\r\n      max = (this.site.inputs[this.max] as InputNumber).max\r\n    this.parsed.min = isNaN(this.min_ref)\r\n      ? 'undefined' === typeof min\r\n        ? view.time_range.time[0]\r\n        : 'number' === typeof min\r\n        ? min\r\n        : min in this.site.data.variables\r\n        ? this.site.data.variables[min].info[d || this.site.data.variables[min].datasets[0]].min\r\n        : parseFloat(min)\r\n      : this.min_ref\r\n    this.parsed.max = isNaN(this.max_ref)\r\n      ? 'undefined' === typeof max\r\n        ? view.time_range.time[1]\r\n        : 'number' === typeof max\r\n        ? max\r\n        : max in this.site.data.variables\r\n        ? this.site.data.variables[max].info[d || this.site.data.variables[max].datasets[0]].max\r\n        : parseFloat(max)\r\n      : this.min_ref\r\n    if (this.default_min) {\r\n      this.current_default = this.parsed.min\r\n    } else if (this.default_max) {\r\n      this.current_default = this.parsed.max\r\n    }\r\n    if (this.ref && variable in this.site.data.variables) {\r\n      this.range[0] = isNaN(this.min_ref) ? Math.max(view.time_range.time[0], this.parsed.min) : this.min_ref\r\n      this.e.min = this.range[0] + ''\r\n      this.range[1] = isNaN(this.max_ref) ? Math.min(view.time_range.time[1], this.parsed.max) : this.max_ref\r\n      this.e.max = this.range[1] + ''\r\n      if (!this.depends[view.y]) {\r\n        this.depends[view.y] = true\r\n        this.site.add_dependency(view.y, {type: 'update', id: this.id})\r\n      }\r\n      if (this.source > this.parsed.max || this.source < this.parsed.min) this.reset()\r\n      // this.variable = await this.site.data.get_variable(variable, this.view)\r\n    } else {\r\n      this.e.min = this.parsed.min + ''\r\n      if (this.parsed.min > this.source || (!this.source && this.default_min)) this.set(this.parsed.min)\r\n      this.e.max = this.parsed.max + ''\r\n      if (this.parsed.max < this.source || (!this.source && this.default_max)) this.set(this.parsed.max)\r\n    }\r\n  }\r\n}\r\n","import type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport class InputRadio extends BaseInput {\r\n  type: 'radio' = 'radio'\r\n  options: NodeListOf<HTMLInputElement>\r\n  values: (string | number)[] = []\r\n  source: string | number\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    this.options = e.querySelectorAll('input')\r\n    this.options.forEach(o => {\r\n      this.values.push(o.value)\r\n      o.addEventListener('click', this.listen)\r\n    })\r\n    if ('number' === typeof this.default && this.options[this.default]) this.default = this.values[this.default]\r\n  }\r\n  get() {\r\n    for (let i = this.options.length; i--; ) {\r\n      if (this.options[i].checked) {\r\n        this.set(i)\r\n        break\r\n      }\r\n    }\r\n  }\r\n  set(v: string | number) {\r\n    this.current_index = 'string' === typeof v ? this.values.indexOf(v) : v\r\n    if (-1 !== this.current_index) {\r\n      this.source =\r\n        this.values[this.current_index] in this.site.inputs\r\n          ? (this.site.valueOf(this.values[this.current_index]) as string)\r\n          : this.values[this.current_index]\r\n      this.options[this.current_index].checked = true\r\n    } else this.source = undefined\r\n    this.site.request_queue(this.id)\r\n  }\r\n  listen(e: MouseEvent) {\r\n    this.set((e.target as HTMLInputElement).value)\r\n  }\r\n  add(value: string, display?: string, noadd?: boolean) {\r\n    const e = document.createElement('div'),\r\n      s = 'TRUE' === this.e.dataset.switch,\r\n      input = document.createElement('input'),\r\n      label = document.createElement('label')\r\n    e.className = 'form-check' + (s ? ' form-switch' : '')\r\n    e.appendChild(input)\r\n    e.appendChild(label)\r\n    input.autocomplete = 'off'\r\n    input.className = 'form-check-input'\r\n    if (s) input.role = 'switch'\r\n    input.type = 'radio'\r\n    input.name = this.e.id + '_options'\r\n    input.id = this.e.id + '_option' + this.e.childElementCount\r\n    input.value = value\r\n    label.innerText = display || this.site.data.format_label(value)\r\n    label.className = 'form-check-label'\r\n    label.setAttribute('for', e.firstElementChild.id)\r\n    if (!noadd) this.e.appendChild(e)\r\n    return input\r\n  }\r\n}\r\n","import type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport class InputSwitch extends BaseInput {\r\n  type: 'switch' = 'switch'\r\n  e: HTMLInputElement\r\n  source: boolean\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    e.addEventListener('change', this.listen)\r\n  }\r\n  get() {\r\n    this.set(this.e.checked)\r\n  }\r\n  set(v: string | boolean) {\r\n    if ('string' === typeof v) v = 'on' === v || 'true' === v\r\n    if (v !== this.source) {\r\n      this.previous = this.e.checked\r\n      this.e.checked = this.source = v\r\n      this.site.request_queue(this.id)\r\n    }\r\n  }\r\n  listen(e: MouseEvent) {\r\n    this.set(this.e.checked)\r\n  }\r\n}\r\n","import type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport class InputCheckbox extends BaseInput {\r\n  type: 'checkbox' = 'checkbox'\r\n  options: NodeListOf<HTMLInputElement>\r\n  values: (string | number)[] = []\r\n  source: (string | number)[]\r\n  current_index: number[]\r\n  off_default: boolean\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    this.options = e.querySelectorAll('input')\r\n    this.options.forEach(o => {\r\n      this.values.push(o.value)\r\n      o.addEventListener('click', this.listen)\r\n    })\r\n    if ('string' === typeof this.default) this.default = this.default.split(',')\r\n    this.get()\r\n  }\r\n  get() {\r\n    this.source = []\r\n    this.current_index = []\r\n    this.off_default = false\r\n    this.options.forEach((o, i) => {\r\n      if (o.checked) {\r\n        this.source.push(this.values[i])\r\n        this.current_index.push(i)\r\n      } else {\r\n        this.off_default = true\r\n      }\r\n    })\r\n    this.site.request_queue(this.id)\r\n  }\r\n  set(v: string | number | (string | number)[]) {\r\n    if (Array.isArray(v)) {\r\n      this.source = []\r\n      this.current_index = []\r\n      this.off_default = false\r\n      this.values.forEach((cv, i) => {\r\n        if (-1 !== v.indexOf(cv)) {\r\n          this.source.push(cv)\r\n          this.current_index.push(i)\r\n          this.options[i].checked = true\r\n        } else {\r\n          this.off_default = true\r\n          this.options[i].checked = false\r\n        }\r\n      })\r\n    } else {\r\n      if ('string' === typeof v) {\r\n        this.set('' === v ? this.values : v.split(','))\r\n        return\r\n      } else {\r\n        if (-1 !== v) {\r\n          this.options[v].checked = true\r\n          this.off_default = false\r\n          this.options.forEach(o => {\r\n            if (!o.checked) this.off_default = true\r\n          })\r\n        }\r\n      }\r\n    }\r\n    this.site.request_queue(this.id)\r\n  }\r\n  listen(e: MouseEvent) {\r\n    const input = e.target as HTMLInputElement\r\n    if (input.checked) {\r\n      this.source.push(input.value)\r\n      this.current_index.push(this.values.indexOf(input.value))\r\n      this.off_default = false\r\n      this.options.forEach(o => {\r\n        if (!o.checked) this.off_default = true\r\n      })\r\n    } else {\r\n      let i = this.source.indexOf(input.value)\r\n      if (i !== -1) {\r\n        this.off_default = true\r\n        this.source.splice(i, 1)\r\n        this.current_index.splice(i, 1)\r\n      }\r\n    }\r\n    this.site.request_queue(this.id)\r\n  }\r\n  add(value: string, display?: string, noadd?: boolean) {\r\n    const e = document.createElement('div'),\r\n      s = 'TRUE' === this.e.dataset.switch,\r\n      input = document.createElement('input'),\r\n      label = document.createElement('label')\r\n    e.className = 'form-check' + (s ? ' form-switch' : '')\r\n    e.appendChild(input)\r\n    e.appendChild(label)\r\n    input.autocomplete = 'off'\r\n    input.className = 'form-check-input'\r\n    if (s) input.role = 'switch'\r\n    input.type = 'checkbox'\r\n    input.name = this.e.id + '_options'\r\n    input.id = this.e.id + '_option' + this.e.childElementCount\r\n    input.value = value\r\n    label.innerText = display || this.site.data.format_label(value)\r\n    label.className = 'form-check-label'\r\n    label.setAttribute('for', e.firstElementChild.id)\r\n    if (!noadd) this.e.appendChild(e)\r\n    return input\r\n  }\r\n}\r\n","import type Community from '../index'\r\nimport {BaseInput} from './index'\r\n\r\nexport class InputText extends BaseInput {\r\n  type: 'text' = 'text'\r\n  default: string | number\r\n  e: HTMLInputElement\r\n  source: string\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.listen = this.listen.bind(this)\r\n    e.addEventListener('change', this.listen)\r\n  }\r\n  get() {\r\n    this.set(this.e.value)\r\n  }\r\n  set(v: string) {\r\n    this.previous = this.e.checked\r\n    this.e.value = this.source = v\r\n    this.site.request_queue(this.id)\r\n  }\r\n  listen(e: MouseEvent) {\r\n    this.set(this.e.value)\r\n  }\r\n}\r\n","import type {\r\n  Circle,\r\n  Control,\r\n  FeatureGroup,\r\n  GeoJSONOptions,\r\n  Layer,\r\n  LeafletEvent,\r\n  LeafletMouseEvent,\r\n  Map,\r\n  Polygon,\r\n} from 'leaflet'\r\nimport DataHandler from '../../data_handler/index'\r\nimport type {Entity, Generic, MeasureInfo, Summary} from '../../types'\r\nimport Community, {Dependency} from '../index'\r\nimport {BaseOutput} from './index'\r\nimport type {SiteDataView} from '../dataview'\r\nimport {palettes} from '../palettes'\r\nimport type {InputNumber} from '../inputs/number'\r\nimport {fill_overlay_properties_options} from '../utils'\r\nimport type {SiteInputs} from '../inputs/index'\r\n\r\ntype LayerSource = {\r\n  name?: string\r\n  url: string\r\n  time?: number\r\n  id_property?: string\r\n  processed?: boolean\r\n  property_summaries?: {}\r\n}\r\nexport type MapLayer = {\r\n  name?: string\r\n  url: string\r\n  id_property?: string\r\n  time?: number | string\r\n  retrieved?: boolean\r\n  processed?: boolean\r\n  property_summaries?: {\r\n    [index: string]: [number, number, number]\r\n  }\r\n  callbacks?: Function[]\r\n}\r\ntype Tiles = {url: string; options?: {[index: string]: any}}\r\ntype Options = {[index: string]: boolean | number | string | (number | string)[]}\r\ntype LayerFilter = {\r\n  feature: string\r\n  operator: string\r\n  value: string\r\n  check?: Function\r\n}\r\ntype Overlay = {\r\n  variable: string\r\n  source: string | LayerSource[]\r\n  filter?: LayerFilter | LayerFilter[]\r\n}\r\nexport type MapSpec = {\r\n  shapes?: MapLayer[]\r\n  overlays?: Overlay[]\r\n  options: Options\r\n  tiles?: Tiles | {light: Tiles; dark: Tiles}\r\n}\r\n\r\nexport type MeasureLayer = {\r\n  source?: string | LayerSource[]\r\n  filter?: LayerFilter[]\r\n}\r\n\r\ntype MapParsed = {\r\n  dataset?: string\r\n  color?: string\r\n  time?: number\r\n  view?: SiteDataView\r\n  palette?: string\r\n  summary?: Summary\r\n}\r\n\r\nexport class OutputMap extends BaseOutput {\r\n  type: 'map' = 'map'\r\n  time: string\r\n  parsed: MapParsed = {}\r\n  clickto?: SiteInputs\r\n  layers: {[index: string]: FeatureGroup} = {}\r\n  overlays: Overlay[] = []\r\n  map: Map\r\n  overlay: FeatureGroup<Layer>\r\n  displaying: FeatureGroup<Layer>\r\n  overlay_control: Control\r\n  tiles: {[index: string]: any} = {}\r\n  fresh_shapes = false\r\n  has_time = false\r\n  by_time: number[] = []\r\n  queue: number | NodeJS.Timeout\r\n  spec: MapSpec\r\n  options: Options\r\n  triggers: {[index: string]: MeasureLayer} = {}\r\n  vstate = ''\r\n  cstate = ''\r\n  reference_options: Generic = {}\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.queue_init = this.queue_init.bind(this)\r\n    this.mouseover = this.mouseover.bind(this)\r\n    this.mouseout = this.mouseout.bind(this)\r\n    this.click = this.click.bind(this)\r\n    this.show_overlay = this.show_overlay.bind(this)\r\n    this.color = this.e.dataset.color\r\n    this.options = this.spec.options\r\n    Object.keys(this.options).forEach(k => {\r\n      const opt = this.options[k]\r\n      if ('string' === typeof opt && opt in site.inputs) this.reference_options[k] = opt\r\n    })\r\n    if (!this.e.style.height) this.e.style.height = this.options.height ? (this.options.height as string) : '400px'\r\n  }\r\n  init() {\r\n    const dep: Dependency = {type: 'update', id: this.id},\r\n      view = this.site.dataviews[this.view]\r\n    if (view) {\r\n      if (view.time_agg in this.site.inputs) this.site.add_dependency(view.time_agg as string, dep)\r\n      if (view.y) this.site.add_dependency(view.y, dep)\r\n    } else this.view = this.site.defaults.dataview\r\n    this.site.add_dependency(this.view, dep)\r\n    if (this.color in this.site.inputs) this.site.add_dependency(this.color, dep)\r\n    if (this.time) this.site.add_dependency(this.time, dep)\r\n    const click_ref = this.e.dataset.click\r\n    if (click_ref in this.site.inputs) this.clickto = this.site.inputs[click_ref]\r\n    if (this.options.overlays_from_measures && this.site.data.variable_info) {\r\n      if (Array.isArray(this.spec.overlays)) this.overlays = this.spec.overlays\r\n      Object.keys(this.site.data.variable_info).forEach(variable => {\r\n        const info = this.site.data.variable_info[variable] as MeasureInfo\r\n        if (info.layer && info.layer.source) {\r\n          const source: {url: string; time: number}[] = [],\r\n            layer: Overlay = {variable: variable, source: source}\r\n          if ('string' === typeof info.layer.source && this.site.patterns.time_ref.test(info.layer.source)) {\r\n            const temp = info.layer.source\r\n            for (\r\n              let range = this.site.data.meta.ranges[variable], y = range[0], max = range[1] + 1, time;\r\n              y < max;\r\n              y++\r\n            ) {\r\n              time = this.site.data.meta.overall.value[y]\r\n              source.push({url: temp.replace(this.site.patterns.time_ref, time + ''), time: time})\r\n            }\r\n          }\r\n          this.site.patterns.time_ref.lastIndex = 0\r\n          if (info.layer.filter && (Array.isArray(info.layer.filter) || 'feature' in info.layer.filter))\r\n            layer.filter = info.layer.filter\r\n          this.overlays.push(layer)\r\n        }\r\n      })\r\n    }\r\n    this.queue_init()\r\n  }\r\n  queue_init() {\r\n    const theme = this.site.spec.settings.theme_dark ? 'dark' : 'light',\r\n      showing = this.deferred || !this.tab || this.tab.classList.contains('show')\r\n    if (showing && window.L) {\r\n      this.map = window.L.map(this.e, this.options)\r\n      this.overlay = window.L.featureGroup().addTo(this.map)\r\n      this.displaying = window.L.featureGroup().addTo(this.map)\r\n      this.overlay_control = window.L.control\r\n        .layers()\r\n        .setPosition('topleft')\r\n        .addOverlay(this.overlay, 'Overlay')\r\n        .addTo(this.map)\r\n      const tiles = this.spec.tiles\r\n      if (tiles) {\r\n        if ('url' in tiles) {\r\n          this.tiles[theme] = window.L.tileLayer(tiles.url, tiles.options)\r\n          this.tiles[theme].addTo(this.map)\r\n        } else {\r\n          Object.keys(tiles).forEach((k: 'dark' | 'light') => {\r\n            this.tiles[k] = window.L.tileLayer(tiles[k].url, tiles[k].options)\r\n            if (theme === k) this.tiles[k].addTo(this.map)\r\n          })\r\n        }\r\n      }\r\n      const time = this.site.data.meta.overall.value[this.site.dataviews[this.view].parsed.time_agg]\r\n      this.spec.shapes.forEach((shape: MapLayer, i: number) => {\r\n        const has_time = 'time' in shape\r\n        if (has_time) {\r\n          if (!this.has_time) {\r\n            this.has_time = true\r\n            this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n          }\r\n          this.by_time.push(+shape.time)\r\n        }\r\n        let k = shape.name\r\n        if (!k) shape.name = k = this.site.spec.metadata.datasets[i < this.site.spec.metadata.datasets.length ? i : 0]\r\n        const mapId = k + (has_time ? shape.time : '')\r\n        if (!(mapId in this.site.maps.queue)) this.site.maps.queue[mapId] = shape\r\n        this.site.data.inited[mapId + this.id] = false\r\n        if (\r\n          (this.site.data.loaded[k] || k === this.site.spec.settings.background_shapes) &&\r\n          (k === mapId || (time && this.by_time.length && shape.time == this.match_time(time)))\r\n        )\r\n          this.retrieve_layer(shape)\r\n      })\r\n      if (this.has_time) this.by_time.sort()\r\n      if (Array.isArray(this.overlays)) {\r\n        this.overlays.forEach(l => {\r\n          if ('string' === typeof l.source) l.source = [{url: l.source}]\r\n          const source = l.source\r\n          source.forEach(s => {\r\n            s.processed = false\r\n            s.property_summaries = {}\r\n            this.site.maps.queue[s.url] = s\r\n          })\r\n          this.triggers[l.variable] = {source}\r\n          const fs = l.filter\r\n          if (fs) {\r\n            const fa = Array.isArray(fs) ? fs : [fs]\r\n            this.triggers[l.variable].filter = fa\r\n            fa.forEach(f => {\r\n              f.check = DataHandler.checks[f.operator]\r\n            })\r\n          }\r\n        })\r\n      }\r\n      this.update()\r\n    } else {\r\n      this.deferred = true\r\n      setTimeout(this.queue_init, showing ? 0 : 2000)\r\n    }\r\n  }\r\n  match_time(time: number) {\r\n    let i = this.by_time.length\r\n    for (; i--; ) if (!i || this.by_time[i] <= time) break\r\n    return this.by_time[i]\r\n  }\r\n  show(e: Entity) {\r\n    if (e.layer && e.layer[this.id]) {\r\n      const highlight_style = {\r\n          color: 'var(--border-highlight)',\r\n          weight: (this.site.spec.settings.polygon_outline as number) + 1,\r\n          fillOpacity: 1,\r\n        },\r\n        layer = e.layer[this.id]\r\n      if ('has_time' in layer) {\r\n        if (!this.site.data.inited[this.parsed.dataset + this.id]) {\r\n          const time = this.match_time(\r\n            this.site.data.meta.overall.value[\r\n              this.site.data.variables[this.parsed.color].time_range[this.parsed.dataset][0] + this.parsed.time\r\n            ]\r\n          )\r\n          if (layer[time]) (layer[time] as Polygon).setStyle(highlight_style)\r\n        }\r\n      } else if (layer.setStyle) {\r\n        layer.setStyle(highlight_style)\r\n      }\r\n    }\r\n  }\r\n  revert(e: Entity) {\r\n    if (e.layer && e.layer[this.id]) {\r\n      const default_style = {\r\n          color: 'var(--border)',\r\n          weight: this.site.spec.settings.polygon_outline as number,\r\n          fillOpacity: 0.7,\r\n        },\r\n        layer = e.layer[this.id]\r\n      if ('has_time' in layer) {\r\n        if (!this.site.data.inited[this.parsed.dataset + this.id]) {\r\n          const time = this.match_time(\r\n            this.site.data.meta.overall.value[\r\n              this.site.data.variables[this.parsed.color].time_range[this.parsed.dataset][0] + this.parsed.time\r\n            ]\r\n          )\r\n          if (layer[time]) (layer[time] as Polygon).setStyle(default_style)\r\n        }\r\n      } else {\r\n        layer.setStyle(default_style)\r\n      }\r\n    }\r\n  }\r\n  mouseover(e: LeafletEvent) {\r\n    e.target.setStyle({\r\n      color: 'var(--border-highlight)',\r\n    })\r\n    this.site.subs.update(\r\n      this.id,\r\n      'show',\r\n      this.site.data.entities[e.target.feature.properties[e.target.source.id_property]]\r\n    )\r\n  }\r\n  mouseout(e: LeafletEvent) {\r\n    this.site.subs.update(\r\n      this.id,\r\n      'revert',\r\n      this.site.data.entities[e.target.feature.properties[e.target.source.id_property]]\r\n    )\r\n    e.target.setStyle({\r\n      color: 'var(--border)',\r\n    })\r\n  }\r\n  click(e: LeafletEvent) {\r\n    if (this.clickto) this.clickto.set(e.target.feature.properties[e.target.source.id_property])\r\n  }\r\n  async update(entity?: Entity, caller?: SiteInputs, pass?: boolean) {\r\n    if ((this.queue as number) > 0) clearTimeout(this.queue)\r\n    this.queue = -1\r\n    if (!pass) {\r\n      if (!this.tab || this.tab.classList.contains('show'))\r\n        this.queue = setTimeout(() => this.update(void 0, void 0, true), 50)\r\n    } else {\r\n      if (this.view && this.displaying) {\r\n        const parsed = this.parsed,\r\n          view = this.site.dataviews[this.view],\r\n          d = view.get.dataset(),\r\n          time = this.site.valueOf(view.time_agg),\r\n          map_time = this.has_time ? this.match_time(time as number) : '',\r\n          inited = d + map_time + this.id in this.site.data.inited,\r\n          mapId = inited ? d + map_time : d\r\n        if (this.site.maps.queue && mapId in this.site.maps.queue && !this.site.data.inited[mapId + this.id]) {\r\n          if (!inited || null !== time)\r\n            this.retrieve_layer(this.site.maps.queue[mapId], () => this.update(void 0, void 0, true))\r\n          return\r\n        }\r\n        if (!view.valid[d] && this.site.data.inited[d]) {\r\n          view.state = ''\r\n          view.update()\r\n        }\r\n        parsed.view = view\r\n        parsed.dataset = d\r\n        const vstate =\r\n            view.value() +\r\n            mapId +\r\n            this.site.spec.settings.background_shapes +\r\n            this.site.spec.settings.background_top +\r\n            this.site.spec.settings.background_polygon_outline +\r\n            this.site.data.inited[this.options.background_shapes as string],\r\n          a = view.selection.all,\r\n          s =\r\n            view.selection[this.site.spec.settings.background_shapes && this.options.background_shapes ? 'ids' : 'all'],\r\n          c = this.site.valueOf(this.color || view.y) as string\r\n        if (this.site.spec.settings.map_overlay && c in this.triggers) {\r\n          this.show_overlay(this.triggers[c], this.site.data.meta.overall.value[view.parsed.time_agg])\r\n        } else {\r\n          this.overlay_control.remove()\r\n          this.overlay.clearLayers()\r\n        }\r\n        if (this.site.data.inited[mapId + this.id] && view.valid[d]) {\r\n          const ys = this.time\r\n              ? (this.site.inputs[this.time] as InputNumber)\r\n              : view.time_agg\r\n              ? view.time_agg in this.site.inputs\r\n                ? (this.site.inputs[view.time_agg] as InputNumber)\r\n                : parseInt(view.time_agg as string)\r\n              : 0,\r\n            time_input = 'number' !== typeof ys\r\n          parsed.palette = (this.site.valueOf(view.palette) || this.site.spec.settings.palette) as string\r\n          if (!(parsed.palette in palettes)) parsed.palette = this.site.defaults.palette\r\n          const varc = await this.site.data.get_variable(c, this.site.dataviews[this.view]),\r\n            summary = varc.views[this.view].summaries[d],\r\n            time =\r\n              (time_input && ys.parsed ? (ys.value() as number) - this.site.data.meta.times[d].range[0] : 0) -\r\n              varc.time_range[d][0]\r\n          parsed.summary = summary\r\n          parsed.time = time\r\n          parsed.color = c\r\n          const subset = !time_input && summary.n[ys] === view.n_selected.dataset ? 'rank' : 'subset_rank'\r\n          if (vstate !== this.vstate) {\r\n            ;(this.map as any)._zoomAnimated = 'none' !== this.site.spec.settings.map_animations\r\n            Object.keys(this.reference_options).forEach(k => {\r\n              this.options[k] = this.site.valueOf(this.reference_options[k])\r\n              if ('zoomAnimation' === k) (this.map as any)._zoomAnimated = this.options[k]\r\n            })\r\n            this.displaying.clearLayers()\r\n            this.fresh_shapes = true\r\n            this.vstate = ''\r\n            let n = 0\r\n            Object.keys(s).forEach(k => {\r\n              const skl = s[k].layer && s[k].layer[this.id]\r\n              if (skl) {\r\n                const fg = k in a,\r\n                  cl = 'has_time' in skl ? (skl[map_time] as Polygon) : skl\r\n                if (cl && (fg || this.options.background_shapes === this.site.data.entities[k].group)) {\r\n                  n++\r\n                  ;(cl.options as GeoJSONOptions).interactive = fg\r\n                  cl.addTo(this.displaying)\r\n                  if (fg) {\r\n                    if (this.site.spec.settings.background_top) cl.bringToBack()\r\n                  } else {\r\n                    if (!this.site.spec.settings.background_top) cl.bringToBack()\r\n                    cl.setStyle({\r\n                      fillOpacity: 0,\r\n                      color: 'var(--border-highlight)',\r\n                      weight: this.site.spec.settings.background_polygon_outline as number,\r\n                    })\r\n                  }\r\n                  if (!this.vstate) this.vstate = vstate\r\n                }\r\n              }\r\n            })\r\n            this.overlay.bringToFront()\r\n            if (n)\r\n              if ('fly' === this.site.spec.settings.map_animations) {\r\n                setTimeout(() => this.map.flyToBounds(this.displaying.getBounds()), 400)\r\n              } else {\r\n                this.map.fitBounds(this.displaying.getBounds())\r\n              }\r\n          }\r\n\r\n          // coloring\r\n          const k =\r\n            c +\r\n            this.vstate +\r\n            parsed.palette +\r\n            time +\r\n            this.site.spec.settings.polygon_outline +\r\n            this.site.spec.settings.color_by_order +\r\n            this.site.spec.settings.color_scale_center\r\n          if (k !== this.cstate) {\r\n            this.cstate = k\r\n            const ls = (this.displaying as any)._layers\r\n            const n = summary.n[time]\r\n            Object.keys(ls).forEach(id => {\r\n              const lsi = ls[id]\r\n              if (d === lsi.entity.group) {\r\n                const e = a[lsi.entity.features.id],\r\n                  es = e && e.views[this.view][subset]\r\n                lsi.setStyle({\r\n                  fillOpacity: 0.7,\r\n                  color: 'var(--border)',\r\n                  fillColor:\r\n                    e && c in es\r\n                      ? this.site.get_color(e.get_value(c, time), parsed.palette, summary, time, es[c][time], n)\r\n                      : this.site.defaults.missing,\r\n                  weight: this.site.spec.settings.polygon_outline,\r\n                })\r\n              }\r\n            })\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  async retrieve_layer(source: MapLayer, callback?: Function) {\r\n    const mapId = source.name ? source.name + (source.time || '') : source.url\r\n    if (!('_raw' in this.site.spec.map)) this.site.spec.map._raw = {}\r\n    if (source.url in this.site.spec.map._raw) {\r\n      this.process_layer(source)\r\n      this.site.maps.queue[mapId].retrieved = true\r\n      callback && callback()\r\n    } else {\r\n      if (this.site.maps.queue[mapId] && 'retrieved' in this.site.maps.queue[mapId]) {\r\n        if (callback) {\r\n          if (!this.site.maps.queue[mapId].callbacks) this.site.maps.queue[mapId].callbacks = []\r\n          this.site.maps.queue[mapId].callbacks.push(callback)\r\n        }\r\n      } else {\r\n        this.site.maps.queue[mapId].retrieved = false\r\n        const f = new window.XMLHttpRequest()\r\n        f.onreadystatechange = () => {\r\n          if (4 === f.readyState && 200 === f.status) {\r\n            this.site.spec.map._raw[source.url] = f.responseText\r\n            if (source.name) {\r\n              this.site.maps.queue[mapId].retrieved = true\r\n            }\r\n            if (this.site.maps.queue[mapId].callbacks) {\r\n              if (callback) this.site.maps.queue[mapId].callbacks.push(callback)\r\n              this.site.maps.queue[mapId].callbacks.forEach(f => f())\r\n            } else callback && callback()\r\n          }\r\n        }\r\n        f.open('GET', source.url, true)\r\n        f.send()\r\n      }\r\n    }\r\n  }\r\n  process_layer(source: MapLayer) {\r\n    const has_time = 'time' in source,\r\n      layerId = source.name + (has_time ? source.time : '')\r\n    this.layers[layerId] = window.L.geoJSON(JSON.parse(this.site.spec.map._raw[source.url]), {\r\n      onEachFeature: (f, l: Polygon) => {\r\n        l.on({\r\n          mouseover: this.mouseover,\r\n          mouseout: this.mouseout,\r\n          click: this.click,\r\n        })\r\n        l.setStyle({weight: 0, fillOpacity: 0})\r\n        ;(l as any).source = source\r\n        const p = l.feature.properties\r\n        let id = p[source.id_property]\r\n        if (!(id in this.site.data.entities) && this.site.patterns.leading_zeros.test(id))\r\n          id = p[source.id_property] = id.replace(this.site.patterns.leading_zeros, '')\r\n        if (!(id in this.site.data.entities)) {\r\n          this.site.data.entities[id] = {layer: {}, features: {id: id}}\r\n        }\r\n        const entity = this.site.data.entities[id]\r\n        if (!('layer' in entity)) entity.layer = {}\r\n        if (has_time) {\r\n          if (!(this.id in entity.layer)) entity.layer[this.id] = {has_time: true}\r\n          ;(entity.layer[this.id] as {[index: string]: Polygon})[source.time as string] = l\r\n        } else entity.layer[this.id] = l\r\n        ;(l as any).entity = entity\r\n        if (entity.features)\r\n          Object.keys(p).forEach(f => {\r\n            if (!(f in entity.features)) {\r\n              if (\r\n                'name' === f.toLowerCase() &&\r\n                (!('name' in entity.features) || entity.features.id === entity.features.name)\r\n              ) {\r\n                entity.features[f.toLowerCase()] = p[f]\r\n              } else {\r\n                entity.features[f] = p[f]\r\n              }\r\n            }\r\n          })\r\n      },\r\n    })\r\n    this.site.data.inited[layerId + this.id] = true\r\n    if (this.site.maps.waiting && this.site.maps.waiting[source.name]) {\r\n      for (let i = this.site.maps.waiting[source.name].length; i--; ) {\r\n        this.site.request_queue(this.site.maps.waiting[source.name][i])\r\n      }\r\n    }\r\n  }\r\n  show_overlay(o: MeasureLayer, time: number) {\r\n    let i = 0,\r\n      source = ''\r\n    if ('string' === typeof o.source) {\r\n      source = o.source\r\n    } else {\r\n      for (i = o.source.length; i--; ) {\r\n        if (!o.source[i].time || time === o.source[i].time) {\r\n          if (o.source[i].name) delete o.source[i].name\r\n          source = o.source[i].url\r\n          break\r\n        }\r\n      }\r\n    }\r\n    if (source) {\r\n      if (source in this.site.spec.map._raw) {\r\n        if (!(source in this.layers)) {\r\n          const property_summaries: {[index: string]: [number, number, number]} = {}\r\n          if (!this.site.maps.queue[source].processed) {\r\n            this.site.maps.queue[source].property_summaries = property_summaries\r\n          }\r\n          this.layers[source] = window.L.geoJSON(JSON.parse(this.site.spec.map._raw[source]), {\r\n            pointToLayer: (point, coords) => window.L.circleMarker(coords),\r\n            onEachFeature: l => {\r\n              const props = l.properties\r\n              if (props) {\r\n                Object.keys(props).forEach(f => {\r\n                  const v = props[f]\r\n                  if ('number' === typeof v) {\r\n                    if (!(f in property_summaries)) property_summaries[f] = [Infinity, -Infinity, 0]\r\n                    if (v < property_summaries[f][0]) property_summaries[f][0] = v\r\n                    if (v > property_summaries[f][1]) property_summaries[f][1] = v\r\n                  }\r\n                })\r\n              }\r\n            },\r\n          }).on('mouseover', (l: LeafletMouseEvent) => {\r\n            const layer = l.propagatedFrom\r\n            if (layer && !layer._tooltip) {\r\n              const props = layer.feature && layer.feature.properties\r\n              if (props) {\r\n                const e = document.createElement('table')\r\n                Object.keys(props).forEach(f => {\r\n                  const v = props[f],\r\n                    tr = document.createElement('tr')\r\n                  let td = document.createElement('td')\r\n                  tr.appendChild(td)\r\n                  td.innerText = f\r\n                  tr.appendChild((td = document.createElement('td')))\r\n                  td.innerText = v\r\n                  e.appendChild(tr)\r\n                })\r\n                layer.bindTooltip(e)\r\n                layer.openTooltip()\r\n              }\r\n            }\r\n          })\r\n          Object.keys(property_summaries).forEach(f => {\r\n            property_summaries[f][2] = property_summaries[f][1] - property_summaries[f][0]\r\n            if (!property_summaries[f][2]) delete property_summaries[f]\r\n          })\r\n          this.site.maps.overlay_property_selectors.forEach(u => {\r\n            if (!(source in u.option_sets)) {\r\n              fill_overlay_properties_options(u, source, u.option_sets)\r\n              u.dataset = source\r\n              u.variable = ''\r\n            }\r\n          })\r\n        }\r\n        this.site.maps.overlay_property_selectors.forEach(u => {\r\n          u.dataset = source\r\n          this.site.conditionals.options(u)\r\n        })\r\n        this.overlay.clearLayers()\r\n        let n = 0\r\n        const summaries = this.site.spec.settings.circle_property && this.site.maps.queue[source].property_summaries,\r\n          prop_summary = summaries && summaries[this.site.spec.settings.circle_property as string]\r\n        this.layers[source].eachLayer((l: Circle) => {\r\n          if (o.filter) {\r\n            for (let i = o.filter.length; i--; ) {\r\n              if (!o.filter[i].check(l.feature.properties[o.filter[i].feature], o.filter[i].value)) return\r\n            }\r\n          }\r\n          n++\r\n          l.setRadius(\r\n            prop_summary\r\n              ? ((l.feature.properties[this.site.spec.settings.circle_property as string] - prop_summary[0]) /\r\n                  prop_summary[2] +\r\n                  0.5) *\r\n                  (this.site.spec.settings.circle_radius as number)\r\n              : (this.site.spec.settings.circle_radius as number)\r\n          ).setStyle({\r\n            weight: this.site.spec.settings.polygon_outline as number,\r\n            color: 'white',\r\n            opacity: 0.5,\r\n            fillOpacity: 0.5,\r\n            fillColor: 'black',\r\n          })\r\n          l.addTo(this.overlay)\r\n        })\r\n        if (n) this.overlay_control.addTo(this.map)\r\n      } else return this.retrieve_layer(o.source[i] as LayerSource, () => this.show_overlay(o, time))\r\n    }\r\n  }\r\n}\r\n","import type {SiteInputs} from '../inputs/index'\r\nimport {BaseOutput} from './index'\r\nimport Community from '../index'\r\nimport {Entity, Summary} from '../../types'\r\nimport {SiteDataView} from '../dataview'\r\n\r\ntype PlotlyAxis = {\r\n  title?: string\r\n  range?: number[]\r\n  gridcolor?: string\r\n  autorange?: boolean\r\n  type?: string\r\n  dtick?: number\r\n  showgrid?: boolean\r\n}\r\n\r\ntype Layout = {\r\n  paper_bgcolor?: string\r\n  plot_bgcolor?: string\r\n  font?: {\r\n    color?: string\r\n  }\r\n  modebar?: {\r\n    bgcolor?: string\r\n    color?: string\r\n  }\r\n  xaxis?: PlotlyAxis\r\n  yaxis?: PlotlyAxis\r\n}\r\n\r\ntype Data = {\r\n  name?: string\r\n  id?: string\r\n  color?: string\r\n  hoverinfo?: string\r\n  line?: {\r\n    color?: string\r\n    width?: number\r\n  }\r\n  marker?: {\r\n    color?: string\r\n    line?: {width?: number; color?: string}\r\n    size?: number\r\n  }\r\n  'marker.line.color'?: string\r\n  'marker.line.width'?: number\r\n  showlegend?: boolean\r\n  text?: string[]\r\n  textfont?: {color?: string}\r\n  type?: string\r\n  x?: number[]\r\n  y?: number[]\r\n  median?: number[]\r\n  q3?: number[]\r\n  q1?: number[]\r\n  upperfence: number[]\r\n  lowerfence: number[]\r\n}\r\n\r\ntype Config = {\r\n  [index: string]: string\r\n}\r\n\r\ninterface PlotlyHTMLElement extends HTMLElement {\r\n  data: Data[]\r\n  config: Config\r\n  layout: Layout\r\n  _fullLayout: Layout\r\n  on: (even_type: string, fun: (d: PlotlyMouseEvent) => void) => PlotlyHTMLElement\r\n}\r\n\r\ndeclare class Plotly {\r\n  static newPlot: (e: HTMLElement, data: Data[], layout: Layout, config: Config) => void\r\n  static react: (e: PlotlyHTMLElement, data: Data[], layout: Layout, config: Config) => void\r\n  static addTraces: (e: PlotlyHTMLElement, trace: Data, position: number) => void\r\n  static deleteTraces: (e: PlotlyHTMLElement, position: number) => void\r\n  static restyle: (e: PlotlyHTMLElement, fragment: {[index: string]: string | number}, position: number) => void\r\n  static relayout: (e: PlotlyHTMLElement, layout: Layout) => void\r\n}\r\n\r\nexport type PlotlySpec = {\r\n  [index: string]: Layout | Config | Data[] | string[] | string\r\n  layout: Layout\r\n  config: Config\r\n  data: Data[]\r\n  subto?: string[]\r\n}\r\n\r\ntype PlotlyMouseEvent = {\r\n  points: {\r\n    fullData: {index: number}\r\n    data: {id: string}\r\n  }[]\r\n}\r\n\r\nexport class OutputPlotly extends BaseOutput {\r\n  type: 'plotly' = 'plotly'\r\n  e: PlotlyHTMLElement\r\n  dark_theme: boolean\r\n  clickto?: SiteInputs\r\n  previous_span = 1\r\n  base_trace?: string\r\n  traces: {[index: string]: string} = {}\r\n  parsed: {\r\n    x?: string\r\n    y?: string\r\n    dataset?: string\r\n    color?: string\r\n    palette?: string\r\n    time?: number\r\n    base_trace?: string\r\n    summary?: Summary\r\n    y_range?: number[]\r\n    x_range?: number[]\r\n    view?: SiteDataView\r\n  } = {}\r\n  style?: Layout\r\n  time: string\r\n  spec: PlotlySpec\r\n  queue: number | NodeJS.Timeout = -1\r\n  state: string = ''\r\n  reference_options: {[index: string]: string} = {}\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.queue_init = this.queue_init.bind(this)\r\n    this.mouseover = this.mouseover.bind(this)\r\n    this.mouseout = this.mouseout.bind(this)\r\n    this.click = this.click.bind(this)\r\n    this.x = e.dataset.x\r\n    this.y = e.dataset.y\r\n    this.color = e.dataset.color\r\n    this.time = e.dataset.colorTime\r\n    Object.keys(this.spec).forEach(k => {\r\n      const opt = this.spec[k]\r\n      if ('string' === typeof opt && opt in site.inputs) this.reference_options[k] = opt\r\n    })\r\n    if (this.tab) {\r\n      document.getElementById(e.parentElement.getAttribute('aria-labelledby')).addEventListener(\r\n        'click',\r\n        function (this: OutputPlotly) {\r\n          if (!this.e.parentElement.classList.contains('active')) {\r\n            setTimeout(this.update, 155)\r\n            setTimeout(this.site.page.trigger_resize, 155)\r\n          }\r\n        }.bind(this)\r\n      )\r\n    }\r\n  }\r\n  init() {\r\n    if (this.x && !(this.x in this.site.data.variables)) {\r\n      this.site.add_dependency(this.x, {type: 'update', id: this.id})\r\n    }\r\n    if (this.y && !(this.y in this.site.data.variables)) {\r\n      this.site.add_dependency(this.y, {type: 'update', id: this.id})\r\n    }\r\n    if (this.color && !(this.color in this.site.data.variables)) {\r\n      this.site.add_dependency(this.color, {type: 'update', id: this.id})\r\n    }\r\n    if (this.time in this.site.inputs) {\r\n      this.site.add_dependency(this.time, {type: 'update', id: this.id})\r\n    }\r\n    if (this.view) {\r\n      this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n      this.site.add_dependency(this.view + '_filter', {type: 'update', id: this.id})\r\n      if (this.site.dataviews[this.view].time_agg in this.site.dataviews)\r\n        this.site.add_dependency(this.site.dataviews[this.view].time_agg as string, {type: 'update', id: this.id})\r\n    } else this.view = this.site.defaults.dataview\r\n    this.spec.data.forEach((p: Data, i: number) => {\r\n      Object.keys(p).forEach((k: keyof Data) => {\r\n        if (this.site.patterns.period.test(k)) {\r\n          const es = k.split('.') as (keyof Data)[],\r\n            n = es.length - 1\r\n          let pl: {[index: string]: string | {[index: string]: string}}\r\n          es.forEach((e, ei) => {\r\n            pl = pl ? (pl[e] = ei === n ? (p[k] as {[index: string]: string}) : {}) : ((p as any)[e] = {})\r\n          })\r\n        }\r\n      })\r\n      if (!('textfont' in p)) p.textfont = {}\r\n      if (!('color' in p.textfont)) p.textfont.color = this.site.defaults.background_highlight\r\n      if (!('line' in p)) p.line = {}\r\n      if (!('color' in p.line)) p.line.color = this.site.defaults.background_highlight\r\n      if (!('marker' in p)) p.marker = {}\r\n      p.marker.size = 8\r\n      if (!('color' in p.marker)) p.marker.color = this.site.defaults.background_highlight\r\n      if (!('line' in p.marker)) p.marker.line = {}\r\n      if (!('color' in p.marker.line)) p.marker.line.color = this.site.defaults.background_highlight\r\n      if (!('text' in p)) p.text = []\r\n      if (!('x' in p)) p.x = []\r\n      if ('box' === p.type) {\r\n        p.hoverinfo = 'none'\r\n      } else if (!('y' in p)) p.y = []\r\n      this.traces[p.type] = JSON.stringify(p)\r\n      if (!i) {\r\n        this.base_trace = p.type\r\n        if (this.base_trace in this.site.inputs)\r\n          this.site.add_dependency(this.base_trace, {type: 'update', id: this.id})\r\n      }\r\n    })\r\n    const click_ref = this.e.dataset.click\r\n    if (click_ref in this.site.inputs) this.clickto = this.site.inputs[click_ref]\r\n    this.queue_init()\r\n  }\r\n  show(e: Entity) {\r\n    this.revert()\r\n    let trace = this.make_data_entry(\r\n      e,\r\n      0,\r\n      0,\r\n      'hover_line',\r\n      this.site.defaults['border_highlight_' + this.site.spec.settings.theme_dark]\r\n    )\r\n    if (trace) {\r\n      trace.line.width = 4\r\n      trace.marker.size = 12\r\n      Plotly.addTraces(this.e, trace, this.e.data.length)\r\n    }\r\n  }\r\n  revert() {\r\n    const data = this.e.data\r\n    if (data.length && 'hover_line' === data[data.length - 1].name) Plotly.deleteTraces(this.e, data.length - 1)\r\n  }\r\n  queue_init() {\r\n    const showing = this.deferred || !this.tab || this.tab.classList.contains('show')\r\n    if (showing && 'Plotly' in window) {\r\n      Plotly.newPlot(this.e, this.spec.data, this.spec.layout, this.spec.config)\r\n      this.e.on('plotly_hover', this.mouseover)\r\n      this.e.on('plotly_unhover', this.mouseout)\r\n      this.e.on('plotly_click', this.click)\r\n      this.update_theme()\r\n      this.update()\r\n    } else {\r\n      this.deferred = true\r\n      setTimeout(this.queue_init, showing ? 0 : 2000)\r\n    }\r\n  }\r\n  mouseover(d: PlotlyMouseEvent) {\r\n    if (d.points && 1 === d.points.length && this.e.data[d.points[0].fullData.index]) {\r\n      Plotly.restyle(this.e, {'line.width': 5}, d.points[0].fullData.index)\r\n      this.site.subs.update(this.id, 'show', this.site.data.entities[d.points[0].data.id])\r\n    }\r\n  }\r\n  mouseout(d: PlotlyMouseEvent) {\r\n    if (d.points && 1 === d.points.length && this.e.data[d.points[0].fullData.index]) {\r\n      Plotly.restyle(this.e, {'line.width': 2}, d.points[0].fullData.index)\r\n      this.site.subs.update(this.id, 'revert', this.site.data.entities[d.points[0].data.id])\r\n    }\r\n  }\r\n  click(d: PlotlyMouseEvent) {\r\n    this.clickto && this.clickto.set(d.points[0].data.id)\r\n  }\r\n  async update(pass?: boolean) {\r\n    if ((this.queue as number) > 0) clearTimeout(this.queue)\r\n    this.queue = -1\r\n    if (!pass) {\r\n      if (!this.tab || this.tab.classList.contains('show')) this.queue = setTimeout(() => this.update(true), 50)\r\n    } else {\r\n      if (this.e.layout) {\r\n        const v = this.site.dataviews[this.view],\r\n          s = v.selection && v.selection.all,\r\n          d = v.get.dataset(),\r\n          y = this.site.inputs[this.time || v.time_agg],\r\n          parsed = this.parsed\r\n        if (this.site.data.inited[d] && v.valid[d] && v.time_range.filtered.length) {\r\n          parsed.base_trace = this.site.valueOf(this.base_trace) as string\r\n          parsed.x = this.site.valueOf(this.x) as string\r\n          parsed.y = this.site.valueOf(this.y) as string\r\n          parsed.color = this.site.valueOf(this.color || v.y || parsed.y) as string\r\n          const varx = await this.site.data.get_variable(parsed.x, v),\r\n            vary = await this.site.data.get_variable(parsed.y, v),\r\n            varcol = await this.site.data.get_variable(parsed.color, v)\r\n          parsed.x_range = varx.time_range[d]\r\n          parsed.y_range = vary.time_range[d]\r\n          parsed.view = v\r\n          parsed.dataset = d\r\n          parsed.palette = (this.site.valueOf(v.palette) || this.site.spec.settings.palette) as string\r\n          if (!(parsed.palette in this.site.palettes)) parsed.palette = this.site.defaults.palette\r\n          parsed.time =\r\n            (y ? (y.value() as number) - this.site.data.meta.times[d].range[0] : 0) - varcol.time_range[d][0]\r\n          parsed.summary = varcol.views[this.view].summaries[d]\r\n          const ns = parsed.summary.n,\r\n            display_time = ns[parsed.time] ? parsed.time : 0,\r\n            summary = vary.views[this.view].summaries[d],\r\n            n = ns[display_time],\r\n            subset = n !== v.n_selected.dataset,\r\n            rank = subset ? 'subset_rank' : 'rank',\r\n            order = subset ? varcol.views[this.view].order[d][display_time] : varcol.info[d].order[display_time],\r\n            traces: Data[] = []\r\n          let i = parsed.summary.missing[display_time],\r\n            k: string,\r\n            b: Data,\r\n            fn = order ? order.length : 0,\r\n            settings = this.site.spec.settings,\r\n            lim = (settings.trace_limit as number) || 0,\r\n            jump,\r\n            state =\r\n              v.value() +\r\n              v.get.time_filters() +\r\n              d +\r\n              parsed.x +\r\n              parsed.y +\r\n              parsed.time +\r\n              parsed.palette +\r\n              parsed.color +\r\n              settings.summary_selection +\r\n              settings.color_scale_center +\r\n              settings.color_by_order +\r\n              settings.trace_limit +\r\n              settings.show_empty_times\r\n          lim = jump = lim && lim < n ? Math.ceil(Math.min(lim / 2, n / 2)) : 0\r\n          Object.keys(this.reference_options).forEach(\r\n            (k: keyof PlotlySpec) => (this.spec[k] = this.site.valueOf(this.reference_options[k]) as string)\r\n          )\r\n          for (; i < fn; i++) {\r\n            if (order[i][0] in s) {\r\n              k = order[i][0]\r\n              const e = s[k]\r\n              state += k\r\n              traces.push(this.make_data_entry(e, e.views[this.view][rank][parsed.color][parsed.time], n))\r\n              if (lim && !--jump) break\r\n            }\r\n          }\r\n          if (lim && i < fn) {\r\n            for (jump = i, i = fn - 1; i > jump; i--) {\r\n              if (order[i][0] in s) {\r\n                k = order[i][0]\r\n                const e = s[k]\r\n                state += k\r\n                traces.push(this.make_data_entry(e, e.views[this.view][rank][parsed.color][parsed.time], n))\r\n                if (!--lim) break\r\n              }\r\n            }\r\n          }\r\n          state += traces.length && traces[0].type\r\n          if (settings.boxplots && 'box' in this.traces && s[k]) {\r\n            state += 'box' + settings.iqr_box\r\n            b = JSON.parse(this.traces.box)\r\n            traces.push(b)\r\n            b.line.color = this.site.defaults.border\r\n            b.median = summary.median\r\n            b.q3 = summary.q3\r\n            b.q1 = summary.q1\r\n            if (settings.iqr_box) {\r\n              b.upperfence = []\r\n              b.lowerfence = []\r\n              b.q1.forEach((q1, i) => {\r\n                if (isNaN(b.median[i])) b.median[i] = 0\r\n                const n = (b.q3[i] - q1) * 1.5,\r\n                  med = b.median[i]\r\n                b.q3[i] = isNaN(b.q3[i]) ? med : Math.max(med, b.q3[i])\r\n                b.upperfence[i] = b.q3[i] + n\r\n                b.q1[i] = isNaN(b.q1[i]) ? med : Math.min(med, q1)\r\n                b.lowerfence[i] = q1 - n\r\n              })\r\n            } else {\r\n              b.upperfence = summary.max\r\n              b.lowerfence = summary.min\r\n            }\r\n            if (settings.show_empty_times) {\r\n              b.x = b.q1.map((_, i) => s[k].get_value(parsed.x, i + parsed.y_range[0]))\r\n            } else {\r\n              b.x = []\r\n              for (i = b.q1.length; i--; ) {\r\n                if (ns[i]) {\r\n                  b.x[i] = s[k].get_value(parsed.x, i + parsed.y_range[0])\r\n                }\r\n              }\r\n            }\r\n          }\r\n          if (state !== this.state) {\r\n            if ('boolean' !== typeof this.e.layout.yaxis.title)\r\n              this.e.layout.yaxis.title =\r\n                this.site.data.format_label(parsed.y) +\r\n                ((settings.trace_limit as number) < v.n_selected.all ? ' (' + settings.trace_limit + ' extremes)' : '')\r\n            if ('boolean' !== typeof this.e.layout.xaxis.title)\r\n              this.e.layout.xaxis.title = this.site.data.format_label(parsed.x)\r\n            this.e.layout.yaxis.autorange = false\r\n            this.e.layout.yaxis.range = [Infinity, -Infinity]\r\n            if (!b) b = {upperfence: summary.max, lowerfence: summary.min}\r\n            let any_skipped = false\r\n            summary.min.forEach((min, i) => {\r\n              if (settings.show_empty_times || ns[i]) {\r\n                const l = Math.min(b.lowerfence[i], min),\r\n                  u = Math.max(b.upperfence[i], summary.max[i])\r\n                if (this.e.layout.yaxis.range[0] > l) this.e.layout.yaxis.range[0] = l\r\n                if (this.e.layout.yaxis.range[1] < u) this.e.layout.yaxis.range[1] = u\r\n              } else any_skipped = true\r\n            })\r\n            const r = (this.e.layout.yaxis.range[1] - this.e.layout.yaxis.range[0]) / 10\r\n            this.e.layout.yaxis.range[0] -= r\r\n            this.e.layout.yaxis.range[1] += r\r\n            if (this.e.layout.yaxis.range[1] > 100) {\r\n              const yinfo = vary.info[d].info\r\n              if (yinfo && 'percent' === (yinfo.aggregation_method || yinfo.type)) this.e.layout.yaxis.range[1] = 100\r\n            }\r\n            if (this.site.data.variables[parsed.x].is_time) {\r\n              const start = v.time_range.filtered[0],\r\n                end = v.time_range.filtered[1],\r\n                adj = any_skipped && end > start ? Math.log(end - start) : 0.5\r\n              if (this.e.layout.xaxis.autorange) {\r\n                this.e.layout.xaxis.autorange = false\r\n                this.e.layout.xaxis.type = 'linear'\r\n                this.e.layout.xaxis.dtick = 1\r\n                this.e.layout.xaxis.range = [start - adj, end + adj]\r\n              } else {\r\n                this.e.layout.xaxis.range[0] = start - adj\r\n                this.e.layout.xaxis.range[1] = end + adj\r\n              }\r\n            }\r\n            if (b.lowerfence.length < this.previous_span) {\r\n              Plotly.newPlot(this.e, traces, this.e.layout, this.e.config)\r\n              this.e\r\n                .on('plotly_hover', this.mouseover)\r\n                .on('plotly_unhover', this.mouseout)\r\n                .on('plotly_click', this.click)\r\n            } else {\r\n              Plotly.react(this.e, traces, this.e.layout, this.e.config)\r\n            }\r\n            setTimeout(this.site.page.trigger_resize, 300)\r\n            this.previous_span = b.lowerfence.length\r\n            this.state = state\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  make_data_entry(e: Entity, rank: number, total: number, name?: string, color?: string) {\r\n    const data = this.site.data\r\n    if (e.data && this.parsed.x in data.variables) {\r\n      const x = data.get_value({variable: this.parsed.x, entity: e}),\r\n        y = data.get_value({variable: this.parsed.y, entity: e}),\r\n        t: Data = JSON.parse(this.traces[this.base_trace]),\r\n        yr = data.variables[this.parsed.y].time_range[this.parsed.dataset],\r\n        xr = data.variables[this.parsed.x].time_range[this.parsed.dataset],\r\n        n = Math.min(yr[1], xr[1]) + 1,\r\n        ns = this.parsed.summary.n\r\n      for (let i = Math.max(yr[0], xr[0]); i < n; i++) {\r\n        if (this.site.spec.settings.show_empty_times || ns[i - this.parsed.y_range[0]]) {\r\n          t.text.push(e.features.name)\r\n          t.x.push(this.parsed.x_range[0] <= i && i <= this.parsed.x_range[1] ? x[i - this.parsed.x_range[0]] : NaN)\r\n          t.y.push(this.parsed.y_range[0] <= i && i <= this.parsed.y_range[1] ? y[i - this.parsed.y_range[0]] : NaN)\r\n        }\r\n      }\r\n      t.type = this.parsed.base_trace\r\n      t.color =\r\n        t.line.color =\r\n        t.marker.color =\r\n        t.textfont.color =\r\n          color ||\r\n          this.site.get_color(\r\n            e.get_value(this.parsed.color, this.parsed.time),\r\n            this.parsed.palette,\r\n            this.parsed.summary,\r\n            this.parsed.time,\r\n            rank,\r\n            total\r\n          ) ||\r\n          this.site.defaults.border\r\n      if ('bar' === t.type) t.marker.line.width = 0\r\n      t.name = name || e.features.name\r\n      t.id = e.features.id\r\n      return t\r\n    }\r\n  }\r\n  update_theme() {\r\n    if (this.dark_theme !== this.site.spec.settings.theme_dark) {\r\n      this.dark_theme = this.site.spec.settings.theme_dark as boolean\r\n      const s = getComputedStyle(document.body)\r\n      if (!('style' in this)) {\r\n        this.style = this.spec.layout\r\n        if (!('font' in this.style)) this.style.font = {}\r\n        if (!('modebar' in this.style)) this.style.modebar = {}\r\n      }\r\n      this.style.paper_bgcolor = s.backgroundColor\r\n      this.style.plot_bgcolor = s.backgroundColor\r\n      this.style.font.color = s.color\r\n      this.style.modebar.bgcolor = s.backgroundColor\r\n      this.style.modebar.color = s.color\r\n      if (this.e._fullLayout.xaxis.showgrid) this.style.xaxis.gridcolor = s.borderColor\r\n      if (this.e._fullLayout.yaxis.showgrid) this.style.yaxis.gridcolor = s.borderColor\r\n      Plotly.relayout(this.e, this.spec.layout)\r\n    }\r\n  }\r\n}\r\n","import type {SiteInputs} from '../inputs/index'\r\nimport {BaseOutput} from './index'\r\nimport type Community from '../index'\r\nimport type {Entity, ObjectIndex, Order, Summary, Variables} from '../../types'\r\nimport DataHandler from '../../data_handler/index'\r\n\r\ntype TableVariableSpec = {name: string; title?: string; source?: 'data' | 'features'}\r\ntype TableOrderSpec = [number, string][]\r\ntype TableFeatureSpec = {title?: string; name?: string}[]\r\nexport type DataTableSpec = {\r\n  [index: string]:\r\n    | boolean\r\n    | string\r\n    | string[]\r\n    | TableFeatureSpec\r\n    | TableOrderSpec\r\n    | TableVariableSpec\r\n    | TableVariableSpec[]\r\n  variables?: string | string[] | TableVariableSpec | TableVariableSpec[]\r\n  order?: TableOrderSpec\r\n  features?: string | TableFeatureSpec\r\n  variable_source?: string\r\n}\r\ntype TableRowRef = {\r\n  time: number\r\n  entity: {get_value: Function; features: {[index: string]: number}; variables: Variables}\r\n  int: boolean\r\n  offset: number\r\n  variable: string\r\n}\r\ntype TableRowGen = {\r\n  int: boolean\r\n  variable: string\r\n  time_range: number[]\r\n  renderer?: (o: OutputDataTable, e: Entity) => void\r\n}\r\ninterface DataTableRow {\r\n  node: () => HTMLTableRowElement\r\n  scrollTo: (animate?: boolean) => void\r\n  selector: {\r\n    rows: number\r\n    cols: number\r\n    opts: {\r\n      order: string\r\n      search: string\r\n      page: string\r\n    }\r\n  }\r\n}\r\ninterface DataTableCell extends HTMLTableCellElement {\r\n  _DT_CellIndex: {row: number; column: number}\r\n}\r\ninterface DataTablesMouseEvent extends MouseEvent {\r\n  target: DataTableCell\r\n}\r\n\r\nexport class OutputDataTable extends BaseOutput {\r\n  type: 'datatable' = 'datatable'\r\n  table: DataTables.Api\r\n  style: HTMLStyleElement\r\n  clickto?: SiteInputs\r\n  spec: DataTableSpec\r\n  parsed: {\r\n    summary?: Summary\r\n    order?: Order\r\n    time: number\r\n    color: string\r\n    dataset?: string\r\n    time_index: ObjectIndex\r\n    time_range?: number[]\r\n  } = {time: 0, color: '', time_index: {}}\r\n  time: string\r\n  queue: number | NodeJS.Timeout = -1\r\n  pending: number | NodeJS.Timeout = -1\r\n  state: string = ''\r\n  reference_options: {[index: string]: string} = {}\r\n  header: {\r\n    title: string\r\n    data?: string | Function\r\n    type?: string\r\n    render?: Function\r\n    dataset?: string\r\n    variable?: string\r\n  }[] = []\r\n  rows: {[index: string]: DataTableRow} = {}\r\n  rowIds: {[index: number]: string} = {}\r\n  variable_header = false\r\n  variables: TableVariableSpec | TableVariableSpec[]\r\n  current_filter: {[index: string]: string} = {}\r\n  varstate: string\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.queue_init = this.queue_init.bind(this)\r\n    this.mouseover = this.mouseover.bind(this)\r\n    this.mouseout = this.mouseout.bind(this)\r\n    this.click = this.click.bind(this)\r\n    e.appendChild(document.createElement('thead'))\r\n    e.appendChild(document.createElement('tbody'))\r\n    this.style = document.head.appendChild(document.createElement('style'))\r\n    e.addEventListener('mouseover', this.mouseover)\r\n    e.addEventListener('mouseout', this.mouseout)\r\n    Object.keys(this.spec).forEach(k => {\r\n      const opt = this.spec[k]\r\n      if ('string' === typeof opt && opt in site.inputs) this.reference_options[k] = opt\r\n    })\r\n    if ('string' === typeof this.spec.variables) this.spec.variable_source = this.spec.variables\r\n    if (this.tab) {\r\n      document.getElementById(e.parentElement.getAttribute('aria-labelledby')).addEventListener(\r\n        'click',\r\n        function (this: OutputDataTable) {\r\n          if (!this.e.parentElement.classList.contains('active')) {\r\n            setTimeout(this.update, 155)\r\n            setTimeout(this.site.page.trigger_resize, 155)\r\n          }\r\n        }.bind(this)\r\n      )\r\n    }\r\n  }\r\n  init() {\r\n    this.parsed.dataset = this.site.dataviews[this.view].get.dataset()\r\n    if (this.spec.variables) {\r\n      if ('string' === typeof this.spec.variables) {\r\n        if (this.spec.variables in this.site.inputs) {\r\n          this.site.add_dependency(this.spec.variables, {type: 'update', id: this.id})\r\n          this.spec.variables = this.site.valueOf(this.spec.variables) as string | string[]\r\n          this.spec.single_variable = 'string' === typeof this.spec.variables\r\n        } else if (!this.spec.single_variable) {\r\n          this.spec.variables = [{name: this.spec.variables}]\r\n        }\r\n      }\r\n    } else this.spec.variables = Object.keys(this.site.data.variables)\r\n    if (Array.isArray(this.spec.variables)) {\r\n      const vars = this.spec.variables as string[]\r\n      if (vars.length && 'string' === typeof vars[0]) {\r\n        this.variables = vars.map((v: string): TableVariableSpec => {\r\n          return {\r\n            name: v,\r\n          }\r\n        })\r\n      }\r\n    } else if ('string' === typeof this.spec.variables) {\r\n      this.variables = {name: this.spec.variables}\r\n    }\r\n    const time = this.site.data.meta.times[this.parsed.dataset]\r\n    if (this.spec.single_variable) {\r\n      const c = this.variables as TableVariableSpec\r\n      this.header.push({title: 'Name', data: 'entity.features.name'})\r\n      if (time && time.is_single) this.variable_header = true\r\n      const t = c.name in this.site.data.variables && this.site.data.variables[c.name].time_range[this.parsed.dataset]\r\n      if (t)\r\n        for (let n = t[1] - t[0] + 1; n--; ) {\r\n          this.header[n + 1] = {\r\n            title: this.variable_header ? c.title || this.site.data.format_label(c.name) : time.value[n + t[0]] + '',\r\n            data: this.site.data.get_value,\r\n            render: DataHandler.retrievers.row_time.bind({\r\n              i: n,\r\n              o: t[0],\r\n              format_value: this.site.data.format_value.bind(this.site.data),\r\n            }),\r\n          }\r\n        }\r\n      this.spec.order = [[this.header.length - 1, 'dsc']]\r\n    } else if (this.spec.wide) {\r\n      if (this.spec.features) {\r\n        if ('string' === typeof this.spec.features) this.spec.features = [{name: this.spec.features}]\r\n        this.spec.features.forEach(f => {\r\n          this.header.push({\r\n            title: f.title || f.name,\r\n            data: 'entity.features.' + f.name.replace(this.site.patterns.all_periods, '\\\\.'),\r\n          })\r\n        })\r\n      }\r\n      const vars = this.variables as TableVariableSpec[]\r\n      for (let i = vars.length; i--; ) {\r\n        const c = vars[i]\r\n        if (!c.source) c.source = c.name in this.site.data.variables ? 'data' : 'features'\r\n        this.header.push(\r\n          'features' === c.source\r\n            ? {\r\n                title: c.title || this.site.data.format_label(c.name),\r\n                data: 'entity.features.' + c.name.toLowerCase().replace(this.site.patterns.all_periods, '\\\\.'),\r\n              }\r\n            : {\r\n                title: c.title || this.site.data.format_label(c.name),\r\n                render: async function (\r\n                  this: {o: OutputDataTable; c: TableVariableSpec},\r\n                  d: number[],\r\n                  type: string,\r\n                  row: TableRowRef\r\n                ) {\r\n                  if ('data' === this.c.source) {\r\n                    if (this.c.name in this.o.site.data.variables) {\r\n                      const v = await this.o.site.data.get_variable(this.c.name, this.o.site.dataviews[this.o.view])\r\n                      const i = row.time - v.time_range[this.o.parsed.dataset][0]\r\n                      return i < 0 ? NaN : row.entity.get_value(this.c.name, i)\r\n                    } else return NaN\r\n                  } else\r\n                    return this.c.source in row.entity && this.c.name in row.entity[this.c.source]\r\n                      ? row.entity[this.c.source][this.c.name]\r\n                      : NaN\r\n                }.bind({o: this, c}),\r\n              }\r\n        )\r\n      }\r\n    } else {\r\n      if (!time.is_single) {\r\n        this.header.push({\r\n          title: 'Year',\r\n          data: 'entity.time.value',\r\n          render: function (d: number[], type: string, row: TableRowRef) {\r\n            const t = row.time + row.offset\r\n            return d && t >= 0 && t < d.length ? d[t] : NaN\r\n          },\r\n        })\r\n      }\r\n      if (this.spec.features) {\r\n        if ('string' === typeof this.spec.features) this.spec.features = [{name: this.spec.features}]\r\n        this.spec.features.forEach(f => {\r\n          this.header.splice(0, 0, {\r\n            title: f.title || f.name,\r\n            data: 'entity.features.' + f.name.replace(this.site.patterns.all_periods, '\\\\.'),\r\n          })\r\n        })\r\n      }\r\n      this.header.push({\r\n        title: 'Variable',\r\n        data: function (row: TableRowRef) {\r\n          return row.variable in row.entity.variables\r\n            ? row.entity.variables[row.variable].meta.short_name\r\n            : row.variable\r\n        },\r\n      })\r\n      this.header.push({\r\n        title: 'Value',\r\n        data: this.site.data.get_value,\r\n        render: (d: (string | number)[], type: string, row: TableRowRef) => {\r\n          return d\r\n            ? 'number' === typeof d[row.time]\r\n              ? this.site.data.format_value(d[row.time] as number, row.int)\r\n              : d[row.time]\r\n            : ''\r\n        },\r\n      })\r\n    }\r\n    if (this.view) {\r\n      this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n      this.site.add_dependency(this.view + '_filter', {type: 'update', id: this.id})\r\n      this.site.add_dependency(this.site.dataviews[this.view].time_agg as string, {type: 'update', id: this.id})\r\n    } else this.view = this.site.defaults.dataview\r\n    const click_ref = this.e.dataset.click\r\n    if (click_ref in this.site.inputs) {\r\n      this.clickto = this.site.inputs[click_ref]\r\n      this.e.addEventListener('click', this.click)\r\n    }\r\n    this.queue_init()\r\n  }\r\n  show(e: Entity) {\r\n    if (e.features && e.features.id in this.rows) {\r\n      if (this.site.spec.settings.table_autoscroll) {\r\n        this.rows[e.features.id].scrollTo('smooth' === this.site.spec.settings.table_scroll_behavior)\r\n      }\r\n      if ((this.pending as number) > 0) clearTimeout(this.pending)\r\n      this.pending = -1\r\n      const row = this.rows[e.features.id].node()\r\n      if (row) {\r\n        row.classList.add('highlighted')\r\n      } else {\r\n        this.pending = setTimeout(\r\n          function (this: DataTableRow) {\r\n            const row = this.node()\r\n            if (row) row.classList.add('highlighted')\r\n          }.bind(this.rows[e.features.id]),\r\n          0\r\n        )\r\n      }\r\n    }\r\n  }\r\n  revert() {\r\n    if ((this.pending as number) > 0) clearTimeout(this.pending)\r\n    this.e.querySelectorAll('tr.highlighted').forEach(e => e.classList.remove('highlighted'))\r\n  }\r\n  queue_init() {\r\n    const showing = this.deferred || !this.tab || this.tab.classList.contains('show')\r\n    if (showing && 'jQuery' in window && 'DataTable' in window && 'get' in this.site.dataviews[this.view]) {\r\n      this.spec.columns = this.header\r\n      this.table = $(this.e).DataTable(this.spec)\r\n      this.update()\r\n    } else {\r\n      this.deferred = true\r\n      setTimeout(this.queue_init, showing ? 0 : 2000)\r\n    }\r\n  }\r\n  async update(pass?: boolean) {\r\n    if ((this.queue as number) > 0) clearTimeout(this.queue)\r\n    this.queue = -1\r\n    if (!pass) {\r\n      if (!this.tab || this.tab.classList.contains('show')) this.queue = setTimeout(() => this.update(true), 50)\r\n    } else {\r\n      if (this.table) {\r\n        let vn =\r\n          this.spec.variable_source &&\r\n          (this.site.valueOf(this.spec.variable_source) as string).replace(this.site.patterns.all_periods, '\\\\.')\r\n        const v = this.site.dataviews[this.view],\r\n          d = v.get.dataset()\r\n        if (!this.site.data.inited[d]) return\r\n        const settings = this.site.spec.settings,\r\n          times = this.site.data.meta.times[d],\r\n          state =\r\n            d +\r\n            v.value() +\r\n            v.get.time_filters() +\r\n            settings.digits +\r\n            vn +\r\n            settings.theme_dark +\r\n            settings.show_empty_times,\r\n          update = state !== this.state,\r\n          time = this.site.valueOf(v.time_agg),\r\n          variable = await this.site.data.get_variable(vn, v)\r\n        this.parsed.time_range = variable ? variable.time_range[d] : times.info.time_range[d]\r\n        this.parsed.time = ('number' === typeof time ? time - times.range[0] : 0) - this.parsed.time_range[0]\r\n        if (update) {\r\n          this.rows = {}\r\n          this.rowIds = {}\r\n          this.table.clear()\r\n          let redraw = true\r\n          if (v.valid[d]) {\r\n            this.state = state\r\n            Object.keys(this.reference_options).forEach(\r\n              k => (this.spec[k] = this.site.valueOf(this.reference_options[k]) as string)\r\n            )\r\n            if (!Array.isArray(this.variables)) {\r\n              this.parsed.time_index = {}\r\n              this.parsed.dataset = d\r\n              this.parsed.color = vn\r\n              this.parsed.summary = this.view in variable.views ? variable.views[this.view].summaries[d] : undefined\r\n              this.parsed.order =\r\n                this.view in variable.views ? variable.views[this.view].order[d][this.parsed.time] : undefined\r\n              if (this.header.length < 2 || d !== this.header[1].dataset || vn !== this.header[1].variable) {\r\n                this.table.destroy()\r\n                $(this.e).empty()\r\n                this.header = [{title: 'Name', data: 'entity.features.name', type: 'string'}]\r\n                if (-1 !== this.parsed.time_range[0]) {\r\n                  for (let n = this.parsed.time_range[2]; n--; ) {\r\n                    this.header[n + 1] = {\r\n                      dataset: d,\r\n                      variable: vn,\r\n                      type: 'string' === variable.type ? 'string' : 'num',\r\n                      title: this.variable_header\r\n                        ? this.variables.title || this.site.data.format_label(vn)\r\n                        : times.value[n + this.parsed.time_range[0]] + '',\r\n                      data: this.site.data.get_value,\r\n                      render: DataHandler.retrievers.row_time.bind({\r\n                        i: n,\r\n                        o: this.parsed.time_range[0],\r\n                        format_value: this.site.data.format_value.bind(this.site.data),\r\n                      }),\r\n                    }\r\n                  }\r\n                } else this.state = ''\r\n                this.spec.order[0][0] = this.header.length - 1\r\n                this.spec.columns = this.header\r\n                this.table = $(this.e).DataTable(this.spec)\r\n              }\r\n              const n = this.header.length,\r\n                ns = this.parsed.summary.n\r\n              let reset\r\n              for (let i = 1, show = false, nshowing = 0; i < n; i++) {\r\n                show =\r\n                  v.times[i - 1 + this.parsed.time_range[0]] && ((settings.show_empty_times as boolean) || !!ns[i - 1])\r\n                this.table.column(i).visible(show, false)\r\n                if (show) {\r\n                  this.parsed.time_index[times.value[i - 1 + this.parsed.time_range[0]]] = ++nshowing\r\n                  reset = false\r\n                }\r\n              }\r\n              if (reset) this.state = ''\r\n            }\r\n            if (this.spec.wide) {\r\n              Object.keys(v.selection.all).forEach(k => {\r\n                if (vn) {\r\n                  if (vn in v.selection.all[k].views[this.view].summary) {\r\n                    this.rows[k] = this.table.row.add({\r\n                      dataset: d,\r\n                      variable: vn,\r\n                      offset: this.parsed.time_range[0],\r\n                      entity: v.selection.all[k],\r\n                      int:\r\n                        d in this.site.data.variables[vn].info &&\r\n                        'integer' === this.site.data.variables[vn].info[d].type,\r\n                    }) as unknown as DataTableRow\r\n                    this.rowIds[this.rows[k].selector.rows] = k\r\n                  }\r\n                } else {\r\n                  for (let i = times.n; i--; ) {\r\n                    this.rows[k] = this.table.row.add({\r\n                      time: i,\r\n                      entity: v.selection.all[k],\r\n                    }) as unknown as DataTableRow\r\n                    this.rowIds[this.rows[k].selector.rows] = k\r\n                  }\r\n                }\r\n              })\r\n            } else if (Array.isArray(this.variables)) {\r\n              if (this.spec.filters)\r\n                Object.keys(this.spec.filters).forEach(f => {\r\n                  this.current_filter[f] = this.site.valueOf(f) as string\r\n                })\r\n              const va: TableRowGen[] = []\r\n              let varstate = '' + this.parsed.dataset + v.get.single_id() + v.get.features() + settings.digits\r\n              for (let i = this.variables.length; i--; ) {\r\n                vn = this.variables[i].name\r\n                pass = !this.spec.filters\r\n                const variable = await this.site.data.get_variable(vn, v)\r\n                if (vn in this.site.data.variables && 'meta' in variable) {\r\n                  if (this.spec.filters) {\r\n                    for (const c in this.current_filter)\r\n                      if (c in variable.meta) {\r\n                        pass = variable.meta[c as keyof typeof variable.meta] === this.current_filter[c]\r\n                        if (!pass) break\r\n                      }\r\n                  } else pass = true\r\n                }\r\n                if (pass) {\r\n                  varstate += vn\r\n                  va.push({\r\n                    variable: vn,\r\n                    int: this.site.patterns.int_types.test(this.site.data.variables[vn].type),\r\n                    time_range: variable.time_range[d],\r\n                    renderer: function (o, e) {\r\n                      const k = e.features.id,\r\n                        r = this.time_range,\r\n                        n = r[1]\r\n                      for (let i = r[0]; i <= n; i++) {\r\n                        o.rows[k] = o.table.row.add({\r\n                          offset: this.time_range[0],\r\n                          time: i - this.time_range[0],\r\n                          dataset: d,\r\n                          variable: this.variable,\r\n                          entity: e,\r\n                          int: this.int,\r\n                        }) as unknown as DataTableRow\r\n                        o.rowIds[o.rows[k].selector.rows] = k\r\n                      }\r\n                    },\r\n                  })\r\n                }\r\n              }\r\n              if (varstate === this.varstate) return\r\n              this.varstate = varstate\r\n              Object.keys(v.selection.all).forEach(k => {\r\n                const e = v.selection.all[k]\r\n                if (this.spec.single_variable) {\r\n                  if (vn in e.views[this.view].summary && variable.code in e.data) {\r\n                    this.rows[k] = this.table.row.add({\r\n                      offset: this.parsed.time_range[0],\r\n                      dataset: d,\r\n                      variable: vn,\r\n                      entity: e,\r\n                      int: this.site.patterns.int_types.test(this.site.data.variables[vn].type),\r\n                    }) as unknown as DataTableRow\r\n                    this.rowIds[this.rows[k].selector.rows] = k\r\n                  }\r\n                } else {\r\n                  va.forEach(v => {\r\n                    if (this.site.data.variables[v.variable].code in e.data) v.renderer(this, e)\r\n                  })\r\n                }\r\n              })\r\n            }\r\n          }\r\n          redraw ? this.table.draw() : this.table.columns.adjust().draw(false)\r\n        }\r\n        if (this.parsed.time > -1 && this.header.length > 1 && v.time_range.filtered_index) {\r\n          if (this.style.sheet.cssRules.length) this.style.sheet.deleteRule(0)\r\n          if (this.parsed.time_index[time as number])\r\n            this.style.sheet.insertRule(\r\n              '#' +\r\n                this.id +\r\n                ' td:nth-child(' +\r\n                (this.parsed.time_index[time as number] + 1) +\r\n                '){background-color: var(--background-highlight)}',\r\n              0\r\n            )\r\n          if (!update && this.site.spec.settings.table_autosort) {\r\n            this.table.order([this.parsed.time + 1, 'dsc']).draw()\r\n          }\r\n          if (this.site.spec.settings.table_autoscroll) {\r\n            const w = this.e.parentElement.getBoundingClientRect().width,\r\n              col = this.table.column(this.parsed.time + 1),\r\n              h = col.header().getBoundingClientRect()\r\n            if (h)\r\n              this.e.parentElement.scroll({\r\n                left: h.x - this.e.getBoundingClientRect().x + h.width + 16 - w,\r\n                behavior: (this.site.spec.settings.table_scroll_behavior as ScrollBehavior) || 'smooth',\r\n              })\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  mouseover(e: DataTablesMouseEvent) {\r\n    if (e.target._DT_CellIndex && e.target._DT_CellIndex.row in this.rowIds) {\r\n      const id = this.rowIds[e.target._DT_CellIndex.row],\r\n        row = this.rows[id].node()\r\n      if (row) row.classList.add('highlighted')\r\n      if (id in this.site.data.entities) {\r\n        this.site.subs.update(this.id, 'show', this.site.data.entities[id])\r\n      }\r\n    }\r\n  }\r\n  mouseout(e: DataTablesMouseEvent) {\r\n    if (e.target._DT_CellIndex && e.target._DT_CellIndex.row in this.rowIds) {\r\n      const id = this.rowIds[e.target._DT_CellIndex.row],\r\n        row = this.rows[id].node()\r\n      if (row) row.classList.remove('highlighted')\r\n      if (id in this.site.data.entities) {\r\n        this.site.subs.update(this.id, 'revert', this.site.data.entities[id])\r\n      }\r\n    }\r\n  }\r\n  click(e: DataTablesMouseEvent) {\r\n    if (this.clickto && e.target._DT_CellIndex && e.target._DT_CellIndex.row in this.rowIds) {\r\n      const id = this.rowIds[e.target._DT_CellIndex.row]\r\n      if (id in this.site.data.entities) this.clickto.set(id)\r\n    }\r\n  }\r\n}\r\n","import type {Entity, ObjectIndex, Order, Summary, Variable} from '../../types'\r\nimport type {SiteDataView} from '../dataview'\r\nimport type Community from '../index'\r\nimport type {SiteInputs} from '../inputs/index'\r\nimport type {DataTableSpec} from './datatables'\r\nimport {BaseOutput} from './index'\r\n\r\nexport class OutputTable extends BaseOutput {\r\n  type: 'table' = 'table'\r\n  clickto?: SiteInputs\r\n  spec: DataTableSpec\r\n  parsed: {\r\n    summary?: Summary\r\n    order?: Order\r\n    time?: number\r\n    color?: string\r\n    dataset?: string\r\n    time_index?: ObjectIndex\r\n    time_range?: number[]\r\n    variable?: Variable\r\n  } = {}\r\n  time: string\r\n  queue: number | NodeJS.Timeout = -1\r\n  state: string = ''\r\n  reference_options: {[index: string]: string} = {}\r\n  header: {\r\n    title: string\r\n    data?: string | Function\r\n    type?: string\r\n    render?: Function\r\n    dataset?: string\r\n    variable?: string\r\n  }[] = []\r\n  rows: {[index: string]: HTMLTableRowElement} = {}\r\n  parts = {\r\n    head: document.createElement('thead'),\r\n    body: document.createElement('tbody'),\r\n  }\r\n  current_variable = ''\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.mouseover = this.mouseover.bind(this)\r\n    this.mouseout = this.mouseout.bind(this)\r\n    this.click = this.click.bind(this)\r\n    this.parts.head.appendChild(document.createElement('tr'))\r\n    e.appendChild(this.parts.head)\r\n    e.appendChild(this.parts.body)\r\n    Object.keys(this.spec).forEach(k => {\r\n      const opt = this.spec[k]\r\n      if ('string' === typeof opt && opt in site.inputs) this.reference_options[k] = opt\r\n    })\r\n    if ('string' === typeof this.spec.variables) this.spec.variable_source = this.spec.variables\r\n    e.addEventListener('mouseover', this.mouseover)\r\n    e.addEventListener('mouseout', this.mouseout)\r\n    if (this.tab) {\r\n      document.getElementById(e.parentElement.getAttribute('aria-labelledby')).addEventListener(\r\n        'click',\r\n        function (this: OutputTable) {\r\n          if (!e.parentElement.classList.contains('active')) {\r\n            setTimeout(this.update, 155)\r\n            setTimeout(this.site.page.trigger_resize, 155)\r\n          }\r\n        }.bind(this)\r\n      )\r\n    }\r\n  }\r\n  init() {\r\n    if (this.spec.variable_source in this.site.inputs)\r\n      this.site.add_dependency(this.spec.variable_source, {type: 'update', id: this.id})\r\n    if (this.view) {\r\n      this.site.add_dependency(this.view, {type: 'update', id: this.id})\r\n      this.site.add_dependency(this.view + '_filter', {type: 'update', id: this.id})\r\n      this.site.add_dependency(this.site.dataviews[this.view].time_agg as string, {type: 'update', id: this.id})\r\n    } else this.view = this.site.defaults.dataview\r\n    const click_ref = this.e.dataset.click\r\n    if (click_ref in this.site.inputs) {\r\n      if (this.e.dataset.click) this.e.classList.add('interactive')\r\n      this.clickto = this.site.inputs[click_ref]\r\n      this.e.addEventListener('click', this.click)\r\n    }\r\n    this.update()\r\n  }\r\n  show(e: Entity) {\r\n    if (e.features) {\r\n      const row = this.rows[e.features.id]\r\n      if (row && row.parentElement) {\r\n        row.classList.add('highlighted')\r\n        if (this.site.spec.settings.table_autoscroll) {\r\n          const h = this.e.parentElement.getBoundingClientRect().height,\r\n            top = row.getBoundingClientRect().y - row.parentElement.getBoundingClientRect().y\r\n          this.e.parentElement.scroll({\r\n            top: h > this.e.scrollHeight - top ? this.e.parentElement.scrollHeight : top,\r\n            behavior: (this.site.spec.settings.table_scroll_behavior as ScrollBehavior) || 'smooth',\r\n          })\r\n        }\r\n      }\r\n    }\r\n  }\r\n  revert(e: Entity) {\r\n    if (e.features && e.features.id in this.rows) {\r\n      this.rows[e.features.id].classList.remove('highlighted')\r\n    }\r\n  }\r\n  createHeader(v: SiteDataView) {\r\n    const dataset = this.parsed.dataset,\r\n      time = this.site.data.meta.times[dataset],\r\n      tr = this.parts.head.firstElementChild,\r\n      range = this.parsed.variable.time_range[dataset],\r\n      start = range[0],\r\n      end = range[1] + 1,\r\n      ns = this.parsed.summary.n\r\n    let th = document.createElement('th'),\r\n      span = document.createElement('span')\r\n    this.parsed.time_index = {}\r\n    tr.innerHTML = ''\r\n    tr.appendChild(th)\r\n    th.appendChild(span)\r\n    span.innerText = 'Name'\r\n    for (let i = start, nshowing = 0; i < end; i++) {\r\n      if (v.times[i] && (this.site.spec.settings.show_empty_times || ns[i - start])) {\r\n        this.parsed.time_index[time.value[i]] = nshowing++\r\n        tr.appendChild((th = document.createElement('th')))\r\n        th.appendChild((span = document.createElement('span')))\r\n        span.innerText = time.value[i] + ''\r\n      }\r\n    }\r\n  }\r\n  appendRows(v: SiteDataView) {\r\n    const es = this.parsed.order,\r\n      variable = this.parsed.variable,\r\n      times = this.site.data.meta.times[this.parsed.dataset].value,\r\n      range = variable.time_range[this.parsed.dataset],\r\n      start = range[0],\r\n      dn = range[1] - start + 1,\r\n      selection = v.selection.all\r\n    this.current_variable = variable.code + this.parsed.dataset\r\n    this.parts.body.innerHTML = ''\r\n    for (let n = es.length; n--; ) {\r\n      const id = es[n][0]\r\n      if (id in selection) {\r\n        const e = this.site.data.entities[id],\r\n          d = e.data[variable.code],\r\n          tr = document.createElement('tr')\r\n        this.rows[id] = tr\r\n        tr.dataset.entityId = id\r\n        let td = document.createElement('td')\r\n        td.innerText = e.features.name\r\n        tr.appendChild(td)\r\n        if (Array.isArray(d)) {\r\n          for (let i = 0; i < dn; i++) {\r\n            if (v.times[i + start] && times[i + start] in this.parsed.time_index) {\r\n              tr.appendChild((td = document.createElement('td')))\r\n              td.innerText = this.site.data.format_value(d[i]) as string\r\n              if (i === this.parsed.time) td.classList.add('highlighted')\r\n            }\r\n          }\r\n        } else {\r\n          tr.appendChild((td = document.createElement('td')))\r\n          td.innerText = this.site.data.format_value(d) as string\r\n          td.dataset.entityId = id\r\n          td.classList.add('highlighted')\r\n        }\r\n        this.parts.body.appendChild(tr)\r\n      }\r\n    }\r\n    if (\r\n      this.site.spec.settings.table_autoscroll &&\r\n      this.parts.head.firstElementChild.childElementCount > 2 &&\r\n      this.parts.head.firstElementChild.childElementCount > this.parsed.time + 1\r\n    ) {\r\n      const w = this.e.parentElement.getBoundingClientRect().width,\r\n        col = this.parts.head.firstElementChild.children[this.parsed.time + 1].getBoundingClientRect()\r\n      this.e.parentElement.scroll({\r\n        left: col.x - this.e.getBoundingClientRect().x + col.width + 16 - w,\r\n        behavior: (this.site.spec.settings.table_scroll_behavior as ScrollBehavior) || 'smooth',\r\n      })\r\n    }\r\n  }\r\n  async update(pass?: boolean) {\r\n    if ((this.queue as number) > 0) clearTimeout(this.queue)\r\n    this.queue = -1\r\n    if (!pass) {\r\n      if (!this.tab || this.tab.classList.contains('show')) this.queue = setTimeout(() => this.update(true), 50)\r\n    } else {\r\n      let vn =\r\n        this.spec.variable_source &&\r\n        (this.site.valueOf(this.spec.variable_source) as string).replace(this.site.patterns.all_periods, '\\\\.')\r\n      const v = this.site.dataviews[this.view],\r\n        d = v.get.dataset(),\r\n        time = this.site.valueOf(v.time_agg),\r\n        state =\r\n          d +\r\n          v.value() +\r\n          v.get.time_filters() +\r\n          this.site.spec.settings.digits +\r\n          vn +\r\n          time +\r\n          this.site.spec.settings.show_empty_times\r\n      if (!this.site.data.inited[d]) return\r\n      if (state !== this.state) {\r\n        this.state = state\r\n        Object.keys(this.reference_options).forEach(\r\n          k => (this.spec[k] = this.site.valueOf(this.reference_options[k]) as string)\r\n        )\r\n        const variable = await this.site.data.get_variable(vn, v)\r\n        this.parsed.dataset = d\r\n        this.parsed.color = vn\r\n        this.parsed.variable = variable\r\n        this.parsed.time_range = variable.time_range[d]\r\n        this.parsed.time =\r\n          ('number' === typeof time ? time - this.site.data.meta.times[d].range[0] : 0) - this.parsed.time_range[0]\r\n        this.parsed.summary = variable.views[this.view].summaries[d]\r\n        this.parsed.order = variable.views[this.view].order[d][this.parsed.time]\r\n        this.createHeader(v)\r\n        this.appendRows(v)\r\n      }\r\n    }\r\n  }\r\n  mouseover(e: MouseEvent) {\r\n    const target = e.target as HTMLElement,\r\n      row = 'TD' === target.tagName ? target.parentElement : target,\r\n      id = row.dataset.entityId\r\n    if (id) {\r\n      row.classList.add('highlighted')\r\n      this.site.subs.update(this.id, 'show', this.site.data.entities[id])\r\n    }\r\n  }\r\n  mouseout(e: MouseEvent) {\r\n    const target = e.target as HTMLElement,\r\n      row = 'TD' === target.tagName ? target.parentElement : target,\r\n      id = row.dataset.entityId\r\n    if (id) {\r\n      row.classList.remove('highlighted')\r\n      this.site.subs.update(this.id, 'revert', this.site.data.entities[id])\r\n    }\r\n  }\r\n  click(e: MouseEvent) {\r\n    const target = e.target as HTMLElement,\r\n      row = 'TD' === target.tagName ? target.parentElement : target,\r\n      id = row.dataset.entityId\r\n    if (this.clickto && id) this.clickto.set(id)\r\n  }\r\n}\r\n","import DataHandler from '../../data_handler/index'\r\nimport type {SiteCondition} from '../../types'\r\nimport type Community from '../index'\r\nimport {tooltip_trigger} from '../utils'\r\nimport {BaseOutput} from './index'\r\n\r\ntype Text = {\r\n  text: string[]\r\n  parts: HTMLElement\r\n  button?: {[index: string]: {text: string[]; type: string; target: string | string[]; trigger: () => void}}\r\n  condition?: SiteCondition[]\r\n}\r\ntype TextSpec = {\r\n  text: Text[]\r\n  condition?: SiteCondition[]\r\n}\r\n\r\nexport class OutputText extends BaseOutput {\r\n  type: 'text' = 'text'\r\n  spec: TextSpec\r\n  text: Text[] | Text[][]\r\n  condition: SiteCondition[]\r\n  depends: Map<string, {id: string; parsed?: string}> = new Map()\r\n  constructor(e: HTMLElement, site: Community) {\r\n    super(e, site)\r\n    this.update = this.update.bind(this)\r\n    this.prep = this.prep.bind(this)\r\n    this.text = this.spec.text\r\n    this.condition = this.spec.condition || []\r\n  }\r\n  init() {\r\n    this.text.forEach(oi => {\r\n      if (Array.isArray(oi)) {\r\n        this.e.appendChild(document.createElement('span'))\r\n        oi.forEach(this.prep)\r\n      } else {\r\n        this.prep(oi)\r\n        this.e.appendChild(oi.parts)\r\n      }\r\n    })\r\n    this.condition.forEach(c => {\r\n      if (c.id in this.site.inputs) this.site.add_dependency(c.id, {type: 'display', id: this.id})\r\n    })\r\n    this.depends.forEach(d => this.site.add_dependency(d.id, {type: 'update', id: this.id}))\r\n    this.update()\r\n  }\r\n  update() {\r\n    this.depends.forEach(d => {\r\n      d.parsed = this.site.valueOf(d.id) as string\r\n      const u = this.site.inputs[d.id]\r\n      if (u) {\r\n        if ('values' in u && 'options' in u && !Array.isArray(u.values) && d.parsed in u.values) {\r\n          d.parsed = u.options[u.values[d.parsed]].innerText\r\n        } else {\r\n          d.parsed =\r\n            'display' in u && d.parsed in u.display\r\n              ? (u.display[d.parsed] as string)\r\n              : this.site.data.format_label(d.parsed)\r\n        }\r\n      }\r\n    })\r\n    this.text.forEach((o, i) => {\r\n      let pass = true,\r\n        s: Text\r\n      if (Array.isArray(o)) {\r\n        for (let t = o.length; t--; ) {\r\n          if ('condition' in o[t]) {\r\n            for (let c = o[t].condition.length; c--; ) {\r\n              pass = o[t].condition[c].check()\r\n              if (!pass) break\r\n            }\r\n          }\r\n          if (pass) {\r\n            s = o[t]\r\n            break\r\n          }\r\n        }\r\n      } else {\r\n        if ('condition' in o) {\r\n          for (let t = o.condition.length; t--; ) {\r\n            pass = o.condition[t].check()\r\n            if (!pass) break\r\n          }\r\n        }\r\n        if (pass) s = o\r\n      }\r\n      if (pass) {\r\n        s.text.forEach((k, i) => {\r\n          if (Array.isArray(k)) {\r\n            k.forEach(ki => {\r\n              if (\r\n                'default' === ki.id ||\r\n                DataHandler.checks[ki.type](this.site.valueOf(ki.id), this.site.valueOf(ki.value))\r\n              )\r\n                k = ki.text\r\n            })\r\n          }\r\n          if (this.depends.has(k)) {\r\n            ;(s.parts.children[i] as HTMLElement).innerText = this.depends.get(k).parsed\r\n          } else if (k in s.button) {\r\n            let text = ''\r\n            s.button[k].text.forEach(b => {\r\n              text = (this.depends.has(b) ? this.depends.get(b).parsed : b) + text\r\n            })\r\n            ;(s.parts.children[i] as HTMLElement).innerText = text\r\n          } else (s.parts.children[i] as HTMLElement).innerText = k\r\n        })\r\n        if (Array.isArray(this.text[i])) {\r\n          this.e.children[i].innerHTML = ''\r\n          this.e.children[i].appendChild(s.parts)\r\n        } else s.parts.classList.remove('hidden')\r\n      } else {\r\n        if (Array.isArray(o)) {\r\n          o.forEach(p => p.parts.classList.add('hidden'))\r\n        } else {\r\n          o.parts.classList.add('hidden')\r\n        }\r\n      }\r\n    })\r\n  }\r\n  prep(text: Text) {\r\n    if (!('button' in text)) text.button = {}\r\n    if ('string' === typeof text.text) text.text = [text.text]\r\n    text.parts = document.createElement('span')\r\n    text.text.forEach(k => {\r\n      if (k in text.button) {\r\n        const p = text.button[k],\r\n          button = document.createElement('button')\r\n        text.parts.appendChild(button)\r\n        button.type = 'button'\r\n        p.trigger = tooltip_trigger.bind({id: this.id + p.text, note: p.target, wrapper: button})\r\n        if ('note' === p.type) {\r\n          button.setAttribute('aria-description', p.target as string)\r\n          button.dataset.of = this.id + p.text\r\n          button.className = 'has-note'\r\n          button.addEventListener('mouseover', p.trigger)\r\n          button.addEventListener('focus', p.trigger)\r\n          button.addEventListener('blur', this.site.page.tooltip_clear)\r\n        } else {\r\n          button.className = 'btn btn-link'\r\n          if (!Array.isArray(p.target)) p.target = [p.target]\r\n          const m = new Map()\r\n          p.target.forEach(t => {\r\n            const u = this.site.inputs[t],\r\n              k = p.type as keyof typeof u\r\n            if (u && 'function' === typeof u[k]) m.set(t, u[k])\r\n          })\r\n          if (m.size) {\r\n            button.setAttribute('aria-label', p.text.join(''))\r\n            button.addEventListener(\r\n              'click',\r\n              function (this: Map<string, () => void>) {\r\n                this.forEach(f => f())\r\n              }.bind(m)\r\n            )\r\n          }\r\n        }\r\n      } else {\r\n        text.parts.appendChild(document.createElement('span'))\r\n      }\r\n      if (k in this.site.inputs) this.depends.set(k, {id: k, parsed: ''})\r\n    })\r\n    if ('condition' in text) {\r\n      for (let i = text.condition.length; i--; ) {\r\n        const c = text.condition[i]\r\n        if (c.id) {\r\n          if ('default' === c.id) {\r\n            c.check = function () {\r\n              return true\r\n            }\r\n          } else {\r\n            this.depends.set(c.id, c)\r\n            c.site = this.site\r\n            c.check = function (this: SiteCondition) {\r\n              return (\r\n                'default' === this.id ||\r\n                DataHandler.checks[this.type](this.site.valueOf(this.id), this.site.valueOf(this.value))\r\n              )\r\n            }.bind(c)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","adopt","then","apply","SuppressedError","defaults","file_format","table_format","features","ID","Name","feature_conditions","variables","filter_by","conditions","options","filter_components","group_checks","v","this","includes","indexOf","excludes","export_checks","a","include","vars","i","length","vector_summary","vec","range","Array","isArray","n","Math","min","r","missing","first","Infinity","mean","sum","max","last","on","isNaN","Number","patterns","seps","comma","word_start","single_operator","greater","less","operator_start","component","number","non_letter_num","entity","time_range","feats","sep","group","meta","times","op","time","tr","Object","keys","forEach","f","yn","y","k","vc","code","data","trange","NaN","push","join","ranges","exporter","query_string","entities","in_browser","all_data","data_ready","query","parse_query","params.options","params.defaults","row_writers","res","statusCode","headers","body","inc","split","exc","exclude","JSON","parse","stringify","rows","rw","bind","no_filter","no_feature_filter","in_group","dataset","operator","malformed","ii","format_label","variable_codes","name","vi","overall","map","first_entity","id","filter","pass","ck","substring","passes_feature_filter","s","adjs","c","info","co","time_component","check","passes_filter","filename","short_name","toLowerCase","replace","document","createElement","appendChild","rel","target","download","href","URL","createObjectURL","Blob","type","setTimeout","dispatchEvent","MouseEvent","revokeObjectURL","removeChild","t","is_time","d","row","offset","o","format_value","int","settings","digits","toFixed","label","l","w","toUpperCase","sets","loaded","site_file","schema","fields","ids","_meta","is_single","sort","datasets","views","full_name","measure","long_name","variable_info","load_id_maps","id_maps","metadata","has_map","data_maps","retrieved","resource","entity_features","map_entities","queue","map_content","entity_info","ingest_map","window","require","get","req","protocol","host","path","end","XMLHttpRequest","onreadystatechange","url","fi","readyState","status","Error","responseText","open","send","m","field","hooks","data_load","sort_a1","b","init","inited_summary","view_names","view","order","selected_order","selected_summaries","summaries","state","table","ny","da","entity_count","at","Uint32Array","Uint16Array","Uint8Array","is_string","summary","rank","subset_rank","dak","ev","level_ids","freeze","eview","isFrozen","filled","q3","norm_median","break_median","lower_median_min","lower_median_range","upper_median_min","upper_median_range","norm_mean","break_mean","lower_mean_min","lower_mean_range","upper_mean_min","upper_mean_range","median","q1","mode","levels","seal","quantile","p","x","ap","bp","ceil","floor","calculate","full","data_processed","summaryId","init_summary","summary_ready","variable","valid","summary_set","summary_selection","selection","all","mo","mso","subset","n_selected","mss","ms","moy","msoy","oi","en","present","isFinite","bmd","bme","data_queue","id_vars","vn","ve","g","inited","retriever","DataHandler","retrievers","infos","si","overwrite","entity_tree","parents","children","relations","id_length","sl","get_value","data_promise","onload","prototype","hasOwnProperty","call","all_data_ready","ps","any","category","variant","desc","replace_dynamic","lastIndex","exec","ss","test","prepare_source","default","q","aq","aqi","tf","checks","undefined","adj","multi","condition","constructor","dataview","dynamic_load","references","load_requests","retrieve","ingest_data","formatter.value","formatter.label","ingester.data","ingester.map","ingester.id_maps","summary.init","calculate_summary","summary.calculate","map_variables","mapper.variables","mapper.entities","parser.query","export","get_variable","partial_init","dataviews","measure_info","base","bn","categories","variants","cats","cn","cs","vs","assign","temp","long_description","short_description","parser.measure_info","_references","package","dp","resources","equals","palette","background_highlight","border","border_highlight_true","border_highlight_false","GlobalView","site","registered","Map","selected","select_ids","filters","states","id_state","filter_state","parsed","agg","as_state","time_agg","active","id_filter","inputs","page","modal","entity_inputs","source","period","all_periods","properties","minmax","int_types","end_punct","mustache","measure_name","http","bool","leading_zeros","url_spaces","hashes","embed_setting","location_string","time_ref","pre_colon","exclude_query","space","has_html","bracket_content","html_tags","html_attributes","id_escapes","repo","basename","storage","location","pathname","perm","localStorage","copy","set","opt","getItem","setItem","Subscriptions","subs","add","update","fun","tu","outputs","u","keymap","Enter","NumpadEnter","ArrowUp","Home","ArrowDown","End","Escape","Tab","Time","toggle_input","enable","classList","contains","removeAttribute","remove","input_element","setAttribute","fill_ids_options","out","onend","loader","removeEventListener","set_current","current_set","values","display","current","disp","combobox","sensitive","groups","by_name","accordion","listbox","ugroup","ee","className","innerText","role","for","lastElementChild","querySelectorAll","fill_levels_options","lk","tooltip_trigger","spec","hide_tooltips","tooltip","showing","firstElementChild","note","wrapper","getBoundingClientRect","style","left","width","top","height","make_summary_table","formatter","parent","additional","h","th","td","lower","make_variable_source","div","span","date_accessed","location_url","cv","uv","parseFloat","valueOf","conditionals","reset","max_indicator","min_indicator","no_view","va","option_sets","optionSource","url_set","url_options","ck_suffix","firstChild","textContent","clearable","fill_variables_options","fresh","selection_subset","innerHTML","ns","selectedIndex","setting","theme","plotly","update_theme","tiles","removeFrom","addTo","history","replaceState","Date","now","hide_url_parameters","get_options_url","script_style","sheet","insertRule","deleteRule","mu","overlay","clearLayers","overlay_control","tag_id","gtag","analytics_storage","global_update","event_category","event_label","filtered","filtered_index","index","time_filters","dependencies","ci","passive","tv","su","retain_state","current_default","palettes","rdylbu7","colors","orrd7","gnbu7","brbg7","puor7","prgn6","reds5","greens5","paired4","greys4","grey","brown","purple","prgn","puor","rdbu","vik","lajolla","BaseInput","input","current_index","previous","optionsource","selectionsubset","depends","elementCount","getAttribute","autotype","parentElement","trigger","addEventListener","tagName","querySelector","tooltip_clear","options_filter","current_filter","set_current_options","to","deferred","request_queue","time_funs","component_fun","SiteDataView","id_source","variable_values","feature_values","full_filter","add_dependency","compile","reparse","size","passed","failed","single_id","ids_check","comp_fun","clear","value_type","InputCombobox","super","hover_index","cleared_selection","expanded","container","reformat_label","resize","toggle","highlight","filterer","close","set_selected","use_display","search","childElementCount","focus","et","action","strict","preventDefault","filter_index","clear_highlight","filter_reset","nextElementSibling","previousElementSibling","port","item","scrollTo","scrollTop","bottom","button","ou","screen","option","create","main","lab","floating","of","autocomplete","title","tabIndex","splice","onchange","noadd","description","TutorialManager","tutorials","elements","resetter","backdrop","menu","frame","header","dialog","timer","progress","continue","in_progress","waiting","current_step","current_time","site_elements","site_reset","start_tutorial","progress_tutorial","execute_step","end_tutorial","insertAdjacentElement","start","manager","n_steps","steps","before","setting_display","part","retrieve_element","current_site_element","text","error","event","click","console","isClick","clearTimeout","focuser","clearInterval","running_timer","handle_object","obj","do_action","set_value","current_element","Event","KeyboardEvent","trimStart","after","scrollIntoView","wait","disabled","disable_continue","availHeight","marginLeft","setInterval","make_variable_reference","author","j","family","given","year","journal","volume","fontStyle","version","doi","PageMenu","timeout","hide","has_toggler","toggler","side","top_menu","content_bounds","right","right_menu","bottom_menu","left_menu","content","trigger_resize","Page","menus","sources","origin","source_file","variable_filters","entity_filters","outer_right","render_credits","show_variable_info","load_screen","getElementById","wrap","navbar","panel","navcolor","hash","backgroundColor","hide_logo","hide_title","hide_navcontent","brand","nav","hide_panels","panels","init_panel","head","theme_dark","init_variable_info","init_filter","global_reset","close_menus","reverse","registered_inputs","marginTop","bw","ul","tags","set_description","unit","aggregation_method","citations","_references_parsed","reference","element","link","filter_select","filter_table","add_filter_condition","presets","select","Dataset","First","Last","heads","cells","format","checked","comp_select","selectedOptions","value_select","value_source","delete","credit_output","credits","li","InputVirtual","value_types","percent","minute","minutes","dollars","BaseOutput","tab","InfoPart","ref","show_summary","caller","color","summary_levels","endpoint","notification","effects","api","fv","navigator","clipboard","writeText","clear_storage","buttongroup","listen","up","down","off_default","min_ref","max_ref","default_min","default_max","radio","switch","checkbox","has_default","processed","parts","minHeight","show","revert","var","parse_variables","subto","fill_summary_table","viewFilter","ei","layers","overlays","fresh_shapes","has_time","by_time","triggers","vstate","cstate","reference_options","queue_init","mouseover","mouseout","show_overlay","dep","click_ref","clickto","overlays_from_measures","layer","L","featureGroup","displaying","control","setPosition","addOverlay","tileLayer","shapes","shape","mapId","maps","background_shapes","match_time","retrieve_layer","property_summaries","fs","fa","highlight_style","weight","polygon_outline","fillOpacity","setStyle","default_style","feature","id_property","map_time","background_top","background_polygon_outline","map_overlay","ys","parseInt","time_input","varc","_zoomAnimated","map_animations","skl","fg","cl","interactive","bringToBack","bringToFront","flyToBounds","getBounds","fitBounds","color_by_order","color_scale_center","ls","_layers","lsi","es","fillColor","get_color","callback","_raw","process_layer","callbacks","layerId","geoJSON","onEachFeature","pointToLayer","point","coords","circleMarker","props","propagatedFrom","_tooltip","bindTooltip","openTooltip","overlay_property_selectors","fill_overlay_properties_options","circle_property","prop_summary","eachLayer","setRadius","circle_radius","opacity","previous_span","traces","colorTime","pl","textfont","line","marker","hoverinfo","base_trace","trace","make_data_entry","Plotly","addTraces","deleteTraces","newPlot","layout","config","points","fullData","restyle","varx","vary","varcol","x_range","y_range","display_time","jump","fn","lim","trace_limit","show_empty_times","boxplots","iqr_box","box","upperfence","lowerfence","med","_","yaxis","xaxis","autorange","any_skipped","yinfo","log","dtick","react","total","yr","xr","dark_theme","getComputedStyle","font","modebar","paper_bgcolor","plot_bgcolor","bgcolor","_fullLayout","showgrid","gridcolor","borderColor","relayout","datatable","time_index","pending","rowIds","variable_header","variable_source","single_variable","render","row_time","wide","table_autoscroll","table_scroll_behavior","node","columns","$","DataTable","destroy","empty","nshowing","column","visible","selector","varstate","renderer","draw","cssRules","table_autosort","scroll","behavior","_DT_CellIndex","current_variable","scrollHeight","createHeader","appendRows","dn","entityId","col","legend","bins","lock","cooldown","integer","ticks","center","current_palette","scale","string","po","var_info","ep","pn","nc","refresh","odd","remake","prop","background","clientX","relatedTarget","prep","ki","has","registered_outputs","tree","lock_after","parsed_query","rule_conditions","dataLayer","poly_channel","ch","pos","coefs","pow","run_queue","rules","rule","us","drop_load_screen","new_display","selectionSubset","removeItem","reload","fire","refresh_conditions","is_view","is_global","dd","di","conditional","du","ri","utils.toggle_input","args","tracking","arguments","visibility","tutorial","uid","_n","which","pal","centered","fixed","stat","center_source","upper","bound_ref","value_range"],"mappings":"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","x_google_ignoreList":[0]}