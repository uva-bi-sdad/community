<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Performs a series of checks to see if data in a given repository can be ingested by a datacommons project."><title>Check Data Repositories — check_repository • community</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Check Data Repositories — check_repository"><meta property="og:description" content="Performs a series of checks to see if data in a given repository can be ingested by a datacommons project."><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">community</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.107</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/anti-patterns.html">Notes against anti-patterns in Site.R</a>
    <a class="dropdown-item" href="../articles/casestudy-arrests.html">Example - Illinois Arrests</a>
    <a class="dropdown-item" href="../articles/quickstart-site.html">Build a Data Site</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/uva-bi-sdad/community/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Check Data Repositories</h1>
      <small class="dont-index">Source: <a href="https://github.com/uva-bi-sdad/community/blob/HEAD/R/check_repository.R" class="external-link"><code>R/check_repository.R</code></a></small>
      <div class="d-none name"><code>check_repository.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs a series of checks to see if data in a given repository can be ingested by a datacommons project.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">check_repository</span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"."</span>, search_pattern <span class="op">=</span> <span class="st">"\\.csv(?:\\.[gbx]z2?)?$"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"value"</span>, value_name <span class="op">=</span> <span class="st">"measure"</span>, value_type <span class="op">=</span> <span class="st">"measure_type"</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"geoid"</span>, time <span class="op">=</span> <span class="st">"year"</span>, dataset <span class="op">=</span> <span class="st">"region_type"</span>,</span>
<span>  entity_info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region_type"</span>, <span class="st">"region_name"</span><span class="op">)</span>, check_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  attempt_repair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dir</dt>
<dd><p>Root directory of the data repository.</p></dd>


<dt>search_pattern</dt>
<dd><p>Regular expression used to search for data files.</p></dd>


<dt>value</dt>
<dd><p>Name of the column containing variable values.</p></dd>


<dt>value_name</dt>
<dd><p>Name of the column containing variable names.</p></dd>


<dt>value_type</dt>
<dd><p>Name of the column indicating the type of each value.</p></dd>


<dt>id</dt>
<dd><p>Column name of IDs that uniquely identify entities.</p></dd>


<dt>time</dt>
<dd><p>Column name of the variable representing time.</p></dd>


<dt>dataset</dt>
<dd><p>Column name used to separate data into sets (such as by region).</p></dd>


<dt>entity_info</dt>
<dd><p>A vector of variable names to go into making <code>entity_info.json</code>.</p></dd>


<dt>check_values</dt>
<dd><p>Logical; if <code>FALSE</code>, will skip value-based checks
(since these are loose heuristics and can be intensive on large files).</p></dd>


<dt>attempt_repair</dt>
<dd><p>Logical; if <code>TRUE</code>, will attempt to fix most warnings in data files.
Use with caution, as this will often remove rows (given <code>NA</code>s) and rewrite the file.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An invisible list of check results, in the form of paths to files and/or measure name.
These may include <strong>general</strong> entries:</p><ul><li><p><strong><code>info</code></strong> (always): All measurement information (<code>measure_info.json</code>) files found.</p></li>
<li><p><strong><code>data</code></strong> (always): All data files found.</p></li>
<li><p><strong><code>not_considered</code></strong>: Subset of data files that do not contain the minimal
columns (<code>id</code>, <code>value</code>, and <code>value_type</code>), and so are not checked further.</p></li>
</ul><p>or those relating to issues with <strong>measure information</strong> (see <code><a href="data_measure_info.html">data_measure_info</a></code>) files:</p><ul><li><p><strong><code>info_malformed</code></strong>: Files that are not in the expected format (a single object with
named entries for each measure), but can be converted automatically.</p></li>
<li><p><strong><code>info_incomplete</code></strong>: Measure entries that are missing some of the required fields.</p></li>
<li><p><strong><code>info_invalid</code></strong>: Files that could not be read in (probably because they do not contain valid JSON).</p></li>
<li><p><strong><code>info_refs_names</code></strong>: Files with a <code>_references</code> entry with no names
(where it should be a named list).</p></li>
<li><p><strong><code>info_refs_missing</code></strong>: Files with an entry in its <code>_references</code> entry that
is missing one or more required entries (<code>author</code>, <code>year</code>, and/or <code>title</code>).</p></li>
<li><p><strong><code>info_refs_*</code></strong>: Files with an entry in its <code>_references</code> entry that has an entry
(<code>*</code>) that is a list (where they should all be strings).</p></li>
<li><p><strong><code>info_refs_author_entry</code></strong>: Files with an entry in its <code>_references</code> entry that has an
<code>author</code> entry that is missing a <code>family</code> entry.</p></li>
<li><p><strong><code>info_source_missing</code></strong>: Measures with an entry in its <code>source</code> entry that is missing a
required entry (<code>name</code> and/or <code>date_accessed</code>).</p></li>
<li><p><strong><code>info_source_*</code></strong>: Measures with an entry (<code>*</code>) in its <code>source</code> entry that is a
list (where they should all be strings).</p></li>
<li><p><strong><code>info_citation</code></strong>: Measures with a <code>citation</code> entry that cannot be found in any
<code>_references</code> entries across measure info files within the repository.</p></li>
<li><p><strong><code>info_layer_source</code></strong>: Measures with an entry in its <code>layer</code> entry that is missing a
<code>source</code> entry.</p></li>
<li><p><strong><code>info_layer_source_url</code></strong>: Measures with an entry in its <code>layer</code> entry that has a list
<code>source</code> entry that is missing a <code>url</code> entry. <code>source</code> entries can either be a string containing a
URL, or a list with a <code>url</code> entry.</p></li>
<li><p><strong><code>info_layer_filter</code></strong>: Measures with an entry in its <code>layer</code> entry that has a <code>filter</code>
entry that is missing required entries (<code>feature</code>, <code>operator</code>, and/or <code>value</code>).</p></li>
</ul><p>or relating to data files with <strong>warnings</strong>:</p><ul><li><p><strong><code>warn_compressed</code></strong>: Files that do not have compression extensions
(<code>.gz</code>, <code>.bz2</code>, or <code>.xz</code>).</p></li>
<li><p><strong><code>warn_blank_colnames</code></strong>: Files with blank column names (often due to saving files with row names).</p></li>
<li><p><strong><code>warn_value_nas</code></strong>: Files that have <code>NA</code>s in their <code>value</code> columns; <code>NA</code>s here
are redundant with the tall format, and so, should be removed.</p></li>
<li><p><strong><code>warn_double_ints</code></strong>: Variable names that have an <code>int</code> type, but with values that have
remainders.</p></li>
<li><p><strong><code>warn_small_percents</code></strong>: Variable names that have a <code>percent</code> type, but that are all under
<code>1</code> (which are assumed to be raw proportions).</p></li>
<li><p><strong><code>warn_small_values</code></strong>: Variable names with many values (over 40%) that are under <code>.00001</code>, and
no values under <code>0</code> or over <code>1</code>. These values should be scaled in some way to be displayed reliably.</p></li>
<li><p><strong><code>warn_value_name_nas</code></strong>: Files that have <code>NA</code>s in their <code>name</code> column.</p></li>
<li><p><strong><code>warn_value_type_nas</code></strong>: Files that have <code>NA</code>s in their <code>name</code> column.</p></li>
<li><p><strong><code>warn_entity_info_nas</code></strong>: Files that have <code>NA</code>s in any of their <code>entity_info</code> columns.</p></li>
<li><p><strong><code>warn_dataset_nas</code></strong>: Files that have <code>NA</code>s in their <code>dataset</code> column.</p></li>
<li><p><strong><code>warn_time_nas</code></strong>: Files that have <code>NA</code>s in their <code>time</code> column.</p></li>
<li><p><strong><code>warn_id_nas</code></strong>: Files that have <code>NA</code>s in their <code>id</code> column.</p></li>
<li><p><strong><code>warn_scientific</code></strong>: Files with IDs that appear to have scientific notation (e.g., <code>1e+5</code>);
likely introduced when the ID column was converted from numbers to characters -- IDs should always be saved as
characters.</p></li>
<li><p><strong><code>warn_bg_agg</code></strong>: Files with IDs that appear to be census block group GEOIDs,
that do not include their tract parents (i.e., IDs consisting of 12 digits, and there are no IDs consisting of
their first 11 digits). These are automatically aggregated by <code><a href="site_build.html">site_build</a></code>, but they should
be manually aggregated.</p></li>
<li><p><strong><code>warn_tr_agg</code></strong>: Files with IDs that appear to be census tract GEOIDs,
that do not include their county parents (i.e., IDs consisting of 11 digits, and there are no IDs consisting of
their first 5 digits). These are automatically aggregated by <code><a href="site_build.html">site_build</a></code>, but they should
be manually aggregated.</p></li>
<li><p><strong><code>warn_missing_info</code></strong>: Measures in files that do not have a corresponding <code>measure_info.json</code>
entry. Sometimes this happens because the entry includes a prefix that cannot be derived from the file name
(which is the part after a year, such as <code>category</code> from <code>set_geo_2015_category.csv.xz</code>).
It is recommended that entries not include prefixes, and that measure names be specific
(e.g., <code>category_count</code> rather than <code>count</code> with a <code>category:count</code> entry).</p></li>
</ul><p>or relating to data files with <strong>failures</strong>:</p><ul><li><p><strong><code>fail_read</code></strong>: Files that could not be read in.</p></li>
<li><p><strong><code>fail_rows</code></strong>: Files containing no rows.</p></li>
<li><p><strong><code>fail_value_type</code></strong>: Files with no <code>value_type</code> column.</p></li>
<li><p><strong><code>fail_time</code></strong>: Files with no <code>time</code> column.</p></li>
<li><p><strong><code>fail_dataset</code></strong>: Files with no <code>dataset</code> column.</p></li>
<li><p><strong><code>fail_entity_info</code></strong>: Files with no <code>entity_info</code> columns.</p></li>
<li><p><strong><code>fail_idlen_county</code></strong>: Files with "county" <code>dataset</code>s with corresponding IDs
that are not consistently 5 characters long.</p></li>
<li><p><strong><code>fail_idlen_tract</code></strong>: Files with "tract" <code>dataset</code>s with corresponding IDs
that are not consistently 11 characters long.</p></li>
<li><p><strong><code>fail_idlen_block_group</code></strong>: Files with "block group" <code>dataset</code>s with corresponding IDs
that are not consistently 12 characters long.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># from a data repository</span></span></span>
<span class="r-in"><span><span class="fu">check_repository</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to automatically fix most warnings</span></span></span>
<span class="r-in"><span><span class="fu">check_repository</span><span class="op">(</span>attempt_repair <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://biocomplexity.virginia.edu/institute/divisions/social-and-decision-analytics" class="external-link">Biocomplexity Institute</a>, Micah Iserman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

